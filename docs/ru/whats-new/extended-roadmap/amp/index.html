










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="ru">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>Планы разработки ClickHouse 2020 | Документация ClickHouse</title>
    <link rel="canonical" href="https://clickhouse.tech/docs/ru/whats-new/extended-roadmap/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Планы разработки ClickHouse 2020 | Документация ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/ru/whats-new/extended-roadmap/",

"datePublished": "2019-11-18T22:10:48+03:00",
"dateModified": "2020-07-14T12:28:38+03:00",

"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Планы разработки ClickHouse 2020 | Документация ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}footer,header{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b{font-weight:bolder}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2.5rem}.h2,h2{font-size:2rem}.h3,h3{font-size:1.75rem}.h4,h4{font-size:1.5rem}.h5,h5{font-size:1.25rem}.h6,h6{font-size:1rem}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-auto,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-auto,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-auto{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}.offset-1{margin-left:8.333333%}.offset-2{margin-left:16.666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.333333%}.offset-5{margin-left:41.666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.333333%}.offset-8{margin-left:66.666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.333333%}.offset-11{margin-left:91.666667%}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.333333%}.offset-md-2{margin-left:16.666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.333333%}.offset-md-5{margin-left:41.666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.333333%}.offset-md-8{margin-left:66.666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.333333%}.offset-md-11{margin-left:91.666667%}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.333333%}.offset-lg-2{margin-left:16.666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.333333%}.offset-lg-5{margin-left:41.666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.333333%}.offset-lg-8{margin-left:66.666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.333333%}.offset-lg-11{margin-left:91.666667%}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-warning{background-color:#ffeeba}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:-ms-inline-flexbox;display:inline-flex;margin-right:1rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-left{float:left}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-left{float:left}.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-left{float:left}.float-lg-right{float:right}.float-lg-none{float:none}}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.fixed-top{position:fixed;top:0;right:0;left:0;z-index:1030}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.h-auto{height:auto}.m-0{margin:0}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.m-1{margin:.25rem}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.m-2{margin:.5rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.m-3{margin:1rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.m-4{margin:1.5rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.m-5{margin:3rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pr-0{padding-right:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pr-1{padding-right:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pr-2{padding-right:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pr-3{padding-right:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pr-4{padding-right:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pr-5{padding-right:3rem}.pb-5,.py-5{padding-bottom:3rem}.m-n1{margin:-.25rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.m-n2{margin:-.5rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.m-n3{margin:-1rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.m-n4{margin:-1.5rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.m-n5{margin:-3rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}.m-auto{margin:auto}.my-auto{margin-top:auto}.mr-auto{margin-right:auto}.mb-auto,.my-auto{margin-bottom:auto}@media(min-width:768px){.m-md-0{margin:0}.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.m-md-1{margin:.25rem}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.m-md-2{margin:.5rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.m-md-3{margin:1rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.m-md-4{margin:1.5rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.m-md-5{margin:3rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pr-md-0{padding-right:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pr-md-1{padding-right:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pr-md-2{padding-right:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pr-md-3{padding-right:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pr-md-4{padding-right:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pr-md-5{padding-right:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.m-md-n1{margin:-.25rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.m-md-n2{margin:-.5rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.m-md-n3{margin:-1rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.m-md-n4{margin:-1.5rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.m-md-n5{margin:-3rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}.m-md-auto{margin:auto}.my-md-auto{margin-top:auto}.mr-md-auto{margin-right:auto}.mb-md-auto,.my-md-auto{margin-bottom:auto}}@media(min-width:992px){.m-lg-0{margin:0}.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.m-lg-1{margin:.25rem}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.m-lg-2{margin:.5rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.m-lg-3{margin:1rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.m-lg-4{margin:1.5rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.m-lg-5{margin:3rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pr-lg-0{padding-right:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pr-lg-1{padding-right:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pr-lg-2{padding-right:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pr-lg-3{padding-right:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pr-lg-4{padding-right:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pr-lg-5{padding-right:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.m-lg-n1{margin:-.25rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.m-lg-n2{margin:-.5rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.m-lg-n3{margin:-1rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.m-lg-n4{margin:-1.5rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.m-lg-n5{margin:-3rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}.m-lg-auto{margin:auto}.my-lg-auto{margin-top:auto}.mr-lg-auto{margin-right:auto}.mb-lg-auto,.my-lg-auto{margin-bottom:auto}}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-left{text-align:left}.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-left{text-align:left}.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.headerlink{text-decoration:none;margin-left:.5rem}body[data-spy] #content{overflow-x:scroll}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#111;background:#eee}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body.blog,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .k{color:#815ba4}.syntax .n{color:#2f1e2e}.syntax .o{color:#5bc4bf}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .ld{color:#48b685}.syntax .m{color:#f99b15}.syntax .s{color:#48b685}.syntax .na{color:#06b6ef}.syntax .ne{color:#ef6155}.syntax .py{color:#2f1e2e}.syntax .s2{color:#48b685}.syntax .s1{color:#48b685}@media(prefers-color-scheme:dark){.syntax .k{color:#c78cff}.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .py{color:#f8f9fa}}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=plany-razrabotki-clickhouse-2020>Планы разработки ClickHouse 2020<a class=headerlink href=../amp/#plany-razrabotki-clickhouse-2020 title="Permanent link"> </a></h1><p>Здесь собраны важные задачи на 2020 год. Многие из них присутствуют в GitHub Issues. Данный текст следует рассматривать как рабочий черновик со сводкой и кратким описанием задач, ссылками и материалами для быстрого доступа на одной странице. Классификация задач условная.</p><p>Так как ClickHouse - open-source продукт, мы хотим, чтобы рабочий процесс был также максимально открытым. В связи с этим, вам следует ожидать наличия на данной странице несколько большего количества деталей описания рабочего процесса, чем вы могли бы предположить - настолько близко, насколько рабочий процесс видят разработчики. Так как неотъемлимой частью процесса разработки является исправление недостатков продукта и улучшение качества кода, на данной странице вы найдёте весьма подробные описания таких деталей. Для других open-source продуктов такой подход к разработке обычно нехарактерен. Благодаря тому, что для каждой задачи указаны её зависимости, вы сможете понять, какие подготовительные работы требуются, что позволяет более точно понимать сроки реализации.</p><h2 id=khranenie-dannykh-indeksatsiia>1. Хранение данных, индексация<a class=headerlink href=../amp/#khranenie-dannykh-indeksatsiia title="Permanent link"> </a></h2><h3 id=indeksy-po-z-order-curve-normalized-z-order-curve>1.1. Индексы по z-Order curve, normalized z-Order curve<a class=headerlink href=../amp/#indeksy-po-z-order-curve-normalized-z-order-curve title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/pull/6286 rel="external nofollow noreferrer" target=_blank>#6286</a></p><p>Задача также относится к категории «17. Работа с географическими данными», так как geoHash - это частный случай z-Order curve.<br> Также связана с задачей 24.27 для нечёткого поиска полудубликатов строк, так как позволит индексировать min-hash.<br> Задача «normalized z-Order curve» в перспективе может быть полезна для БК и Метрики, так как позволяет смешивать OrderID и PageID и избежать дублирования данных.<br> В задаче также вводится способ индексации путём обращения функции нескольких аргументов на интервале, что имеет смысл для дальнейшего развития.</p><p><a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>Андрей Чулков</a>, ВШЭ.</p><h3 id=wait-free-katalog-baz-dannykh>1.2. + Wait-free каталог баз данных<a class=headerlink href=../amp/#wait-free-katalog-baz-dannykh title="Permanent link"> </a></h3><p>Q2. Делает <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>Александр Токмаков</a>, первый рабочий вариант в декабре 2019. Нужно для DataLens и Яндекс.Метрики.</p><p>Манипуляции с каталогом баз данных: запросы CREATE TABLE, DROP TABLE, RENAME TABLE и DATABASE, требуют синхронизации с помощью блокировок. Эта синхронизация становится весьма сложной, так как на неё полагается много внутренних структур данных.</p><p>Предлагается реализовать альтернативный подход, в котором таблицы и базы данных являются всего лишь ссылками на persistent объекты. Подробное описание задачи: <a href=https://github.com/ClickHouse/ClickHouse/issues/6787 rel="external nofollow noreferrer" target=_blank>#6787</a></p><p>Upd. Сделана крупная часть задачи, но ориентироваться стоит уже на Q2.<br> Upd. Pull request готов для мержа.<br> Upd. Попало 20.4. Доступно под флагом allow_experimental_database_atomic.</p><h3 id=neblokiruiushchie-alter>1.3. + Неблокирующие ALTER<a class=headerlink href=../amp/#neblokiruiushchie-alter title="Permanent link"> </a></h3><p>Q1. И полностью immutable куски. Делает <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Готов приступить к задаче в конце ноября 2019. Нужно для Яндекс.Метрики.</p><p>Upd. Большая часть задачи реализована и добавлена в master. Есть незначительные технические долги. Остаётся реализация неблокирующего изменения метаданных таблицы.<br> Upd. Всё доделано, ожидается в релизе 20.6.</p><h3 id=netranzitivnye-alter-stolbtsov>1.4. + Нетранзитивные ALTER столбцов<a class=headerlink href=../amp/#netranzitivnye-alter-stolbtsov title="Permanent link"> </a></h3><p>Требует 1.3. Будет делать <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Ура, сделано.</p><h3 id=alter-rename-column>1.5. + ALTER RENAME COLUMN<a class=headerlink href=../amp/#alter-rename-column title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/6861 rel="external nofollow noreferrer" target=_blank>#6861</a></p><p>Требует 1.3. Будет делать <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>.</p><h3 id=polimorfnye-kuski-dannykh>1.6. + Полиморфные куски данных<a class=headerlink href=../amp/#polimorfnye-kuski-dannykh title="Permanent link"> </a></h3><p>Компактные куски - Q1, куски в оперативке Q1/Q2 - пункт 1.7.</p><p>Компактные куски реализованы, ещё не включены по-умолчанию. Первым шагом включаем по-умолчанию для системных таблиц.</p><p>Upd. Включено для системных таблиц.</p><p>Делает <a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Антон Попов</a>, первый рабочий вариант в декабре. Пререквизит чтобы снизить сложность мелких INSERT, что в свою очередь нужно для 1.12, иначе задача 1.12 не сможет нормально работать. Особенно нужно для Яндекс.Облака.</p><p>Данные в таблицах типа MergeTree в ClickHouse хранятся в виде набора независимых «кусков». Внутри куска, каждый столбец, а также индекс, хранится в отдельных файлах. Это сделано для возможности быстрых манипуляций со столбцами (пример - запрос ALTER DROP COLUMN). При вставке данных (INSERT), создаётся новый кусок. Для таблиц с большим количеством столбцов, запросы INSERT с маленьким количеством строк являются неэффективными, так как требуют создания большого количества файлов в файловой системе. Это является врождённой особенностью ClickHouse - одной из первой проблем, с которыми сталкиваются пользователи. Пользователям приходится буферизовывать данные и собирать их в более крупные пачки перед вставкой в ClickHouse.</p><p>Для смягчения эффекта от этой проблемы, в ClickHouse существуют таблицы типа Buffer. Они накапливают данные в оперативке перед записью в другую таблицу. Впрочем, таблицы Buffer не являются полноценным решением проблемы из-за: - наличия блокировок при вставке; - переупорядочивание вставляемых данных; - неатомарность перекладывания данных из Buffer в результирующую таблицу.</p><p>Вместо этого предлагается разрешить кускам таблиц типа MergeTree располагать данные в разных форматах. А именно: - в оперативной памяти; - на диске со всеми столбцами в одном файле; - на диске со столбцами в отдельных файлах: в зависимости от размера куска и прошедшего времени. Для размещения кусков в оперативной памяти, придётся также реализовать опциональную поддержку write-ahead log с настраиваемыми правилами по сбросу на диск. Это позволит избавиться от проблем с мелкими вставками для MergeTree таблиц. Для ReplicatedMergeTree таблиц, это решит проблему лишь частично.</p><h3 id=buferizatsiia-i-wal-v-mergetree>1.7. + Буферизация и WAL в MergeTree<a class=headerlink href=../amp/#buferizatsiia-i-wal-v-mergetree title="Permanent link"> </a></h3><p>Требует 1.6. Антон Попов. Задача взята в работу. Q2.<br> Есть pull request.<br> Upd. В стадии код-ревью.<br> Upd. Готово для использования начиная с версии 20.6 в экспериментальном режиме.</p><h3 id=perenos-mezhdu-razdelami-po-ttl>1.8. + Перенос между разделами по TTL<a class=headerlink href=../amp/#perenos-mezhdu-razdelami-po-ttl title="Permanent link"> </a></h3><p>Делает <a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Владимир Чеботарёв</a>, Altinity. Декабрь 2019.</p><p>Q1. Закоммичено, но есть технический долг, который исправляется сейчас.<br> Готово. Нет, не готово - там всё ещё технический долг.</p><h3 id=ispolzovanie-ttl-dlia-prorezhivaniia-dannykh>1.9. + Использование TTL для прореживания данных<a class=headerlink href=../amp/#ispolzovanie-ttl-dlia-prorezhivaniia-dannykh title="Permanent link"> </a></h3><p>Будет делать Сорокин Николай, ВШЭ и Яндекс.<br> Upd. Есть pull request. Upd. Сделано.</p><p>Сейчас пользователь может задать в таблице выражение, которое определяет, сколько времени хранятся данные. Обычно это выражение задаётся относительно значения столбца с датой - например: удалять данные через три месяца. <a href=https://clickhouse.tech/docs/ru/operations/table_engines/mergetree/ target=_blank>https://clickhouse.tech/docs/ru/operations/table_engines/mergetree/</a>#table_engine-mergetree-ttl</p><p>Это может быть задано для всей таблицы (тогда строки целиком удаляются после указанного времени) или для отдельных столбцов (тогда данные столбца физически удаляются с диска, а строки в таблице остаются; при чтении значений столбца, они читаются как значения по-умолчанию).</p><p>Но пользователи также хотят более продвинутый вариант этой функциональности: не удалять строки или столбцы целиком, а прореживать их - оставлять меньшее количество строк.</p><p>И тут есть несколько вариантов:<br> 1. По прошествии времени, оставлять каждую N-ую строку.<br> 2. По прошествии времени, выполнять агрегацию данных, заменяя значения некоторых столбцов на значения агрегатных функций от множества значений в нескольких строках.</p><p>Пункт 1 не представляет интереса, так как уже реализован с помощью TTL выражений для удаления данных. В качестве этого выражения можно прописать, например, <code class=syntax>cityHash64(*) % 10 = 0 ? now() : event_time + INTERVAL 3 MONTH</code>. Правда как-то неудобно получается.</p><p>А вот пункт 2 требуется продумать. Не очевидно даже, какой лучше использовать синтаксис для этого при создании таблицы. Но мы придумаем - сразу видно несколько вариантов.</p><p>Частный случай такой задачи уже есть в <a href=https://clickhouse.tech/docs/ru/operations/table_engines/graphitemergetree/ target=_blank>https://clickhouse.tech/docs/ru/operations/table_engines/graphitemergetree/</a> Но это было сделано для конкретной задачи. А надо обобщить.</p><h3 id=perezhatie-starykh-dannykh-v-fone>1.10. Пережатие старых данных в фоне<a class=headerlink href=../amp/#perezhatie-starykh-dannykh-v-fone title="Permanent link"> </a></h3><p>Будет делать Кирилл Барухов, ВШЭ, экспериментальная реализация к весне 2020. Нужно для Яндекс.Метрики.</p><p>Алгоритмы сжатия типа LZ77 позволяют потратить больше времени на сжатие данных, чтобы сжать данные сильнее, но при этом без проигрыша по скорости разжатия данных. В частности, этим свойством обладает LZ4 и ZSTD, которые используются в ClickHouse. Это позволяет использовать свободные ресурсы CPU, когда сервер не нагружен, для пережатия данных, чтобы данные занимали меньше места на дисках, и при этом сохранить или даже улучшить скорость обработки запросов.</p><p>В то же время, ClickHouse обычно используется для «импульсного» сценария нагрузки. Запрос от пользователя обрабатывается максимально быстро, используя все ресурсы CPU, но в среднем по времени, сервер недостаточно нагружен.</p><p>Предлагается добавить в ClickHouse настройки по пережатию данных и фоновые потоки, выполняющие эту задачу.</p><p>Upd. Представлен прототип неизвестной степени готовности.</p><h3 id=virtualnaia-failovaia-sistema>1.11. + Виртуальная файловая система<a class=headerlink href=../amp/#virtualnaia-failovaia-sistema title="Permanent link"> </a></h3><p>На VFS переведены Log, TinyLog, StripeLog, а также MergeTree, что доказывает состоятельность реализации.</p><p>Нужно для Яндекс.Облака. Делает Александр, Яндекс.Облако.</p><p>ClickHouse использует для хранения данных локальную файловую систему. Существует сценарий работы, в котором размещение старых (архивных) данных было бы выгодно на удалённой файловой системе. Если файловая система POSIX совместимая, то это не составляет проблем: ClickHouse успешно работает с Ceph, GlusterFS, MooseFS. Также востребованным является сценарий использования S3 (из-за доступности в облаке) или HDFS (для интеграции с Hadoop). Но эти файловые системы не являются POSIX совместимыми. Хотя для них существуют FUSE драйверы, но скорость работы сильно страдает и поддержка неполная.</p><p>ClickHouse использует небольшое подмножество функций ФС, но в то же время, и некоторые специфические части: симлинки и хардлинки, O_DIRECT. Предлагается выделить всё взаимодействие с файловой системой в отдельный интерфейс.</p><h3 id=eksperimentalnaia-realizatsiia-vfs-poverkh-s3-i-hdfs>1.12. Экспериментальная реализация VFS поверх S3 и HDFS<a class=headerlink href=../amp/#eksperimentalnaia-realizatsiia-vfs-poverkh-s3-i-hdfs title="Permanent link"> </a></h3><p>Q4.</p><p>Нужно для Яндекс.Облака. Требует 1.11. Желательно 1.6 и 1.18.<br> Делает Александр, Яндекс.Облако (сначала часть для S3), а также Олег Ершов, ВШЭ и Яндекс.</p><p>Upd. Олег будет делать только часть про HDFS.<br> Upd. Реализация поверх S3 является рабочей на уровне PoC.<br> Upd. Реализация поверх S3 ужасно тормозит и сейчас доделывается.<br> Upd. Реализацию поверх HDFS взял AmosBird для Kuaishou.</p><h3 id=uskorenie-zaprosov-s-final>1.13. + Ускорение запросов с FINAL<a class=headerlink href=../amp/#uskorenie-zaprosov-s-final title="Permanent link"> </a></h3><p>Требует 2.1. Делает <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>. Нужно для Яндекс.Метрики. Q2.<br> Upd: PR <a href=https://github.com/ClickHouse/ClickHouse/pull/10463 rel="external nofollow noreferrer" target=_blank>#10463</a></p><h3 id=ne-pisat-stolbtsy-polnostiu-sostoiashchie-iz-nulei>1.14. Не писать столбцы, полностью состоящие из нулей<a class=headerlink href=../amp/#ne-pisat-stolbtsy-polnostiu-sostoiashchie-iz-nulei title="Permanent link"> </a></h3><p>Антон Попов. Q3.<br> В очереди. Простая задача, является небольшим пререквизитом для потенциальной поддержки полуструктурированных данных.</p><h3 id=vozmozhnost-imet-raznyi-pervichnyi-kliuch-v-raznykh-kuskakh>1.15. Возможность иметь разный первичный ключ в разных кусках<a class=headerlink href=../amp/#vozmozhnost-imet-raznyi-pervichnyi-kliuch-v-raznykh-kuskakh title="Permanent link"> </a></h3><p>Сложная задача, только после 1.3.<br> Upd. В обсуждении.</p><h3 id=neskolko-fizicheskikh-predstavlenii-dlia-odnogo-kuska-dannykh>1.16. Несколько физических представлений для одного куска данных<a class=headerlink href=../amp/#neskolko-fizicheskikh-predstavlenii-dlia-odnogo-kuska-dannykh title="Permanent link"> </a></h3><p>Сложная задача, только после 1.3 и 1.6. Позволяет компенсировать 21.20.<br> Upd. В обсуждении.</p><h3 id=neskolko-sortirovok-dlia-odnoi-tablitsy>1.17. Несколько сортировок для одной таблицы<a class=headerlink href=../amp/#neskolko-sortirovok-dlia-odnoi-tablitsy title="Permanent link"> </a></h3><p>Сложная задача, только после 1.3 и 1.6.<br> Upd. В обсуждении.</p><h3 id=otdelnoe-khranenie-failov-kuskov>1.18. Отдельное хранение файлов кусков<a class=headerlink href=../amp/#otdelnoe-khranenie-failov-kuskov title="Permanent link"> </a></h3><p>Требует 1.3 и 1.6. Полная замена hard links на sym links, что будет лучше для 1.12.</p><h2 id=krupnye-refaktoringi>2. Крупные рефакторинги<a class=headerlink href=../amp/#krupnye-refaktoringi title="Permanent link"> </a></h2><p>Для обоснования необходимости смотрите ссылки в описании других задач.</p><h3 id=peredelka-konveiera-vypolneniia-zaprosov-na-processors>2.1. + Переделка конвейера выполнения запросов на Processors<a class=headerlink href=../amp/#peredelka-konveiera-vypolneniia-zaprosov-na-processors title="Permanent link"> </a></h3><p>Делает <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>. Финальная стадия разработки. Включение по-умолчанию в конце декабря 2019. Удаление старого кода в начале 2020.</p><p>Upd. На данный момент исправляются проблемы с регрессиями производительности в отдельных случаях. Кажется, что все проблемы исправлены.<br> Включение по-умолчанию в Q1, но остаётся вторая часть задачи по корректному выделению async части.</p><p>Upd. Включили по-умолчанию. Удаление старого кода не раньше, чем после первого релиза, в котором это включено по-умолчанию и всё ещё можно выключить обратно.</p><p>Upd. Уже есть первый релиз, в котором это включено по-умолчанию.</p><p>Upd. Всё ещё ждём удаление старого кода, которое должно случиться после релиза 20.4.</p><p>Upd. Старый код по большей части удалён.</p><h3 id=infrastruktura-sobytiimetrikogranicheniikvottrassirovki>2.2. Инфраструктура событий/метрик/ограничений/квот/трассировки<a class=headerlink href=../amp/#infrastruktura-sobytiimetrikogranicheniikvottrassirovki title="Permanent link"> </a></h3><p>В очереди. <a href=https://gist.github.com/alexey-milovidov/d62d73222d83b9319dc519cbb13aeff6 target=_blank>https://gist.github.com/alexey-milovidov/d62d73222d83b9319dc519cbb13aeff6</a></p><h3 id=perenos-stolbtsovogo-serde-iz-datatype-v-column>2.3. Перенос столбцового ser/de из DataType в Column<a class=headerlink href=../amp/#perenos-stolbtsovogo-serde-iz-datatype-v-column title="Permanent link"> </a></h3><p>В очереди. Антон Попов.</p><h3 id=perevod-lowcardinality-iz-datatype-v-column-dobavlenie-columnsparse>2.4. Перевод LowCardinality из DataType в Column. Добавление ColumnSparse<a class=headerlink href=../amp/#perevod-lowcardinality-iz-datatype-v-column-dobavlenie-columnsparse title="Permanent link"> </a></h3><p>Требует 2.3.</p><h3 id=versionirovanie-sostoianii-agregatnykh-funktsii>2.5. Версионирование состояний агрегатных функций<a class=headerlink href=../amp/#versionirovanie-sostoianii-agregatnykh-funktsii title="Permanent link"> </a></h3><p>В очереди.</p><h3 id=pravaia-chast-in-kak-tip-dannykh-vypolnenie-in-v-vide-skaliarnogo-podzaprosa>2.6. Правая часть IN как тип данных. Выполнение IN в виде скалярного подзапроса<a class=headerlink href=../amp/#pravaia-chast-in-kak-tip-dannykh-vypolnenie-in-v-vide-skaliarnogo-podzaprosa title="Permanent link"> </a></h3><p>Требует 2.1.</p><h3 id=normalizatsiia-context>2.7. Нормализация Context<a class=headerlink href=../amp/#normalizatsiia-context title="Permanent link"> </a></h3><p>В очереди. Нужно для YQL.</p><p>Александр Токмаков исправил множество проблем с использованием Context и сейчас переносит каталог БД наружу.</p><p>Upd. Каталог БД вынесен из Context.<br> Upd. SharedContext вынесен из Context.<br> Upd. Проблема нейтрализована и перестала быть актуальной.</p><h3 id=deklarativnyi-parser-zaprosov>2.8. Декларативный парсер запросов<a class=headerlink href=../amp/#deklarativnyi-parser-zaprosov title="Permanent link"> </a></h3><p>Средний приоритет. Нужно для YQL.</p><p>Upd. В очереди. Иван Лежанкин.</p><h3 id=loggirovnie-v-format-stile>2.9. + Логгировние в format-стиле<a class=headerlink href=../amp/#loggirovnie-v-format-stile title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/6049#issuecomment-570836998 rel="external nofollow noreferrer" target=_blank>#6049</a></p><p>Сделано.</p><h3 id=zaprashivat-u-tablits-ne-stolbtsy-a-srezy>2.10. Запрашивать у таблиц не столбцы, а срезы<a class=headerlink href=../amp/#zaprashivat-u-tablits-ne-stolbtsy-a-srezy title="Permanent link"> </a></h3><p>В очереди.</p><h3 id=razbiratelstvo-i-normalizatsiia-funktsionalnosti-dlia-bitmap>2.11. Разбирательство и нормализация функциональности для bitmap<a class=headerlink href=../amp/#razbiratelstvo-i-normalizatsiia-funktsionalnosti-dlia-bitmap title="Permanent link"> </a></h3><p>В очереди.</p><h3 id=deklarativnye-signatury-funktsii>2.12. Декларативные сигнатуры функций<a class=headerlink href=../amp/#deklarativnye-signatury-funktsii title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/pull/3775 rel="external nofollow noreferrer" target=_blank>#3775</a></p><p>Задачу делает Алексей Миловидов. Прогресс 50% и разработка временно приостановлена.</p><p>Upd. Разработка всё ещё приостановлена.</p><h3 id=kazhdaia-funktsiia-v-otdelnom-faile>2.13. Каждая функция в отдельном файле<a class=headerlink href=../amp/#kazhdaia-funktsiia-v-otdelnom-faile title="Permanent link"> </a></h3><p>Задачу делает Алексей Миловидов. Прогресс 80%. Потребуется помощь других разработчиков.</p><p>Upd. Поползновения наблюдаются.</p><h3 id=vse-funktsii-s-sostoianiem-peredelat-na-functionbuilder>2.14. Все функции с состоянием переделать на FunctionBuilder<a class=headerlink href=../amp/#vse-funktsii-s-sostoianiem-peredelat-na-functionbuilder title="Permanent link"> </a></h3><p>Долг <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>. Сейчас код находится в переходном состоянии, что неприемлемо.</p><h3 id=funktsiia-subscribe-dlia-istorage>2.15. Функция subscribe для IStorage<a class=headerlink href=../amp/#funktsiia-subscribe-dlia-istorage title="Permanent link"> </a></h3><p>Для нормализации работы materialized views поверх Merge, Distributed, Kafka.</p><h2 id=dokumentatsiia>3. Документация<a class=headerlink href=../amp/#dokumentatsiia title="Permanent link"> </a></h2><p>Здесь задачи только по инфраструктуре документации.</p><h3 id=perenos-dokumentatsii-po-funktsiiam-v-kod>3.1. Перенос документации по функциям в код<a class=headerlink href=../amp/#perenos-dokumentatsii-po-funktsiiam-v-kod title="Permanent link"> </a></h3><p>Требует 2.12 и 2.13. Хотим в Q2, средний приоритет.</p><h3 id=perenos-odnorodnykh-chastei-dokumentatsii-v-kod>3.2. Перенос однородных частей документации в код<a class=headerlink href=../amp/#perenos-odnorodnykh-chastei-dokumentatsii-v-kod title="Permanent link"> </a></h3><p>Требует 3.1.</p><h3 id=ispravit-katastroficheski-otvratitelno-nepriemlemyi-poisk-po-dokumentatsii>+ 3.3. Исправить катастрофически отвратительно неприемлемый поиск по документации<a class=headerlink href=../amp/#ispravit-katastroficheski-otvratitelno-nepriemlemyi-poisk-po-dokumentatsii title="Permanent link"> </a></h3><p><a href=https://github.com/blinkov/ rel="external nofollow noreferrer" target=_blank>Иван Блинков</a> - очень хороший человек. Сам сайт документации основан на технологиях, не удовлетворяющих требованиям задачи, и эти технологии трудно исправить. Задачу будет делать первый встретившийся нам frontend разработчик, которого мы сможем заставить это сделать.</p><p>Upd. Иван Блинков сделал эту задачу путём замены треш-технологий на нормальные.</p><h3 id=dobavit-iaponskii-iazyk-v-dokumentatsiiu>3.4. + Добавить японский язык в документацию<a class=headerlink href=../amp/#dobavit-iaponskii-iazyk-v-dokumentatsiiu title="Permanent link"> </a></h3><p>Эту задачу сделает <a href=https://github.com/blinkov/ rel="external nofollow noreferrer" target=_blank>Иван Блинков</a>, до конца декабря 2019. Сделано.</p><h2 id=setevoe-vzaimodeistvie>4. Сетевое взаимодействие<a class=headerlink href=../amp/#setevoe-vzaimodeistvie title="Permanent link"> </a></h2><h3 id=umenshenie-chisla-potokov-pri-raspredelionnykh-zaprosakh>4.1. Уменьшение числа потоков при распределённых запросах<a class=headerlink href=../amp/#umenshenie-chisla-potokov-pri-raspredelionnykh-zaprosakh title="Permanent link"> </a></h3><p>Весна 2020. Upd. Есть прототип. Upd. Он не работает. Upd. Человек отказался от задачи, теперь сроки не определены.</p><h3 id=spekuliativnoe-vypolnenie-zaprosov-na-neskolkikh-replikakh>4.2. Спекулятивное выполнение запросов на нескольких репликах<a class=headerlink href=../amp/#spekuliativnoe-vypolnenie-zaprosov-na-neskolkikh-replikakh title="Permanent link"> </a></h3><p>Нужно для Яндекс.Метрики. Требует 4.1.</p><p>Если распределённый запрос затрагивает большое количество серверов, то время выполнения запросов часто становится большим из-за tail latencies - случайных редких замедлений отдельных серверов. Эту проблему можно избежать, отправляя один и тот же запрос сразу на несколько реплик, и используя данные с наиболее быстрой.</p><p>Задача скрывает в себе много тонкостей, связанных с обработкой стадий выполнения запроса (соединение, обмен handshake, отправка запроса, получение заголовка результата, получение пакетов прогресса, получение данных), правильной возможностью настройки таймаутов, правильной отменой запросов.</p><p>Сейчас для распределённых запросов используется по потоку на соединение. Это позволяет хорошо распараллелить вычисления над полученными данными и утилизировать сеть, но становится сильно избыточным для больших кластеров. Для примера, создание 1000 потоков для чтения данных из 1000 серверов кластера - лишь расходует ресурсы и увеличивает время выполнения запроса. Вместо этого необходимо использовать количество потоков не большее количества процессорных ядер, и мультиплексировать в одном потоке общение с серверами. Реализация нетривиальна, так как мультиплексировать необходимо каждую стадию общения по сети, включая установку соединения и обмен handshake.</p><p>Upd. Сейчас обсуждается, как сделать другую задачу вместо этой.</p><h3 id=ogranichenie-chisla-odnovremennykh-skachivanii-s-replik>4.3. Ограничение числа одновременных скачиваний с реплик<a class=headerlink href=../amp/#ogranichenie-chisla-odnovremennykh-skachivanii-s-replik title="Permanent link"> </a></h3><p>Изначально делал Олег Алексеенков, но пока решение не готово, хотя там не так уж много доделывать.</p><h3 id=ogranichenie-setevoi-polosy-pri-replikatsii>4.4. Ограничение сетевой полосы при репликации<a class=headerlink href=../amp/#ogranichenie-setevoi-polosy-pri-replikatsii title="Permanent link"> </a></h3><p>Нужно для Метрики.</p><h3 id=vozmozhnost-prodolzhit-peredachu-kuska-dannykh-pri-replikatsii-posle-sboia>4.5. Возможность продолжить передачу куска данных при репликации после сбоя<a class=headerlink href=../amp/#vozmozhnost-prodolzhit-peredachu-kuska-dannykh-pri-replikatsii-posle-sboia title="Permanent link"> </a></h3><h3 id=p2p-peredacha-dlia-global-podzaprosov>4.6. p2p передача для GLOBAL подзапросов<a class=headerlink href=../amp/#p2p-peredacha-dlia-global-podzaprosov title="Permanent link"> </a></h3><h3 id=lenivaia-zagruzka-mnozhestv-dlia-in-i-join-s-pomoshchiu-kv-zaprosov>4.7. Ленивая загрузка множеств для IN и JOIN с помощью k/v запросов<a class=headerlink href=../amp/#lenivaia-zagruzka-mnozhestv-dlia-in-i-join-s-pomoshchiu-kv-zaprosov title="Permanent link"> </a></h3><h3 id=razdelit-background-pool-dlia-fetch-i-merge>4.8. Разделить background pool для fetch и merge<a class=headerlink href=../amp/#razdelit-background-pool-dlia-fetch-i-merge title="Permanent link"> </a></h3><p>В очереди. Исправить проблему, что восстанавливающаяся реплика перестаёт мержить. Частично компенсируется 4.3.<br> Александр Казаков.</p><h2 id=operatsii>5. Операции<a class=headerlink href=../amp/#operatsii title="Permanent link"> </a></h2><h3 id=razdelenie-zadach-na-bolee-melkie-kuski-v-clickhouse-copier>5.1. + Разделение задач на более мелкие куски в clickhouse-copier<a class=headerlink href=../amp/#razdelenie-zadach-na-bolee-melkie-kuski-v-clickhouse-copier title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/pull/9075 rel="external nofollow noreferrer" target=_blank>#9075</a><br> Q1. Нужно для Метрики, в очереди. Никита Михайлов.</p><p>Upd. Задача на финальной стадии разработки.<br> Upd. Сделано. Эффективность работы под вопросом. Есть варианты, как сделать лучше.</p><h3 id=avtonastroika-limita-na-operativku-i-razmera-keshei>5.2. + Автонастройка лимита на оперативку и размера кэшей<a class=headerlink href=../amp/#avtonastroika-limita-na-operativku-i-razmera-keshei title="Permanent link"> </a></h3><h3 id=vstroennaia-ruchka-dlia-prometheus>5.3. + Встроенная ручка для Prometheus<a class=headerlink href=../amp/#vstroennaia-ruchka-dlia-prometheus title="Permanent link"> </a></h3><p>Сделано. <a href=https://github.com/Vdimir target=_blank>https://github.com/Vdimir</a></p><h3 id=opt-in-soobshchat-v-kliente-esli-vyshla-novaia-versiia>5.4. Opt-in сообщать в клиенте, если вышла новая версия<a class=headerlink href=../amp/#opt-in-soobshchat-v-kliente-esli-vyshla-novaia-versiia title="Permanent link"> </a></h3><p>Есть поползновения.</p><h3 id=lts-relizy>5.5. + LTS релизы<a class=headerlink href=../amp/#lts-relizy title="Permanent link"> </a></h3><p>Требует 7.5. Задачу хочет Метрика, Облако, БК, Маркет и Altinity. Первой LTS версией уже стала версия 19.14.<br> Метрика, БК, Маркет, Altinity уже используют более свежие версии чем LTS.<br> Upd. Появилась вторая версия LTS - 20.3.</p><h2 id=instrumentirovanie>6. Инструментирование<a class=headerlink href=../amp/#instrumentirovanie title="Permanent link"> </a></h2><h3 id=ispravleniia-sempliruiushchego-profailera-zaprosov>6.1. + Исправления сэмплирующего профайлера запросов<a class=headerlink href=../amp/#ispravleniia-sempliruiushchego-profailera-zaprosov title="Permanent link"> </a></h3><p>Михаил Филимонов, Altinity. Ноябрь 2019. Сделано.<br> Осталось ещё проверить работоспособность профайлера в первом потоке (что важно для INSERT). Иван Лежанкин. Q1. Сделано.</p><h3 id=dobavlenie-memory-profiler>6.2. + Добавление memory profiler<a class=headerlink href=../amp/#dobavlenie-memory-profiler title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/6387 rel="external nofollow noreferrer" target=_blank>#6387</a></p><p>Сравнительно простая задача, но только для опытных разработчиков. Нужна всем. Иван Лежанкин. Q1. Сделано.</p><h3 id=uchiot-operativki-total-rasshirit-ne-tolko-na-zaprosy>6.3. + Учёт оперативки total расширить не только на запросы<a class=headerlink href=../amp/#uchiot-operativki-total-rasshirit-ne-tolko-na-zaprosy title="Permanent link"> </a></h3><p>Исправление долгоживущей проблемы с дрифтом учёта оперативки. Нужна для Метрики и БК.</p><h3 id=podderzhka-perf-events-kak-metrik-zaprosa>6.4. + Поддержка perf events как метрик запроса<a class=headerlink href=../amp/#podderzhka-perf-events-kak-metrik-zaprosa title="Permanent link"> </a></h3><p>Делает Андрей Скобцов, ВШЭ.</p><p>В Linux существует возможность получать в программе информацию о счётчиках производительности и событиях, относящихся к CPU и ядру ОС. Подробнее смотрите <code class=syntax>man perf_event_open</code>. Предлагается добавить эти метрики в ClickHouse для инструментирования запросов.</p><p>Есть прототип. <br> Сделано.</p><h3 id=eksperimenty-s-llvm-x-ray>6.5. Эксперименты с LLVM X-Ray<a class=headerlink href=../amp/#eksperimenty-s-llvm-x-ray title="Permanent link"> </a></h3><p>Требует 2.2.</p><h3 id=stek-treis-dlia-liubykh-iskliuchenii>6.6. + Стек трейс для любых исключений<a class=headerlink href=../amp/#stek-treis-dlia-liubykh-iskliuchenii title="Permanent link"> </a></h3><p>Сейчас есть стек трейс для почти всех, но не всех исключений. Требует 7.4.</p><h3 id=tablitsa-system-stack-trace>6.7. + Таблица system.stack_trace<a class=headerlink href=../amp/#tablitsa-system-stack-trace title="Permanent link"> </a></h3><p>Сравнительно простая задача, но только для опытных разработчиков.</p><h3 id=tablitsa-system-crashes>6.8. Таблица system.crashes<a class=headerlink href=../amp/#tablitsa-system-crashes title="Permanent link"> </a></h3><p>Сравнительно простая задача, но только для опытных разработчиков.<br> Upd. В разработке.</p><h3 id=otpravliat-informatsiiu-klientu-esli-server-padaet-po-signalu>6.9. + Отправлять информацию клиенту, если сервер падает по сигналу<a class=headerlink href=../amp/#otpravliat-informatsiiu-klientu-esli-server-padaet-po-signalu title="Permanent link"> </a></h3><p>Сделано.</p><h3 id=sbor-obshchikh-sistemnykh-metrik>6.10. Сбор общих системных метрик<a class=headerlink href=../amp/#sbor-obshchikh-sistemnykh-metrik title="Permanent link"> </a></h3><h2 id=soprovozhdenie-razrabotki>7. Сопровождение разработки<a class=headerlink href=../amp/#soprovozhdenie-razrabotki title="Permanent link"> </a></h2><h3 id=icu-v-submodules>7.1. + ICU в submodules<a class=headerlink href=../amp/#icu-v-submodules title="Permanent link"> </a></h3><p>Добавление в submodules также нужно для Аркадии (7.26).</p><h3 id=llvm-v-submodules>7.2. + LLVM в submodules<a class=headerlink href=../amp/#llvm-v-submodules title="Permanent link"> </a></h3><p>Сделал Алексей Миловидов.</p><h3 id=obnovlenie-poco>7.3. + Обновление Poco<a class=headerlink href=../amp/#obnovlenie-poco title="Permanent link"> </a></h3><p>Алексанр Кузьменков.</p><h3 id=vkliuchit-libc-libc-abi-pri-sborke-s-gcc>7.4. + Включить libc++, libc++-abi при сборке с gcc<a class=headerlink href=../amp/#vkliuchit-libc-libc-abi-pri-sborke-s-gcc title="Permanent link"> </a></h3><p>Сейчас включено только при сборке с clang, но продакшен сборка использует gcc.<br> Требует 7.2 и, возможно, 7.1 (только в случае новой версии ICU).</p><h3 id=nachat-publikovat-lts-relizy>7.5. + Начать публиковать LTS релизы<a class=headerlink href=../amp/#nachat-publikovat-lts-relizy title="Permanent link"> </a></h3><p><a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>.</p><h3 id=pravilnyi-statisticheskii-test-dlia-comparison-mode-v-clickhouse-performance-test>7.6. + Правильный статистический тест для comparison mode в clickhouse-performance-test<a class=headerlink href=../amp/#pravilnyi-statisticheskii-test-dlia-comparison-mode-v-clickhouse-performance-test title="Permanent link"> </a></h3><p>Задачу начал делать Дмитрий Рубашкин (ВШЭ). Сейчас продолжает <a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Александр Кузьменков</a>. Сделано, работает в CI. Долгое время не были определены надёжные критерии для результата теста. Сейчас проблема решена, но остались не решёнными некоторые вопросы.</p><h3 id=dodelat-testy-pod-msan>7.7. + Доделать тесты под MSan<a class=headerlink href=../amp/#dodelat-testy-pod-msan title="Permanent link"> </a></h3><p>Уже есть ASan, TSan, UBSan. Не хватает тестов под MSan. Они уже добавлены в CI, но не проходят.<br><a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Александр Кузьменков</a> и <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>Александр Токмаков</a>.</p><p>Upd. Задача всё ещё медленно тащится.<br> Upd. Доделал Алексей Миловидов.</p><h3 id=dobavit-clang-tidy>7.8. + Добавить clang-tidy<a class=headerlink href=../amp/#dobavit-clang-tidy title="Permanent link"> </a></h3><p>Уже есть PVS-Studio. Мы очень довольны, но этого недостаточно.</p><p>Upd. Алексей Миловидов. Добавлено некоторое множество проверок, но нужно рассмотреть все проверки подряд и добавить всё, что можно.<br> Upd. Рассмотрели все проверки подряд.</p><h3 id=proverki-na-stil-imion-s-pomoshchiu-clang-tidy>7.9. + Проверки на стиль имён с помощью clang-tidy<a class=headerlink href=../amp/#proverki-na-stil-imion-s-pomoshchiu-clang-tidy title="Permanent link"> </a></h3><p>Сделано. Только в .cpp файлах и только для имён локальных переменных. Остальное слишком сложно.</p><h3 id=vkliuchenie-ubsan-i-msan-v-integratsionnykh-testakh>7.10. Включение UBSan и MSan в интеграционных тестах<a class=headerlink href=../amp/#vkliuchenie-ubsan-i-msan-v-integratsionnykh-testakh title="Permanent link"> </a></h3><p>UBSan включен в функциональных тестах, но не включен в интеграционных тестах. Требует 7.7.</p><h3 id=vkliuchenie-san-v-unit-testakh>7.11. + Включение *San в unit тестах<a class=headerlink href=../amp/#vkliuchenie-san-v-unit-testakh title="Permanent link"> </a></h3><p>У нас мало unit тестов по сравнению с функциональными тестами и их использование не обязательно. Но они всё-равно важны и нет причин не запускать их под всеми видами sanitizers.</p><p>Илья Яцишин. Сделано.</p><h3 id=pokazyvat-testovoe-pokrytie-novogo-koda-v-pr>7.12. Показывать тестовое покрытие нового кода в PR<a class=headerlink href=../amp/#pokazyvat-testovoe-pokrytie-novogo-koda-v-pr title="Permanent link"> </a></h3><p>Пока есть просто показ тестового покрытия всего кода.</p><h3 id=vkliuchenie-analoga-weverything-v-gcc>7.13. + Включение аналога -Weverything в gcc<a class=headerlink href=../amp/#vkliuchenie-analoga-weverything-v-gcc title="Permanent link"> </a></h3><p>Мы используем -Wall -Wextra -Weverything -Werror.<br> При сборке с clang, -Weverything уже включено. Но в gcc есть уникальные warning-и, отсутствующие в clang.<br> Сделал Wolf Kreuzerkrieg.</p><h3 id=alternativa-dlia-readline-i-libedit>7.14. + Альтернатива для readline и libedit<a class=headerlink href=../amp/#alternativa-dlia-readline-i-libedit title="Permanent link"> </a></h3><p>Подключение replxx вместо readline сделал Иван Лежанкин.</p><p>Есть технический долг с лицензиями файлов консорциума Unicode.<br> Есть технический долг с работой \G в multiline режиме.</p><h3 id=uluchshenie-vozmozhnostei-interaktivnogo-rezhima-clickhouse-client>7.14.1. + Улучшение возможностей интерактивного режима clickhouse-client<a class=headerlink href=../amp/#uluchshenie-vozmozhnostei-interaktivnogo-rezhima-clickhouse-client title="Permanent link"> </a></h3><p>Тагир Кускаров, ВШЭ.</p><p>Upd. В рамках данной задачи добавляем подстветку синтаксиса и исправление проблем со вставкой больших запросов.<br> Upd. Минимальная подсветка добавлена, а все остальные задачи не сделаны.</p><p>Для ввода запросов в интерактивном режиме в клиенте командной строки clickhouse-client использовалась библиотека readline или libedit.</p><p>Библиотеки readline и libedit обладает следующими недостатками:<br> - (исправлено в новых версиях readline) Очень низкая производительность вставки больших кусков текста. Вставка каждого следующего символа имеет сложность O(n = количество предыдущих символов) и при вставке 1 МБ текста, скорость падает до десятков байт в секунду.<br> - Крайне сложно или невозможно реализовать подсветку синтаксиса по мере набора текста, а также autocomplete без нажатия дополнительных клавиш для вызова.<br> - Лицензия GPL (для readline) препятствует её включению в кодовую базу продукта.<br> - Плохо работает навигация по истории, если история вкючает запросы, не помещающиеся на экран.<br> - История сохраняется лишь при завершении работы клиента.<br> - При параллельной работе нескольких клиентов с одним файлом истории, сохраняется история только одного из клиентов.<br> - Плохо работает история для многострочных запросов.<br> - Излишняя экономия пересылаемых данных, что часто приводит к остаткам мусора в терминале.</p><p>Кроме того, имеются следующие сложно достижимые достоинства:<br> - Поддержка right-to-left текста;<br> - Поддержка editrc конфигураций.</p><p>В качестве альтернатив можно рассмотреть следующие варианты:<br> - Linenoise от Salvatore Sanfilippo. Достоинства: простота и компактность кода; высокая скорость работы. Недостатки: отсутствует поддержка Unicode; отсутствует автоматический перенос текста, что затрудняет работу с многострочными запросами.<br> - Linenoise с патчами для поддержки Unicode. Недостаток: теряется преимущество по скорости работы.<br> - Fish shell. Не является библиотекой, но представляет собой отличный пример, как можно реализовать подстветку синтаксиса и удобный autocomplete. Поддерживает Unicode, но работает весьма медленно.<br> - Python Prompt Toolkit. Не является подходящим решением для интеграции в C++ проект. Хорошие возможности по подсветке синтаксиса и autocomplete.</p><p>Вместо этого предлагается в качестве примера изучить прототип текстового редактора Kilo: <a href=https://viewsourcecode.org/snaptoken/kilo/ target=_blank>https://viewsourcecode.org/snaptoken/kilo/</a> и реализовать всю необходимую функциональность.</p><h3 id=zamena-libressl-obratno-na-openssl>7.15. + Замена libressl обратно на openssl<a class=headerlink href=../amp/#zamena-libressl-obratno-na-openssl title="Permanent link"> </a></h3><p>Поводом использования libressl послужило желание нашего хорошего друга из известной компании несколько лет назад. Но сейчас ситуация состоит в том, что openssl продолжает развиваться, а libressl не особо, и можно спокойно менять обратно.</p><p>Нужно для Яндекс.Облака для поддержки TLS 1.3.</p><h3 id=tzdata-vnutri-binarnika>7.16. + tzdata внутри бинарника<a class=headerlink href=../amp/#tzdata-vnutri-binarnika title="Permanent link"> </a></h3><p>Как в Аркадии, fallback на системные.</p><h3 id=dodelat-tgz-pakety>7.17. + Доделать tgz пакеты<a class=headerlink href=../amp/#dodelat-tgz-pakety title="Permanent link"> </a></h3><p>Уже давно собираются универсальные tgz пакеты, но по нелепой случайности из них исчез install скрипт.<br><a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Может делегировать эту задачу кому угодно.<br> Upd. Сделано всё кроме инструкции на сайте. Для этого требуется создать директории testing/stable/prestable на repo.yandex.ru. Внезапно оказалось, что человек, отвечающий за это, в отпуске, и он не отвечает на вопрос, кто его заместитель. Q1.</p><h3 id=dodelat-binarniki-pod-mac>7.18. + Доделать бинарники под Mac<a class=headerlink href=../amp/#dodelat-binarniki-pod-mac title="Permanent link"> </a></h3><p>Уже есть автосборка бинарников под Mac на каждый коммит и PR, но с недостатками.<br><a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Иван Лежанкин</a>. Требует 7.1, 7.2. Рекомендуется 7.14. Сейчас не хватает по крайней мере SSL и ICU. Нужно для Яндекс.Облака.<br> Upd. Сделано SSL. Ориентируемся в Q1, но приоритет средний и может потеряться.</p><h3 id=pomestit-ssylku-na-sobrannye-binarniki-pod-mac-na-sait>7.18.1. Поместить ссылку на собранные бинарники под Mac на сайт<a class=headerlink href=../amp/#pomestit-ssylku-na-sobrannye-binarniki-pod-mac-na-sait title="Permanent link"> </a></h3><p>Сейчас людям приходится делать несколько кликов, чтобы их скачать.<br><a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>.<br> Upd. Добавлены прямые ссылки и инструкция в документации. Но всё ещё нет инструкции на главной странице сайта.</p><h3 id=dodelat-proverit-avtosborku-pod-aarch64>7.19. + Доделать (проверить) автосборку под AArch64<a class=headerlink href=../amp/#dodelat-proverit-avtosborku-pod-aarch64 title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/8027 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/8027</a>#issuecomment-566670282<br> Проверили на настоящем сервере Huawei, а также в специальном Docker контейнере, который содержит внутри qemu-user-static.<br> Также можно проверить на Cavium, на Raspberry Pi а также на твоём Android телефоне.</p><h3 id=avtosborka-dlia-freebsd-x86-64>7.20. + Автосборка для FreeBSD x86_64<a class=headerlink href=../amp/#avtosborka-dlia-freebsd-x86-64 title="Permanent link"> </a></h3><p><a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Иван Лежанкин</a>.</p><p>Upd. В процессе реализации, есть pull request.<br> Upd. Есть сборки, <a href=https://clickhouse-builds.s3.yandex.net/0/2cb4c91c0286b774534fcbe80e5ef8835a74a83a/report.html rel="external nofollow noreferrer" target=_blank>пример</a><br> Всё ещё нет инструкции на сайте!</p><h3 id=avtosborka-dlia-linux-ppc64>7.21. Автосборка для Linux ppc64<a class=headerlink href=../amp/#avtosborka-dlia-linux-ppc64 title="Permanent link"> </a></h3><p><a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Иван Лежанкин</a>.<br> Как-то медленно тащится.<br> Как-то вообще не тащится. Также договорились, что сделаем ещё автосборку для MIPS64.</p><h3 id=deshbord-dlia-pull-requests>7.22. + Дэшборд для pull requests<a class=headerlink href=../amp/#deshbord-dlia-pull-requests title="Permanent link"> </a></h3><p>Дарья Петрова, УрФУ.</p><p>Рабочий прототип: <a href=https://pulls-dashboard-demo.herokuapp.com/dashboard/ClickHouse/ClickHouse target=_blank>https://pulls-dashboard-demo.herokuapp.com/dashboard/ClickHouse/ClickHouse</a><br> Upd. Мы пользуемся этим инструментом в ежедневной работе.</p><p>Над ClickHouse одновременно работает большое количество разработчиков, которые оформляют свои изменения в виде pull requests. Когда непомерженных pull requests много, то возникает сложность с организацией работы - непонятно, на какой pull request смотреть в первую очередь.</p><p>Предлагается реализовать простое одностраничное веб-приложение, в котором отображается список pull requests со следующей информацией:<br> - размер diff - количество изменённых строк;<br> - как давно было последнее обновление;<br> - типы изменённых файлов: C++, документация, скрипты сборки;<br> - наличие добавленных тестов;<br> - есть ли описание для changelog;<br> - изменены ли submodules;<br> - был ли разрешён запуск проверок CI;<br> - статусы проверок CI;<br> - количество approve от ревьюеров;</p><p>Статусы проверок - наиболее важная часть. Так как для каждого PR выполняется несколько десятков проверок и наиболее медленные работают до нескольких часов, придётся:<br> - отображать сразу все проверки для каждого PR в виде красивой разноцветной матрицы с информацией по наведению мыши;<br> - отсортировать проверки по важности: например, если у внешнего разработчика проходят все проверки кроме стиля кода, то мы можем взять это в работу сами;<br> - если для предыдущего коммита проверка была завершена, а для последнего коммита ещё только идёт - то можно отображать в таблице статус предыдущей проверки более блёклым цветом.</p><p>Предлагается реализовать несколько вариантов сортировок. Очевидное - по времени обновления, более интересно - некое ранжирование с целью выяснить, «что лучше взять в работу прямо сейчас».</p><p>Похожие продукты уже есть, например: <a href=http://prs.mozilla.io/yandex:ClickHouse target=_blank>http://prs.mozilla.io/yandex:ClickHouse</a> К сожалению, этот продукт заброшен, да и делает не совсем то, что нужно. По своему усмотрению, можно взять из него что-нибудь полезное.</p><h3 id=funktsii-dlia-fuzzing>7.23. + Функции для fuzzing<a class=headerlink href=../amp/#funktsii-dlia-fuzzing title="Permanent link"> </a></h3><p>Андрей Некрашевич, ВШЭ.</p><p>Fuzzing тестирование - это тестирование случайными данными. Мы рассмотрим несколько подходов к этой задачи:</p><ol><li>Добавление в SQL диалект ClickHouse функций для генерации случайных данных (пример - случайные бинарные строки заданной длины, случайные валидные UTF-8 строки) и «порчи» данных (например, поменять значения случайных бит с заданной частотой). Это будет использовано для тестирования SQL-функций ClickHouse.</li></ol><p>Можно добавить функции:<br><code class=syntax>randomString(length)</code><br><code class=syntax>randomFixedString(length)</code><br> - строка заданной длины с равномерно распределёнными случайными байтами;<br><code class=syntax>randomStringASCII(length)</code><br><code class=syntax>randomStringUTF8(length)</code></p><p><code class=syntax>fuzzBits(s, inverse_probability)</code> - изменить каждый бит строки на противоположный с заданной вероятностью;<br><code class=syntax>fuzzBytes(s, inverse_probability)</code> - изменить каждый байт строки на равномерно случайный с заданной вероятностью;</p><p>У каждой функции опциональный аргумент против склейки одинаковых выражений в запросе.</p><p>Также можно сделать функции с детерминированным генератором случайных чисел (аргументом передаётся seed) для воспроизводимости тестовых кейсов.</p><p>Upd. Сергей Штыков сделал функцию <code class=syntax>randomPrintableASCII</code>.<br> Upd. Илья Яцишин сделал табличную функцию <code class=syntax>generateRandom</code>.<br> Upd. Эльдар Заитов добавляет OSS Fuzz.<br> Upd. Сделаны randomString, randomFixedString.<br> Upd. Сделаны fuzzBits, fuzzBytes.</p><h3 id=fuzzing-leksera-i-parsera-zaprosov-kodekov-i-formatov>7.24. Fuzzing лексера и парсера запросов; кодеков и форматов<a class=headerlink href=../amp/#fuzzing-leksera-i-parsera-zaprosov-kodekov-i-formatov title="Permanent link"> </a></h3><p>Продолжение 7.23.</p><ol><li><p>Использование AFL или LibFuzzer для тестирования отдельных частей кодовой базы ClickHouse.</p></li><li><p>Генерация и выполнение случайных синтаксически корректных запросов на случайных данных.</p></li></ol><p>Upd. Александр Кузьменков сделал фазер запросов на основе мутаций AST.</p><h3 id=sinkhronizatsiia-relizov-v-arkadiiu>7.25. + Синхронизация релизов в Аркадию<a class=headerlink href=../amp/#sinkhronizatsiia-relizov-v-arkadiiu title="Permanent link"> </a></h3><p>Изначально занимался Олег Алексеенков. Сейчас он перешёл работать в дружественный отдел, но обещает продолжать синхронизацию.<br> Затем, возможно, <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Иван Лежанкин</a>. Но сейчас приостановлено, так как Максим из YT должен исправить регрессию производительности в анализе индекса.</p><p>Максим из YT сказал, что сделает это после нового года.<br> Максим из YT сказал, что «мы планируем в январе добиться».<br> Максим сейчас занимается собираемостью YT с новой версией ClickHouse.</p><p>Нужно для CHYT и YQL.</p><p>Upd: Все патчи Максима отправлены в master. Задача взята в работу.<br> Upd: Задача в процессе реализации. Синхронизироваться будет master. Делает <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Иван Лежанкин</a><br> Upd: Есть собирающийся прототип, но сборка как будто ещё не в trunk Аркадии.<br> Upd: Добавлено в Аркадию, но не все файлы (не побайтово).<br> Upd: Добавлены все файлы побайтово.</p><h3 id=pobaitovaia-identichnost-repozitoriia-s-arkadiei>7.26. + Побайтовая идентичность репозитория с Аркадией<a class=headerlink href=../amp/#pobaitovaia-identichnost-repozitoriia-s-arkadiei title="Permanent link"> </a></h3><p>Команда DevTools. Прогресс по задаче под вопросом.<br> Upd. Готово (все директории кроме contrib).</p><h3 id=zapusk-avtotestov-v-arkadii>7.27. + Запуск автотестов в Аркадии<a class=headerlink href=../amp/#zapusk-avtotestov-v-arkadii title="Permanent link"> </a></h3><p>Требует 7.26. Коллеги начали делать, есть результат.<br> Upd. В Аркадии частично работает небольшая часть тестов. И этого достаточно.</p><h3 id=optsii-clickhouse-install-stop-start-vmesto-postinst-init-d-systemd-skriptov>7.29. Опции clickhouse install, stop, start вместо postinst, init.d, systemd скриптов<a class=headerlink href=../amp/#optsii-clickhouse-install-stop-start-vmesto-postinst-init-d-systemd-skriptov title="Permanent link"> </a></h3><p>Низкий приоритет.</p><h3 id=vozmozhnost-perekliucheniia-binarnykh-failov-na-prodakshene-bez-vykladki-paketov>7.30. Возможность переключения бинарных файлов на продакшене без выкладки пакетов<a class=headerlink href=../amp/#vozmozhnost-perekliucheniia-binarnykh-failov-na-prodakshene-bez-vykladki-paketov title="Permanent link"> </a></h3><p>Низкий приоритет.</p><h3 id=zerkalirovanie-nagruzki-mezhdu-serverami>7.31. Зеркалирование нагрузки между серверами<a class=headerlink href=../amp/#zerkalirovanie-nagruzki-mezhdu-serverami title="Permanent link"> </a></h3><p>В очереди. Нужно для Яндекс.Метрики.</p><h3 id=obfuskatsiia-prodakshen-zaprosov>7.32. Обфускация продакшен запросов<a class=headerlink href=../amp/#obfuskatsiia-prodakshen-zaprosov title="Permanent link"> </a></h3><p>Роман Ильговский. Нужно для Яндекс.Метрики.<br> Есть pull request, почти готово: <a href=https://github.com/ClickHouse/ClickHouse/pull/10973 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/10973</a></p><p>Имея SQL запрос, требуется вывести структуру таблиц, на которых этот запрос будет выполнен, и заполнить эти таблицы случайными данными, такими, что результат этого запроса зависит от выбора подмножества данных.</p><p>Для примера, если есть запрос <code class=syntax>SELECT SearchPhrase, count(*) FROM table WHERE CounterID = 34 AND SearchPhrase LIKE '%ClickHouse%'</code>, то мы можем сделать вывод, что CounterID имеет числовой тип, а SearchPhrase - строковый. Заполнить таблицу данными, на которых отдельные условия <code class=syntax>CounterID = 34</code> и <code class=syntax>SearchPhrase LIKE '%ClickHouse%'</code> для некоторых строк выполнены, а для некоторых строк не выполнены.</p><p>Обфускация запросов: имея секретные запросы и структуру таблиц, заменить имена полей и константы, чтобы запросы можно было использовать в качестве публично доступных тестов.</p><h3 id=vykladyvat-patch-relizy-v-repozitorii-avtomaticheski>7.33. Выкладывать патч релизы в репозиторий автоматически<a class=headerlink href=../amp/#vykladyvat-patch-relizy-v-repozitorii-avtomaticheski title="Permanent link"> </a></h3><p>В очереди. Иван Лежанкин.<br> Отсутствует прогресс.</p><h3 id=bekportirovat-bugfix-avtomaticheski>7.34. + Бэкпортировать bugfix автоматически<a class=headerlink href=../amp/#bekportirovat-bugfix-avtomaticheski title="Permanent link"> </a></h3><p>В очереди. Иван Лежанкин.<br> Присутствует прогресс.<br> Сделано.</p><h3 id=nachalnye-pravila-dlia-avto-merge>7.35. Начальные правила для авто-merge<a class=headerlink href=../amp/#nachalnye-pravila-dlia-avto-merge title="Permanent link"> </a></h3><p>Зелёные проверки и два ревью.<br><a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Может делегировать эту задачу кому угодно.</p><h3 id=poniatie-doverennykh-kontribiutorov>7.36. Понятие доверенных контрибьюторов<a class=headerlink href=../amp/#poniatie-doverennykh-kontribiutorov title="Permanent link"> </a></h3><p>Контрибьюторы, у которых есть 5 померженных PR. Для их новых PR автотесты запускаются сразу.<br><a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Может делегировать эту задачу кому угодно.<br> Сейчас добавляем некоторых доверенных контрибьюторов в ручном режиме.<br> Upd. Всё ещё добавляем в ручном режиме.</p><h3 id=razobratsia-s-repo-yandex-ru>7.37. + Разобраться с repo.yandex.ru<a class=headerlink href=../amp/#razobratsia-s-repo-yandex-ru title="Permanent link"> </a></h3><p>Есть жалобы на скорость загрузки и неудобство maintenance, operations, visibility.</p><p>Upd. Иван Блинков настроил CDN repo.clickhouse.tech, что решает проблему с доступностью зарубежом.<br> Вопрос с operations, visibility пока актуален.</p><p>Upd. Частично решён вопрос с visibility - есть какой-то дэшборд.</p><h2 id=integratsiia-s-vneshnimi-sistemami>8. Интеграция с внешними системами<a class=headerlink href=../amp/#integratsiia-s-vneshnimi-sistemami title="Permanent link"> </a></h2><h3 id=podderzhka-alter-modify-setting-dlia-kafka>8.1. Поддержка ALTER MODIFY SETTING для Kafka<a class=headerlink href=../amp/#podderzhka-alter-modify-setting-dlia-kafka title="Permanent link"> </a></h3><p>Также - возможность указать все настройки форматов в Kafka.</p><p>Altinity. Никто не делает эту задачу.</p><h3 id=podderzhka-mongo-atlas-uri>8.2. Поддержка Mongo Atlas URI<a class=headerlink href=../amp/#podderzhka-mongo-atlas-uri title="Permanent link"> </a></h3><p><a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Александр Кузьменков</a>.<br> Upd. Задача взята в работу.</p><h3 id=dorabotki-globs-pravilnaia-podderzhka-diapazonov-umenshenie-chisla-odnovremennykh-stream-ov>8.3. + Доработки globs (правильная поддержка диапазонов, уменьшение числа одновременных stream-ов)<a class=headerlink href=../amp/#dorabotki-globs-pravilnaia-podderzhka-diapazonov-umenshenie-chisla-odnovremennykh-stream-ov title="Permanent link"> </a></h3><p><a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Ольга Хвостикова</a>.</p><p>Уменьшение числа stream-ов сделано, а вот правильная поддержка диапазонов - нет. Будем надеяться на Q1/Q2. Сделано.</p><h3 id=unifikatsiia-file-hdfs-s3-pod-url>8.4. Унификация File, HDFS, S3 под URL<a class=headerlink href=../amp/#unifikatsiia-file-hdfs-s3-pod-url title="Permanent link"> </a></h3><h3 id=autentifikatsiia-v-s3>8.5. + Аутентификация в S3<a class=headerlink href=../amp/#autentifikatsiia-v-s3 title="Permanent link"> </a></h3><p><a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Владимир Чеботарёв</a>, Altinity.</p><h3 id=kerberos-autentifikatsiia-dlia-hdfs-i-kafka>8.6. Kerberos аутентификация для HDFS и Kafka<a class=headerlink href=../amp/#kerberos-autentifikatsiia-dlia-hdfs-i-kafka title="Permanent link"> </a></h3><p>Андрей Коняев, ArenaData. Он куда-то пропал.</p><h3 id=ispravlenie-melochi-hdfs-na-ochen-starykh-iadrakh-linux>8.7. + Исправление мелочи HDFS на очень старых ядрах Linux<a class=headerlink href=../amp/#ispravlenie-melochi-hdfs-na-ochen-starykh-iadrakh-linux title="Permanent link"> </a></h3><p>В ядрах 2.6 отсутствует один системный вызов, который библиотека hdfs3 использует без необходимости.<br> Сделал Amos Bird.</p><h3 id=podderzhka-virtualnykh-stolbtsov-s-imenem-faila-i-putiom>8.8. + Поддержка виртуальных столбцов с именем файла и путём<a class=headerlink href=../amp/#podderzhka-virtualnykh-stolbtsov-s-imenem-faila-i-putiom title="Permanent link"> </a></h3><p><a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Ольга Хвостикова</a>.</p><h3 id=podderzhka-szhatykh-failov-gz-bz-na-chtenie-i-zapis>8.9. + Поддержка сжатых файлов (gz, bz) на чтение и запись<a class=headerlink href=../amp/#podderzhka-szhatykh-failov-gz-bz-na-chtenie-i-zapis title="Permanent link"> </a></h3><p>Сделал <a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a></p><h3 id=zapis-v-tablichnuiu-funktsiiu-odbc>8.10. + Запись в табличную функцию ODBC<a class=headerlink href=../amp/#zapis-v-tablichnuiu-funktsiiu-odbc title="Permanent link"> </a></h3><p>Артемий Бобровский, ВШЭ<br> Есть pull request.</p><h3 id=dvizhok-tablits-dlia-chteniia-iz-mongo>8.11. + Движок таблиц для чтения из Mongo<a class=headerlink href=../amp/#dvizhok-tablits-dlia-chteniia-iz-mongo title="Permanent link"> </a></h3><p>Артемий Бобровский, ВШЭ<br> Есть pull request.<br> Upd. В стадии код-ревью.<br> Готово.</p><h3 id=propusk-stolbtsov-v-formatakh-parquet-orc>8.12. Пропуск столбцов в форматах Parquet, ORC<a class=headerlink href=../amp/#propusk-stolbtsov-v-formatakh-parquet-orc title="Permanent link"> </a></h3><p>Реализовано возможно частично - проверить.</p><h3 id=podderzhka-massivov-v-parquet-orc>8.13. Поддержка массивов в Parquet, ORC<a class=headerlink href=../amp/#podderzhka-massivov-v-parquet-orc title="Permanent link"> </a></h3><h3 id=zapis-dannykh-v-orc>8.14. + Запись данных в ORC<a class=headerlink href=../amp/#zapis-dannykh-v-orc title="Permanent link"> </a></h3><p>Павел Круглов, ВШЭ. Есть pull request. Готово.</p><h3 id=zapis-dannykh-v-capnproto>8.15. Запись данных в CapNProto<a class=headerlink href=../amp/#zapis-dannykh-v-capnproto title="Permanent link"> </a></h3><h3 id=podderzhka-formata-avro>8.16. + Поддержка формата Avro<a class=headerlink href=../amp/#podderzhka-formata-avro title="Permanent link"> </a></h3><p>Andrew Onyshchuk. Есть pull request. Q1. Сделано.</p><p>Формат Apache Avro является компактным структурированным построчным бинарным форматом данных с внешней схемой. Этот формат часто используется совместно с Kafka и поддержка его в качестве одного из форматов ввода-вывода в ClickHouse является востребованной пользователями.</p><h3 id=podderzhka-formata-jsoneachrow-zasunutogo-v-massiv>8.16.1. + Поддержка формата JSONEachRow, засунутого в массив<a class=headerlink href=../amp/#podderzhka-formata-jsoneachrow-zasunutogo-v-massiv title="Permanent link"> </a></h3><p>Павел Круглов, ВШЭ и Яндекс. Есть pull request.</p><h3 id=podderzhka-formata-thrift>8.16.2. - Поддержка формата Thrift<a class=headerlink href=../amp/#podderzhka-formata-thrift title="Permanent link"> </a></h3><p>Павел Круглов, ВШЭ и Яндекс. Задача отменена.</p><h3 id=podderzhka-formata-msgpack>8.16.3. + Поддержка формата MsgPack<a class=headerlink href=../amp/#podderzhka-formata-msgpack title="Permanent link"> </a></h3><p>Павел Круглов, ВШЭ и Яндекс.<br> Задача взята в работу.</p><p>Upd. Почти готово - есть лишь небольшой технический долг.<br> Upd. Готово.</p><h3 id=format-regexp>8.16.4. + Формат Regexp<a class=headerlink href=../amp/#format-regexp title="Permanent link"> </a></h3><p>Павел Круглов, ВШЭ и Яндекс.<br> Есть pull request. Готово.</p><h3 id=clickhouse-kak-mysql-replika>8.17. ClickHouse как MySQL реплика<a class=headerlink href=../amp/#clickhouse-kak-mysql-replika title="Permanent link"> </a></h3><p>Задачу делает BohuTANG.</p><p>Реализовать возможность подписаться на row-based репликацию MySQL и сохранять полученные данные в CollapsingMergeTree или ReplacingMergeTree таблицы. Сторонние решения для этой задачи уже существуют: <a href=https://www.altinity.com/blog/2018/6/30/realtime-mysql-clickhouse-replication-in-practice target=_blank>https://www.altinity.com/blog/2018/6/30/realtime-mysql-clickhouse-replication-in-practice</a> Также существует стороннее решение для PostgreSQL: <a href=https://github.com/mkabilov/pg2ch target=_blank>https://github.com/mkabilov/pg2ch</a></p><p>Встроенная в ClickHouse возможность работать в качестве реплики MySQL даст преимущества для дальнейшего развития.</p><h3 id=clickhouse-kak-federated-mysql>8.18. + ClickHouse как Federated MySQL<a class=headerlink href=../amp/#clickhouse-kak-federated-mysql title="Permanent link"> </a></h3><p>Maxim Fedotov, Wargaming + Yuri Baranov, Яндекс.</p><h3 id=integratsiia-s-rabbitmq>8.19. + Интеграция с RabbitMQ<a class=headerlink href=../amp/#integratsiia-s-rabbitmq title="Permanent link"> </a></h3><p>Ксения Сумарокова, ВШЭ.</p><p>В ClickHouse часто используется потоковый импорт данных из распределённой очереди. Наиболее популярно использование совместно с Kafka. Эта возможность уже есть.</p><p>Следующей по востребованности является система очередей RabbitMQ. Её поддержка в ClickHouse отсутствует.</p><p>Есть pull request в процессе разработки.<br> Upd. В процессе code review.<br> Upd. Готово.</p><h3 id=integratsiia-s-sqs>8.20. - Интеграция с SQS<a class=headerlink href=../amp/#integratsiia-s-sqs title="Permanent link"> </a></h3><p>Низкий приоритет. Отменено.</p><h3 id=podderzhka-proizvolnogo-kolichestva-iazykov-dlia-imion-regionov>8.21. Поддержка произвольного количества языков для имён регионов<a class=headerlink href=../amp/#podderzhka-proizvolnogo-kolichestva-iazykov-dlia-imion-regionov title="Permanent link"> </a></h3><p>Нужно для БК. Декабрь 2019.<br> В декабре для БК сделан минимальный вариант этой задачи.<br> Максимальный вариант, вроде, никому не нужен.<br> Upd. Всё ещё кажется, что задача не нужна.</p><h3 id=podderzhka-sintaksisa-dlia-peremennykh-v-stile-mysql>8.22. + Поддержка синтаксиса для переменных в стиле MySQL<a class=headerlink href=../amp/#podderzhka-sintaksisa-dlia-peremennykh-v-stile-mysql title="Permanent link"> </a></h3><p>При парсинге запроса преобразовывать синтаксис вида <code class=syntax>@@version_full</code> в вызов функции <code class=syntax>getGlobalVariable('version_full')</code>. Поддержать популярные MySQL переменные. Может быть поможет Юрий Баранов, если будет энтузиазм.</p><p>Upd. Юрий Баранов работает в Google, там запрещено разрабатывать ClickHouse.<br> Upd. Сделано теми людьми, кому не запрещено разрабатывать ClickHouse.</p><h3 id=podpiska-dlia-importa-obnovliaemykh-i-rotiruemykh-logov-v-fs>8.23. Подписка для импорта обновляемых и ротируемых логов в ФС<a class=headerlink href=../amp/#podpiska-dlia-importa-obnovliaemykh-i-rotiruemykh-logov-v-fs title="Permanent link"> </a></h3><p>Желательно 2.15.</p><h2 id=bezopasnost>9. Безопасность<a class=headerlink href=../amp/#bezopasnost title="Permanent link"> </a></h2><h3 id=ogranichenie-na-khosty-v-zaprosakh-ko-vneshnim-sistemam>9.1. + Ограничение на хосты в запросах ко внешним системам<a class=headerlink href=../amp/#ogranichenie-na-khosty-v-zaprosakh-ko-vneshnim-sistemam title="Permanent link"> </a></h3><p>Михаил Коротов.</p><h3 id=prednastroennye-imenovannye-soedineniia-k-vneshnim-bd>9.2. Преднастроенные именованные соединения к внешним БД<a class=headerlink href=../amp/#prednastroennye-imenovannye-soedineniia-k-vneshnim-bd title="Permanent link"> </a></h3><p>ClickHouse предоставляет возможность обратиться к внешней базе данных из языка запросов. Это реализовано в виде табличных функций. В параметрах к табличной функции указывается адрес удалённой базы данных (хост, порт), а также аутентификационные данные (имя пользователя, пароль). Аутентификационные данные указываются в запросе в открытом виде и, таким образом, попадают в историю запросов и в логи, что компрометирует безопасность системы.</p><p>Вместо этого предлагается описывать необходимые данные в конфигурационном файле сервера или в отдельном сервисе и ссылаться на них по именам.</p><h3 id=podderzhka-tls-dlia-zookeeper>9.3. + Поддержка TLS для ZooKeeper<a class=headerlink href=../amp/#podderzhka-tls-dlia-zookeeper title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/10174 rel="external nofollow noreferrer" target=_blank>#10174</a></p><p>Есть pull request.</p><h2 id=vneshnie-slovari>10. Внешние словари<a class=headerlink href=../amp/#vneshnie-slovari title="Permanent link"> </a></h2><h3 id=ispravlenie-zavisaniia-v-biblioteke-dostupa-k-yt>10.1. + Исправление зависания в библиотеке доступа к YT<a class=headerlink href=../amp/#ispravlenie-zavisaniia-v-biblioteke-dostupa-k-yt title="Permanent link"> </a></h3><p>Библиотека для доступа к YT не переживает учения.<br> Нужно для БК и Метрики. Поиск причин - <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Дальшейшее исправление возможно на стороне YT.</p><p>Цитата: «Оказывается для YT-клиента зависания на несколько минут это нормально. Убрал внутренние ретраи, снизил таймауты. Однозначно станет лучше».</p><h3 id=ispravlenie-sigill-v-biblioteke-dostupa-k-yt>10.2. + Исправление SIGILL в библиотеке доступа к YT<a class=headerlink href=../amp/#ispravlenie-sigill-v-biblioteke-dostupa-k-yt title="Permanent link"> </a></h3><p>Код YT использует SIGILL вместо abort. Это, опять же, происходит при учениях.<br> Нужно для БК и Метрики. Поиск причин - <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>. Дальшейшее исправление возможно на стороне YT.</p><p>Upd. Одну причину устранили, но ещё что-то неизвестное осталось.<br> Upd. Нас заставляют переписать эту библиотеку с одного API на другое, так как старое внезапно устарело. Кажется, что переписывание случайно исправит все проблемы.<br> Upd. Ура, нашли причину и исправили.</p><h3 id=vozmozhnost-chteniia-dannykh-iz-staticheskikh-tablits-v-yt-slovariakh>10.3. Возможность чтения данных из статических таблиц в YT словарях<a class=headerlink href=../amp/#vozmozhnost-chteniia-dannykh-iz-staticheskikh-tablits-v-yt-slovariakh title="Permanent link"> </a></h3><p>Нужно для БК и Метрики.</p><h3 id=slovar-iz-ydb-kikimr>10.4. - Словарь из YDB (KikiMR)<a class=headerlink href=../amp/#slovar-iz-ydb-kikimr title="Permanent link"> </a></h3><p>Нужно для Метрики, а делать будет таинственный незнакомец из команды KikiMR (под вопросом). Таинственный незнакомец не подтверждает, что он будет делать эту задачу.</p><h3 id=zakrytie-soedinenii-i-umenshenie-chisla-soedinenii-dlia-mysql-i-odbc>10.5. Закрытие соединений и уменьшение числа соединений для MySQL и ODBC<a class=headerlink href=../amp/#zakrytie-soedinenii-i-umenshenie-chisla-soedinenii-dlia-mysql-i-odbc title="Permanent link"> </a></h3><p>Нужно для Метрики.</p><p>Для MySQL сделал Clément Rodriguez.</p><h3 id=slovari-iz-cassandra-i-couchbase>10.6. Словари из Cassandra и Couchbase<a class=headerlink href=../amp/#slovari-iz-cassandra-i-couchbase title="Permanent link"> </a></h3><p>Готова Cassandra.</p><h3 id=podderzhka-nullable-v-slovariakh>10.7. Поддержка Nullable в словарях<a class=headerlink href=../amp/#podderzhka-nullable-v-slovariakh title="Permanent link"> </a></h3><h3 id=podderzhka-massivov-v-slovariakh>10.8. Поддержка массивов в словарях<a class=headerlink href=../amp/#podderzhka-massivov-v-slovariakh title="Permanent link"> </a></h3><h3 id=umenshenie-blokirovok-dlia-cache-slovarei-za-schiot-odnovremennykh-zaprosov-odnogo-i-togo-zhe>10.9. - Уменьшение блокировок для cache словарей за счёт одновременных запросов одного и того же<a class=headerlink href=../amp/#umenshenie-blokirovok-dlia-cache-slovarei-za-schiot-odnovremennykh-zaprosov-odnogo-i-togo-zhe title="Permanent link"> </a></h3><p>Заменено в пользу 10.10, 10.11.</p><h3 id=vozmozhnost-ispolzovaniia-starykh-znachenii-iz-cache-slovaria-poka-oni-perezaprashivaiutsia>10.10. + Возможность использования старых значений из cache словаря пока они перезапрашиваются<a class=headerlink href=../amp/#vozmozhnost-ispolzovaniia-starykh-znachenii-iz-cache-slovaria-poka-oni-perezaprashivaiutsia title="Permanent link"> </a></h3><p>Никита Михайлов. Q1. Нужно для БК и Метрики.</p><h3 id=vozmozhnost-iskliuchitelno-asinkhronnykh-zaprosov-v-cache-slovariakh>10.11. + Возможность исключительно асинхронных запросов в cache словарях<a class=headerlink href=../amp/#vozmozhnost-iskliuchitelno-asinkhronnykh-zaprosov-v-cache-slovariakh title="Permanent link"> </a></h3><p>Никита Михайлов. Q1. Нужно для БК и Метрики. Требует 10.10.</p><h3 id=layout-direct-dlia-slovarei>10.12. + Layout direct для словарей<a class=headerlink href=../amp/#layout-direct-dlia-slovarei title="Permanent link"> </a></h3><p>Артём Стрельцов, Николай Дегтеринский, Наталия Михненко, ВШЭ.<br> Приступили к этой задаче.<br> Готов direct, есть pull request complex_key_direct.<br> Готово всё.</p><h3 id=ispolzovanie-join-kak-generic-layout-dlia-slovarei>10.13. Использование Join как generic layout для словарей<a class=headerlink href=../amp/#ispolzovanie-join-kak-generic-layout-dlia-slovarei title="Permanent link"> </a></h3><h3 id=podderzhka-vsekh-tipov-v-funktsii-transform>10.14. Поддержка всех типов в функции transform<a class=headerlink href=../amp/#podderzhka-vsekh-tipov-v-funktsii-transform title="Permanent link"> </a></h3><h3 id=ispolzovanie-slovarei-kak-spetsializirovannogo-layout-dlia-join>10.15. + Использование словарей как специализированного layout для Join<a class=headerlink href=../amp/#ispolzovanie-slovarei-kak-spetsializirovannogo-layout-dlia-join title="Permanent link"> </a></h3><h3 id=slovari-na-lokalnom-ssd>10.16. + Словари на локальном SSD<a class=headerlink href=../amp/#slovari-na-lokalnom-ssd title="Permanent link"> </a></h3><p>Никита Васильев, ВШЭ и Яндекс. Есть pull request.</p><p>Реализовать в ClickHouse специализированный движок таблиц, подходящий для быстрых key-value запросов и оптимизированный для расположения данных на SSD. Это может быть: реализация на основе RocksDB; сериализованные RowBinary данные с индексом в оперативке; секретная очень эффективная структура данных, о которой я расскажу.</p><p>Использовать эту структуру данных как отдельный вид словарей, как источник для cache словарей или как дополнительный уровень кэширования для cache словарей.</p><p>Upd. Задача в финальной стадии готовности.</p><h3 id=lokalnyi-damp-sostoianiia-slovaria-dlia-bystrogo-starta-servera>10.17. Локальный дамп состояния словаря для быстрого старта сервера<a class=headerlink href=../amp/#lokalnyi-damp-sostoianiia-slovaria-dlia-bystrogo-starta-servera title="Permanent link"> </a></h3><h3 id=tablitsa-join-ili-slovar-na-udalionnom-servere-kak-key-value-bd-dlia-cache-slovaria>10.18. Таблица Join или словарь на удалённом сервере как key-value БД для cache словаря<a class=headerlink href=../amp/#tablitsa-join-ili-slovar-na-udalionnom-servere-kak-key-value-bd-dlia-cache-slovaria title="Permanent link"> </a></h3><h3 id=vozmozhnost-zaregistrirovat-nekotorye-funktsii-ispolzuiushchie-slovari-pod-polzovatelskimi-imenami>10.19. Возможность зарегистрировать некоторые функции, использующие словари, под пользовательскими именами<a class=headerlink href=../amp/#vozmozhnost-zaregistrirovat-nekotorye-funktsii-ispolzuiushchie-slovari-pod-polzovatelskimi-imenami title="Permanent link"> </a></h3><h2 id=interfeisy>11. Интерфейсы<a class=headerlink href=../amp/#interfeisy title="Permanent link"> </a></h2><h3 id=vstavka-sostoianii-agregatnykh-funktsii-v-vide-kortezha-argumentov-ili-massiva-kortezhei-argumentov>11.1. Вставка состояний агрегатных функций в виде кортежа аргументов или массива кортежей аргументов<a class=headerlink href=../amp/#vstavka-sostoianii-agregatnykh-funktsii-v-vide-kortezha-argumentov-ili-massiva-kortezhei-argumentov title="Permanent link"> </a></h3><h3 id=vozmozhnost-ispolzovat-dvizhok-jdbc-iz-korobki>11.2. Возможность использовать движок JDBC из коробки<a class=headerlink href=../amp/#vozmozhnost-ispolzovat-dvizhok-jdbc-iz-korobki title="Permanent link"> </a></h3><p>Нужно разобраться, как упаковывать Java в статический бинарник, возможно AppImage. Или предоставить максимально простую инструкцию по установке jdbc-bridge. Может быть будет заинтересован Александр Крашенинников, Badoo, так как он разработал jdbc-bridge.</p><p>Upd. Александр Крашенинников перешёл в другую компанию и больше не занимается этим.</p><h3 id=integratsionnye-testy-odbc-draivera-putiom-podkliucheniia-clickhouse-k-samomu-sebe-cherez-odbc>11.3. + Интеграционные тесты ODBC драйвера путём подключения ClickHouse к самому себе через ODBC<a class=headerlink href=../amp/#integratsionnye-testy-odbc-draivera-putiom-podkliucheniia-clickhouse-k-samomu-sebe-cherez-odbc title="Permanent link"> </a></h3><p>Михаил Филимонов, Altinity. Готово.</p><h3 id=ispravlenie-upiachek-s-tipami-date-i-decimal-v-clickhouse-cpp>11.4. Исправление упячек с типами Date и Decimal в clickhouse-cpp<a class=headerlink href=../amp/#ispravlenie-upiachek-s-tipami-date-i-decimal-v-clickhouse-cpp title="Permanent link"> </a></h3><p>Altinity целиком взяли на себя поддержку clickhouse-cpp драйвера.</p><h3 id=podderzhka-tls-v-clickhouse-cpp>11.5. Поддержка TLS в clickhouse-cpp<a class=headerlink href=../amp/#podderzhka-tls-v-clickhouse-cpp title="Permanent link"> </a></h3><p>А знаете ли вы, что библиотеку clickhouse-cpp разрабатывал один хороший человек в свободное время?</p><h3 id=integratsionnye-testy-clickhouse-cpp>11.6. Интеграционные тесты clickhouse-cpp<a class=headerlink href=../amp/#integratsionnye-testy-clickhouse-cpp title="Permanent link"> </a></h3><h3 id=interaktivnyi-rezhim-raboty-programmy-clickhouse-local>11.7. Интерактивный режим работы программы clickhouse-local<a class=headerlink href=../amp/#interaktivnyi-rezhim-raboty-programmy-clickhouse-local title="Permanent link"> </a></h3><h3 id=podderzhka-protokola-postgresql>11.8. + Поддержка протокола PostgreSQL<a class=headerlink href=../amp/#podderzhka-protokola-postgresql title="Permanent link"> </a></h3><p>Элбакян Мовсес Андраникович, ВШЭ.</p><p>В ClickHouse в прошлом году добавили поддержку wire-протокола MySQL. PostgreSQL, так же как MySQL, использует несложный протокол общения между клиентом и сервером, но свой собственный. Поддержка этого протокола является востребованной и откроет новые возможности для ClickHouse.</p><p>Задача в процессе разработки.<br> Задача в финальной стадии разработки.</p><h3 id=dorabotki-odbc-draivera>11.9. + Доработки ODBC драйвера<a class=headerlink href=../amp/#dorabotki-odbc-draivera title="Permanent link"> </a></h3><p>Денис Глазачев, Altinity. Хороший прогресс по этой задаче.</p><h3 id=prednastroennye-http-handlers-dlia-zaprosov>11.10. + Преднастроенные HTTP handlers для запросов<a class=headerlink href=../amp/#prednastroennye-http-handlers-dlia-zaprosov title="Permanent link"> </a></h3><p>zhang2014, есть pull request.</p><p>Возможность описать в конфигурационном файле handler (путь в URL) для HTTP запросов к серверу, которому соответствует некоторый параметризованный запрос. Пользователь может вызвать этот обработчик и не должен передавать SQL запрос.</p><h2 id=upravlenie-polzovateliami-i-dostupom>12. Управление пользователями и доступом<a class=headerlink href=../amp/#upravlenie-polzovateliami-i-dostupom title="Permanent link"> </a></h2><h3 id=role-based-access-control>12.1. + Role Based Access Control<a class=headerlink href=../amp/#role-based-access-control title="Permanent link"> </a></h3><p><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a>. Финальная стадия разработки, рабочая версия в начале апреля 2019.<br> Q2. Сейчас сделаны все интерфейсы в коде и запросы, но не сделаны варианты хранения прав кроме прототипа.<br> Upd. Сделано хранение прав. До готового к использованию состояния осталось несколько доработок.</p><h3 id=upravlenie-polzovateliami-i-pravami-dostupa-s-pomoshchiu-sql-zaprosov>12.2. + Управление пользователями и правами доступа с помощью SQL запросов<a class=headerlink href=../amp/#upravlenie-polzovateliami-i-pravami-dostupa-s-pomoshchiu-sql-zaprosov title="Permanent link"> </a></h3><p><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a>. Финальная стадия разработки, рабочая версия в декабре 2019.<br> Q1. Сделано управление правами полностью, но не реализовано их хранение, см. 12.1.</p><h3 id=podkliuchenie-spravochnika-polzovatelei-i-prav-dostupa-iz-ldap>12.3. Подключение справочника пользователей и прав доступа из LDAP<a class=headerlink href=../amp/#podkliuchenie-spravochnika-polzovatelei-i-prav-dostupa-iz-ldap title="Permanent link"> </a></h3><p>Аутентификация через LDAP - Денис Глазачев.<br><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a> и Денис Глазачев, Altinity. Требует 12.1.<br> Q3.</p><h3 id=podkliuchenie-idm-sistemy-iandeksa-kak-spravochnika-polzovatelei-i-prav-dostupa>12.4. Подключение IDM системы Яндекса как справочника пользователей и прав доступа<a class=headerlink href=../amp/#podkliuchenie-idm-sistemy-iandeksa-kak-spravochnika-polzovatelei-i-prav-dostupa title="Permanent link"> </a></h3><p>Пока низкий приоритет. Нужно для Метрики. Требует 12.3.</p><h3 id=pluggable-autentifikatsiia-s-pomoshchiu-kerberos-vozmozhno-podkliuchenie-gsasl>12.5. Pluggable аутентификация с помощью Kerberos (возможно, подключение GSASL)<a class=headerlink href=../amp/#pluggable-autentifikatsiia-s-pomoshchiu-kerberos-vozmozhno-podkliuchenie-gsasl title="Permanent link"> </a></h3><p><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a> и Денис Глазачев, Altinity. Требует 12.1.</p><h3 id=informatsiia-o-polzovateliakh-i-kvotakh-v-sistemnoi-tablitse>12.6. + Информация о пользователях и квотах в системной таблице<a class=headerlink href=../amp/#informatsiia-o-polzovateliakh-i-kvotakh-v-sistemnoi-tablitse title="Permanent link"> </a></h3><p><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a>. Требует 12.1.<br> Есть pull request. Q2. Готово.</p><h2 id=razdelenie-resursov-multi-tenancy>13. Разделение ресурсов, multi-tenancy<a class=headerlink href=../amp/#razdelenie-resursov-multi-tenancy title="Permanent link"> </a></h2><h3 id=overcommit-zaprosov-po-pamiati-i-vytesnenie>13.1. Overcommit запросов по памяти и вытеснение<a class=headerlink href=../amp/#overcommit-zaprosov-po-pamiati-i-vytesnenie title="Permanent link"> </a></h3><p>Требует 2.1. Способ реализации обсуждается. Александр Казаков.</p><h3 id=obshchii-konveier-vypolneniia-na-server>13.2. Общий конвейер выполнения на сервер<a class=headerlink href=../amp/#obshchii-konveier-vypolneniia-na-server title="Permanent link"> </a></h3><p>Требует 2.1. <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>.</p><h3 id=puly-resursov>13.3. Пулы ресурсов<a class=headerlink href=../amp/#puly-resursov title="Permanent link"> </a></h3><p>Александр Казаков.</p><p>Требует 13.2 или сможем сделать более неудобную реализацию раньше.<br> Обсуждается вариант неудобной реализации. Пока средний приоритет, целимся на Q1/Q2.<br> Вариант реализации выбрал Александр Казаков.<br> Upd. Не уследили, и задачу стали обсуждать менеджеры.<br> Upd. Задачу смотрит Александр Казаков.<br> Upd. Задача взята в работу.</p><h2 id=dialekt-sql>14. Диалект SQL<a class=headerlink href=../amp/#dialekt-sql title="Permanent link"> </a></h2><h3 id=ispravlenie-semantiki-cast-dlia-nullable>14.1. + Исправление семантики CAST для Nullable<a class=headerlink href=../amp/#ispravlenie-semantiki-cast-dlia-nullable title="Permanent link"> </a></h3><p>Нужно для DataLens. А также для внедрения в BI инструмент Looker.</p><h3 id=podderzhka-with-dlia-podzaprosov>14.2. Поддержка WITH для подзапросов<a class=headerlink href=../amp/#podderzhka-with-dlia-podzaprosov title="Permanent link"> </a></h3><h3 id=podderzhka-podstanovok-dlia-mnozhestv-v-pravoi-chasti-in>14.3. Поддержка подстановок для множеств в правой части IN<a class=headerlink href=../amp/#podderzhka-podstanovok-dlia-mnozhestv-v-pravoi-chasti-in title="Permanent link"> </a></h3><h3 id=podderzhka-podstanovok-dlia-identifikatorov-imion-v-sql-zaprose>14.4. Поддержка подстановок для идентификаторов (имён) в SQL запросе<a class=headerlink href=../amp/#podderzhka-podstanovok-dlia-identifikatorov-imion-v-sql-zaprose title="Permanent link"> </a></h3><p>zhang2014<br> Задача на паузе.</p><h3 id=podderzhka-zadaniia-mnozhestva-kak-massiva-v-pravoi-chasti-sektsii-in>14.5. + Поддержка задания множества как массива в правой части секции IN<a class=headerlink href=../amp/#podderzhka-zadaniia-mnozhestva-kak-massiva-v-pravoi-chasti-sektsii-in title="Permanent link"> </a></h3><p>Василий Немков, Altinity, делал эту задачу, но забросил её в пользу других задач.<br> В результате, сейчас доделывает Антон Попов.</p><h3 id=globalnyi-scope-dlia-with>14.6. Глобальный scope для WITH<a class=headerlink href=../amp/#globalnyi-scope-dlia-with title="Permanent link"> </a></h3><h3 id=nullable-dlia-with-rollup-with-cube-with-totals>14.7. Nullable для WITH ROLLUP, WITH CUBE, WITH TOTALS<a class=headerlink href=../amp/#nullable-dlia-with-rollup-with-cube-with-totals title="Permanent link"> </a></h3><p>Простая задача.</p><h3 id=modifikatory-distinct-order-by-dlia-agregatnykh-funktsii>14.8. Модификаторы DISTINCT, ORDER BY для агрегатных функций<a class=headerlink href=../amp/#modifikatory-distinct-order-by-dlia-agregatnykh-funktsii title="Permanent link"> </a></h3><p>В ClickHouse поддерживается вычисление COUNT(DISTINCT x). Предлагается добавить возможность использования модификатора DISTINCT для всех агрегатных функций. Например, AVG(DISTINCT x) - вычислить среднее значение для всех различных значений x. Под вопросом вариант, в котором фильтрация уникальных значений выполняется по одному выражению, а агрегация по другому.</p><p>Результат некоторых агрегатных функций зависит от порядка данных. Предлагается реализовать модификатор ORDER BY, задающий порядок явно. Пример: groupArray(x ORDER BY y, z).</p><p>Upd. Есть pull request-ы.<br> Upd. DISTINCT готов.</p><h3 id=podderzhka-zaprosa-explain>14.9. + Поддержка запроса EXPLAIN<a class=headerlink href=../amp/#podderzhka-zaprosa-explain title="Permanent link"> </a></h3><p>Требует 2.1. <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>.<br> Upd. Есть pull request. Готово.</p><h3 id=arrayreduce-kak-funktsiia-vysshego-poriadka>14.10. arrayReduce как функция высшего порядка<a class=headerlink href=../amp/#arrayreduce-kak-funktsiia-vysshego-poriadka title="Permanent link"> </a></h3><h3 id=funktsii-dlia-grouping-sets>14.11. Функции для grouping sets<a class=headerlink href=../amp/#funktsii-dlia-grouping-sets title="Permanent link"> </a></h3><h3 id=funktsii-obrabotki-vremennykh-riadov>14.12. Функции обработки временных рядов<a class=headerlink href=../amp/#funktsii-obrabotki-vremennykh-riadov title="Permanent link"> </a></h3><p>Сложная задача, так как вводит новый класс функций и требует его обработку в оптимизаторе запросов.</p><p>В time-series СУБД нужны функции, которые зависят от последовательности значений. Или даже от последовательности значений и их меток времени. Примеры: moving average, exponential smoothing, derivative, Holt-Winters forecast. Вычисление таких функций поддерживается в ClickHouse лишь частично. Так, ClickHouse поддерживает тип данных «массив» и позволяет реализовать эти функции как функции, принимающие массивы. Но гораздо удобнее для пользователя было бы иметь возможность применить такие функции к таблице (промежуточному результату запроса после сортировки).</p><p>Это требует введение нового класса функций (помимо обычных и агрегатных функций) - такие функции будут иметь в коде ClickHouse свой собственный интерфейс, и их вычисление придётся отдельно учитывать в конвейере выполнения запросов. Для примера, вычисление обычных функций тривиально распараллеливается по процессорным ядрам и по серверам; вычисление агрегатных функций распараллеливается с некоторыми особенностями (работа с промежуточными состояниями вычислений, операция merge); а для функций по обработке временных рядов этот вопрос остаётся открытым - возможно, их придётся вычислять на одном сервере и в одном потоке.</p><h3 id=primenimost-funktsii-vysshego-poriadka-dlia-kortezhei-i-nested>14.13. Применимость функций высшего порядка для кортежей и Nested<a class=headerlink href=../amp/#primenimost-funktsii-vysshego-poriadka-dlia-kortezhei-i-nested title="Permanent link"> </a></h3><h3 id=neiavnye-preobrazovaniia-tipov-konstant>14.14. Неявные преобразования типов констант<a class=headerlink href=../amp/#neiavnye-preobrazovaniia-tipov-konstant title="Permanent link"> </a></h3><p>Сделано для операторов сравнения с константами (подавляющее большинство use cases).<br> В общем виде требует 2.12.</p><h3 id=neiavnye-preobrazovaniia-tipov-pod-nastroikoi>14.15. Неявные преобразования типов под настройкой<a class=headerlink href=../amp/#neiavnye-preobrazovaniia-tipov-pod-nastroikoi title="Permanent link"> </a></h3><p>Требует 2.12. Для внедрения в BI инструмент Looker.</p><h3 id=sinonimy-dlia-funktsii-iz-mysql>14.16. Синонимы для функций из MySQL<a class=headerlink href=../amp/#sinonimy-dlia-funktsii-iz-mysql title="Permanent link"> </a></h3><h3 id=vvesti-poniatie-stateful-funktsii>14.17. + Ввести понятие stateful функций<a class=headerlink href=../amp/#vvesti-poniatie-stateful-funktsii title="Permanent link"> </a></h3><p>zhang2014.<br> Для runningDifference, neighbour - их учёт в оптимизаторе запросов.<br> В интерфейсе уже сделано. Надо проверить, что учитывается в нужных местах (например, что работает predicate pushdown сквозь ORDER BY, если таких функций нет).</p><h3 id=union-distinct-i-vozmozhnost-vkliuchit-ego-po-umolchaniiu>14.18. UNION DISTINCT и возможность включить его по-умолчанию<a class=headerlink href=../amp/#union-distinct-i-vozmozhnost-vkliuchit-ego-po-umolchaniiu title="Permanent link"> </a></h3><p>Для BI систем.</p><h3 id=sovmestimost-parsera-tipov-dannykh-s-sql>14.19. + Совместимость парсера типов данных с SQL<a class=headerlink href=../amp/#sovmestimost-parsera-tipov-dannykh-s-sql title="Permanent link"> </a></h3><p>Павел Потёмкин, ВШЭ.<br> Для BI систем.</p><h3 id=pozitsionnye-argumenty-dlia-group-by-i-order-by>14.20. Позиционные аргументы для GROUP BY и ORDER BY<a class=headerlink href=../amp/#pozitsionnye-argumenty-dlia-group-by-i-order-by title="Permanent link"> </a></h3><p>Тривиально и используется многими системами, но не входит в стандарт SQL.</p><h3 id=privedenie-tipov-dlia-in-podzapros-i-dlia-join>14.21. Приведение типов для IN (подзапрос) и для JOIN<a class=headerlink href=../amp/#privedenie-tipov-dlia-in-podzapros-i-dlia-join title="Permanent link"> </a></h3><h2 id=uluchshenie-podderzhki-join>15. Улучшение поддержки JOIN<a class=headerlink href=../amp/#uluchshenie-podderzhki-join title="Permanent link"> </a></h2><h3 id=dovedenie-merge-join-do-prodakshena>15.1. + Доведение merge JOIN до продакшена<a class=headerlink href=../amp/#dovedenie-merge-join-do-prodakshena title="Permanent link"> </a></h3><p>Артём Зуйков. Сейчас merge JOIN включается вручную опцией и всегда замедляет запросы. Хотим, чтобы он замедлял запросы только когда это неизбежно.<br> Кстати, смысл merge JOIN появляется только совместно с 15.2 и 15.3.<br> Q1. Сделали адаптивный вариант, но вроде он что-то всё-ещё замедляет.<br> Задача сделана, но всё работает слишком медленно.</p><h3 id=algoritm-two-level-merge-join>15.1.1. Алгоритм two-level merge JOIN<a class=headerlink href=../amp/#algoritm-two-level-merge-join title="Permanent link"> </a></h3><p>Также известен как grace hash join.<br> Артём Зуйков. В очереди.</p><h3 id=testirovanie-realizatsii-join-v-greenplum>15.1.2. Тестирование реализации JOIN в Greenplum<a class=headerlink href=../amp/#testirovanie-realizatsii-join-v-greenplum title="Permanent link"> </a></h3><p>В очереди. Как будто задача самоотменилась.</p><h3 id=prokidyvanie-uslovii-v-outer-join>15.2. Прокидывание условий в OUTER JOIN<a class=headerlink href=../amp/#prokidyvanie-uslovii-v-outer-join title="Permanent link"> </a></h3><p>Возможно, Артём Зуйков, но задача ещё не продумана до конца. Возможно, требует 2.1.</p><h3 id=logicheskii-vyvod-dlia-tsepochek-vida-on-t1-x-t2-y-where-t1-x-10>15.3. Логический вывод для цепочек вида ON t1.x = t2.y WHERE t1.x = 10<a class=headerlink href=../amp/#logicheskii-vyvod-dlia-tsepochek-vida-on-t1-x-t2-y-where-t1-x-10 title="Permanent link"> </a></h3><p>Возможно, Артём Зуйков. Для полноценной работы 15.2.</p><h3 id=distributed-join-s-pomoshchiu-pereraspredeleniia-dannykh>15.4. Distributed JOIN с помощью перераспределения данных<a class=headerlink href=../amp/#distributed-join-s-pomoshchiu-pereraspredeleniia-dannykh title="Permanent link"> </a></h3><p>Артём Зуйков.</p><h3 id=ispolzovanie-kliucha-tablitsy-dlia-optimizatsii-merge-join>15.5. Использование ключа таблицы для оптимизации merge JOIN<a class=headerlink href=../amp/#ispolzovanie-kliucha-tablitsy-dlia-optimizatsii-merge-join title="Permanent link"> </a></h3><h3 id=semi-i-anti-join>15.6. + SEMI и ANTI JOIN<a class=headerlink href=../amp/#semi-i-anti-join title="Permanent link"> </a></h3><p>Артём Зуйков.</p><h2 id=tipy-dannykh-i-funktsii>16. Типы данных и функции<a class=headerlink href=../amp/#tipy-dannykh-i-funktsii title="Permanent link"> </a></h2><h3 id=datetime64>16.1. + DateTime64<a class=headerlink href=../amp/#datetime64 title="Permanent link"> </a></h3><p>Василий Немков, Altinity, декабрь 2019.</p><h3 id=tip-dannykh-dlia-json>16.2. Тип данных для JSON<a class=headerlink href=../amp/#tip-dannykh-dlia-json title="Permanent link"> </a></h3><p>zhang2014</p><p>Есть PR, в процессе ревью.</p><h3 id=podderzhka-nekonstantnykh-argumentov-s-reguliarnymi-vyrazheniiami-v-funktsiiakh>16.3. Поддержка неконстантных аргументов с регулярными выражениями в функциях<a class=headerlink href=../amp/#podderzhka-nekonstantnykh-argumentov-s-reguliarnymi-vyrazheniiami-v-funktsiiakh title="Permanent link"> </a></h3><p>Данила Кутенин, но только после секретного изменения в работе.<br> Upd. Секретного изменения в работе не будет, задачу будет делать другой человек.</p><h3 id=funktsiia-rownumberforkey>16.4. Функция rowNumberForKey<a class=headerlink href=../amp/#funktsiia-rownumberforkey title="Permanent link"> </a></h3><h3 id=funktsii-dlia-xml-i-html-escape>16.5. Функции для XML и HTML escape<a class=headerlink href=../amp/#funktsii-dlia-xml-i-html-escape title="Permanent link"> </a></h3><h3 id=funktsii-normalizatsii-i-kheshirovaniia-sql-zaprosov>16.6. Функции нормализации и хэширования SQL запросов<a class=headerlink href=../amp/#funktsii-normalizatsii-i-kheshirovaniia-sql-zaprosov title="Permanent link"> </a></h3><h2 id=rabota-s-geograficheskimi-dannymi>17. Работа с географическими данными<a class=headerlink href=../amp/#rabota-s-geograficheskimi-dannymi title="Permanent link"> </a></h2><h3 id=geo-slovari-dlia-opredeleniia-regiona-po-koordinatam>17.1. Гео-словари для определения региона по координатам<a class=headerlink href=../amp/#geo-slovari-dlia-opredeleniia-regiona-po-koordinatam title="Permanent link"> </a></h3><p><a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>Андрей Чулков</a>, Антон Кваша, Артур Петуховский, ВШЭ.<br> Будет основано на коде от Арслана Урташева.</p><p>ClickHouse не является geospatial СУБД. Тем не менее, в ClickHouse есть несколько функций для таких задач. Например, функция <code class=syntax>pointInPolygon</code> позволяет быстро проверить попадание точек в полигон на плоскости. При этом, полигон задаётся в явном виде и должен быть константным для вызова функции (то есть - проверяется принадлежность многих точек одному полигону). Эта функциональность нужна, например, для рекламного таргетинга мобильных устройств по координатам.</p><p>Похожая, но более сложная задача, которую ClickHouse пока не умеет решать - определение полигона среди множества полигонов, в которые попадают точки. Для примера: определение района города по географическим координатам. Для решения этой задачи нужно будет реализовать поддержку словарей с полигонами, в которых данные проиндексированы для быстрого поиска.</p><p>Upd. Андрей сделал прототип интерфейса и реализацию-заглушку внутри него.<br> Upd. Андрей сделал прототип более оптимальной структуры данных.<br> Upd. Есть обнадёживающие результаты.<br> Upd. В ревью.</p><h3 id=gis-tipy-dannykh-i-operatsii>17.2. GIS типы данных и операции<a class=headerlink href=../amp/#gis-tipy-dannykh-i-operatsii title="Permanent link"> </a></h3><p>Алексей Коряков, Алексей Илюхов, ВШЭ, Яндекс.Карты.</p><p>Реализовать в ClickHouse типы данных для задач обработки геоинформационных данных: Point, Line, MultiLine, Polygon и операции над ними - проверка вхождения, пересечения. Вариантом минимум будет реализация этих операций в евклидовой системе координат. Дополнительно - на сфере и WGS84.</p><p>Upd. Есть pull request.</p><h3 id=uskorenie-greatcircledistance>17.3. + Ускорение greatCircleDistance<a class=headerlink href=../amp/#uskorenie-greatcircledistance title="Permanent link"> </a></h3><p><a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Ольга Хвостикова</a>, основано на коде Андрея Аксёнова, получено разрешение на использование кода.</p><h3 id=uskorenie-geohash-s-pomoshchiu-biblioteki-iz-arkadii>17.4. Ускорение geohash с помощью библиотеки из Аркадии<a class=headerlink href=../amp/#uskorenie-geohash-s-pomoshchiu-biblioteki-iz-arkadii title="Permanent link"> </a></h3><p>Получено одобрение от руководства.</p><h3 id=proverki-v-funktsii-pointinpolygon>17.5. + Проверки в функции pointInPolygon<a class=headerlink href=../amp/#proverki-v-funktsii-pointinpolygon title="Permanent link"> </a></h3><p>Сейчас функция тихо не работает в случае полигонов с самопересечениями, надо кидать исключение.</p><h2 id=mashinnoe-obuchenie-i-statistika>18. Машинное обучение и статистика<a class=headerlink href=../amp/#mashinnoe-obuchenie-i-statistika title="Permanent link"> </a></h2><h3 id=inkrementalnaia-klasterizatsiia-dannykh>18.1. Инкрементальная кластеризация данных<a class=headerlink href=../amp/#inkrementalnaia-klasterizatsiia-dannykh title="Permanent link"> </a></h3><p>Александр Кожихов, Максим Кузнецов. Обнаружена фундаментальная проблема в реализации, доделывает предположительно <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>. Он может делегировать задачу кому угодно.</p><p>Исправление фундаментальной проблемы - есть PR.</p><h3 id=agregatnye-funktsii-dlia-statisticheskikh-testov>18.2. Агрегатные функции для статистических тестов<a class=headerlink href=../amp/#agregatnye-funktsii-dlia-statisticheskikh-testov title="Permanent link"> </a></h3><p>Артём Цыганов, Руденский Константин Игоревич, Семёнов Денис, ВШЭ.</p><p>Предлагается реализовать в ClickHouse статистические тесты (Analysis of Variance, тесты нормальности распределения и т. п.) в виде агрегатных функций. Пример: <code class=syntax>welchTTest(value, sample_idx)</code>.</p><p>Сделали прототип двух тестов, есть pull request. Также есть pull request для корелляции рангов.</p><h3 id=infrastruktura-dlia-trenirovki-modelei-v-clickhouse>18.3. Инфраструктура для тренировки моделей в ClickHouse<a class=headerlink href=../amp/#infrastruktura-dlia-trenirovki-modelei-v-clickhouse title="Permanent link"> </a></h3><p>В очереди.</p><h2 id=uluchshenie-raboty-klastera>19. Улучшение работы кластера<a class=headerlink href=../amp/#uluchshenie-raboty-klastera title="Permanent link"> </a></h2><h3 id=parallelnye-kvorumnye-vstavki-bez-linearizuemosti>19.1. Параллельные кворумные вставки без линеаризуемости<a class=headerlink href=../amp/#parallelnye-kvorumnye-vstavki-bez-linearizuemosti title="Permanent link"> </a></h3><p>Репликация данных в ClickHouse по-умолчанию является асинхронной без выделенного мастера. Это значит, что клиент, осуществляющий вставку данных, получает успешный ответ после того, как данные попали на один сервер; репликация данных по остальным серверам осуществляется в другой момент времени. Это ненадёжно, потому что допускает потерю только что вставленных данных при потере лишь одного сервера.</p><p>Для решения этой проблемы, в ClickHouse есть возможность включить «кворумную» вставку. Это значит, что клиент, осуществляющий вставку данных, получает успешный ответ после того, как данные попали на несколько (кворум) серверов. Обеспечивается линеаризуемость: клиент, получает успешный ответ после того, как данные попали на несколько реплик, <em>которые содержат все предыдущие данные, вставленные с кворумом</em> (такие реплики можно называть «синхронными»), и при запросе SELECT можно выставить настройку, разрешающую только чтение с синхронных реплик.</p><p>Если бы свойства линеаризуемости не было, то для трёх серверов A, B, C, значения кворума = 2, и для трёх вставок данных 1, 2, 3, возможна ситуация, что первая вставка прошла на серверы A и B, вторая прошла на серверы B и C, а третья - на серверы A и C, и теперь ни один из серверов не содержит полный набор данных 1, 2, 3.</p><p>Как ни странно, такое свойство не нужно большинству пользователей. Оно запрещает параллельно выполняющиеся вставки. А пользователи хотят вставлять данные надёжно (на более чем одну реплику), но не важно, в каком порядке. Предлагается сделать опцию, которая отключает линеаризуемость.</p><p>Иногда пользователь хочет реализовать кворумную вставку вручную: просто соединиться с несколькими репликами и вставть на них одинаковые данные (чтобы обеспечить надёжную вставку, не ориентируясь на то, как работает механизм репликации). Сейчас ожидания пользователя не оправдываются. В ClickHouse есть механизм дедупликации для обеспечения идемпотентности вставок. Вторая вставка с такими же данными (пусть даже на другую реплику) будет проигнорирована. Надо сделать так, чтобы вместо этого, вставка одинаковых данных на другую реплику, имела такой же эффект, как если бы эти данные были получены с помощью механизма репликации.</p><h3 id=podkliuchenie-etcd-ili-consul-kak-alternativy-zookeeper>19.2. Подключение Etcd или Consul как альтернативы ZooKeeper<a class=headerlink href=../amp/#podkliuchenie-etcd-ili-consul-kak-alternativy-zookeeper title="Permanent link"> </a></h3><p>Алексей Лёвушкин, ВШЭ и Яндекс.</p><p>Для координации реплик в ClickHouse используется ZooKeeper. Многие пользователи ClickHouse хотели бы иметь возможность использовать для координации некоторые другие системы вместо ZooKeeper. Рассматриваемыми вариантами таких систем являются Etcd, Consul, FoundationDB. Это весьма проблематично, так как эти системы существенно отличаются по интерфейсам и возможностям. Тем не менее, для того, чтобы эта задача стала возможной, в ClickHouse обобщён интерфейс взаимодействия с ZooKeeper, и теперь на его место можно подставлять другие реализации.</p><p>В прошлом году, Алексей добавил модельную реализацию (mock) интерфейса ZooKeeper для тестирования. Сейчас предлагается сделать реализацию поверх Etcd, а также расширить возможности тестовой реализации.</p><p>Upd. Алексей сделал какой-то вариант, но борется с тем, что ничего не работает.<br> Upd. Есть pull request на начальной стадии.</p><h3 id=podkliuchenie-yt-cypress-ili-ydb-kak-alternativy-zookeeper>19.3. - Подключение YT Cypress или YDB как альтернативы ZooKeeper<a class=headerlink href=../amp/#podkliuchenie-yt-cypress-ili-ydb-kak-alternativy-zookeeper title="Permanent link"> </a></h3><p>Hold. Полезно для заказчиков внутри Яндекса, но есть риски. Эту задачу никто не будет делать.</p><h3 id=internal-replication-auto>19.4. internal_replication = ‘auto’<a class=headerlink href=../amp/#internal-replication-auto title="Permanent link"> </a></h3><h3 id=replitsiruemye-bazy-dannykh>19.5. Реплицируемые базы данных<a class=headerlink href=../amp/#replitsiruemye-bazy-dannykh title="Permanent link"> </a></h3><p>В очереди, возможно Валерий Батурин, ВШЭ.</p><p>Репликация в ClickHouse работает на уровне отдельных таблиц. Это является очень гибким решением: на одном сервере одна из таблиц может быть не реплицирована, другая иметь двухкратную репликацию, а третья - реплицирована по всем серверам. Но если все таблицы в базе данных реплицированы одинаковым образом. то это затрудняет управление кластером. Например, при восстановлени сервера, требуется отдельно создавать реплику для каждой таблицы.</p><p>Предлагается реализовать «движок баз данных», который осуществляет репликацию метаданных (множество имеющихся таблиц и лог DDL операций над ними: CREATE, DROP, RENAME, ALTER). Пользователь сможет создать реплицируемую базу данных; при её создании или восстановлении на другом сервере, все реплицируемые таблицы будут созданы автоматически.</p><p>Upd. Задача в разработке.</p><h3 id=odnovremennyi-vybor-kuskov-dlia-sliianiia-mnogimi-replikami-otkaz-ot-leader-election-v-zk>19.6. + Одновременный выбор кусков для слияния многими репликами, отказ от leader election в ZK<a class=headerlink href=../amp/#odnovremennyi-vybor-kuskov-dlia-sliianiia-mnogimi-replikami-otkaz-ot-leader-election-v-zk title="Permanent link"> </a></h3><p>Готово.</p><h3 id=vozmozhnost-zapisi-dannykh-pri-nedostupnosti-zk-i-otkaz-ot-lineinogo-poriadka-kuskov-v-bolshinstve-sluchaev>19.7. Возможность записи данных при недоступности ZK и отказ от линейного порядка кусков в большинстве случаев<a class=headerlink href=../amp/#vozmozhnost-zapisi-dannykh-pri-nedostupnosti-zk-i-otkaz-ot-lineinogo-poriadka-kuskov-v-bolshinstve-sluchaev title="Permanent link"> </a></h3><h3 id=otkaz-ot-khraneniia-v-zk-mnozhestva-kuskov-dlia-kazhdoi-repliki-otdelno>19.8. Отказ от хранения в ZK множества кусков для каждой реплики отдельно<a class=headerlink href=../amp/#otkaz-ot-khraneniia-v-zk-mnozhestva-kuskov-dlia-kazhdoi-repliki-otdelno title="Permanent link"> </a></h3><h3 id=otkaz-ot-khraneniia-v-zk-loga-vstavok-i-merzhei-obmen-dannymi-o-kuskakh-napriamuiu>19.9. Отказ от хранения в ZK лога вставок и мержей. Обмен данными о кусках напрямую<a class=headerlink href=../amp/#otkaz-ot-khraneniia-v-zk-loga-vstavok-i-merzhei-obmen-dannymi-o-kuskakh-napriamuiu title="Permanent link"> </a></h3><p>Три задачи выше обсуждаются, есть варианты.</p><h3 id=oblachnye-tablitsy>19.10. Облачные таблицы<a class=headerlink href=../amp/#oblachnye-tablitsy title="Permanent link"> </a></h3><p>Требует 1.6, 19.1, 19.6, 19.7, 19.8, 19.9.</p><h2 id=mutatsii-dannykh>20. Мутации данных<a class=headerlink href=../amp/#mutatsii-dannykh title="Permanent link"> </a></h2><p>Пока все задачи по точечным UPDATE/DELETE имеют низкий приоритет, но ожидаем взять в работу в середине 2020.</p><h3 id=podderzhka-delete-putiom-zapominaniia-mnozhestva-zatronutykh-kuskov-i-kliuchei>20.1. Поддержка DELETE путём запоминания множества затронутых кусков и ключей<a class=headerlink href=../amp/#podderzhka-delete-putiom-zapominaniia-mnozhestva-zatronutykh-kuskov-i-kliuchei title="Permanent link"> </a></h3><h3 id=podderzhka-delete-putiom-preobrazovaniia-mnozhestva-kliuchei-v-mnozhestvo-row-numbers-na-replike-stolbtsa-flagov-i-indeksa-po-diapazonam>20.2. Поддержка DELETE путём преобразования множества ключей в множество row_numbers на реплике, столбца флагов и индекса по диапазонам<a class=headerlink href=../amp/#podderzhka-delete-putiom-preobrazovaniia-mnozhestva-kliuchei-v-mnozhestvo-row-numbers-na-replike-stolbtsa-flagov-i-indeksa-po-diapazonam title="Permanent link"> </a></h3><h3 id=podderzhka-lenivykh-delete-putiom-zapominaniia-vyrazhenii-i-preobrazovaniia-k-mnozhestvu-kliuchei-v-fone>20.3. Поддержка ленивых DELETE путём запоминания выражений и преобразования к множеству ключей в фоне<a class=headerlink href=../amp/#podderzhka-lenivykh-delete-putiom-zapominaniia-vyrazhenii-i-preobrazovaniia-k-mnozhestvu-kliuchei-v-fone title="Permanent link"> </a></h3><h3 id=podderzhka-update-s-pomoshchiu-preobrazovaniia-v-delete-i-vstavok>20.4. Поддержка UPDATE с помощью преобразования в DELETE и вставок<a class=headerlink href=../amp/#podderzhka-update-s-pomoshchiu-preobrazovaniia-v-delete-i-vstavok title="Permanent link"> </a></h3><h2 id=optimizatsii-proizvoditelnosti>21. Оптимизации производительности<a class=headerlink href=../amp/#optimizatsii-proizvoditelnosti title="Permanent link"> </a></h2><h3 id=parallelnyi-parsing-formatov>21.1. + Параллельный парсинг форматов<a class=headerlink href=../amp/#parallelnyi-parsing-formatov title="Permanent link"> </a></h3><p>Начинал Олег Ершов, доделывает Никита Михайлов, помогает <a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Александр Кузьменков</a>. Готово.</p><h3 id=izbavlenie-ot-lishnego-kopirovaniia-pri-parallelnom-parsinge-formatov-esli-vozmozhen-mmap-faila-tselikom>21.1.1. Избавление от лишнего копирования при параллельном парсинге форматов, если возможен mmap файла целиком<a class=headerlink href=../amp/#izbavlenie-ot-lishnego-kopirovaniia-pri-parallelnom-parsinge-formatov-esli-vozmozhen-mmap-faila-tselikom title="Permanent link"> </a></h3><h3 id=parallelnoe-formatirovanie-formatov>21.2. Параллельное форматирование форматов<a class=headerlink href=../amp/#parallelnoe-formatirovanie-formatov title="Permanent link"> </a></h3><p>После 21.1, предположительно Никита Михайлов. Задача сильно проще чем 21.1.<br> В процессе.</p><h3 id=ispravlenie-nizkoi-proizvoditelnosti-analiza-indeksa-v-sluchae-bolshogo-mnozhestva-v-sektsii-in>21.3. + Исправление низкой производительности анализа индекса в случае большого множества в секции IN<a class=headerlink href=../amp/#ispravlenie-nizkoi-proizvoditelnosti-analiza-indeksa-v-sluchae-bolshogo-mnozhestva-v-sektsii-in title="Permanent link"> </a></h3><p>Нужно всем (Zen, БК, DataLens, TestEnv…). Антон Попов, Q1/Q2.</p><p>Upd. Антон делает эту задачу. Большая часть уже реализована.</p><h3 id=ispolzovanie-order-by-kliucha-dlia-optimizatsii-group-by-i-distinct>21.4. Использование ORDER BY ключа для оптимизации GROUP BY и DISTINCT<a class=headerlink href=../amp/#ispolzovanie-order-by-kliucha-dlia-optimizatsii-group-by-i-distinct title="Permanent link"> </a></h3><p>Дмитрий Рубашкин, ВШЭ. Помогает Антон Попов.</p><p>Если таблица имеет ключ сортировки, то возможно эффективное чтение упорядоченных данных. Если запрос содержит операцию GROUP BY, содержащую по крайней мере префикс от ключа сортировки таблицы, либо инъективные функции от него, то возможно более эффективное выполнение GROUP BY: промежуточный результат агрегации финализируется и отправляется клиенту как только в потоке данных при чтении из таблицы встретился следующий ключ.</p><p>Аналогичную оптимизацию следует реализовать для DISTINCT и LIMIT BY.</p><p>В прошлом году, аналогичное решение сделали для операции ORDER BY.</p><p>Upd. Есть pull request для GROUP BY. Приличные результаты.<br> Upd. Для GROUP BY готово, в процессе для DISTINCT.<br> Upd. Для DISTINCT есть pull request.</p><h3 id=rasparallelivanie-insert-pri-insert-select-esli-eto-neobkhodimo>21.5. + Распараллеливание INSERT при INSERT SELECT, если это необходимо<a class=headerlink href=../amp/#rasparallelivanie-insert-pri-insert-select-esli-eto-neobkhodimo title="Permanent link"> </a></h3><p><a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>Vxider</a>, ICT<br> Есть pull request.</p><h3 id=umenshenie-chisla-potokov-dlia-select-v-sluchae-trivialnogo-insert-select>21.6. Уменьшение числа потоков для SELECT в случае тривиального INSERT SELECT<a class=headerlink href=../amp/#umenshenie-chisla-potokov-dlia-select-v-sluchae-trivialnogo-insert-select title="Permanent link"> </a></h3><p>ucasFL, в разработке.</p><h3 id=kesh-rezultatov-zaprosov>21.7. Кэш результатов запросов<a class=headerlink href=../amp/#kesh-rezultatov-zaprosov title="Permanent link"> </a></h3><p><a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>Achimbab</a>.<br> Есть pull request. Но это не совсем то.<br> Upd. В обсуждении.</p><h3 id=vzaimnaia-integratsiia-allokatora-i-kesha>21.8. Взаимная интеграция аллокатора и кэша<a class=headerlink href=../amp/#vzaimnaia-integratsiia-allokatora-i-kesha title="Permanent link"> </a></h3><p>Михаил Кот, ВШЭ. Задача сложная и рискованная.</p><p>Для выделения памяти, аллокаторы запрашивают её у операционной системы (<code class=syntax>mmap</code>). Это возможно только для достаточно крупных кусков памяти является довольно медленной операцией. Поэтому, современные аллокаторы кэшируют крупные куски памяти в программе. При вызове free, кусок памяти, как правило, не отдаётся ОС, а остаётся для последующего переиспользования. Для выделения мелких кусков памяти, крупные куски разбиваются с помощью специальных структур данных (free-list, heap, bitmap). Для уменьшения contention в многопоточных программах, эти структуры также делаются thread-локальными.</p><p>Часто в программе есть кэши некоторых данных. Например - кэш данных после разжатия, использующийся чтобы сэкономить на повторных запросах одних и тех же данных. При вытеснении из кэша, блок данных освобождается (<code class=syntax>free</code>) и данные, бывшие в кэше, становятся недоступными для переиспользования. Но если принимать во внимание то, как работает аллокатор памяти, то оказывается, что после освобождения памяти, данные всё ещё остаются доступными в программе. И если этот кусок памяти не будет выделен аллокатором снова, его можно было бы продолжить использовать в качестве кэша. Иными словами, в программе есть domain-specific кэш, а аллокатор имеет свой кэш, и они не знают друг о друге.</p><p>Для domain-specific кэшей (как например, кэш разжатых данных) выгодно, чтобы они использовали как можно больший объём свободной памяти. Но в этом случае, памяти может не хватить для других структур данных в программе. Если аллокатор памяти знает про кэш, то выделение памяти можно было бы делать путём вытеснения данных из кэша.</p><p>Upd. Есть нерабочий прототип, скорее всего будет отложено.<br> Upd. Отложено до осени.</p><h3 id=otdelnyi-allokator-dlia-keshei-s-aslr>21.8.1. Отдельный аллокатор для кэшей с ASLR<a class=headerlink href=../amp/#otdelnyi-allokator-dlia-keshei-s-aslr title="Permanent link"> </a></h3><p>В прошлом году задачу пытался сделать Данила Кутенин с помощью lfalloc из Аркадии и mimalloc из Microsoft, но оба решения не были квалифицированы для использования в продакшене. Успешная реализация задачи 21.8 отменит необходимость в этой задаче, поэтому холд.</p><h3 id=ispravit-push-down-vyrazhenii-s-pomoshchiu-processors>21.9. Исправить push-down выражений с помощью Processors<a class=headerlink href=../amp/#ispravit-push-down-vyrazhenii-s-pomoshchiu-processors title="Permanent link"> </a></h3><p><a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>. Требует 2.1.</p><h3 id=uluchshenie-evristiki-prewhere>21.10. + Улучшение эвристики PREWHERE<a class=headerlink href=../amp/#uluchshenie-evristiki-prewhere title="Permanent link"> </a></h3><p>Amos Bird.</p><h3 id=peephole-optimizatsii-zaprosov>21.11. Peephole оптимизации запросов<a class=headerlink href=../amp/#peephole-optimizatsii-zaprosov title="Permanent link"> </a></h3><p>Руслан Камалов, Михаил Малафеев, Виктор Гришанин, ВШЭ</p><p>Реализовать в ClickHouse оптимизации запросов, основанные на упрощении отдельных небольших кусков выражений (так называемые «peephole» оптимизации). Примеры:<br> - Замена цепочек if на multiIf.<br> - Удаление min/max/any-агрегатов от выражений от ключей GROUP BY.<br> - Вынесение арифметических операций из агрегатных функций;<br> - Вынесение любых функций наружу any, anyLast.<br> - При GROUP BY по transform или if по строкам, замена строк на Enum.</p><p>Сделана замена цепочек if на multiIf, но внезапно оказалось, что это является не оптимизацией, а наоборот.<br> Сделано ещё несколько оптимизаций.<br> Upd. Все вышеперечисленные оптимизации доступны в pull requests.<br> Upd. Из них почти все помержены, осталась одна.</p><h3 id=algebraicheskie-optimizatsii-zaprosov>21.12. Алгебраические оптимизации запросов<a class=headerlink href=../amp/#algebraicheskie-optimizatsii-zaprosov title="Permanent link"> </a></h3><p>Руслан Камалов, Михаил Малафеев, Виктор Гришанин, ВШЭ</p><p>Реализовать в ClickHouse оптимизации запросов, основанные на алгебраических свойствах функций. Примеры:<br> - Обращение инъективных функций в сравнениях на равенство.<br> - Вынесение инъективных функцию наружу uniq.<br> - Удаление монотонных функций из ORDER BY.<br> - Удаление избыточных выражений из ORDER BY.<br> - Удаление из GROUP BY функций от других ключей GROUP BY.<br> - Удаление дублирующихся DISTINCT, ORDER BY из подзапросов.</p><p>Несколько оптимизаций есть в PR.<br> Upd. Все оптимизации кроме "Обращение инъективных функций в сравнениях на равенство" есть в PR.<br> Upd. Из них больше половины помержены, осталось ещё две.</p><h3 id=fusion-agregatnykh-funktsii>21.13. Fusion агрегатных функций<a class=headerlink href=../amp/#fusion-agregatnykh-funktsii title="Permanent link"> </a></h3><p>После или совместно с 21.11.</p><h3 id=optimizatsiia-zaprosov-s-pomoshchiu-constraints>21.14. Оптимизация запросов с помощью constraints<a class=headerlink href=../amp/#optimizatsiia-zaprosov-s-pomoshchiu-constraints title="Permanent link"> </a></h3><p>Constraints позволяют задать выражение, истинность которого проверяется при вставке данных в таблицу. Предположение о том, что выражение истинно, может использоваться и для оптимизации запросов. Например, встретив в запросе точно такое же выражение, можно заменить его на константу 1.</p><p>Если выражение содержит равенство, то встретив в запросе одну из частей равенства, её можно заменить на другую часть равенства, если это сделает проще чтение данных или вычисление выражения. Например, задан constraint: <code class=syntax>URLDomain = domain(URL)</code>. Значит, выражение <code class=syntax>domain(URL)</code> можно заменить на <code class=syntax>URLDomain</code>.</p><p>Upd. Возможно будет отложено на следующий год.</p><h3 id=mnogostupenchatoe-chtenie-dannykh-vmesto-prewhere>21.15. Многоступенчатое чтение данных вместо PREWHERE<a class=headerlink href=../amp/#mnogostupenchatoe-chtenie-dannykh-vmesto-prewhere title="Permanent link"> </a></h3><p>Требует 2.1 и 21.10.</p><h3 id=optimizatsiia-group-by-s-bolshim-kolichestvom-agregatnykh-funktsii-putiom-vychisleniia-v-dva-prokhoda>21.16. Оптимизация GROUP BY с большим количеством агрегатных функций путём вычисления в два прохода<a class=headerlink href=../amp/#optimizatsiia-group-by-s-bolshim-kolichestvom-agregatnykh-funktsii-putiom-vychisleniia-v-dva-prokhoda title="Permanent link"> </a></h3><p>Нужно для БК.</p><h3 id=optimizatsiia-group-by-pri-nalichii-order-by-po-tem-zhe-kliucham-s-limit>21.17. Оптимизация GROUP BY при наличии ORDER BY по тем же ключам с LIMIT<a class=headerlink href=../amp/#optimizatsiia-group-by-pri-nalichii-order-by-po-tem-zhe-kliucham-s-limit title="Permanent link"> </a></h3><p>Нужно для БК.</p><h3 id=vnutrenniaia-parallelizatsiia-merzha-bolshikh-sostoianii-agregatnykh-funktsii>21.18. Внутренняя параллелизация мержа больших состояний агрегатных функций<a class=headerlink href=../amp/#vnutrenniaia-parallelizatsiia-merzha-bolshikh-sostoianii-agregatnykh-funktsii title="Permanent link"> </a></h3><h3 id=optimizatsiia-sortirovki>21.19. Оптимизация сортировки<a class=headerlink href=../amp/#optimizatsiia-sortirovki title="Permanent link"> </a></h3><p>Василий Морозов, Арслан Гумеров, Альберт Кидрачев, ВШЭ.<br> В прошлом году задачу начинал делать другой человек, но не добился достаточного прогресса.</p><ul><li><ol><li>Оптимизация top sort.</li></ol></li></ul><p>В ClickHouse используется неоптимальный вариант top sort. Суть его в том, что из каждого блока достаётся top N записей, а затем, все блоки мержатся. Но доставание top N записей у каждого следующего блока бессмысленно, если мы знаем, что из них в глобальный top N войдёт меньше. Конечно нужно реализовать вариацию на тему priority queue (heap) с быстрым пропуском целых блоков, если ни одна строка не попадёт в накопленный top.</p><ul><li><ol start=2><li>Рекурсивный вариант сортировки по кортежам.</li></ol></li></ul><p>Для сортировки по кортежам используется обычная сортировка с компаратором, который в цикле по элементам кортежа делает виртуальные вызовы <code class=syntax>IColumn::compareAt</code>. Это неоптимально - как из-за короткого цикла по неизвестному в compile-time количеству элементов, так и из-за виртуальных вызовов. Чтобы обойтись без виртуальных вызовов, есть метод <code class=syntax>IColumn::getPermutation</code>. Он используется в случае сортировки по одному столбцу. Есть вариант, что в случае сортировки по кортежу, что-то похожее тоже можно применить… например, сделать метод <code class=syntax>updatePermutation</code>, принимающий аргументы offset и limit, и допереставляющий перестановку в диапазоне значений, в которых предыдущий столбец имел равные значения.</p><ol start=3><li>RadixSort для сортировки.</li></ol><p>Один наш знакомый начал делать задачу по попытке использования RadixSort для сортировки столбцов. Был сделан вариант indirect сортировки (для <code class=syntax>getPermutation</code>), но не оптимизирован до конца - есть лишние ненужные перекладывания элементов. Для того, чтобы его оптимизировать, придётся добавить немного шаблонной магии (на последнем шаге что-то не копировать, вместо перекладывания индексов - складывать их в готовое место). Также этот человек добавил метод MSD Radix Sort для реализации radix partial sort. Но даже не проверил производительность.</p><p>Наиболее содержательная часть задачи может состоять в применении Radix Sort для сортировки кортежей, расположенных в оперативке в виде Structure Of Arrays неизвестного в compile-time размера. Это может работать хуже, чем то, что описано в пункте 2… Но попробовать не помешает.</p><ol start=4><li>Three-way comparison sort.</li></ol><p>Виртуальный метод <code class=syntax>compareAt</code> возвращает -1, 0, 1. Но алгоритмы сортировки сравнениями обычно рассчитаны на <code class=syntax>operator&lt;</code> и не могут получить преимущества от three-way comparison. А можно ли написать так, чтобы преимущество было?</p><ol start=5><li>pdq partial sort</li></ol><p>Хороший алгоритм сортировки сравнениями <code class=syntax>pdqsort</code> не имеет варианта partial sort. Заметим, что на практике, почти все сортировки в запросах ClickHouse являются partial_sort, так как <code class=syntax>ORDER BY</code> почти всегда идёт с <code class=syntax>LIMIT</code>. Кстати, Данила Кутенин уже попробовал это и показал, что в тривиальном случае преимущества нет. Но не очевидно, что нельзя сделать лучше.</p><h3 id=ispolzovanie-materializovannykh-predstavlenii-dlia-optimizatsii-zaprosov>21.20. Использование материализованных представлений для оптимизации запросов<a class=headerlink href=../amp/#ispolzovanie-materializovannykh-predstavlenii-dlia-optimizatsii-zaprosov title="Permanent link"> </a></h3><p>В ByteDance есть готовая реализация, но они её боятся из-за, возможно, низкого качества кода.<br> Upd. Вместо этого будем делать задачу 1.16.</p><h3 id=chtenie-bolshikh-failov-s-pomoshchiu-mmap>21.21. + Чтение больших файлов с помощью mmap<a class=headerlink href=../amp/#chtenie-bolshikh-failov-s-pomoshchiu-mmap title="Permanent link"> </a></h3><p>Сделан вариант, но достаточно топорный. Без тестирования в продакшене включать по-умолчанию нельзя.</p><h3 id=userspace-page-cache>21.22. Userspace page cache<a class=headerlink href=../amp/#userspace-page-cache title="Permanent link"> </a></h3><p>Требует 21.8.</p><h3 id=uskorenie-raboty-s-vtorichnymi-indeksami>21.23. Ускорение работы с вторичными индексами<a class=headerlink href=../amp/#uskorenie-raboty-s-vtorichnymi-indeksami title="Permanent link"> </a></h3><p>zhang2014.<br> Есть pull request.</p><h2 id=dolgi-i-nedodelannye-vozmozhnosti>22. Долги и недоделанные возможности<a class=headerlink href=../amp/#dolgi-i-nedodelannye-vozmozhnosti title="Permanent link"> </a></h2><h3 id=ispravlenie-nerabotaiushchikh-taimautov-esli-ispolzuetsia-tls>22.1. + Исправление неработающих таймаутов, если используется TLS<a class=headerlink href=../amp/#ispravlenie-nerabotaiushchikh-taimautov-esli-ispolzuetsia-tls title="Permanent link"> </a></h3><p>Нужно для Яндекс.Облака. Сделал Алексей Миловидов.</p><h3 id=ubrat-vozmozhnost-izmenit-nastroiki-v-native-protokole-v-sluchae-readonly>22.2. + Убрать возможность изменить настройки в native протоколе в случае readonly<a class=headerlink href=../amp/#ubrat-vozmozhnost-izmenit-nastroiki-v-native-protokole-v-sluchae-readonly title="Permanent link"> </a></h3><p>N.Vartolomei.</p><h3 id=zashchita-ot-absurdno-zadannykh-polzovatelem-kodekov>22.3. + Защита от абсурдно заданных пользователем кодеков<a class=headerlink href=../amp/#zashchita-ot-absurdno-zadannykh-polzovatelem-kodekov title="Permanent link"> </a></h3><h3 id=ispravlenie-ostavshikhsia-deadlocks-v-tablichnykh-rwlock-akh>22.4. + Исправление оставшихся deadlocks в табличных RWLock-ах<a class=headerlink href=../amp/#ispravlenie-ostavshikhsia-deadlocks-v-tablichnykh-rwlock-akh title="Permanent link"> </a></h3><p>Александр Казаков. Нужно для Яндекс.Метрики и Datalens. Задача постепенно тащится и исправлениями в соседних местах стала менее актуальна.<br> В Q1 будет сделана или отменена с учётом 1.2. и 1.3.<br> Upd. Добавили таймауты.</p><h3 id=ispravlenie-redkikh-srabatyvanii-tsan-v-stress-testakh-v-ci>22.5. + Исправление редких срабатываний TSan в stress тестах в CI<a class=headerlink href=../amp/#ispravlenie-redkikh-srabatyvanii-tsan-v-stress-testakh-v-ci title="Permanent link"> </a></h3><p>Александр Казаков сделал эту задачу.</p><h3 id=izmenenie-tolko-default-v-alter-table-mozhet-pomeniat-tip-stolbtsa>22.6. + Изменение только DEFAULT в ALTER TABLE может поменять тип столбца<a class=headerlink href=../amp/#izmenenie-tolko-default-v-alter-table-mozhet-pomeniat-tip-stolbtsa title="Permanent link"> </a></h3><p>Александр Сапин сделал эту задачу.</p><h3 id=row-level-security-ne-rabotaet-v-sluchae-nalichiia-v-zaprose-in-podzaprosov>22.7. + Row-Level Security не работает в случае наличия в запросе IN подзапросов<a class=headerlink href=../amp/#row-level-security-ne-rabotaet-v-sluchae-nalichiia-v-zaprose-in-podzaprosov title="Permanent link"> </a></h3><p>Нужно для Метрики. Иван Лежанкин.</p><h3 id=ispravit-deserializatsiiu-parametrov-dlia-parametrizovannykh-zaprosov>22.8. + Исправить десериализацию параметров для параметризованных запросов<a class=headerlink href=../amp/#ispravit-deserializatsiiu-parametrov-dlia-parametrizovannykh-zaprosov title="Permanent link"> </a></h3><p>Хотел исправить Василий Немков, Altinity, но есть маленькие затруднения, наверное переделает Алексей Миловидов.</p><h3 id=razobratsia-s-deserializatsiei-massivov-so-znacheniiami-po-umolchaniiu-v-protobuf-formate-v-sluchae-protobuf-3>22.9. Разобраться с десериализацией массивов со значениями по-умолчанию в Protobuf формате в случае protobuf 3<a class=headerlink href=../amp/#razobratsia-s-deserializatsiei-massivov-so-znacheniiami-po-umolchaniiu-v-protobuf-formate-v-sluchae-protobuf-3 title="Permanent link"> </a></h3><p><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a>. Возможно, это - фундаментальная проблема и следует её только документировать.<br> Кажется, отменяем, но пока ещё не всё ясно.</p><h3 id=ispravlenie-drifta-pri-otslezhivanii-potrebleniia-pamiati-zaprosami>22.10. + Исправление дрифта при отслеживании потребления памяти запросами<a class=headerlink href=../amp/#ispravlenie-drifta-pri-otslezhivanii-potrebleniia-pamiati-zaprosami title="Permanent link"> </a></h3><p>Требует 6.3., но можно улучшить отдельными хаками. Нужно Метрике и БК.</p><h3 id=bolee-prostaia-serde-nastroek-zaprosov>22.11. + Более простая ser/de настроек запросов<a class=headerlink href=../amp/#bolee-prostaia-serde-nastroek-zaprosov title="Permanent link"> </a></h3><p>И пропуск неизвестных настроек. Важно для Метрики для упрощения апгрейда без изменения конфига.<br><a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Виталий Баранов</a>, готово.</p><h3 id=ispravlenie-nizkoi-proizvoditelnosti-chteniia-iz-kafka>22.12. + Исправление низкой производительности чтения из Kafka<a class=headerlink href=../amp/#ispravlenie-nizkoi-proizvoditelnosti-chteniia-iz-kafka title="Permanent link"> </a></h3><p>Для ClickHouse нехарактерно наличие кода, обладающего столь низкой производительностью. Практики разработки не подразумевают, что такой код должен попасть в продакшен без надлежащего тестирования производительности.</p><p>Изначально было назначено на <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ивана Лежанкина</a>, но по неизвестной причине было не сделано в течение нескольких месяцев.<br> Сделал Михаил Филимонов, Altinity.</p><h3 id=posmotret-pochemu-ne-rabotaiut-nekotorye-collations>22.13. + Посмотреть, почему не работают некоторые collations<a class=headerlink href=../amp/#posmotret-pochemu-ne-rabotaiut-nekotorye-collations title="Permanent link"> </a></h3><p>Изначально было назначено на <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ивана Лежанкина</a>, но в результате сделал Александр Сапин.</p><h3 id=posmotret-pochemu-ne-rabotaet-storageset-dlia-mergetree-tablits-pri-nekotorykh-usloviiakh>22.14. + Посмотреть, почему не работает StorageSet для MergeTree таблиц при некоторых условиях<a class=headerlink href=../amp/#posmotret-pochemu-ne-rabotaet-storageset-dlia-mergetree-tablits-pri-nekotorykh-usloviiakh title="Permanent link"> </a></h3><p>Вроде бы сделал Никита Михайлов - проверить существующие issues на эту тему.</p><h3 id=normalizatsiia-kommitov-v-kafka-i-idempotentnosti-operatsii>22.15. Нормализация коммитов в Kafka и идемпотентности операций<a class=headerlink href=../amp/#normalizatsiia-kommitov-v-kafka-i-idempotentnosti-operatsii title="Permanent link"> </a></h3><p>Altinity.<br> Я не в курсе, какой статус.</p><h3 id=ispravlenie-nizkoi-proizvoditelnosti-kodeka-doubledelta>22.16. + Исправление низкой производительности кодека DoubleDelta<a class=headerlink href=../amp/#ispravlenie-nizkoi-proizvoditelnosti-kodeka-doubledelta title="Permanent link"> </a></h3><p>Василий Немков, Altinity - в процессе.<br> Upd. Готово.</p><h3 id=konsistentno-rabotaiushchii-populate-dlia-materializedview>22.17. Консистентно работающий POPULATE для MaterializedView<a class=headerlink href=../amp/#konsistentno-rabotaiushchii-populate-dlia-materializedview title="Permanent link"> </a></h3><h3 id=ispravlenie-zametnogo-padeniia-proizvoditelnosti-formatov-posle-dobavleniia-domenov-tipov>22.18. Исправление заметного падения производительности форматов после добавления доменов типов<a class=headerlink href=../amp/#ispravlenie-zametnogo-padeniia-proizvoditelnosti-formatov-posle-dobavleniia-domenov-tipov title="Permanent link"> </a></h3><p>Василий Немков, Altinity.</p><h3 id=odnovremennoe-ispolzovanie-sample-i-prewhere>22.19. + Одновременное использование SAMPLE и PREWHERE<a class=headerlink href=../amp/#odnovremennoe-ispolzovanie-sample-i-prewhere title="Permanent link"> </a></h3><p>Нужно для Метрики. <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>, ноябрь 2019.</p><h3 id=nepravilnaia-rabota-prewhere-pri-nekotorykh-usloviiakh>22.20. + Неправильная работа PREWHERE при некоторых условиях<a class=headerlink href=../amp/#nepravilnaia-rabota-prewhere-pri-nekotorykh-usloviiakh title="Permanent link"> </a></h3><p><a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>, декабрь 2019.</p><h3 id=nepravilnoe-povedenie-datetime-v-raione-nachala-unix-epoch>22.21. + Неправильное поведение DateTime в районе начала unix epoch<a class=headerlink href=../amp/#nepravilnoe-povedenie-datetime-v-raione-nachala-unix-epoch title="Permanent link"> </a></h3><p>Алексей Миловидов.</p><h3 id=nullable-v-funktsii-transform-i-v-case-po-mnozhestvu-znachenii>22.22. Nullable в функции transform и в CASE по множеству значений<a class=headerlink href=../amp/#nullable-v-funktsii-transform-i-v-case-po-mnozhestvu-znachenii title="Permanent link"> </a></h3><p>После 10.14.</p><p><a href=https://github.com/ClickHouse/ClickHouse/issues/7237 rel="external nofollow noreferrer" target=_blank>#7237</a><br><a href=https://github.com/ClickHouse/ClickHouse/issues/2655 rel="external nofollow noreferrer" target=_blank>#2655</a></p><h3 id=pravilnaia-obrabotka-nullable-v-funktsiiakh-kotorye-kidaiut-iskliuchenie-na-default-znachenii-modulo-intdiv>22.23. Правильная обработка Nullable в функциях, которые кидают исключение на default значении: modulo, intDiv<a class=headerlink href=../amp/#pravilnaia-obrabotka-nullable-v-funktsiiakh-kotorye-kidaiut-iskliuchenie-na-default-znachenii-modulo-intdiv title="Permanent link"> </a></h3><h3 id=izlishniaia-filtratsiia-odbc-connection-string>22.24. + Излишняя фильтрация ODBC connection string<a class=headerlink href=../amp/#izlishniaia-filtratsiia-odbc-connection-string title="Permanent link"> </a></h3><p>Нужно для Метрики. Алексей Миловидов.</p><h3 id=izbavitsia-ot-biblioteki-btrie>22.25. Избавиться от библиотеки btrie<a class=headerlink href=../amp/#izbavitsia-ot-biblioteki-btrie title="Permanent link"> </a></h3><p>Алексей Миловидов. Низкий приоритет.</p><h3 id=plokhaia-proizvoditelnost-quantiletdigest>22.26. Плохая производительность quantileTDigest<a class=headerlink href=../amp/#plokhaia-proizvoditelnost-quantiletdigest title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/2668 rel="external nofollow noreferrer" target=_blank>#2668</a></p><p>Алексей Миловидов или будет переназначено.</p><h3 id=proverit-neskolko-pr-kotorye-byli-zakryty-zhang2014-i-sundy-li>22.27. Проверить несколько PR, которые были закрыты zhang2014 и sundy-li<a class=headerlink href=../amp/#proverit-neskolko-pr-kotorye-byli-zakryty-zhang2014-i-sundy-li title="Permanent link"> </a></h3><p>Алексей Миловидов.</p><h3 id=izuchit-i-ispravit-povedenie-raboty-s-kafka-pri-rebalansirovke>22.28. Изучить и исправить поведение работы с Kafka при ребалансировке<a class=headerlink href=../amp/#izuchit-i-ispravit-povedenie-raboty-s-kafka-pri-rebalansirovke title="Permanent link"> </a></h3><p>Altinity.</p><h3 id=uiazvimost-ddl-dlia-slovarei-executable>22.29. + Уязвимость DDL для словарей executable<a class=headerlink href=../amp/#uiazvimost-ddl-dlia-slovarei-executable title="Permanent link"> </a></h3><p><a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a></p><h2 id=default-festival>23. Default Festival<a class=headerlink href=../amp/#default-festival title="Permanent link"> </a></h2><h3 id=vkliuchenie-minimalistic-part-header-v-zookeeper>23.1. + Включение minimalistic_part_header в ZooKeeper<a class=headerlink href=../amp/#vkliuchenie-minimalistic-part-header-v-zookeeper title="Permanent link"> </a></h3><p>Сильно уменьшает объём данных в ZooKeeper. Уже год в продакшене в Яндекс.Метрике.<br> Алексей Миловидов, ноябрь 2019.</p><h3 id=vkliuchenie-distributed-aggregation-memory-efficient>23.2. Включение distributed_aggregation_memory_efficient<a class=headerlink href=../amp/#vkliuchenie-distributed-aggregation-memory-efficient title="Permanent link"> </a></h3><p>Есть риски меньшей производительности лёгких запросов, хотя производительность тяжёлых запросов всегда увеличивается.</p><h3 id=vkliuchenie-min-bytes-to-external-sort-i-min-bytes-to-external-group-by>23.3. Включение min_bytes_to_external_sort и min_bytes_to_external_group_by<a class=headerlink href=../amp/#vkliuchenie-min-bytes-to-external-sort-i-min-bytes-to-external-group-by title="Permanent link"> </a></h3><p>Желательно 5.2. и 13.1.</p><h3 id=vkliuchenie-sinkhronnoi-zapisi-v-distributed-tablitsy-po-umolchaniiu>23.4. Включение синхронной записи в Distributed таблицы по-умолчанию<a class=headerlink href=../amp/#vkliuchenie-sinkhronnoi-zapisi-v-distributed-tablitsy-po-umolchaniiu title="Permanent link"> </a></h3><p>Есть гипотеза, что плохо работает на очень больших кластерах.</p><h3 id=vkliuchenie-compile-expressions>23.5. Включение compile_expressions<a class=headerlink href=../amp/#vkliuchenie-compile-expressions title="Permanent link"> </a></h3><p>Требует 7.2. Задачу изначально на 99% сделал Денис Скоробогатов, ВШЭ и Яндекс. Остальной процент доделывал Алексей Миловидов, а затем <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>.</p><h3 id=vkliuchenie-uchiota-poriadka-stolbtsov-v-csv>23.6. + Включение учёта порядка столбцов в CSV<a class=headerlink href=../amp/#vkliuchenie-uchiota-poriadka-stolbtsov-v-csv title="Permanent link"> </a></h3><p>Просто аккуратно включить.</p><h3 id=vkliuchenie-null-as-default-v-csv>23.7. Включение NULL as Default в CSV<a class=headerlink href=../amp/#vkliuchenie-null-as-default-v-csv title="Permanent link"> </a></h3><p>Просто аккуратно включить.</p><h3 id=vkliuchenie-optimizatsii-values>23.8. + Включение оптимизации VALUES<a class=headerlink href=../amp/#vkliuchenie-optimizatsii-values title="Permanent link"> </a></h3><p>Просто аккуратно включить.</p><h3 id=vkliuchenie-processors>23.9. + Включение Processors<a class=headerlink href=../amp/#vkliuchenie-processors title="Permanent link"> </a></h3><p>Q1. <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>.</p><h3 id=vkliuchenie-mlock-binarnika>23.10. + Включение mlock бинарника<a class=headerlink href=../amp/#vkliuchenie-mlock-binarnika title="Permanent link"> </a></h3><p>Возможность mlock бинарника сделал Олег Алексеенков <a href=https://github.com/ClickHouse/ClickHouse/pull/3553 rel="external nofollow noreferrer" target=_blank>#3553</a><br> . Поможет, когда на серверах кроме ClickHouse работает много посторонних программ (мы иногда называем их в шутку «треш-программами»).</p><h2 id=eksperimentalnye-zadachi>24. Экспериментальные задачи<a class=headerlink href=../amp/#eksperimentalnye-zadachi title="Permanent link"> </a></h2><h3 id=veb-interfeis-dlia-prosmotra-sostoianiia-klastera-i-profilirovaniia-zaprosov>24.1. Веб-интерфейс для просмотра состояния кластера и профилирования запросов<a class=headerlink href=../amp/#veb-interfeis-dlia-prosmotra-sostoianiia-klastera-i-profilirovaniia-zaprosov title="Permanent link"> </a></h3><p>Антон Мамонов, УрФУ, Яндекс.</p><p>Внутри ClickHouse есть богатые возможности по интроспекции и профилированию. Эти возможности доступны через системные таблицы и использовать их приходится путём формулирования SQL запросов. Это неудобно.</p><p>Вместо этого предлагается сделать, чтобы ClickHouse отдавал HTML страницу, реализующую интерактивный web-интерфейс со следующими возможностями:<br> - отображение состояния кластеров (какие кластеры известны, статус каждого сервера);<br> - графики нагрузки текущего сервера или выбранного сервера кластера;<br> - обновляемый список запросов;<br> - просмотр лога запросов с наиболее востребованными фильтрациями по одной кнопке;<br> - просмотр лога на кластере, например - последние ошибки;<br> - просмотр метрик использования ресурсов, flame graph и pprof-граф для выбранных запросов;<br> - отчёт по использованию кластера (пример: количество ядер CPU по пользователям за сегодня).</p><h3 id=eksperimentalnye-algoritmy-szhatiia>24.2. Экспериментальные алгоритмы сжатия<a class=headerlink href=../amp/#eksperimentalnye-algoritmy-szhatiia title="Permanent link"> </a></h3><p>ClickHouse поддерживает LZ4 и ZSTD для сжатия данных. Эти алгоритмы являются парето-оптимальными по соотношению скорости и коэффициентам сжатия среди достаточно известных. Тем не менее, существуют менее известные алгоритмы сжатия, которые могут превзойти их по какому-либо критерию. Из потенциально более быстрых по сравнимом коэффициенте сжатия: Lizard, LZSSE, density. Из более сильных: bsc и csc. Необходимо изучить эти алгоритмы, добавить их поддержку в ClickHouse и исследовать их работу на тестовых датасетах.</p><h3 id=eksperimentalnye-kodeki>24.3. Экспериментальные кодеки<a class=headerlink href=../amp/#eksperimentalnye-kodeki title="Permanent link"> </a></h3><p>Существуют специализированные алгоритмы кодирования числовых последовательностей: Group VarInt, MaskedVByte, PFOR. Необходимо изучить наиболее эффективные реализации этих алгоритмов. Примеры вы сможете найти на <a href=https://github.com/lemire target=_blank>https://github.com/lemire</a> и <a href=https://github.com/powturbo/ target=_blank>https://github.com/powturbo/</a> а также <a href=https://github.com/schizofreny/middle-out target=_blank>https://github.com/schizofreny/middle-out</a></p><p>Внедрить их в ClickHouse в виде кодеков и изучить их работу на тестовых датасетах.</p><p>Upd. Есть два pull requests в начальной стадии, отложено.</p><h3 id=shifrovanie-v-clickhouse-na-urovne-vfs>24.4. Шифрование в ClickHouse на уровне VFS<a class=headerlink href=../amp/#shifrovanie-v-clickhouse-na-urovne-vfs title="Permanent link"> </a></h3><p>Данные в ClickHouse хранятся без шифрования. При наличии доступа к дискам, злоумышленник может прочитать данные. Предлагается реализовать два подхода к шифрованию:</p><ol><li>Шифрование на уровне VFS.</li></ol><p>Обсуждаются детали реализации. Q3/Q4.<br> Виталий Баранов.</p><h3 id=podderzhka-funktsii-shifrovaniia-dlia-otdelnykh-znachenii>24.5. Поддержка функций шифрования для отдельных значений<a class=headerlink href=../amp/#podderzhka-funktsii-shifrovaniia-dlia-otdelnykh-znachenii title="Permanent link"> </a></h3><p>Смотрите также 24.5.</p><ol start=2><li>Шифрование отдельных значений.<br> Для этого требуется реализовать функции шифрования и расшифрования, доступные из SQL. Для шифрования реализовать возможность добавления нужного количества случайных бит для исключения одинаковых зашифрованных значений на одинаковых данных. Это позволит реализовать возможность «забывания» данных без удаления строк таблицы: можно шифровать данные разных клиентов разными ключами, и для того, чтобы забыть данные одного клиента, потребуется всего лишь удалить ключ.</li></ol><p>Делает Василий Немков, Altinity</p><h3 id=userspace-raid>24.6. Userspace RAID<a class=headerlink href=../amp/#userspace-raid title="Permanent link"> </a></h3><p>Глеб Новиков, ВШЭ.</p><p>RAID позволяет одновременно увеличить надёжность хранения данных на дисках и увеличить скорость работы дискового массива. Обычно RAID настраивается с помощью встроенных возможностей ядра Linux (mdraid) или с помощью hardware контроллера. У этого есть следующие ограничения:</p><ol><li><p>Иногда (в облачной инфраструктуре некоторых компаний) сервер предоставляется с отдельными дисками, подмонтированными в виде отдельных разделов (JBOD), без возможности создания RAID.</p></li><li><p>В ClickHouse для обеспечения избыточности обычно используется репликация между серверами. Но при восстановлении одного из дисков RAID не используются данные с реплик, а в случае отказа одного из дисков в RAID-0, приходится передавать с реплики все данные, а не только данные, соответствующие одному из дисков. Это происходит, потому что RAID не интегрирован в ClickHouse и «не знает» про его особенности.</p></li><li><p>Отсутствуют продвинутые варианты обеспечения избыточности, как например, LRC.</p></li></ol><p>Для преодоления этих ограничений, предлагается реализовать в ClickHouse встроенный алгоритм расположения данных на дисках.</p><p>Есть pull request на начальной стадии.</p><h3 id=veroiatnostnye-struktury-dannykh-dlia-filtratsii-po-podzaprosam>24.7. Вероятностные структуры данных для фильтрации по подзапросам<a class=headerlink href=../amp/#veroiatnostnye-struktury-dannykh-dlia-filtratsii-po-podzaprosam title="Permanent link"> </a></h3><p>Рузель Ибрагимов, ВШЭ и Яндекс.</p><p>Частой задачей является выполнение запроса с фильтрацией по множеству, полученному по подзапросу. Пример: найти пользователей, которые заходили на сайт сегодня и заходили неделю назад. Это выражается в виде запроса: <code class=syntax>SELECT UserID FROM table WHERE EventDate = today() AND UserID IN (SELECT ...)</code>. При выполнении этого запроса, сначала выполняется подзапрос в правой части <code class=syntax>IN</code> и формируется хэш-таблица в оперативке; затем эта хэш-таблица используется для фильтрации.</p><p>Иногда объём данных достаточно большой, и хэш-таблица не помещается в оперативку. В этом случае можно рассмотреть в качестве варианта приближённый рассчёт: найти пользователей, которые заходили на сайт сегодня и наверное заходили неделю назад. Для этого можно вместо хэш-таблицы использовать Bloom Filter. Другая задача: найти пользователей, которые встречались, скорее всего, не менее некоторого количества раз. Для этого можно использовать Counting Bloom Filter. Также следует изучить структуры данных Quotient Filter и Cuckoo Filer, а ещё - секретный алгоритм Chaotic Map от Андрея Плахова.</p><p>Предлагается реализовать это в языке запросов ClickHouse с помощью специального синтаксиса, например <code class=syntax>x IN BLOOM FILTER (n, m) (SELECT ...)</code>.</p><p>Есть pull request на стадии работающего прототипа.</p><h3 id=spetsializatsiia-vektorizovannogo-koda-dlia-avxavx2avx512-i-arm-neon>24.8. + Специализация векторизованного кода для AVX/AVX2/AVX512 и ARM NEON<a class=headerlink href=../amp/#spetsializatsiia-vektorizovannogo-koda-dlia-avxavx2avx512-i-arm-neon title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/1017 rel="external nofollow noreferrer" target=_blank>#1017</a></p><p>Дмитрий Ковальков, ВШЭ и Яндекс.</p><p>Подавляющее большинство кода ClickHouse написана для x86_64 с набором инструкций до SSE 4.2 включительно. Лишь отдельные редкие функции поддерживают AVX/AVX2/AVX512 с динамической диспетчеризацией.</p><p>В первой части задачи, следует добавить в ClickHouse реализации некоторых примитивов, оптимизированные под более новый набор инструкций. Например, AVX2 реализацию генератора случайных чисел pcg: <a href=https://github.com/lemire/simdpcg target=_blank>https://github.com/lemire/simdpcg</a></p><p>Во второй части задачи, предлагается адаптировать существующие куски кода, использующие SSE intrinsics на AVX/AVX2 и сравнить производительность. Также рассматривается оптимизация под ARM NEON.</p><h3 id=obshchii-podkhod-k-cpu-dispatching-v-fabrike-funktsii>24.9. + Общий подход к CPU dispatching в фабрике функций<a class=headerlink href=../amp/#obshchii-podkhod-k-cpu-dispatching-v-fabrike-funktsii title="Permanent link"> </a></h3><p>Дмитрий Ковальков, ВШЭ и Яндекс.</p><p>Продолжение 24.8.</p><p>Upd. Есть pull request. В стадии ревью. Готово.</p><h3 id=podderzhka-tipov-halfbfloat16unum>24.10. Поддержка типов half/bfloat16/unum<a class=headerlink href=../amp/#podderzhka-tipov-halfbfloat16unum title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/7657 rel="external nofollow noreferrer" target=_blank>#7657</a></p><p>Рустам Гусейн-заде, ВШЭ.</p><p>Есть pull request на промежуточной стадии.</p><h3 id=user-defined-functions>24.11. User Defined Functions<a class=headerlink href=../amp/#user-defined-functions title="Permanent link"> </a></h3><p>Игорь Минеев, ВШЭ.</p><p>ClickHouse предоставляет достаточно богатый набор встроенных функций языка запросов, но не позволяет пользователю добавлять свои функции без редактировния исходников и перекомпиляции системы. Это мотивировано следующими потенциальными проблемами:</p><ol><li>ClickHouse является array-oriented системой, и все функции внутри кода принимают для обработки целые массивы, а не отдельные значения. Это усложняет внутренний интерфейс и делает его менее удобным для пользователя.</li><li>Предоставление возможности подключения UDF в виде shared библиотек, потребовало бы фиксировать этот интерфейс или поддерживать обратную совместимость, тогда как мы бы хотели, при разработке ClickHouse, менять этот интерфейс по своему усмотрению без оглядки.</li><li>Сложность внутренних структур данных повышает вероятность ошибок типа buffer overflow и повреждения памяти, что сильно затруднит сопровождение ClickHouse с пользовательскими функциями.</li></ol><p>Тем не менее, можно выбрать более аккуратный подход, избегающий непосредственной линковки с shared библиотеками.</p><p>Сначала можно реализовать поддержку UDF в виде выражений, составленных из простых функций ClickHouse. В ClickHouse есть встроенная кодогенерация на LLVM, что позволит таким функциям работать весьма эффективно. Но этот подход весьма ограничен и поэтому не является исчерпывающим.</p><p>Затем предлагается реализовать поддержку UDF в виде исходников на C++, которые компилируются в runtime, с использованием заголовочных файлов ClickHouse. Требование компиляции из исходников вместо shared библиотек, позволит ослабить необходимость в поддержке совместимости ABI.</p><p>Для безопасности, потребуется исследовать возможность размещения буферов данных в shared memory для выполнения UDF в отдельных процессах с изоляцией по памяти. Возможно, для этого пригодится интеграция с Apache Arrow.</p><p>Также рассматривается возможность написания UDF на Rust, а также использование Web Assembly. Отдельно можно рассмотреть подключение NumPy и R и других технологий, которые предоставляют операции над целыми массивами.</p><p>Upd. В работе два варианта реализации UDF.</p><h3 id=gpu-offloading>24.12. GPU offloading<a class=headerlink href=../amp/#gpu-offloading title="Permanent link"> </a></h3><p>Риск состоит в том, что даже известные GPU базы, такие как OmniSci, работают медленнее, чем ClickHouse.<br> Преимущество возможно только на полной сортировке и JOIN.<br> Алексей Соловей, nVidia и Рита Коннова, ВШЭ.</p><p>В компании nVidia сделали прототип offloading вычисления GROUP BY с некоторыми из агрегатных функций в ClickHouse и обещат предоставить исходники в публичный доступ для дальнейшего развития. Предлагается изучить этот прототип и расширить его применимость для более широкого сценария использования. В качестве альтернативы, предлагается изучить исходные коды системы <code class=syntax>OmniSci</code> или <code class=syntax>Alenka</code> или библиотеку <code class=syntax>CUB</code> <a href=https://nvlabs.github.io/cub/ target=_blank>https://nvlabs.github.io/cub/</a> и применить некоторые из алгоритмов в ClickHouse.</p><p>Upd. В компании nVidia выложили прототип, теперь нужна интеграция в систему сборки.<br> Upd. Интеграция в систему сборки - Иван Лежанкин.<br> Upd. Есть прототип bitonic sort.<br> Upd. Прототип bitonic sort помержен, но целесообразность под вопросом (он работает медленнее).<br> Наверное надо будет подержать и удалить.</p><h3 id=stream-zaprosy>24.13. Stream запросы<a class=headerlink href=../amp/#stream-zaprosy title="Permanent link"> </a></h3><p>Пререквизит для ClickHouse как CEP-системы.</p><h3 id=window-funktsii>24.14. Window функции<a class=headerlink href=../amp/#window-funktsii title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/1469 rel="external nofollow noreferrer" target=_blank>#1469</a></p><p>Требует 2.1.</p><p>Upd. Есть два прототипа от внешних контрибьюторов.</p><h3 id=podderzhka-polustrukturirovannykh-dannykh>24.15. Поддержка полуструктурированных данных<a class=headerlink href=../amp/#podderzhka-polustrukturirovannykh-dannykh title="Permanent link"> </a></h3><p>Требует 1.14 и 2.10.</p><h3 id=uluchshenie-evristiki-sliianii>24.16. Улучшение эвристики слияний<a class=headerlink href=../amp/#uluchshenie-evristiki-sliianii title="Permanent link"> </a></h3><p>В прошлом году исследование по этой задаче сделал Егор Соловьёв, ВШЭ и Яндекс.Такси. Его исследование показало, что алгоритм нельзя существенно улучшить путём изменения параметров. Но исследование лажовое, так как рассмотрен только уже использующийся алгоритм. То есть, задача остаётся открытой.</p><h3 id=eksperimentalnye-sposoby-uskoreniia-parallelnogo-group-by>24.17. Экспериментальные способы ускорения параллельного GROUP BY<a class=headerlink href=../amp/#eksperimentalnye-sposoby-uskoreniia-parallelnogo-group-by title="Permanent link"> </a></h3><p>Максим Серебряков</p><p>Задача в работе.<br> Upd. Достигнуты обнадёживающие результаты.<br> Upd. Есть pull request - в большинстве случаев одновременно и ускорение и снижение потребления памяти, но требуются доработки.</p><h3 id=ne-tcp-protokol-peredachi-failov-pri-replikatsii>24.18. Не TCP протокол передачи файлов при репликации<a class=headerlink href=../amp/#ne-tcp-protokol-peredachi-failov-pri-replikatsii title="Permanent link"> </a></h3><h3 id=promezhutochnoe-sostoianie-group-by-kak-struktura-dannykh-dlia-key-value-dostupa>24.19. Промежуточное состояние GROUP BY как структура данных для key-value доступа<a class=headerlink href=../amp/#promezhutochnoe-sostoianie-group-by-kak-struktura-dannykh-dlia-key-value-dostupa title="Permanent link"> </a></h3><h3 id=short-circuit-vychisleniia-nekotorykh-vyrazhenii>24.20. Short-circuit вычисления некоторых выражений<a class=headerlink href=../amp/#short-circuit-vychisleniia-nekotorykh-vyrazhenii title="Permanent link"> </a></h3><p>Два года назад задачу попробовала сделать Анастасия Царькова, ВШЭ и Яндекс, но реализация получилась слишком неудобной и её удалили.</p><h3 id=realizatsiia-v-clickhouse-protokola-raspredelionnogo-konsensusa>24.21. Реализация в ClickHouse протокола распределённого консенсуса<a class=headerlink href=../amp/#realizatsiia-v-clickhouse-protokola-raspredelionnogo-konsensusa title="Permanent link"> </a></h3><p>Имеет смысл только после 19.2.</p><h3 id=vyvod-tipov-po-bloku-dannykh-vyvod-formata-dannykh-po-primeru>24.22. Вывод типов по блоку данных. Вывод формата данных по примеру<a class=headerlink href=../amp/#vyvod-tipov-po-bloku-dannykh-vyvod-formata-dannykh-po-primeru title="Permanent link"> </a></h3><p>Задача отложена.</p><p>ClickHouse является строго типизированной системой. Для того, чтобы прочитать данные в каком либо формате (например, CSV), требуется заранее указать типы данных. Если при чтении формата выясняется, что данные не могут быть прочитаны в рамках заданных типов, то кидается исключение.</p><p>ClickHouse также может использоваться для быстрой аналитики по локальным файлам, без загрузки их в базу данных (программа <code class=syntax>clickhouse-local</code>). В этом случае, его использование может заменить <code class=syntax>awk</code>, <code class=syntax>sed</code>, <code class=syntax>grep</code>. Но остаётся неудобство - необходимость указания типов данных.</p><p>Предлагается реализовать функциональность вывода типов по первому блоку данных путём применения эвристик и постепенного расширения типов.</p><p>Другая экспериментальная задача - реализация эвристик для обработки данных в неизвестном построчном текстовом формате. Детектирование CSV, TSV, JSON, детектирование разделителей и форматов значений.</p><h3 id=minimalnaia-podderzhka-tranzaktsii-dlia-mnozhestva-vstavokchtenii>24.23. Минимальная поддержка транзакций для множества вставок/чтений<a class=headerlink href=../amp/#minimalnaia-podderzhka-tranzaktsii-dlia-mnozhestva-vstavokchtenii title="Permanent link"> </a></h3><p>Максим Кузнецов, ВШЭ.</p><p>Таблицы типа MergeTree состоят из набора независимых неизменяемых «кусков» данных. При вставках данных (INSERT), формируются новые куски. При модификациях данных (слияние кусков), формируются новые куски, а старые - становятся неактивными и перестают использоваться следующими запросами. Чтение данных (SELECT) производится из снэпшота множества кусков на некоторый момент времени. Таким образом, чтения и вставки не блокируют друг друга.</p><p>Если же выполняется несколько запросов SELECT, то чтение данных может осуществляться из снэпшотов по состоянию на несколько разных моментов времени и быть неконсистентным. Пример: пользователю отображается отчёт из нескольких графиков и таблиц, но из-за того, что между разными запросами, данные успели обновиться, отображаемые данные не соответствуют друг другу.</p><p>Пример с другой стороны - пользователь хочет осуществить несколько вставок (INSERT) в одну или несколько таблиц, но так, чтобы данные появились в них атомарно с точки зрения других запросов (SELECT).</p><p>Для решения этих проблем, предлагается ввести глобальные метки времени для кусков данных (сейчас уже есть инкрементальные номера кусков, но они выделяются в рамках одной таблицы). Первым шагом сделаем эти метки времени в рамках сервера. Вторым шагом сделаем метки времени в рамках всех серверов, но неточные на основе локальных часов. Третьим шагом сделаем метки времени, выдаваемые сервисом координации.</p><h3 id=realizatsiia-algoritmov-differential-privacy>24.24. Реализация алгоритмов differential privacy<a class=headerlink href=../amp/#realizatsiia-algoritmov-differential-privacy title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/6874 rel="external nofollow noreferrer" target=_blank>#6874</a></p><p>Артём Вишняков, ВШЭ. Есть pull request.</p><h3 id=integratsiia-v-clickhouse-funktsionalnosti-obrabotki-http-user-agent>24.25. Интеграция в ClickHouse функциональности обработки HTTP User Agent<a class=headerlink href=../amp/#integratsiia-v-clickhouse-funktsionalnosti-obrabotki-http-user-agent title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/157 rel="external nofollow noreferrer" target=_blank>#157</a><br> Есть хороший код в Яндекс.Метрике. Получено согласие от руководства.<br> Михаил Филитов, ВШЭ.<br> Upd. Есть pull request. Нужно ещё чистить код библиотеки.</p><h3 id=podderzhka-open-tracing-ili-analogov>24.26. Поддержка open tracing или аналогов<a class=headerlink href=../amp/#podderzhka-open-tracing-ili-analogov title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/5182 rel="external nofollow noreferrer" target=_blank>#5182</a></p><p>Александр Кожихов, ВШЭ и Яндекс.YT.<br> Upd. Есть pull request с прототипом.</p><h3 id=realizatsiia-algoritmov-min-hash-sim-hash-dlia-nechiotkogo-poiska-poludublikatov>24.27. Реализация алгоритмов min-hash, sim-hash для нечёткого поиска полудубликатов<a class=headerlink href=../amp/#realizatsiia-algoritmov-min-hash-sim-hash-dlia-nechiotkogo-poiska-poludublikatov title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/pull/7649 rel="external nofollow noreferrer" target=_blank>#7649</a></p><p>ucasFL, ICT.</p><p>Алгоритмы min-hash и sim-hash позволяют вычислить для текста несколько хэш-значений таких, что при небольшом изменении текста, по крайней мере один из хэшей не меняется. Вычисления можно реализовать на n-грамах и словарных шинглах. Предлагается добавить поддержку этих алгоритмов в виде функций в ClickHouse и изучить их применимость для задачи нечёткого поиска полудубликатов.</p><p>Есть pull request, есть что доделывать.</p><h3 id=drugoi-sketch-dlia-kvantilei>24.28. Другой sketch для квантилей<a class=headerlink href=../amp/#drugoi-sketch-dlia-kvantilei title="Permanent link"> </a></h3><p>Похоже на quantileTiming, но с логарифмическими корзинами. См. DDSketch.</p><h3 id=podderzhka-arrow-flight>24.29. Поддержка Arrow Flight<a class=headerlink href=../amp/#podderzhka-arrow-flight title="Permanent link"> </a></h3><p><a href=https://github.com/ClickHouse/ClickHouse/issues/7554 rel="external nofollow noreferrer" target=_blank>#7554</a></p><p>Жанна Зосимова, ВШЭ.<br> Upd. Пока поддержали Arrow как формат ввода-вывода.</p><h3 id=clickhouse-kak-grafovaia-subd>24.30. - ClickHouse как графовая СУБД<a class=headerlink href=../amp/#clickhouse-kak-grafovaia-subd title="Permanent link"> </a></h3><p>Amos Bird, но его решение слишком громоздкое и пока не open-source. Отменено.</p><h3 id=korellirovannye-podzaprosy>24.31. Кореллированные подзапросы<a class=headerlink href=../amp/#korellirovannye-podzaprosy title="Permanent link"> </a></h3><p>Перепиcывание в JOIN. Не раньше 21.11, 21.12, 21.9. Низкий приоритет.</p><h3 id=podderzhka-grpc>24.32. Поддержка GRPC<a class=headerlink href=../amp/#podderzhka-grpc title="Permanent link"> </a></h3><p>Мария Конькова, ВШЭ и Яндекс.<br> Также смотрите 24.29.</p><p>В ClickHouse есть два основных протокола: родной протокол общения между серверами и HTTP/1.1 протокол. HTTP/1.1 протокол удобен для работы из самых разных языков программирования, но, в отличие от родного протокола, не поддерживает двусторонний обмен информацией во время запроса:<br> - передачу информации о прогрессе во время выполнения запроса;<br> - передачу логов во время выполнения запроса;<br> - отмену выполнения запроса в тот момент как данные ещё не начали передаваться;</p><p>Рассматривается вариант - поддержка GRPC в ClickHouse. Здесь есть неочевидные моменты, такие как - эффективная передача массивов данных в column-oriented формате - насколько удобно будет обернуть это в GRPC.</p><p>Задача в работе, есть pull request. <a href=https://github.com/ClickHouse/ClickHouse/pull/10136 rel="external nofollow noreferrer" target=_blank>#10136</a></p><h2 id=devrel>25. DevRel<a class=headerlink href=../amp/#devrel title="Permanent link"> </a></h2><h3 id=perevod-instruktsii-dlia-nachinaiushchikh-razrabotchikov>25.1. + Перевод инструкции для начинающих разработчиков<a class=headerlink href=../amp/#perevod-instruktsii-dlia-nachinaiushchikh-razrabotchikov title="Permanent link"> </a></h3><p>Александр Казаков, ноябрь 2019.</p><h3 id=vychitka-i-vykladka-stati-pro-obfuskatsiiu-dannykh-na-angliiskom>25.2. + Вычитка и выкладка статьи про обфускацию данных на английском<a class=headerlink href=../amp/#vychitka-i-vykladka-stati-pro-obfuskatsiiu-dannykh-na-angliiskom title="Permanent link"> </a></h3><p>Эми, Александр Казаков, Алексей Миловидов, Q1.<br> Готово к выкладке.</p><h3 id=podgotovka-stati-sekrety-optimizatsii-proizvoditelnosti-clickhouse>25.3. Подготовка статьи «Секреты оптимизации производительности ClickHouse»<a class=headerlink href=../amp/#podgotovka-stati-sekrety-optimizatsii-proizvoditelnosti-clickhouse title="Permanent link"> </a></h3><p>Алексей Миловидов, Леонид.</p><h3 id=podgotovka-stati-profailer-zaprosov-trudnyi-put>25.4. Подготовка статьи «Профайлер запросов: трудный путь»<a class=headerlink href=../amp/#podgotovka-stati-profailer-zaprosov-trudnyi-put title="Permanent link"> </a></h3><p>Алексей Миловидов, Леонид.</p><h3 id=podgotovka-stati-testirovanie-clickhouse-kotoroe-my-zasluzhili>25.5. Подготовка статьи «Тестирование ClickHouse, которое мы заслужили»<a class=headerlink href=../amp/#podgotovka-stati-testirovanie-clickhouse-kotoroe-my-zasluzhili title="Permanent link"> </a></h3><h3 id=perevod-etikh-statei-na-angliiskii>25.6. Перевод этих статей на английский<a class=headerlink href=../amp/#perevod-etikh-statei-na-angliiskii title="Permanent link"> </a></h3><p>Требует 25.3, 25.4, 25.5. Эми</p><h3 id=perevod-stati-danily-kutenina-na-angliiskii>25.7. Перевод статьи Данилы Кутенина на английский<a class=headerlink href=../amp/#perevod-stati-danily-kutenina-na-angliiskii title="Permanent link"> </a></h3><p>Эми</p><h3 id=vystuplenie-keynote-na-bdtc>25.8. + Выступление keynote на BDTC<a class=headerlink href=../amp/#vystuplenie-keynote-na-bdtc title="Permanent link"> </a></h3><p>Алексей Миловидов</p><h3 id=podgotovka-dokladchikov-khvostikao-ilezhankin-nikitamikhailov-akuzm-i-drugie>25.9. Подготовка докладчиков: khvostikao, ilezhankin, nikitamikhailov, akuzm и другие<a class=headerlink href=../amp/#podgotovka-dokladchikov-khvostikao-ilezhankin-nikitamikhailov-akuzm-i-drugie title="Permanent link"> </a></h3><p><a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Ольга Хвостикова</a>, <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Иван Лежанкин</a>, Никита Михайлов, <a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Александр Кузьменков</a>, Артём Зуйков.<br> Уже готовые докладчики: Алексей Миловидов, <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Николай Кочетов</a>, <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>Александр Сапин</a>.<br> Получаем минимум 8 докладчиков в 2020 году.</p><h3 id=mitapy-v-rossii-i-belarusi-moskva-x2-mitap-dlia-razrabotchikov-ili-khakaton-sankt-peterburg-minsk-nizhnii-novgorod-ekaterinburg-novosibirsk-iili-akademgorodok-innopolis-ili-kazan>25.10. Митапы в России и Беларуси: Москва x2 + митап для разработчиков или хакатон, Санкт-Петербург, Минск, Нижний Новгород, Екатеринбург, Новосибирск и/или Академгородок, Иннополис или Казань<a class=headerlink href=../amp/#mitapy-v-rossii-i-belarusi-moskva-x2-mitap-dlia-razrabotchikov-ili-khakaton-sankt-peterburg-minsk-nizhnii-novgorod-ekaterinburg-novosibirsk-iili-akademgorodok-innopolis-ili-kazan title="Permanent link"> </a></h3><p>Екатерина - организация. Upd. Проведено два онлайн митапа на русском и два на английском.</p><h3 id=mitapy-zarubezhnye-vostok-ssha-niu-iork-vozmozhno-raleigh-vozmozhno-severo-zapad-sietl-kitai-pekin-snova-vozmozhno-mitap-dlia-razrabotchikov-ili-khakaton-london>25.11. Митапы зарубежные: восток США (Нью Йорк, возможно Raleigh), возможно северо-запад (Сиэтл), Китай (Пекин снова, возможно митап для разработчиков или хакатон), Лондон<a class=headerlink href=../amp/#mitapy-zarubezhnye-vostok-ssha-niu-iork-vozmozhno-raleigh-vozmozhno-severo-zapad-sietl-kitai-pekin-snova-vozmozhno-mitap-dlia-razrabotchikov-ili-khakaton-london title="Permanent link"> </a></h3><p><a href=https://github.com/blinkov/ rel="external nofollow noreferrer" target=_blank>Иван Блинков</a> - организация. Две штуки в США запланированы. Upd. Два митапа в США и один в Европе проведены.</p><h3 id=statia-nauchnaia-pro-ustroistvo-khraneniia-dannykh-i-indeksov-ili-whitepaper-po-arkhitekture-est-variant-podat-na-vldb>25.12. Статья «научная» - про устройство хранения данных и индексов или whitepaper по архитектуре. Есть вариант подать на VLDB<a class=headerlink href=../amp/#statia-nauchnaia-pro-ustroistvo-khraneniia-dannykh-i-indeksov-ili-whitepaper-po-arkhitekture-est-variant-podat-na-vldb title="Permanent link"> </a></h3><p>Низкий приоритет. Алексей Миловидов.</p><h3 id=uchastie-vo-vsekh-meropriiatiiakh-iandeksa-kotorye-sviazany-s-razrabotkoi-bekenda-c-razrabotkoi-ili-s-bazami-dannykh-vozmozhno-uchastie-v-devrel-meropriiatiiakh>25.13. Участие во всех мероприятиях Яндекса, которые связаны с разработкой бэкенда, C++ разработкой или с базами данных, возможно участие в DevRel мероприятиях<a class=headerlink href=../amp/#uchastie-vo-vsekh-meropriiatiiakh-iandeksa-kotorye-sviazany-s-razrabotkoi-bekenda-c-razrabotkoi-ili-s-bazami-dannykh-vozmozhno-uchastie-v-devrel-meropriiatiiakh title="Permanent link"> </a></h3><p>Алексей Миловидов и все подготовленные докладчики</p><h3 id=konferentsii-v-rossii-vse-highload-vozmozhno-codefest-dump-ili-uwdc-vozmozhno-c-russia>25.14. Конференции в России: все HighLoad, возможно CodeFest, DUMP или UWDC, возможно C++ Russia<a class=headerlink href=../amp/#konferentsii-v-rossii-vse-highload-vozmozhno-codefest-dump-ili-uwdc-vozmozhno-c-russia title="Permanent link"> </a></h3><p>Алексей Миловидов и все подготовленные докладчики.<br> Upd. Есть Saint HighLoad online.<br> Upd. Есть C++ Russia.<br> CodeFest, DUMP, UWDC отменились.</p><h3 id=konferentsii-zarubezhnye-percona-dataops-popytka-popast-na-bolee-krupnye>25.15. Конференции зарубежные: Percona, DataOps, попытка попасть на более крупные<a class=headerlink href=../amp/#konferentsii-zarubezhnye-percona-dataops-popytka-popast-na-bolee-krupnye title="Permanent link"> </a></h3><p>Алексей Миловидов и все подготовленные докладчики<br> Upd. Есть Percona.<br> DataOps отменилась.</p><h3 id=sait-play-clickhouse>25.16. Сайт play.clickhouse<a class=headerlink href=../amp/#sait-play-clickhouse title="Permanent link"> </a></h3><p>Цель состоит в реализации сайта, на котором можно попробовать задавать произвольные запросы к временному экземпляру ClickHouse и изучать его поведение. Из похожих проектов можно отметить: <a href=https://godbolt.org/ rel="external nofollow noreferrer" target=_blank>Compiler Explorer</a>, <a href=http://ideone.com/ target=_blank>http://ideone.com/</a>, <a href=http://sqlfiddle.com/ rel="external nofollow noreferrer" target=_blank>SQLFiddle</a>, <a href=https://www.db-fiddle.com/ rel="external nofollow noreferrer" target=_blank>DB-Fiddle</a>.</p><p>С помощью такого сайта можно решать следующие задачи:<br> - ознакомление с языком запросов ClickHouse;<br> - демонстрация примеров из документации;<br> - демонстрация скорости работы на тестовых датасетах;<br> - сравнение поведения разных версий ClickHouse друг с другом;<br> - демонстрация неожиданного поведения или багов;</p><p>Требуется проработать вопрос безопасности и изоляции инстансов (поднятие в контейнерах с ограничениями по сети), подключение тестовых датасетов с помощью copy-on-write файловой системы; органичения ресурсов.</p><p>Есть минимальный прототип. Сделал Илья Яцишин. Этот прототип не позволяет делиться ссылками на результаты запросов.</p><h3 id=vzaimodeistvie-s-vuzami-vshe-urfu-ict-beijing>25.17. Взаимодействие с ВУЗами: ВШЭ, УрФУ, ICT Beijing<a class=headerlink href=../amp/#vzaimodeistvie-s-vuzami-vshe-urfu-ict-beijing title="Permanent link"> </a></h3><p>Алексей Миловидов и вся группа разработки.<br> Благодаря Robert Hodges добавлен CMU.<br> Upd. Взаимодействие с ВШЭ 2019/2020 успешно выполнено.</p><h3 id=lektsiia-v-shad>25.18. - Лекция в ШАД<a class=headerlink href=../amp/#lektsiia-v-shad title="Permanent link"> </a></h3><p>Алексей Миловидов</p><h3 id=uchastie-v-kurse-razrabotki-na-c-v-shad>25.19. - Участие в курсе разработки на C++ в ШАД<a class=headerlink href=../amp/#uchastie-v-kurse-razrabotki-na-c-v-shad title="Permanent link"> </a></h3><h3 id=eshchio-odno-sravnenie-proizvoditelnosti-analiticheskikh-subd>25.20. Ещё одно сравнение производительности аналитических СУБД<a class=headerlink href=../amp/#eshchio-odno-sravnenie-proizvoditelnosti-analiticheskikh-subd title="Permanent link"> </a></h3><p>Матвей Бубнов, УрФУ</p><p>Существуют мало известные специализированные СУБД, способные конкурировать с ClickHouse по скорости обработки некоторых классов запросов. Пример: <code class=syntax>TDEngine</code> и <code class=syntax>DolphinDB</code>, <code class=syntax>VictoriaMetrics</code>, а также <code class=syntax>Apache Doris</code> и <code class=syntax>LocustDB</code>. Предлагается изучить и классифицировать архитектурные особенности этих систем - их особенности и преимущества. Установить эти системы, загрузить тестовые данные, изучить производительность. Проанализировать, за счёт чего достигаются преимущества.</p><p>Upd. Есть поползновения с TDEngine.</p><h3 id=povtornoe-nagrazhdenie-kontribiutorov-v-kitae>25.21. Повторное награждение контрибьюторов в Китае<a class=headerlink href=../amp/#povtornoe-nagrazhdenie-kontribiutorov-v-kitae title="Permanent link"> </a></h3><p>Upd. Ждём снятия ограничений и восстановления активности по онлайн митапам.</p><h3 id=on-site-pomoshch-s-clickhouse-kompaniiam-v-dni-riadom-s-meropriiatiiami>25.22. On-site помощь с ClickHouse компаниям в дни рядом с мероприятиями<a class=headerlink href=../amp/#on-site-pomoshch-s-clickhouse-kompaniiam-v-dni-riadom-s-meropriiatiiami title="Permanent link"> </a></h3><p><a href=https://github.com/blinkov/ rel="external nofollow noreferrer" target=_blank>Иван Блинков</a> - организация. Провёл мероприятие для турецкой компании.<br> Upd. On-site заменяется на Online.</p><h3 id=novyi-merch-dlia-clickhouse>25.23. Новый мерч для ClickHouse<a class=headerlink href=../amp/#novyi-merch-dlia-clickhouse title="Permanent link"> </a></h3><p>Upd. Старого пока хватает, раздача уменьшилась.</p><h3 id=konkursy-bughunter-ili-optimizatsii-koda-na-c>25.24. Конкурсы bughunter или оптимизации кода на C++<a class=headerlink href=../amp/#konkursy-bughunter-ili-optimizatsii-koda-na-c title="Permanent link"> </a></h3><p>Проведение конкурсов должно начинаться для сотрудников Яндекса, пока нет согласования.</p><h3 id=seminary-dlia-potentsialnykh-klientov-iandeks-oblaka>25.25. Семинары для потенциальных клиентов Яндекс.Облака<a class=headerlink href=../amp/#seminary-dlia-potentsialnykh-klientov-iandeks-oblaka title="Permanent link"> </a></h3><p>По мере необходимости. Алексей Миловидов, организация - Яндекс.Облако.</p><h3 id=uchastie-v-gsoc>25.26. - Участие в GSoC<a class=headerlink href=../amp/#uchastie-v-gsoc title="Permanent link"> </a></h3><p>Андрей Бородин пытается уговорить нас участвовать, но пока загружены задачей 25.17.</p><p>UPD: не участвуем.</p><h3 id=obnovit-sait-clickhouse>25.27. + Обновить сайт ClickHouse<a class=headerlink href=../amp/#obnovit-sait-clickhouse title="Permanent link"> </a></h3><p>Иван Блинков. Нет рисков. Нужно для Яндекс.Облака. Upd. Сделано.</p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Рейтинг: RATING_VALUE - RATING_COUNT голосов</p>
  <span class="alert-heading display-6">Рейтинг статьи</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2020 Yandex LLC</div>
    <div>Собрано из <a href="https://github.com/ClickHouse/ClickHouse/commit/782f2179ce4ad0b9a9c898a5f32557555b59e4d0" rel="external nofollow noreferrer" target="_blank" class="text-reset">782f2179ce</a>, опубликовано <span title="2019-11-18T22:10:48+03:00">2019-11-18</span>, изменено <span title="2020-07-14T12:28:38+03:00">2020-07-14</span>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.tech/docs/ru/whats-new/extended-roadmap/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
