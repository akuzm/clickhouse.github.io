










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="zh">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>ClickHouse 测试 | ClickHouse文档</title>
    <link rel="canonical" href="https://clickhouse.tech/docs/zh/development/tests/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "ClickHouse 测试 | ClickHouse文档",
"mainEntityOfPage": "https://clickhouse.tech/docs/zh/development/tests/",

"datePublished": "2017-10-25T08:27:09+03:00",
"dateModified": "2020-04-30T21:19:18+03:00",

"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "ClickHouse 测试 | ClickHouse文档",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}footer{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ul{margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}b,strong{font-weight:bolder}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2.5rem}.h2,h2{font-size:2rem}.h3,h3{font-size:1.75rem}.h4,h4{font-size:1.5rem}.h5,h5{font-size:1.25rem}.h6,h6{font-size:1rem}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-top{position:fixed;top:0;right:0;left:0;z-index:1030}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.pl-0{padding-left:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.pl-1{padding-left:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.pl-2{padding-left:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pb-3,.py-3{padding-bottom:1rem}.pl-3{padding-left:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.pl-4{padding-left:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pb-5,.py-5{padding-bottom:3rem}.pl-5{padding-left:3rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.pl-md-0{padding-left:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.pl-md-1{padding-left:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.pl-md-2{padding-left:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.pl-md-3{padding-left:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.pl-md-4{padding-left:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.pl-md-5{padding-left:3rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.pl-lg-0{padding-left:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.pl-lg-1{padding-left:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.pl-lg-2{padding-left:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.pl-lg-3{padding-left:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.pl-lg-4{padding-left:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.pl-lg-5{padding-left:3rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.headerlink{text-decoration:none;margin-left:.5rem}body[data-spy] #content{overflow-x:scroll}#content code{color:#111;background:#eee}#content pre{background:#eee;padding:1rem}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body.blog,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content code,#content pre{background:#444;color:#eee}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .err{color:#ef6155}.syntax .n{color:#2f1e2e}.syntax .o{color:#5bc4bf}.syntax .p{color:#2f1e2e}.syntax .cp{color:#8d8687}.syntax .c1{color:#8d8687}.syntax .ge{font-style:italic}.syntax .ld{color:#48b685}.syntax .s{color:#48b685}.syntax .py{color:#2f1e2e}.syntax .mo{color:#f99b15}.syntax .s2{color:#48b685}.syntax .sh{color:#48b685}.syntax .s1{color:#48b685}@media(prefers-color-scheme:dark){.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .sh{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .py{color:#f8f9fa}}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=clickhouse-ce-shi>ClickHouse 测试<a class=headerlink href=../amp/#clickhouse-ce-shi title="Permanent link"> </a></h1><h2 id=gong-neng-xing-ce-shi>功能性测试<a class=headerlink href=../amp/#gong-neng-xing-ce-shi title="Permanent link"> </a></h2><p>功能性测试是最简便使用的。绝大部分 ClickHouse 的功能可以通过功能性测试来测试，任何代码的更改都必须通过该测试。</p><p>每个功能测试会向正在运行的 ClickHouse服 务器发送一个或多个查询，并将结果与预期结果进行比较。</p><p>测试用例在 <code class=syntax>tests/queries</code> 目录中。这里有两个子目录：<code class=syntax>stateless</code> 和 <code class=syntax>stateful</code>目录。 无状态的测试无需预加载测试数据集 - 通常是在测试运行期间动态创建小量的数据集。有状态测试需要来自 Yandex.Metrica 的预加载测试数据，而不向一般公众提供。 我们倾向于仅使用«无状态»测试并避免添加新的«有状态»测试。</p><p>每个测试用例可以是两种类型之一：<code class=syntax>.sql</code> 和 <code class=syntax>.sh</code>。<code class=syntax>.sql</code> 测试文件是用于管理<code class=syntax>clickhouse-client --multiquery --testmode</code>的简单SQL脚本。<code class=syntax>.sh</code> 测试文件是一个可以自己运行的脚本。</p><p>要运行所有测试，请使用 <code class=syntax>tests/clickhouse-test</code> 工具，用 <code class=syntax>--help</code> 可以获取所有的选项列表。您可以简单地运行所有测试或运行测试名称中的子字符串过滤的测试子集：<code class=syntax>./clickhouse-test substring</code>。</p><p>调用功能测试最简单的方法是将 <code class=syntax>clickhouse-client</code> 复制到<code class=syntax>/usr/bin/</code>，运行<code class=syntax>clickhouse-server</code>，然后从自己的目录运行<code class=syntax>./ clickhouse-test</code>。</p><p>要添加新测试，请在 <code class=syntax>tests/queries/0_stateless</code> 目录内添加新的 <code class=syntax>.sql</code> 或 <code class=syntax>.sh</code> 文件，手动检查，然后按以下方式生成 <code class=syntax>.reference</code> 文件： <code class=syntax>clickhouse-client -n --testmode &lt; 00000_test.sql &gt; 00000_test.reference</code> 或 <code class=syntax>./00000_test.sh &gt; ./00000_test.reference</code>。</p><p>测试应该只使用（创建，删除等）<code class=syntax>test</code> 数据库中的表，这些表假定是事先创建的; 测试也可以使用临时表。</p><p>如果要在功能测试中使用分布式查询，可以利用 <code class=syntax>remote</code> 表函数和 <code class=syntax>127.0.0.{1..2}</code> 地址为服务器查询自身; 或者您可以在服务器配置文件中使用预定义的测试集群，例如<code class=syntax>test_shard_localhost</code>。</p><p>有些测试在名称中标有 <code class=syntax>zookeeper</code>，<code class=syntax>shard</code> 或 <code class=syntax>long</code>。<code class=syntax>zookeeper</code> 用于使用ZooKeeper的测试; <code class=syntax>shard</code> 用于需要服务器监听<code class=syntax>127.0.0.*</code>的测试。<code class=syntax>long</code> 适用于运行时间稍长一秒的测试。</p><h2 id=yi-zhi-de-bug>已知的bug<a class=headerlink href=../amp/#yi-zhi-de-bug title="Permanent link"> </a></h2><p>如果我们知道一些可以通过功能测试轻松复制的错误，我们将准备好的功能测试放在 <code class=syntax>tests/queries/bugs</code> 目录中。当修复错误时，这些测试将被移动到 <code class=syntax>tests/queries/0_stateless</code> 目录中。</p><h2 id=ji-cheng-ce-shi>集成测试<a class=headerlink href=../amp/#ji-cheng-ce-shi title="Permanent link"> </a></h2><p>集成测试允许在集群配置中测试 ClickHouse，并与其他服务器（如MySQL，Postgres，MongoDB）进行 ClickHouse 交互。它们可用于模拟网络拆分，数据包丢弃等。这些测试在Docker 下运行，并使用各种软件创建多个容器。</p><p>参考 <code class=syntax>tests/integration/README.md</code> 文档关于如何使用集成测试。</p><p>请注意，ClickHouse 与第三方驱动程序的集成未经过测试。此外，我们目前还没有与 JDBC 和ODBC 驱动程序进行集成测试。</p><h2 id=dan-yuan-ce-shi>单元测试<a class=headerlink href=../amp/#dan-yuan-ce-shi title="Permanent link"> </a></h2><p>当您想要测试整个 ClickHouse，而不是单个独立的库或类时，单元测试非常有用。您可以使用<code class=syntax>ENABLE_TESTS</code> CMake 选项启用或禁用测试构建。单元测试（和其他测试程序）位于代码中的<code class=syntax>tests</code> 子目录中。要运行单元测试，请键入 <code class=syntax>ninja test</code>。有些测试使用 <code class=syntax>gtest</code>，但有些只是在测试失败时返回非零状态码。</p><p>如果代码已经被功能测试覆盖（并且功能测试通常使用起来要简单得多），则不一定要进行单元测试。</p><h2 id=xing-neng-ce-shi>性能测试<a class=headerlink href=../amp/#xing-neng-ce-shi title="Permanent link"> </a></h2><p>性能测试允许测量和比较综合查询中 ClickHouse 的某些独立部分的性能。测试位于<code class=syntax>tests/performance</code> 目录中。每个测试都由 <code class=syntax>.xml</code> 文件表示，并附有测试用例的描述。使用 <code class=syntax>clickhouse performance-test</code> 工具（嵌入在 <code class=syntax>clickhouse</code> 二进制文件中）运行测试。请参阅 <code class=syntax>--help</code> 以进行调用。</p><p>每个测试在循环中运行一个或多个查询（可能带有参数组合），并具有一些停止条件（如«最大执行速度不会在三秒内更改»）并测量一些有关查询性能的指标（如«最大执行速度»））。某些测试可以包含预加载的测试数据集的前提条件。</p><p>如果要在某些情况下提高 ClickHouse 的性能，并且如果可以在简单查询上观察到改进，则强烈建议编写性能测试。在测试过程中使用 <code class=syntax>perf top</code> 或其他 perf 工具总是有意义的。</p><p>性能测试不是基于每个提交运行的。不收集性能测试结果，我们手动比较它们。</p><h2 id=ce-shi-gong-ju-he-jiao-ben>测试工具和脚本<a class=headerlink href=../amp/#ce-shi-gong-ju-he-jiao-ben title="Permanent link"> </a></h2><p><code class=syntax>tests</code>目录中的一些程序不是准备测试，而是测试工具。例如，对于<code class=syntax>Lexer</code>，有一个工具<code class=syntax>src/Parsers/tests/lexer</code> 标准输出。您可以使用这些工具作为代码示例以及探索和手动测试。</p><p>您还可以将一对文件 <code class=syntax>.sh</code> 和 <code class=syntax>.reference</code> 与工具放在一些预定义的输入上运行它 - 然后可以将脚本结果与 <code class=syntax>.reference</code> 文件进行比较。这些测试不是自动化的。</p><h2 id=za-xiang-ce-shi>杂项测试<a class=headerlink href=../amp/#za-xiang-ce-shi title="Permanent link"> </a></h2><p>有一些外部字典的测试位于 <code class=syntax>tests/external_dictionaries</code>，机器学习模型在<code class=syntax>tests/external_models</code>目录。这些测试未更新，必须转移到集成测试。</p><p>对于分布式数据的插入，有单独的测试。此测试在单独的服务器上运行 ClickHouse 集群并模拟各种故障情况：网络拆分，数据包丢弃（ClickHouse 节点之间，ClickHouse 和 ZooKeeper之间，ClickHouse 服务器和客户端之间等），进行 <code class=syntax>kill -9</code>，<code class=syntax>kill -STOP</code> 和<code class=syntax>kill -CONT</code> 等操作，类似<a href=https://aphyr.com/tags/Jepsen rel="external nofollow noreferrer" target=_blank>Jepsen</a>。然后，测试检查是否已写入所有已确认的插入，并且所有已拒绝的插入都未写入。</p><p>在 ClickHouse 开源之前，分布式测试是由单独的团队编写的，但该团队不再使用 ClickHouse，测试是在 Java 中意外编写的。由于这些原因，必须重写分布式测试并将其移至集成测试。</p><h2 id=shou-dong-ce-shi>手动测试<a class=headerlink href=../amp/#shou-dong-ce-shi title="Permanent link"> </a></h2><p>当您开发了新的功能，做手动测试也是合理的。可以按照以下步骤来进行：</p><p>编译 ClickHouse。在命令行中运行 ClickHouse：进入 <code class=syntax>programs/clickhouse-server</code> 目录并运行 <code class=syntax>./clickhouse-server</code>。它会默认使用当前目录的配置文件 (<code class=syntax>config.xml</code>， <code class=syntax>users.xml</code> 以及在 <code class=syntax>config.d</code> 和 <code class=syntax>users.d</code> 目录的文件)。可以使用 <code class=syntax>programs/clickhouse-client/clickhouse-client</code> 来连接数据库。</p><p>或者，您可以安装 ClickHouse 软件包：从 Yandex 存储库中获得稳定版本，或者您可以在ClickHouse源根目录中使用 <code class=syntax>./release</code> 构建自己的软件包。然后使用 <code class=syntax>sudo service clickhouse-server start</code> 启动服务器（或停止服务器）。在 <code class=syntax>/etc/clickhouse-server/clickhouse-server.log</code> 中查找日志。</p><p>当您的系统上已经安装了 ClickHouse 时，您可以构建一个新的 <code class=syntax>clickhouse</code> 二进制文件并替换现有的二进制文件：</p><div class=codehilite><pre><span></span><code class=syntax><span class=err>sudo service clickhouse-server stop</span>
<span class=err>sudo cp ./clickhouse /usr/bin/</span>
<span class=err>sudo service clickhouse-server start</span>
</code></pre></div><p>您也可以停止 clickhouse-server 并使用相同的配置运行您自己的服务器，日志打印到终端：</p><div class=codehilite><pre><span></span><code class=syntax><span class=err>sudo service clickhouse-server stop</span>
<span class=err>sudo -u clickhouse /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span>
</code></pre></div><p>使用 gdb 的一个示例:</p><div class=codehilite><pre><span></span><code class=syntax><span class=err>sudo -u clickhouse gdb --args /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span>
</code></pre></div><p>如果 clickhouse-server 已经运行并且您不想停止它，您可以更改 <code class=syntax>config.xml</code> 中的端口号（或在 <code class=syntax>config.d</code> 目录中的文件中覆盖它们），配置适当的数据路径，然后运行它。</p><p><code class=syntax>clickhouse</code> 二进制文件几乎没有依赖关系，适用于各种 Linux 发行版。要快速地测试服务器上的更改，您可以简单地将新建的 <code class=syntax>clickhouse</code> 二进制文件 <code class=syntax>scp</code> 到其他服务器，然后按照上面的示例运行它。</p><h2 id=ce-shi-huan-jing>测试环境<a class=headerlink href=../amp/#ce-shi-huan-jing title="Permanent link"> </a></h2><p>在将版本发布为稳定之前，我们将其部署在测试环境中 测试环境是一个处理[Yandex.Metrica]（<a href=https://metrica.yandex.com/ target=_blank>https://metrica.yandex.com/</a>）总数据的1/39部分大小的集群。 我们与 Yandex.Metrica 团队公用我们的测试环境。ClickHouse 在现有数据的基础上无需停机即可升级。 我们首先看到数据处理成功而不会实时滞后，复制继续工作，并且 Yandex.Metrica 团队无法看到问题。 首先的检查可以通过以下方式完成：</p><div class=codehilite><pre><span></span><code class=syntax><span class=err>SELECT hostName() AS h, any(version()), any(uptime()), max(UTCEventTime), count() FROM remote('example01-01-{1..3}t', merge, hits) WHERE EventDate &gt;= today() - 2 GROUP BY h ORDER BY h;</span>
</code></pre></div><p>在某些情况下，我们还部署到 Yandex 的合作团队的测试环境：市场，云等。此外，我们还有一些用于开发目的的硬件服务器。</p><h2 id=fu-zai-ce-shi>负载测试<a class=headerlink href=../amp/#fu-zai-ce-shi title="Permanent link"> </a></h2><p>部署到测试环境后，我们使用生产群集中的查询运行负载测试。 这是手动完成的。</p><p>确保在生产集群中开启了 <code class=syntax>query_log</code> 选项。</p><p>收集一天或更多的查询日志：</p><div class=codehilite><pre><span></span><code class=syntax><span class=err>clickhouse-client --query="SELECT DISTINCT query FROM system.query_log WHERE event_date = today() AND query LIKE '%ym:%' AND query NOT LIKE '%system.query_log%' AND type = 2 AND is_initial_query" &gt; queries.tsv</span>
</code></pre></div><p>这是一个复杂的例子。<code class=syntax>type = 2</code> 将过滤成功执行的查询。<code class=syntax>query LIKE'％ym：％'</code> 用于从 Yandex.Metrica 中选择相关查询。<code class=syntax>is_initial_query</code> 是仅选择由客户端发起的查询，而不是由 ClickHouse 本身（作为分布式查询处理的一部分）。</p><p><code class=syntax>scp</code> 这份日志到测试机器，并运行以下操作：</p><div class=codehilite><pre><span></span><code class=syntax><span class=err>clickhouse benchmark --concurrency 16 &lt; queries.tsv</span>
</code></pre></div><p>(可能你需要指定运行的用户 <code class=syntax>--user</code>)</p><p>然后离开它一晚或周末休息一下。</p><p>你要检查下 <code class=syntax>clickhouse-server</code> 是否崩溃，内存占用是否合理，性能也不会随着时间的推移而降低。</p><p>由于查询和环境的高度可变性，不会记录精确的查询执行时序并且不进行比较。</p><h2 id=bian-yi-ce-shi>编译测试<a class=headerlink href=../amp/#bian-yi-ce-shi title="Permanent link"> </a></h2><p>构建测试允许检查构建在各种替代配置和某些外部系统上是否被破坏。测试位于<code class=syntax>ci</code>目录。 它们从 Docker，Vagrant 中的源代码运行构建，有时在 Docker 中运行 <code class=syntax>qemu-user-static</code>。这些测试正在开发中，测试运行不是自动化的。</p><p>动机：</p><p>通常我们会在 ClickHouse 构建的单个版本上发布并运行所有测试。 但是有一些未经过彻底测试的替代构建版本。 例子：</p><ul><li>在 FreeBSD 中的构建；</li><li>在 Debian 中使用系统包中的库进行构建；</li><li>使用库的共享链接构建；</li><li>在 AArch64 平台进行构建。</li></ul><p>例如，使用系统包构建是不好的做法，因为我们无法保证系统具有的确切版本的软件包。但 Debian 维护者确实需要这样做。出于这个原因，我们至少必须支持这种构建。另一个例子：共享链接是一个常见的麻烦来源，但是对于一些爱好者来说需要它。</p><p>虽然我们无法对所有构建版本运行所有测试，但我们想要检查至少不会破坏各种构建变体。为此，我们使用构建测试。</p><h2 id=ce-shi-xie-yi-jian-rong-xing>测试协议兼容性<a class=headerlink href=../amp/#ce-shi-xie-yi-jian-rong-xing title="Permanent link"> </a></h2><p>当我们扩展 ClickHouse 网络协议时，我们手动测试旧的 clickhouse-client 与新的 clickhouse-server 和新的clickhouse-client 一起使用旧的 clickhouse-server (只需从相应的包中运行二进制文件)</p><h2 id=lai-zi-bian-yi-qi-de-ti-shi>来自编译器的提示<a class=headerlink href=../amp/#lai-zi-bian-yi-qi-de-ti-shi title="Permanent link"> </a></h2><p>ClickHouse 主要的代码 (位于<code class=syntax>dbms</code>目录中) 使用 <code class=syntax>-Wall -Wextra -Werror</code> 构建，并带有一些其他已启用的警告。 虽然没有为第三方库启用这些选项。</p><p>Clang 有更多有用的警告 - 您可以使用 <code class=syntax>-Weverything</code> 查找它们并选择默认构建的东西。</p><p>对于生产构建，使用 gcc（它仍然生成比 clang 稍高效的代码）。对于开发来说，clang 通常更方便使用。您可以使用调试模式在自己的机器上构建（以节省笔记本电脑的电量），但请注意，由于更好的控制流程和过程分析，编译器使用 <code class=syntax>-O3</code> 会生成更多警告。 当使用 clang 构建时，使用 <code class=syntax>libc++</code> 而不是 <code class=syntax>libstdc++</code>，并且在使用调试模式构建时，使用调试版本的 <code class=syntax>libc++</code>，它允许在运行时捕获更多错误。</p><h2 id=sanitizers>消毒剂<a class=headerlink href=../amp/#sanitizers title="Permanent link"> </a></h2><p><strong>地址消毒剂</strong>.<br> 我们在每个提交的基础上在 ASan 下运行功能和集成测试。</p><p><strong>ﾂ暗ｪﾂ氾环催ﾂ団ﾂ法ﾂ人)</strong>.<br> 我们在 Valgrind 过夜进行功能测试。 这需要几个小时。 目前在 <code class=syntax>re2</code> 库中有一个已知的误报，请参阅 <a href=https://research.swtch.com/sparse rel="external nofollow noreferrer" target=_blank>文章</a>。</p><p><strong>螺纹消毒剂</strong>.<br> 我们在 TSan 下进行功能测试。ClickHouse 必须通过所有测试。在 TSan 下运行不是自动化的，只是偶尔执行。</p><p><strong>记忆消毒剂</strong>.<br> 目前我们不使用 MSan。</p><p><strong>未定义的行为消毒剂。</strong><br> 我们仍然不会在每次提交的基础上使用 UBSan。 有一些地方需要解决。</p><p><strong>调试分alloc。</strong><br> 您可以使用 <code class=syntax>DEBUG_TCMALLOC</code> CMake 选项启用 <code class=syntax>tcmalloc</code> 的调试版本。我们在每次提交的基础上使用调试分配器运行测试。</p><p>更多请参阅 <code class=syntax>tests/instructions/sanitizers.txt</code>。</p><h2 id=mo-hu-ce-shi>模糊测试<a class=headerlink href=../amp/#mo-hu-ce-shi title="Permanent link"> </a></h2><p>我们使用简单的模糊测试来生成随机SQL查询并检查服务器是否正常，使用 Address sanitizer 执行模糊测试。你可以在<code class=syntax>00746_sql_fuzzy.pl</code> 找到它。 测试应连续进行（过夜和更长时间）。</p><p>截至2018年12月，我们仍然不使用库代码的孤立模糊测试。</p><h2 id=an-quan-shen-ji>安全审计<a class=headerlink href=../amp/#an-quan-shen-ji title="Permanent link"> </a></h2><p>Yandex Cloud 部门的人员从安全角度对 ClickHouse 功能进行了一些基本概述。</p><h2 id=jing-tai-fen-xi>静态分析<a class=headerlink href=../amp/#jing-tai-fen-xi title="Permanent link"> </a></h2><p>我们偶尔使用静态分析。我们已经评估过 <code class=syntax>clang-tidy</code>， <code class=syntax>Coverity</code>， <code class=syntax>cppcheck</code>， <code class=syntax>PVS-Studio</code>， <code class=syntax>tscancode</code>。您将在 <code class=syntax>tests/instructions/</code> 目录中找到使用说明。你也可以阅读<a href=https://habr.com/company/yandex/blog/342018/ rel="external nofollow noreferrer" target=_blank>俄文文章</a>.</p><p>如果您使用 <code class=syntax>CLion</code> 作为 IDE，您可以开箱即用一些 <code class=syntax>clang-tidy</code> 检查。</p><h2 id=qi-ta-qiang-hua>其他强化<a class=headerlink href=../amp/#qi-ta-qiang-hua title="Permanent link"> </a></h2><p>默认情况下使用 <code class=syntax>FORTIFY_SOURCE</code>。它几乎没用，但在极少数情况下仍然有意义，我们不会禁用它。</p><h2 id=dai-ma-feng-ge>代码风格<a class=headerlink href=../amp/#dai-ma-feng-ge title="Permanent link"> </a></h2><p>代码风格在<a href=https://clickhouse.tech/docs/en/development/style/ target=_blank>这里</a> 有说明。</p><p>要检查一些常见的样式冲突，您可以使用 <code class=syntax>utils/check-style</code> 脚本。</p><p>为了强制你的代码的正确风格，你可以使用 <code class=syntax>clang-format</code> 文件。<code class=syntax>.clang-format</code> 位于源代码根目录， 它主要与我们的实际代码风格对应。但不建议将 <code class=syntax>clang-format</code> 应用于现有文件，因为它会使格式变得更糟。您可以使用 <code class=syntax>clang-format-diff</code> 工具，您可以在 clang 源代码库中找到</p><p>或者，您可以尝试<code class=syntax>uncrustify</code> 工具来格式化您的代码。配置文件在源代码的根目录中的<code class=syntax>uncrustify.cfg</code>。它比 <code class=syntax>clang-format</code> 经过更少的测试。</p><p><code class=syntax>CLion</code> 有自己的代码格式化程序，必须调整为我们的代码风格。</p><h2 id=metrica-b2b-ce-shi>Metrica B2B 测试<a class=headerlink href=../amp/#metrica-b2b-ce-shi title="Permanent link"> </a></h2><p>每个 ClickHouse 版本都经过 Yandex Metrica 和 AppMetrica 引擎的测试。测试和稳定版本的 ClickHouse 部署在虚拟机上，并使用处理输入数据固定样本的度量引擎的小副本运行。 将度量引擎的两个实例的结果一起进行比较</p><p>这些测试是由单独的团队自动完成的。由于移动部件的数量很多，大部分时间的测试都是完全无关的，很难弄清楚。很可能这些测试对我们来说是负值。然而，这些测试被证明是有用的大约一个或两个倍的数百。</p><h2 id=ce-shi-fu-gai-lu>测试覆盖率<a class=headerlink href=../amp/#ce-shi-fu-gai-lu title="Permanent link"> </a></h2><p>截至2018年7月，我们不会跟踪测试复盖率。</p><h2 id=zi-dong-hua-ce-shi>自动化测试<a class=headerlink href=../amp/#zi-dong-hua-ce-shi title="Permanent link"> </a></h2><p>我们使用 Yandex 内部 CI 和名为«沙箱»的作业自动化系统运行测试。 我们还继续使用 Jenkins（可在Yandex内部使用）。</p><p>构建作业和测试在沙箱中按每次提交的基础上运行。结果包和测试结果发布在 GitHub 上，可以通过直接链接下载，结果会被永久存储。当您在 GitHub 上发送拉取请求时，我们将其标记为«可以测试»，我们的 CI 系统将为您构建 ClickHouse 包（发布，调试，地址消除等）。</p><p>由于时间和计算能力的限制，我们不使用 Travis CI。</p><p>在 Jenkins，我们运行字典测试，指标B2B测试。 我们使用 Jenkins 来准备和发布版本。 Jenkins是一种传统的技术，所有的工作将被转移到沙箱中。</p><p><a href=https://clickhouse.tech/docs/zh/development/tests/ target=_blank>来源文章</a> <!--hide--></p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">评分: RATING_VALUE - RATING_COUNT 所得票数</p>
  <span class="alert-heading display-6">文章评级</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2020 Yandex LLC</div>
    <div>建于 <a href="https://github.com/ClickHouse/ClickHouse/commit/782f2179ce4ad0b9a9c898a5f32557555b59e4d0" rel="external nofollow noreferrer" target="_blank" class="text-reset">782f2179ce</a>, 发表于 <span title="2017-10-25T08:27:09+03:00">2017-10-25</span>, 修改于 <span title="2020-04-30T21:19:18+03:00">2020-04-30</span>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.tech/docs/zh/development/tests/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
