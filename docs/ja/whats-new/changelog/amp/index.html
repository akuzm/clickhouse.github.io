










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="ja">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>2020 | ClickHouseドキュメント</title>
    <link rel="canonical" href="https://clickhouse.tech/docs/ja/whats-new/changelog/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "2020 | ClickHouseドキュメント",
"mainEntityOfPage": "https://clickhouse.tech/docs/ja/whats-new/changelog/",

"datePublished": "2020-04-03T16:23:32+03:00",
"dateModified": "2020-05-15T07:34:54+03:00",

"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "2020 | ClickHouseドキュメント",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}footer,header,section{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ul{margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}b{font-weight:bolder}small{font-size:80%}sub{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sub{bottom:-.25em}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}th{text-align:inherit}label{display:inline-block;margin-bottom:.5rem}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}template{display:none}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2.5rem}.h2,h2{font-size:2rem}.h3,h3{font-size:1.75rem}.h4,h4{font-size:1.5rem}.h5,h5{font-size:1.25rem}.h6,h6{font-size:1rem}.lead{font-size:1.25rem;font-weight:300}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.small,small{font-size:80%;font-weight:400}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-auto,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-auto,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-auto{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-first{-ms-flex-order:-1;order:-1}.order-last{-ms-flex-order:13;order:13}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}.offset-1{margin-left:8.333333%}.offset-2{margin-left:16.666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.333333%}.offset-5{margin-left:41.666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.333333%}.offset-8{margin-left:66.666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.333333%}.offset-11{margin-left:91.666667%}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-first{-ms-flex-order:-1;order:-1}.order-md-last{-ms-flex-order:13;order:13}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.333333%}.offset-md-2{margin-left:16.666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.333333%}.offset-md-5{margin-left:41.666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.333333%}.offset-md-8{margin-left:66.666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.333333%}.offset-md-11{margin-left:91.666667%}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-first{-ms-flex-order:-1;order:-1}.order-lg-last{-ms-flex-order:13;order:13}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.333333%}.offset-lg-2{margin-left:16.666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.333333%}.offset-lg-5{margin-left:41.666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.333333%}.offset-lg-8{margin-left:66.666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.333333%}.offset-lg-11{margin-left:91.666667%}}.table{width:100%;margin-bottom:1rem;color:#212529}.table th{padding:.75rem;vertical-align:top;border-top:1px solid #dee2e6}.table-primary,.table-primary>th{background-color:#b8daff}.table-primary th{border-color:#7abaff}.table-success,.table-success>th{background-color:#c3e6cb}.table-success th{border-color:#8fd19e}.table-info,.table-info>th{background-color:#bee5eb}.table-info th{border-color:#86cfda}.table-warning,.table-warning>th{background-color:#ffeeba}.table-warning th{border-color:#ffdf7e}.table-light,.table-light>th{background-color:#fdfdfe}.table-light th{border-color:#fbfcfc}.table-dark,.table-dark>th{background-color:#c6c8ca}.table-dark th{border-color:#95999c}.table-active,.table-active>th{background-color:rgba(0,0,0,.075)}.table-dark{color:#fff;background-color:#343a40}.table-dark th{border-color:#454d55}.valid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#28a745}.is-valid~.valid-feedback{display:block}.custom-select.is-valid{border-color:#28a745;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-valid:focus{border-color:#28a745;box-shadow:0 0 0 .2rem rgba(40,167,69,.25)}.custom-control-input.is-valid~.custom-control-label{color:#28a745}.custom-control-input.is-valid~.custom-control-label::before{border-color:#28a745}.custom-control-input.is-valid:checked~.custom-control-label::before{border-color:#34ce57;background-color:#34ce57}.custom-control-input.is-valid:focus~.custom-control-label::before{box-shadow:0 0 0 .2rem rgba(40,167,69,.25)}.custom-control-input.is-valid:focus:not(:checked)~.custom-control-label::before{border-color:#28a745}.custom-file-input.is-valid~.custom-file-label{border-color:#28a745}.custom-file-input.is-valid:focus~.custom-file-label{border-color:#28a745;box-shadow:0 0 0 .2rem rgba(40,167,69,.25)}.invalid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.is-invalid~.invalid-feedback{display:block}.custom-select.is-invalid{border-color:#dc3545;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.custom-control-input.is-invalid~.custom-control-label{color:#dc3545}.custom-control-input.is-invalid~.custom-control-label::before{border-color:#dc3545}.custom-control-input.is-invalid:checked~.custom-control-label::before{border-color:#e4606d;background-color:#e4606d}.custom-control-input.is-invalid:focus~.custom-control-label::before{box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.custom-control-input.is-invalid:focus:not(:checked)~.custom-control-label::before{border-color:#dc3545}.custom-file-input.is-invalid~.custom-file-label{border-color:#dc3545}.custom-file-input.is-invalid:focus~.custom-file-label{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn.disabled,.btn:disabled{opacity:.65}a.btn.disabled{pointer-events:none}.btn-primary{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:hover{color:#fff;background-color:#0069d9;border-color:#0062cc}.btn-primary:focus{color:#fff;background-color:#0069d9;border-color:#0062cc;box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-primary.disabled,.btn-primary:disabled{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:not(:disabled):not(.disabled).active,.btn-primary:not(:disabled):not(.disabled):active{color:#fff;background-color:#0062cc;border-color:#005cbf}.btn-primary:not(:disabled):not(.disabled).active:focus,.btn-primary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-success{color:#fff;background-color:#28a745;border-color:#28a745}.btn-success:hover{color:#fff;background-color:#218838;border-color:#1e7e34}.btn-success:focus{color:#fff;background-color:#218838;border-color:#1e7e34;box-shadow:0 0 0 .2rem rgba(72,180,97,.5)}.btn-success.disabled,.btn-success:disabled{color:#fff;background-color:#28a745;border-color:#28a745}.btn-success:not(:disabled):not(.disabled).active,.btn-success:not(:disabled):not(.disabled):active{color:#fff;background-color:#1e7e34;border-color:#1c7430}.btn-success:not(:disabled):not(.disabled).active:focus,.btn-success:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(72,180,97,.5)}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info:focus{color:#fff;background-color:#138496;border-color:#117a8b;box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-info.disabled,.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:not(:disabled):not(.disabled).active,.btn-info:not(:disabled):not(.disabled):active{color:#fff;background-color:#117a8b;border-color:#10707f}.btn-info:not(:disabled):not(.disabled).active:focus,.btn-info:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning.disabled,.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:not(:disabled):not(.disabled).active,.btn-warning:not(:disabled):not(.disabled):active{color:#212529;background-color:#d39e00;border-color:#c69500}.btn-warning:not(:disabled):not(.disabled).active:focus,.btn-warning:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light.disabled,.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:not(:disabled):not(.disabled).active,.btn-light:not(:disabled):not(.disabled):active{color:#212529;background-color:#dae0e5;border-color:#d3d9df}.btn-light:not(:disabled):not(.disabled).active:focus,.btn-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark.disabled,.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:not(:disabled):not(.disabled).active,.btn-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#1d2124;border-color:#171a1d}.btn-dark:not(:disabled):not(.disabled).active:focus,.btn-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-outline-primary{color:#007bff;border-color:#007bff}.btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-primary.disabled,.btn-outline-primary:disabled{color:#007bff;background-color:transparent}.btn-outline-primary:not(:disabled):not(.disabled).active,.btn-outline-primary:not(:disabled):not(.disabled):active{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:not(:disabled):not(.disabled).active:focus,.btn-outline-primary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-success{color:#28a745;border-color:#28a745}.btn-outline-success:hover{color:#fff;background-color:#28a745;border-color:#28a745}.btn-outline-success:focus{box-shadow:0 0 0 .2rem rgba(40,167,69,.5)}.btn-outline-success.disabled,.btn-outline-success:disabled{color:#28a745;background-color:transparent}.btn-outline-success:not(:disabled):not(.disabled).active,.btn-outline-success:not(:disabled):not(.disabled):active{color:#fff;background-color:#28a745;border-color:#28a745}.btn-outline-success:not(:disabled):not(.disabled).active:focus,.btn-outline-success:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(40,167,69,.5)}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-info.disabled,.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-info:not(:disabled):not(.disabled).active,.btn-outline-info:not(:disabled):not(.disabled):active{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:not(:disabled):not(.disabled).active:focus,.btn-outline-info:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning.disabled,.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-warning:not(:disabled):not(.disabled).active,.btn-outline-warning:not(:disabled):not(.disabled):active{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:not(:disabled):not(.disabled).active:focus,.btn-outline-warning:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light.disabled,.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-light:not(:disabled):not(.disabled).active,.btn-outline-light:not(:disabled):not(.disabled):active{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:not(:disabled):not(.disabled).active:focus,.btn-outline-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-outline-dark:not(:disabled):not(.disabled).active,.btn-outline-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:not(:disabled):not(.disabled).active:focus,.btn-outline-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link.disabled,.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.collapsing{position:relative;height:0;overflow:hidden;transition:height .35s ease}@media(prefers-reduced-motion:reduce){.collapsing{transition:none}}.btn-group,.btn-group-vertical{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group-vertical>.btn:hover,.btn-group>.btn:hover{z-index:1}.btn-group-vertical>.btn.active,.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.btn-group-vertical{-ms-flex-direction:column;flex-direction:column;-ms-flex-align:start;align-items:flex-start;-ms-flex-pack:center;justify-content:center}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group{width:100%}.btn-group-vertical>.btn-group:not(:first-child),.btn-group-vertical>.btn:not(:first-child){margin-top:-1px}.btn-group-vertical>.btn-group:not(:last-child)>.btn{border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:not(:first-child)>.btn,.btn-group-vertical>.btn:not(:first-child){border-top-left-radius:0;border-top-right-radius:0}.input-group{position:relative;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:stretch;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select{position:relative;-ms-flex:1 1 0;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select{margin-left:-1px}.input-group>.custom-file .custom-file-input:focus~.custom-file-label,.input-group>.custom-select:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.input-group>.custom-file:not(:last-child) .custom-file-label,.input-group>.custom-file:not(:last-child) .custom-file-label::after{border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-file:not(:first-child) .custom-file-label{border-top-left-radius:0;border-bottom-left-radius:0}.input-group-text{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:.25rem}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select{height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:-ms-inline-flexbox;display:inline-flex;margin-right:1rem}.custom-control-input{position:absolute;left:0;z-index:-1;width:1rem;height:1.25rem;opacity:0}.custom-control-input:checked~.custom-control-label::before{color:#fff;border-color:#007bff;background-color:#007bff}.custom-control-input:focus~.custom-control-label::before{box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-control-input:focus:not(:checked)~.custom-control-label::before{border-color:#80bdff}.custom-control-input:not(:disabled):active~.custom-control-label::before{color:#fff;background-color:#b3d7ff;border-color:#b3d7ff}.custom-control-input:disabled~.custom-control-label,.custom-control-input[disabled]~.custom-control-label{color:#6c757d}.custom-control-input:disabled~.custom-control-label::before,.custom-control-input[disabled]~.custom-control-label::before{background-color:#e9ecef}.custom-control-label{position:relative;margin-bottom:0;vertical-align:top}.custom-control-label::before{position:absolute;top:.25rem;left:-1.5rem;display:block;width:1rem;height:1rem;pointer-events:none;content:"";background-color:#fff;border:#adb5bd solid 1px}.custom-control-label::after{position:absolute;top:.25rem;left:-1.5rem;display:block;width:1rem;height:1rem;content:"";background:no-repeat 50%/50% 50%}.custom-switch{padding-left:2.25rem}.custom-switch .custom-control-label::before{left:-2.25rem;width:1.75rem;pointer-events:all;border-radius:.5rem}.custom-switch .custom-control-label::after{top:calc(.25rem+2px);left:calc(-2.25rem+2px);width:calc(1rem - 4px);height:calc(1rem - 4px);background-color:#adb5bd;border-radius:.5rem;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-transform .15s ease-in-out;transition:transform .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:transform .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-transform .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-switch .custom-control-label::after{transition:none}}.custom-switch .custom-control-input:checked~.custom-control-label::after{background-color:#fff;-webkit-transform:translateX(.75rem);transform:translateX(.75rem)}.custom-switch .custom-control-input:disabled:checked~.custom-control-label::before{background-color:rgba(0,123,255,.5)}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-file-input{position:relative;z-index:2;width:100%;height:calc(1.5em+.75rem+2px);margin:0;opacity:0}.custom-file-input:focus~.custom-file-label{border-color:#80bdff;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-file-input:disabled~.custom-file-label,.custom-file-input[disabled]~.custom-file-label{background-color:#e9ecef}.custom-file-input:lang(en)~.custom-file-label::after{content:"Browse"}.custom-file-input~.custom-file-label[data-browse]::after{content:attr(data-browse)}.custom-file-label{position:absolute;top:0;right:0;left:0;z-index:1;height:calc(1.5em+.75rem+2px);padding:.375rem .75rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;border:1px solid #ced4da;border-radius:.25rem}.custom-file-label::after{position:absolute;top:0;right:0;bottom:0;z-index:3;display:block;height:calc(1.5em+.75rem);padding:.375rem .75rem;line-height:1.5;color:#495057;content:"Browse";background-color:#e9ecef;border-left:inherit;border-radius:0 .25rem .25rem 0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#007bff;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#b3d7ff}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#007bff;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#b3d7ff}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#007bff;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#b3d7ff}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px;background-color:#dee2e6;border-radius:1rem}.custom-range:disabled::-webkit-slider-thumb{background-color:#adb5bd}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#adb5bd}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#adb5bd}.custom-control-label::before,.custom-file-label,.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-control-label::before,.custom-file-label,.custom-select{transition:none}}.tab-content>.active{display:block}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#004085;background-color:#cce5ff;border-color:#b8daff}.alert-primary .alert-link{color:#002752}.alert-success{color:#155724;background-color:#d4edda;border-color:#c3e6cb}.alert-success .alert-link{color:#0b2e13}.alert-info{color:#0c5460;background-color:#d1ecf1;border-color:#bee5eb}.alert-info .alert-link{color:#062c33}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.progress{display:-ms-flexbox;display:flex;height:1rem;overflow:hidden;font-size:.75rem;background-color:#e9ecef;border-radius:.25rem}.progress-bar{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;overflow:hidden;color:#fff;text-align:center;white-space:nowrap;background-color:#007bff;transition:width .6s ease}@media(prefers-reduced-motion:reduce){.progress-bar{transition:none}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}.close{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.5}.close:hover{color:#000;text-decoration:none}.close:not(:disabled):not(.disabled):focus,.close:not(:disabled):not(.disabled):hover{opacity:.75}a.close.disabled{pointer-events:none}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#007bff}a.bg-primary:focus,a.bg-primary:hover{background-color:#0062cc}.bg-success{background-color:#28a745}a.bg-success:focus,a.bg-success:hover{background-color:#1e7e34}.bg-info{background-color:#17a2b8}a.bg-info:focus,a.bg-info:hover{background-color:#117a8b}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}@media print{.d-print-none{display:none}.d-print-inline{display:inline}.d-print-inline-block{display:inline-block}.d-print-block{display:block}.d-print-table{display:table}.d-print-table-row{display:table-row}}.float-left{float:left}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-left{float:left}.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-left{float:left}.float-lg-right{float:right}.float-lg-none{float:none}}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.position-static{position:static}.position-relative{position:relative}.position-absolute{position:absolute}.position-fixed{position:fixed}.fixed-top{position:fixed;top:0;right:0;left:0;z-index:1030}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.w-25{width:25%}.w-50{width:50%}.w-75{width:75%}.w-100{width:100%}.w-auto{width:auto}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.h-auto{height:auto}.mt-0,.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.mt-1,.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.mt-2,.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.mt-3,.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.mt-4,.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.mt-5,.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pr-0{padding-right:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pr-1{padding-right:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pr-2{padding-right:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pr-3{padding-right:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pr-4{padding-right:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pr-5{padding-right:3rem}.pb-5,.py-5{padding-bottom:3rem}.mt-n1,.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.mt-n2,.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.mt-n3,.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.mt-n4,.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.mt-n5,.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}.mt-auto,.my-auto{margin-top:auto}.mr-auto{margin-right:auto}.mb-auto,.my-auto{margin-bottom:auto}@media(min-width:768px){.mt-md-0,.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.mt-md-1,.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.mt-md-2,.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.mt-md-3,.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.mt-md-4,.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.mt-md-5,.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pr-md-0{padding-right:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pr-md-1{padding-right:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pr-md-2{padding-right:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pr-md-3{padding-right:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pr-md-4{padding-right:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pr-md-5{padding-right:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.mt-md-n1,.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.mt-md-n2,.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.mt-md-n3,.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.mt-md-n4,.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.mt-md-n5,.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}.mt-md-auto,.my-md-auto{margin-top:auto}.mr-md-auto{margin-right:auto}.mb-md-auto,.my-md-auto{margin-bottom:auto}}@media(min-width:992px){.mt-lg-0,.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.mt-lg-1,.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.mt-lg-2,.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.mt-lg-3,.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.mt-lg-4,.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.mt-lg-5,.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pr-lg-0{padding-right:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pr-lg-1{padding-right:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pr-lg-2{padding-right:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pr-lg-3{padding-right:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pr-lg-4{padding-right:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pr-lg-5{padding-right:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.mt-lg-n1,.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.mt-lg-n2,.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.mt-lg-n3,.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.mt-lg-n4,.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.mt-lg-n5,.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}.mt-lg-auto,.my-lg-auto{margin-top:auto}.mr-lg-auto{margin-right:auto}.mb-lg-auto,.my-lg-auto{margin-bottom:auto}}.text-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-left{text-align:left}.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-left{text-align:left}.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#007bff}a.text-primary:focus,a.text-primary:hover{color:#0056b3}.text-success{color:#28a745}a.text-success:focus,a.text-success:hover{color:#19692c}.text-info{color:#17a2b8}a.text-info:focus,a.text-info:hover{color:#0f6674}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-break{word-break:break-word;overflow-wrap:break-word}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table th{background-color:#fff}.table-dark{color:inherit}.table-dark th{border-color:#dee2e6}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn.disabled,.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.w-15{width:15%}#feedback_email{white-space:nowrap}.comments-bg{background:#f8f9fa}@media(prefers-color-scheme:dark){.comments-bg{background:#333}}.headerlink{text-decoration:none;margin-left:.5rem}body[data-spy] #content{overflow-x:scroll}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content th{padding:.75rem;vertical-align:top}#content th{border:1px solid #444451}#content code{color:#111;background:#eee}#content pre{background:#eee;padding:1rem}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre,th,tr{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code,#content pre{background:#444;color:#eee}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .n{color:#2f1e2e}.syntax .o{color:#5bc4bf}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .gh{color:#2f1e2e;font-weight:700}.syntax .ld{color:#48b685}.syntax .s{color:#48b685}.syntax .no{color:#ef6155}.syntax .ne{color:#ef6155}.syntax .nn{color:#fec418}.syntax .py{color:#2f1e2e}.syntax .w{color:#2f1e2e}.syntax .s2{color:#48b685}.syntax .sh{color:#48b685}.syntax .si{color:#f99b15}.syntax .s1{color:#48b685}.syntax .vi{color:#ef6155}.syntax .il{color:#f99b15}@media(prefers-color-scheme:dark){.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .sh{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .gh{color:#f8f9fa;font-weight:700}.syntax .py{color:#f8f9fa}.syntax .w{color:#f8f9fa}}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
    <div class="alert alert-primary" role="alert">
      <p class="display-5 mb-2">助けが欲しかった！</p>
      <p class="lead">このドキュメントページの以下の内容は機械翻訳されています。 異な他のウェブサイトで行われませんができます。 この翻訳テキスト生活をGitHubリポジトリとClickHouseコードベース、待ち員ネイティブスピーカーで人間が読む. <a href="/docs/en/whats-new/changelog/" class="alert-link">また、参照として、元の英語版を使用することができます。</a></p>
      <p class="lead">
          <a class="btn btn-lg btn-primary text-white" href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ja/whats-new/changelog/index.md" target="_blank" rel="external nofollow noreferrer">
              このページを編集してClickHouseの文書を編集する
          </a>
      </p>
    </div>

          <h2 id=clickhouse-release-20-5>ClickHouse release 20.5<a class=headerlink href=../amp/#clickhouse-release-20-5 title="Permanent link"> </a></h2><h3 id=clickhouse-release-v20-5-2-7-stable-2020-07-02>ClickHouse release v20.5.2.7-stable 2020-07-02<a class=headerlink href=../amp/#clickhouse-release-v20-5-2-7-stable-2020-07-02 title="Permanent link"> </a></h3><h4 id=backward-incompatible-change>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change title="Permanent link"> </a></h4><ul><li>Return non-Nullable result from COUNT(DISTINCT), and <code class=syntax>uniq</code> aggregate functions family. If all passed values are NULL, return zero instead. This improves SQL compatibility. <a href=https://github.com/ClickHouse/ClickHouse/pull/11661 rel="external nofollow noreferrer" target=_blank>#11661</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added a check for the case when user-level setting is specified in a wrong place. User-level settings should be specified in <code class=syntax>users.xml</code> inside <code class=syntax>&lt;profile&gt;</code> section for specific user profile (or in <code class=syntax>&lt;default&gt;</code> for default settings). The server won't start with exception message in log. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9051 rel="external nofollow noreferrer" target=_blank>#9051</a>. If you want to skip the check, you can either move settings to the appropriate place or add <code class=syntax>&lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt;</code> to config.xml. <a href=https://github.com/ClickHouse/ClickHouse/pull/11449 rel="external nofollow noreferrer" target=_blank>#11449</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>The setting <code class=syntax>input_format_with_names_use_header</code> is enabled by default. It will affect parsing of input formats <code class=syntax>-WithNames</code> and <code class=syntax>-WithNamesAndTypes</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10937 rel="external nofollow noreferrer" target=_blank>#10937</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove <code class=syntax>experimental_use_processors</code> setting. It is enabled by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/10924 rel="external nofollow noreferrer" target=_blank>#10924</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Update <code class=syntax>zstd</code> to 1.4.4. It has some minor improvements in performance and compression ratio. If you run replicas with different versions of ClickHouse you may see reasonable error messages <code class=syntax>Data after merge is not byte-identical to data on another replicas.</code> with explanation. These messages are Ok and you should not worry. This change is backward compatible but we list it here in changelog in case you will wonder about these messages. <a href=https://github.com/ClickHouse/ClickHouse/pull/10663 rel="external nofollow noreferrer" target=_blank>#10663</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added a check for meaningless codecs and a setting <code class=syntax>allow_suspicious_codecs</code> to control this check. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/4966 rel="external nofollow noreferrer" target=_blank>#4966</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10645 rel="external nofollow noreferrer" target=_blank>#10645</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Several Kafka setting changes their defaults. See <a href=https://github.com/ClickHouse/ClickHouse/pull/11388 rel="external nofollow noreferrer" target=_blank>#11388</a>.</li></ul><h4 id=new-feature>New Feature<a class=headerlink href=../amp/#new-feature title="Permanent link"> </a></h4><ul><li><code class=syntax>TTL DELETE WHERE</code> and <code class=syntax>TTL GROUP BY</code> for automatic data coarsening and rollup in tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10537 rel="external nofollow noreferrer" target=_blank>#10537</a> (<a href=https://github.com/expl0si0nn rel="external nofollow noreferrer" target=_blank>expl0si0nn</a>).</li><li>Implementation of PostgreSQL wire protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/10242 rel="external nofollow noreferrer" target=_blank>#10242</a> (<a href=https://github.com/MovElb rel="external nofollow noreferrer" target=_blank>Movses</a>).</li><li>Added system tables for users, roles, grants, settings profiles, quotas, row policies; added commands SHOW USER, SHOW [CURRENT|ENABLED] ROLES, SHOW SETTINGS PROFILES. <a href=https://github.com/ClickHouse/ClickHouse/pull/10387 rel="external nofollow noreferrer" target=_blank>#10387</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Support writes in ODBC Table function <a href=https://github.com/ClickHouse/ClickHouse/pull/10554 rel="external nofollow noreferrer" target=_blank>#10554</a> (<a href=https://github.com/ageraab rel="external nofollow noreferrer" target=_blank>ageraab</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10901 rel="external nofollow noreferrer" target=_blank>#10901</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Add query performance metrics based on Linux <code class=syntax>perf_events</code> (these metrics are calculated with hardware CPU counters and OS counters). It is optional and requires <code class=syntax>CAP_SYS_ADMIN</code> to be set on clickhouse binary. <a href=https://github.com/ClickHouse/ClickHouse/pull/9545 rel="external nofollow noreferrer" target=_blank>#9545</a> <a href=https://github.com/And42 rel="external nofollow noreferrer" target=_blank>Andrey Skobtsov</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11226 rel="external nofollow noreferrer" target=_blank>#11226</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li><li>Now support <code class=syntax>NULL</code> and <code class=syntax>NOT NULL</code> modifiers for data types in <code class=syntax>CREATE</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/11057 rel="external nofollow noreferrer" target=_blank>#11057</a> (<a href=https://github.com/Potya rel="external nofollow noreferrer" target=_blank>Павел Потемкин</a>).</li><li>Add <code class=syntax>ArrowStream</code> input and output format. <a href=https://github.com/ClickHouse/ClickHouse/pull/11088 rel="external nofollow noreferrer" target=_blank>#11088</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Support Cassandra as external dictionary source. <a href=https://github.com/ClickHouse/ClickHouse/pull/4978 rel="external nofollow noreferrer" target=_blank>#4978</a> (<a href=https://github.com/favstovol rel="external nofollow noreferrer" target=_blank>favstovol</a>).</li><li>Added a new layout <code class=syntax>direct</code> which loads all the data directly from the source for each query, without storing or caching data. <a href=https://github.com/ClickHouse/ClickHouse/pull/10622 rel="external nofollow noreferrer" target=_blank>#10622</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>).</li><li>Added new <code class=syntax>complex_key_direct</code> layout to dictionaries, that does not store anything locally during query execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/10850 rel="external nofollow noreferrer" target=_blank>#10850</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>).</li><li>Added support for MySQL style global variables syntax (stub). This is needed for compatibility of MySQL protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/11832 rel="external nofollow noreferrer" target=_blank>#11832</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added syntax highligting to <code class=syntax>clickhouse-client</code> using <code class=syntax>replxx</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11422 rel="external nofollow noreferrer" target=_blank>#11422</a> (<a href=https://github.com/kuskarov rel="external nofollow noreferrer" target=_blank>Tagir Kuskarov</a>).</li><li><code class=syntax>minMap</code> and <code class=syntax>maxMap</code> functions were added. <a href=https://github.com/ClickHouse/ClickHouse/pull/11603 rel="external nofollow noreferrer" target=_blank>#11603</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li><li>Add the <code class=syntax>system.asynchronous_metric_log</code> table that logs historical metrics from <code class=syntax>system.asynchronous_metrics</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11588 rel="external nofollow noreferrer" target=_blank>#11588</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li><li>Add functions <code class=syntax>extractAllGroupsHorizontal(haystack, re)</code> and <code class=syntax>extractAllGroupsVertical(haystack, re)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11554 rel="external nofollow noreferrer" target=_blank>#11554</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Add SHOW CLUSTER(S) queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11467 rel="external nofollow noreferrer" target=_blank>#11467</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li><li>Add <code class=syntax>netloc</code> function for extracting network location, similar to <code class=syntax>urlparse(url)</code>, <code class=syntax>netloc</code> in python. <a href=https://github.com/ClickHouse/ClickHouse/pull/11356 rel="external nofollow noreferrer" target=_blank>#11356</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li><li>Add 2 more virtual columns for engine=Kafka to access message headers. <a href=https://github.com/ClickHouse/ClickHouse/pull/11283 rel="external nofollow noreferrer" target=_blank>#11283</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Add <code class=syntax>_timestamp_ms</code> virtual column for Kafka engine (type is <code class=syntax>Nullable(DateTime64(3))</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/11260 rel="external nofollow noreferrer" target=_blank>#11260</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Add function <code class=syntax>randomFixedString</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10866 rel="external nofollow noreferrer" target=_blank>#10866</a> (<a href=https://github.com/xolm rel="external nofollow noreferrer" target=_blank>Andrei Nekrashevich</a>).</li><li>Add function <code class=syntax>fuzzBits</code> that randomly flips bits in a string with given probability. <a href=https://github.com/ClickHouse/ClickHouse/pull/11237 rel="external nofollow noreferrer" target=_blank>#11237</a> (<a href=https://github.com/xolm rel="external nofollow noreferrer" target=_blank>Andrei Nekrashevich</a>).</li><li>Allow comparison of numbers with constant string in comparison operators, IN and VALUES sections. <a href=https://github.com/ClickHouse/ClickHouse/pull/11647 rel="external nofollow noreferrer" target=_blank>#11647</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add <code class=syntax>round_robin</code> load_balancing mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/11645 rel="external nofollow noreferrer" target=_blank>#11645</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Add <code class=syntax>cast_keep_nullable</code> setting. If set <code class=syntax>CAST(something_nullable AS Type)</code> return <code class=syntax>Nullable(Type)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11733 rel="external nofollow noreferrer" target=_blank>#11733</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Added column <code class=syntax>position</code> to <code class=syntax>system.columns</code> table and <code class=syntax>column_position</code> to <code class=syntax>system.parts_columns</code> table. It contains ordinal position of a column in a table starting with 1. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/7744 rel="external nofollow noreferrer" target=_blank>#7744</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11655 rel="external nofollow noreferrer" target=_blank>#11655</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>ON CLUSTER support for SYSTEM {FLUSH DISTRIBUTED,STOP/START DISTRIBUTED SEND}. <a href=https://github.com/ClickHouse/ClickHouse/pull/11415 rel="external nofollow noreferrer" target=_blank>#11415</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Add system.distribution_queue table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11394 rel="external nofollow noreferrer" target=_blank>#11394</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Support for all format settings in Kafka, expose some setting on table level, adjust the defaults for better performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/11388 rel="external nofollow noreferrer" target=_blank>#11388</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Add <code class=syntax>port</code> function (to extract port from URL). <a href=https://github.com/ClickHouse/ClickHouse/pull/11120 rel="external nofollow noreferrer" target=_blank>#11120</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Now <code class=syntax>dictGet*</code> functions accept table names. <a href=https://github.com/ClickHouse/ClickHouse/pull/11050 rel="external nofollow noreferrer" target=_blank>#11050</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>The <code class=syntax>clickhouse-format</code> tool is now able to format multiple queries when the <code class=syntax>-n</code> argument is used. <a href=https://github.com/ClickHouse/ClickHouse/pull/10852 rel="external nofollow noreferrer" target=_blank>#10852</a> (<a href=https://github.com/dgrr rel="external nofollow noreferrer" target=_blank>Darío</a>).</li><li>Possibility to configure proxy-resolver for DiskS3. <a href=https://github.com/ClickHouse/ClickHouse/pull/10744 rel="external nofollow noreferrer" target=_blank>#10744</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Make <code class=syntax>pointInPolygon</code> work with non-constant polygon. PointInPolygon now can take Array(Array(Tuple(..., ...))) as second argument, array of polygon and holes. <a href=https://github.com/ClickHouse/ClickHouse/pull/10623 rel="external nofollow noreferrer" target=_blank>#10623</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li><li>Added <code class=syntax>move_ttl_info</code> to <code class=syntax>system.parts</code> in order to provide introspection of move TTL functionality. <a href=https://github.com/ClickHouse/ClickHouse/pull/10591 rel="external nofollow noreferrer" target=_blank>#10591</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>Possibility to work with S3 through proxies. <a href=https://github.com/ClickHouse/ClickHouse/pull/10576 rel="external nofollow noreferrer" target=_blank>#10576</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Add <code class=syntax>NCHAR</code> and <code class=syntax>NVARCHAR</code> synonims for data types. <a href=https://github.com/ClickHouse/ClickHouse/pull/11025 rel="external nofollow noreferrer" target=_blank>#11025</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Resolved <a href=https://github.com/ClickHouse/ClickHouse/issues/7224 rel="external nofollow noreferrer" target=_blank>#7224</a>: added <code class=syntax>FailedQuery</code>, <code class=syntax>FailedSelectQuery</code> and <code class=syntax>FailedInsertQuery</code> metrics to <code class=syntax>system.events</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11151 rel="external nofollow noreferrer" target=_blank>#11151</a> (<a href=https://github.com/naorlov rel="external nofollow noreferrer" target=_blank>Nikita Orlov</a>).</li><li>Add more <code class=syntax>jemalloc</code> statistics to <code class=syntax>system.asynchronous_metrics</code>, and ensure that we see up-to-date values for them. <a href=https://github.com/ClickHouse/ClickHouse/pull/11748 rel="external nofollow noreferrer" target=_blank>#11748</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li><li>Allow to specify default S3 credentials and custom auth headers. <a href=https://github.com/ClickHouse/ClickHouse/pull/11134 rel="external nofollow noreferrer" target=_blank>#11134</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>).</li><li>Added new functions to import/export DateTime64 as Int64 with various precision: <code class=syntax>to-/fromUnixTimestamp64Milli/-Micro/-Nano</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10923 rel="external nofollow noreferrer" target=_blank>#10923</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Allow specifying <code class=syntax>mongodb://</code> URI for MongoDB dictionaries. <a href=https://github.com/ClickHouse/ClickHouse/pull/10915 rel="external nofollow noreferrer" target=_blank>#10915</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li><li>OFFSET keyword can now be used without an affiliated LIMIT clause. <a href=https://github.com/ClickHouse/ClickHouse/pull/10802 rel="external nofollow noreferrer" target=_blank>#10802</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li><li>Added <code class=syntax>system.licenses</code> table. This table contains licenses of third-party libraries that are located in <code class=syntax>contrib</code> directory. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/2890 rel="external nofollow noreferrer" target=_blank>#2890</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10795 rel="external nofollow noreferrer" target=_blank>#10795</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>New function function toStartOfSecond(DateTime64) -&gt; DateTime64 that nullifies sub-second part of DateTime64 value. <a href=https://github.com/ClickHouse/ClickHouse/pull/10722 rel="external nofollow noreferrer" target=_blank>#10722</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Add new input format <code class=syntax>JSONAsString</code> that accepts a sequence of JSON objects separated by newlines, spaces and/or commas. <a href=https://github.com/ClickHouse/ClickHouse/pull/10607 rel="external nofollow noreferrer" target=_blank>#10607</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li><li>Allowed to profile memory with finer granularity steps than 4 MiB. Added sampling memory profiler to capture random allocations/deallocations. <a href=https://github.com/ClickHouse/ClickHouse/pull/10598 rel="external nofollow noreferrer" target=_blank>#10598</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li><code class=syntax>SimpleAggregateFunction</code> now also supports <code class=syntax>sumMap</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10000 rel="external nofollow noreferrer" target=_blank>#10000</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li><li>Support <code class=syntax>ALTER RENAME COLUMN</code> for the distributed table engine. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/10727 rel="external nofollow noreferrer" target=_blank>#10727</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10747 rel="external nofollow noreferrer" target=_blank>#10747</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10887 rel="external nofollow noreferrer" target=_blank>#10887</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li></ul><h4 id=bug-fix>Bug Fix<a class=headerlink href=../amp/#bug-fix title="Permanent link"> </a></h4><ul><li>Fix UBSan report in Decimal parse. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7540 rel="external nofollow noreferrer" target=_blank>#7540</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10512 rel="external nofollow noreferrer" target=_blank>#10512</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential floating point exception when parsing DateTime64. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11374 rel="external nofollow noreferrer" target=_blank>#11374</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11875 rel="external nofollow noreferrer" target=_blank>#11875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. <a href=https://github.com/ClickHouse/ClickHouse/pull/11895 rel="external nofollow noreferrer" target=_blank>#11895</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix wrong result of comparison of FixedString with constant String. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11393 rel="external nofollow noreferrer" target=_blank>#11393</a>. This bug appeared in version 20.4. <a href=https://github.com/ClickHouse/ClickHouse/pull/11828 rel="external nofollow noreferrer" target=_blank>#11828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix wrong result for <code class=syntax>if</code> with NULLs in condition. <a href=https://github.com/ClickHouse/ClickHouse/pull/11807 rel="external nofollow noreferrer" target=_blank>#11807</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix using too many threads for queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11788 rel="external nofollow noreferrer" target=_blank>#11788</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed <code class=syntax>Scalar doesn't exist</code> exception when using <code class=syntax>WITH &lt;scalar subquery&gt; ...</code> in <code class=syntax>SELECT ... FROM merge_tree_table ...</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/11621 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11621</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11767 rel="external nofollow noreferrer" target=_blank>#11767</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix unexpected behaviour of queries like <code class=syntax>SELECT *, xyz.*</code> which were success while an error expected. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li><li>Now replicated fetches will be cancelled during metadata alter. <a href=https://github.com/ClickHouse/ClickHouse/pull/11744 rel="external nofollow noreferrer" target=_blank>#11744</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Parse metadata stored in zookeeper before checking for equality. <a href=https://github.com/ClickHouse/ClickHouse/pull/11739 rel="external nofollow noreferrer" target=_blank>#11739</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix <code class=syntax>ORDER BY ... WITH FILL</code> over const columns. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix very rare race condition in SYSTEM SYNC REPLICA. If the replicated table is created and at the same time from the separate connection another client is issuing <code class=syntax>SYSTEM SYNC REPLICA</code> command on that table (this is unlikely, because another client should be aware that the table is created), it's possible to get nullptr dereference. <a href=https://github.com/ClickHouse/ClickHouse/pull/11691 rel="external nofollow noreferrer" target=_blank>#11691</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix <code class=syntax>LIMIT n WITH TIES</code> usage together with <code class=syntax>ORDER BY</code> statement, which contains aliases. <a href=https://github.com/ClickHouse/ClickHouse/pull/11689 rel="external nofollow noreferrer" target=_blank>#11689</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix possible <code class=syntax>Pipeline stuck</code> for selects with parallel <code class=syntax>FINAL</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11636 rel="external nofollow noreferrer" target=_blank>#11636</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11682 rel="external nofollow noreferrer" target=_blank>#11682</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix error which leads to an incorrect state of <code class=syntax>system.mutations</code>. It may show that whole mutation is already done but the server still has <code class=syntax>MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11611 rel="external nofollow noreferrer" target=_blank>#11611</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11681 rel="external nofollow noreferrer" target=_blank>#11681</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix syntax hilite in CREATE USER query. <a href=https://github.com/ClickHouse/ClickHouse/pull/11664 rel="external nofollow noreferrer" target=_blank>#11664</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11352 rel="external nofollow noreferrer" target=_blank>#11352</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11644 rel="external nofollow noreferrer" target=_blank>#11644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Without <code class=syntax>-q</code> option the database does not get created at startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/11604 rel="external nofollow noreferrer" target=_blank>#11604</a> (<a href=https://github.com/giordyb rel="external nofollow noreferrer" target=_blank>giordyb</a>).</li><li>Fix error <code class=syntax>Block structure mismatch</code> for queries with sampling reading from <code class=syntax>Buffer</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11602 rel="external nofollow noreferrer" target=_blank>#11602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when <code class=syntax>exception.code() % 256 == 0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix race conditions in CREATE/DROP of different replicas of ReplicatedMergeTree. Continue to work if the table was not removed completely from ZooKeeper or not created successfully. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11432 rel="external nofollow noreferrer" target=_blank>#11432</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11592 rel="external nofollow noreferrer" target=_blank>#11592</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix error <code class=syntax>Size of offsets doesn't match size of column</code> for queries with <code class=syntax>PREWHERE column in (subquery)</code> and <code class=syntax>ARRAY JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed rare segfault in <code class=syntax>SHOW CREATE TABLE</code> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11490 rel="external nofollow noreferrer" target=_blank>#11490</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11579 rel="external nofollow noreferrer" target=_blank>#11579</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>All queries in HTTP session have had the same query_id. It is fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/11578 rel="external nofollow noreferrer" target=_blank>#11578</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li><li>Fix the error <code class=syntax>Data compressed with different methods</code> that can happen if <code class=syntax>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix shard_num/replica_num for <code class=syntax>&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href=https://github.com/ClickHouse/ClickHouse/pull/11528 rel="external nofollow noreferrer" target=_blank>#11528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix async INSERT into Distributed for prefer_localhost_replica=0 and w/o internal_replication. <a href=https://github.com/ClickHouse/ClickHouse/pull/11527 rel="external nofollow noreferrer" target=_blank>#11527</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with <code class=syntax>-State</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix <code class=syntax>Pipeline stuck</code> exception for <code class=syntax>INSERT SELECT FINAL</code> where <code class=syntax>SELECT</code> (<code class=syntax>max_threads</code>&gt;1) has multiple streams but <code class=syntax>INSERT</code> has only one (<code class=syntax>max_insert_threads</code>==0). <a href=https://github.com/ClickHouse/ClickHouse/pull/11455 rel="external nofollow noreferrer" target=_blank>#11455</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix wrong result in queries like <code class=syntax>select count() from t, u</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11454 rel="external nofollow noreferrer" target=_blank>#11454</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix return compressed size for codecs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix potential uninitialized memory read in MergeTree shutdown if table was not created successfully. <a href=https://github.com/ClickHouse/ClickHouse/pull/11420 rel="external nofollow noreferrer" target=_blank>#11420</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash in JOIN over <code class=syntax>LowCarinality(T)</code> and <code class=syntax>Nullable(T)</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/11380 rel="external nofollow noreferrer" target=_blank>#11380</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11414 rel="external nofollow noreferrer" target=_blank>#11414</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix error code for wrong <code class=syntax>USING</code> key. <a href=https://github.com/ClickHouse/ClickHouse/issues/11373 rel="external nofollow noreferrer" target=_blank>#11373</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11404 rel="external nofollow noreferrer" target=_blank>#11404</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fixed <code class=syntax>geohashesInBox</code> with arguments outside of latitude/longitude range. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Better errors for <code class=syntax>joinGet()</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/11389 rel="external nofollow noreferrer" target=_blank>#11389</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix possible <code class=syntax>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href=https://github.com/ClickHouse/ClickHouse/pull/11354 rel="external nofollow noreferrer" target=_blank>#11354</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix support for <code class=syntax>\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9933 rel="external nofollow noreferrer" target=_blank>#9933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11350 rel="external nofollow noreferrer" target=_blank>#11350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential segfault when using <code class=syntax>Lazy</code> database. <a href=https://github.com/ClickHouse/ClickHouse/pull/11348 rel="external nofollow noreferrer" target=_blank>#11348</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash in direct selects from <code class=syntax>Join</code> table engine (without JOIN) and wrong nullability. <a href=https://github.com/ClickHouse/ClickHouse/pull/11340 rel="external nofollow noreferrer" target=_blank>#11340</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix crash in <code class=syntax>quantilesExactWeightedArray</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Now merges stopped before change metadata in <code class=syntax>ALTER</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11335 rel="external nofollow noreferrer" target=_blank>#11335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Make writing to <code class=syntax>MATERIALIZED VIEW</code> with setting <code class=syntax>parallel_view_processing = 1</code> parallel again. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix <code class=syntax>visitParamExtractRaw</code> when extracted JSON has strings with unbalanced { or [. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix insignificant data race in <code class=syntax>clickhouse-copier</code>. Found by integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11313 rel="external nofollow noreferrer" target=_blank>#11313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class=syntax>empty</code> or <code class=syntax>notEmpty</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code class=syntax>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class=syntax>max_network_bandwidth</code>, <code class=syntax>max_execution_speed</code> or <code class=syntax>priority</code> settings. Change the default value of <code class=syntax>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class=syntax>min_execution_speed</code> and <code class=syntax>max_execution_speed</code> have no effect. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class=syntax>clickhouse-client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash when <code class=syntax>SET DEFAULT ROLE</code> is called with wrong arguments. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10586 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/10586</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11278 rel="external nofollow noreferrer" target=_blank>#11278</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix crash while reading malformed data in <code class=syntax>Protobuf</code> format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fixed a bug when <code class=syntax>cache</code> dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href=https://github.com/ClickHouse/ClickHouse/pull/11233 rel="external nofollow noreferrer" target=_blank>#11233</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li><li>Fix error <code class=syntax>Block structure mismatch in QueryPipeline</code> while reading from <code class=syntax>VIEW</code> with constants in inner query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11181 rel="external nofollow noreferrer" target=_blank>#11181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11205 rel="external nofollow noreferrer" target=_blank>#11205</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix possible exception <code class=syntax>Invalid status for associated output</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11200 rel="external nofollow noreferrer" target=_blank>#11200</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Now <code class=syntax>primary.idx</code> will be checked if it's defined in <code class=syntax>CREATE</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/11199 rel="external nofollow noreferrer" target=_blank>#11199</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix possible error <code class=syntax>Cannot capture column</code> for higher-order functions with <code class=syntax>Array(Array(LowCardinality))</code> captured argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed <code class=syntax>S3</code> globbing which could fail in case of more than 1000 keys and some backends. <a href=https://github.com/ClickHouse/ClickHouse/pull/11179 rel="external nofollow noreferrer" target=_blank>#11179</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href=https://github.com/ClickHouse/ClickHouse/pull/11145 rel="external nofollow noreferrer" target=_blank>#11145</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href=https://github.com/ClickHouse/ClickHouse/pull/11114 rel="external nofollow noreferrer" target=_blank>#11114</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Remove logging from mutation finalization task if nothing was finalized. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed deadlock during server startup after update with changes in structure of system log tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/11106 rel="external nofollow noreferrer" target=_blank>#11106</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed memory leak in registerDiskS3. <a href=https://github.com/ClickHouse/ClickHouse/pull/11074 rel="external nofollow noreferrer" target=_blank>#11074</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Fix error <code class=syntax>No such name in Block::erase()</code> when JOIN appears with PREWHERE or <code class=syntax>optimize_move_to_prewhere</code> makes PREWHERE from WHERE. <a href=https://github.com/ClickHouse/ClickHouse/pull/11051 rel="external nofollow noreferrer" target=_blank>#11051</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fixes the potential missed data during termination of Kafka engine table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11048 rel="external nofollow noreferrer" target=_blank>#11048</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fixed parseDateTime64BestEffort argument resolution bugs. <a href=https://github.com/ClickHouse/ClickHouse/issues/10925 rel="external nofollow noreferrer" target=_blank>#10925</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Now it's possible to <code class=syntax>ADD/DROP</code> and <code class=syntax>RENAME</code> the same one column in a single <code class=syntax>ALTER</code> query. Exception message for simultaneous <code class=syntax>MODIFY</code> and <code class=syntax>RENAME</code> became more clear. Partially fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10669 rel="external nofollow noreferrer" target=_blank>#10669</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11037 rel="external nofollow noreferrer" target=_blank>#11037</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed parsing of S3 URLs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11036 rel="external nofollow noreferrer" target=_blank>#11036</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>Fix memory tracking for two-level <code class=syntax>GROUP BY</code> when there is a <code class=syntax>LIMIT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11022 rel="external nofollow noreferrer" target=_blank>#11022</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix very rare potential use-after-free error in MergeTree if table was not created successfully. <a href=https://github.com/ClickHouse/ClickHouse/pull/10986 rel="external nofollow noreferrer" target=_blank>#10986</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix metadata (relative path for rename) and data (relative path for symlink) handling for Atomic database. <a href=https://github.com/ClickHouse/ClickHouse/pull/10980 rel="external nofollow noreferrer" target=_blank>#10980</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix server crash on concurrent <code class=syntax>ALTER</code> and <code class=syntax>DROP DATABASE</code> queries with <code class=syntax>Atomic</code> database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10968 rel="external nofollow noreferrer" target=_blank>#10968</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix incorrect raw data size in method getRawData(). <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li><li>Fix incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Avoid sending partially written files by the DistributedBlockOutputStream. <a href=https://github.com/ClickHouse/ClickHouse/pull/10940 rel="external nofollow noreferrer" target=_blank>#10940</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix crash in <code class=syntax>SELECT count(notNullIn(NULL, []))</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10920 rel="external nofollow noreferrer" target=_blank>#10920</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href=https://github.com/ClickHouse/ClickHouse/pull/10910 rel="external nofollow noreferrer" target=_blank>#10910</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Now it's possible to execute multiple <code class=syntax>ALTER RENAME</code> like <code class=syntax>a TO b, c TO a</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10895 rel="external nofollow noreferrer" target=_blank>#10895</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix possible race which could happen when you get result from aggregate function state from multiple thread for the same column. The only way (which I found) it can happen is when you use <code class=syntax>finalizeAggregation</code> function while reading from table with <code class=syntax>Memory</code> engine which stores <code class=syntax>AggregateFunction</code> state for <code class=syntax>quanite*</code> function. <a href=https://github.com/ClickHouse/ClickHouse/pull/10890 rel="external nofollow noreferrer" target=_blank>#10890</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix backward compatibility with tuples in Distributed tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix SIGSEGV in StringHashTable (if such key does not exist). <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed <code class=syntax>WATCH</code> hangs after <code class=syntax>LiveView</code> table was dropped from database with <code class=syntax>Atomic</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10859 rel="external nofollow noreferrer" target=_blank>#10859</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed bug in <code class=syntax>ReplicatedMergeTree</code> which might cause some <code class=syntax>ALTER</code> on <code class=syntax>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Now constraints are updated if the column participating in <code class=syntax>CONSTRAINT</code> expression was renamed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10844 rel="external nofollow noreferrer" target=_blank>#10844</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10847 rel="external nofollow noreferrer" target=_blank>#10847</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix potential read of uninitialized memory in cache dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/10834 rel="external nofollow noreferrer" target=_blank>#10834</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix columns order after Block::sortColumns() (also add a test that shows that it affects some real use case - Buffer engine). <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix the issue with ODBC bridge when no quoting of identifiers is requested. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7984 rel="external nofollow noreferrer" target=_blank>#7984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix UBSan and MSan report in DateLUT. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Make use of <code class=syntax>src_type</code> for correct type conversion in key conditions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li><li>Get rid of old libunwind patches. <a href=https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012 target=_blank>https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> This allows to disable <code class=syntax>-fno-omit-frame-pointer</code> in <code class=syntax>clang</code> builds that improves performance at least by 1% in average. <a href=https://github.com/ClickHouse/ClickHouse/pull/10761 rel="external nofollow noreferrer" target=_blank>#10761</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix avgWeighted when using floating-point weight over multiple shards. <a href=https://github.com/ClickHouse/ClickHouse/pull/10758 rel="external nofollow noreferrer" target=_blank>#10758</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>).</li><li>Fix <code class=syntax>parallel_view_processing</code> behavior. Now all insertions into <code class=syntax>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix combinator -OrNull and -OrDefault when combined with -State. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Fix crash in <code class=syntax>generateRandom</code> with nested types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10583 rel="external nofollow noreferrer" target=_blank>#10583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10734 rel="external nofollow noreferrer" target=_blank>#10734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix data corruption for <code class=syntax>LowCardinality(FixedString)</code> key column in <code class=syntax>SummingMergeTree</code> which could have happened after merge. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix usage of primary key wrapped into a function with 'FINAL' modifier and 'ORDER BY' optimization. <a href=https://github.com/ClickHouse/ClickHouse/pull/10715 rel="external nofollow noreferrer" target=_blank>#10715</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix possible buffer overflow in function <code class=syntax>h3EdgeAngle</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10711 rel="external nofollow noreferrer" target=_blank>#10711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix atomicity of HTTP insert. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9666 rel="external nofollow noreferrer" target=_blank>#9666</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10687 rel="external nofollow noreferrer" target=_blank>#10687</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li><li>Fix multiple usages of <code class=syntax>IN</code> operator with the identical set in one query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fixed bug, which causes http requests stuck on client close when <code class=syntax>readonly=2</code> and <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7939 rel="external nofollow noreferrer" target=_blank>#7939</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7019 rel="external nofollow noreferrer" target=_blank>#7019</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7736 rel="external nofollow noreferrer" target=_blank>#7736</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7091 rel="external nofollow noreferrer" target=_blank>#7091</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix order of parameters in AggregateTransform constructor. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li><li>Fix the lack of parallel execution of remote queries with <code class=syntax>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix possible incorrect number of rows for queries with <code class=syntax>LIMIT</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10566 rel="external nofollow noreferrer" target=_blank>#10566</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10709 rel="external nofollow noreferrer" target=_blank>#10709</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10660 rel="external nofollow noreferrer" target=_blank>#10660</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix bug which locks concurrent alters when table has a lot of parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/10659 rel="external nofollow noreferrer" target=_blank>#10659</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix nullptr dereference in StorageBuffer if server was shutdown before table startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/10641 rel="external nofollow noreferrer" target=_blank>#10641</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix predicates optimization for distributed queries (<code class=syntax>enable_optimize_predicate_expression=1</code>) for queries with <code class=syntax>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix optimize_skip_unused_shards with LowCardinality. <a href=https://github.com/ClickHouse/ClickHouse/pull/10611 rel="external nofollow noreferrer" target=_blank>#10611</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix segfault in StorageBuffer when exception on server startup. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10550 rel="external nofollow noreferrer" target=_blank>#10550</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10609 rel="external nofollow noreferrer" target=_blank>#10609</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>On <code class=syntax>SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed incorrect scalar results inside inner query of <code class=syntax>MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed handling condition variable for synchronous mutations. In some cases signals to that condition variable could be lost. <a href=https://github.com/ClickHouse/ClickHouse/pull/10588 rel="external nofollow noreferrer" target=_blank>#10588</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>Fixes possible crash <code class=syntax>createDictionary()</code> is called before <code class=syntax>loadStoredObject()</code> has finished. <a href=https://github.com/ClickHouse/ClickHouse/pull/10587 rel="external nofollow noreferrer" target=_blank>#10587</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix error <code class=syntax>the BloomFilter false positive must be a double number between 0 and 1</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Fix SELECT of column ALIAS which default expression type different from column type. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Implemented comparison between DateTime64 and String values (just like for DateTime). <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fix index corruption, which may accur in some cases after merge compact parts into another compact part. <a href=https://github.com/ClickHouse/ClickHouse/pull/10531 rel="external nofollow noreferrer" target=_blank>#10531</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Disable GROUP BY sharding_key optimization by default (<code class=syntax>optimize_distributed_group_by_sharding_key</code> had been introduced and turned of by default, due to trickery of sharding_key analyzing, simple example is <code class=syntax>if</code> in sharding key) and fix it for WITH ROLLUP/CUBE/TOTALS. <a href=https://github.com/ClickHouse/ClickHouse/pull/10516 rel="external nofollow noreferrer" target=_blank>#10516</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/10263 rel="external nofollow noreferrer" target=_blank>#10263</a> (after that PR dist send via INSERT had been postponing on each INSERT) Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/8756 rel="external nofollow noreferrer" target=_blank>#8756</a> (that PR breaks distributed sends with all of the following conditions met (unlikely setup for now I guess): <code class=syntax>internal_replication == false</code>, multiple local shards (activates the hardlinking code) and <code class=syntax>distributed_storage_policy</code> (makes <code class=syntax>link(2)</code> fails on <code class=syntax>EXDEV</code>)). <a href=https://github.com/ClickHouse/ClickHouse/pull/10486 rel="external nofollow noreferrer" target=_blank>#10486</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed error with "max_rows_to_sort" limit. <a href=https://github.com/ClickHouse/ClickHouse/pull/10268 rel="external nofollow noreferrer" target=_blank>#10268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Get dictionary and check access rights only once per each call of any function reading external dictionaries. <a href=https://github.com/ClickHouse/ClickHouse/pull/10928 rel="external nofollow noreferrer" target=_blank>#10928</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li></ul><h4 id=improvement>Improvement<a class=headerlink href=../amp/#improvement title="Permanent link"> </a></h4><ul><li>Apply <code class=syntax>TTL</code> for old data, after <code class=syntax>ALTER MODIFY TTL</code> query. This behaviour is controlled by setting <code class=syntax>materialize_ttl_after_modify</code>, which is enabled by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/11042 rel="external nofollow noreferrer" target=_blank>#11042</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>When parsing C-style backslash escapes in string literals, VALUES and various text formats (this is an extension to SQL standard that is endemic for ClickHouse and MySQL), keep backslash if unknown escape sequence is found (e.g. <code class=syntax>\%</code> or <code class=syntax>\w</code>) that will make usage of <code class=syntax>LIKE</code> and <code class=syntax>match</code> regular expressions more convenient (it's enough to write <code class=syntax>name LIKE 'used\_cars'</code> instead of <code class=syntax>name LIKE 'used\\_cars'</code>) and more compatible at the same time. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10922 rel="external nofollow noreferrer" target=_blank>#10922</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11208 rel="external nofollow noreferrer" target=_blank>#11208</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>When reading Decimal value, cut extra digits after point. This behaviour is more compatible with MySQL and PostgreSQL. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10202 rel="external nofollow noreferrer" target=_blank>#10202</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11831 rel="external nofollow noreferrer" target=_blank>#11831</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Allow to DROP replicated table if the metadata in ZooKeeper was already removed and does not exist (this is also the case when using TestKeeper for testing and the server was restarted). Allow to RENAME replicated table even if there is an error communicating with ZooKeeper. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10720 rel="external nofollow noreferrer" target=_blank>#10720</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11652 rel="external nofollow noreferrer" target=_blank>#11652</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Slightly improve diagnostic of reading decimal from string. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10202 rel="external nofollow noreferrer" target=_blank>#10202</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11829 rel="external nofollow noreferrer" target=_blank>#11829</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix sleep invocation in signal handler. It was sleeping for less amount of time than expected. <a href=https://github.com/ClickHouse/ClickHouse/pull/11825 rel="external nofollow noreferrer" target=_blank>#11825</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>(Only Linux) OS related performance metrics (for CPU and I/O) will work even without <code class=syntax>CAP_NET_ADMIN</code> capability. <a href=https://github.com/ClickHouse/ClickHouse/pull/10544 rel="external nofollow noreferrer" target=_blank>#10544</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li><li>Added <code class=syntax>hostname</code> as an alias to function <code class=syntax>hostName</code>. This feature was suggested by Victor Tarnavskiy from Yandex.Metrica. <a href=https://github.com/ClickHouse/ClickHouse/pull/11821 rel="external nofollow noreferrer" target=_blank>#11821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added support for distributed <code class=syntax>DDL</code> (update/delete/drop partition) on cross replication clusters. <a href=https://github.com/ClickHouse/ClickHouse/pull/11703 rel="external nofollow noreferrer" target=_blank>#11703</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li><li>Emit warning instead of error in server log at startup if we cannot listen one of the listen addresses (e.g. IPv6 is unavailable inside Docker). Note that if server fails to listen all listed addresses, it will refuse to startup as before. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4406 rel="external nofollow noreferrer" target=_blank>#4406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11687 rel="external nofollow noreferrer" target=_blank>#11687</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Default user and database creation on docker image starting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10637 rel="external nofollow noreferrer" target=_blank>#10637</a> (<a href=https://github.com/tarampampam rel="external nofollow noreferrer" target=_blank>Paramtamtam</a>).</li><li>When multiline query is printed to server log, the lines are joined. Make it to work correct in case of multiline string literals, identifiers and single-line comments. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/3853 rel="external nofollow noreferrer" target=_blank>#3853</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11686 rel="external nofollow noreferrer" target=_blank>#11686</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Multiple names are now allowed in commands: CREATE USER, CREATE ROLE, ALTER USER, SHOW CREATE USER, SHOW GRANTS and so on. <a href=https://github.com/ClickHouse/ClickHouse/pull/11670 rel="external nofollow noreferrer" target=_blank>#11670</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Add support for distributed DDL (<code class=syntax>UPDATE/DELETE/DROP PARTITION</code>) on cross replication clusters. <a href=https://github.com/ClickHouse/ClickHouse/pull/11508 rel="external nofollow noreferrer" target=_blank>#11508</a> (<a href=https://github.com/etah000 rel="external nofollow noreferrer" target=_blank>frank lee</a>).</li><li>Clear password from command line in <code class=syntax>clickhouse-client</code> and <code class=syntax>clickhouse-benchmark</code> if the user has specified it with explicit value. This prevents password exposure by <code class=syntax>ps</code> and similar tools. <a href=https://github.com/ClickHouse/ClickHouse/pull/11665 rel="external nofollow noreferrer" target=_blank>#11665</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Don't use debug info from ELF file if it doesn't correspond to the running binary. It is needed to avoid printing wrong function names and source locations in stack traces. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7514 rel="external nofollow noreferrer" target=_blank>#7514</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11657 rel="external nofollow noreferrer" target=_blank>#11657</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Return NULL/zero when value is not parsed completely in parseDateTimeBestEffortOrNull/Zero functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7876 rel="external nofollow noreferrer" target=_blank>#7876</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11653 rel="external nofollow noreferrer" target=_blank>#11653</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Skip empty parameters in requested URL. They may appear when you write <code class=syntax>http://localhost:8123/?&amp;a=b</code> or <code class=syntax>http://localhost:8123/?a=b&amp;&amp;c=d</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10749 rel="external nofollow noreferrer" target=_blank>#10749</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11651 rel="external nofollow noreferrer" target=_blank>#11651</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Allow using <code class=syntax>groupArrayArray</code> and <code class=syntax>groupUniqArrayArray</code> as <code class=syntax>SimpleAggregateFunction</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11650 rel="external nofollow noreferrer" target=_blank>#11650</a> (<a href=https://github.com/ksvladimir rel="external nofollow noreferrer" target=_blank>Volodymyr Kuznetsov</a>).</li><li>Allow comparison with constant strings by implicit conversions when analysing index conditions on other types. This may close <a href=https://github.com/ClickHouse/ClickHouse/issues/11630 rel="external nofollow noreferrer" target=_blank>#11630</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11648 rel="external nofollow noreferrer" target=_blank>#11648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li><a href=https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377</a> Support config default HTTPHandlers. <a href=https://github.com/ClickHouse/ClickHouse/pull/11628 rel="external nofollow noreferrer" target=_blank>#11628</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Make more input formats to work with Kafka engine. Fix the issue with premature flushes. Fix the performance issue when <code class=syntax>kafka_num_consumers</code> is greater than number of partitions in topic. <a href=https://github.com/ClickHouse/ClickHouse/pull/11599 rel="external nofollow noreferrer" target=_blank>#11599</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Improve <code class=syntax>multiple_joins_rewriter_version=2</code> logic. Fix unknown columns error for lambda aliases. <a href=https://github.com/ClickHouse/ClickHouse/pull/11587 rel="external nofollow noreferrer" target=_blank>#11587</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Better exception message when cannot parse columns declaration list. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10403 rel="external nofollow noreferrer" target=_blank>#10403</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11537 rel="external nofollow noreferrer" target=_blank>#11537</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Improve <code class=syntax>enable_optimize_predicate_expression=1</code> logic for VIEW. <a href=https://github.com/ClickHouse/ClickHouse/pull/11513 rel="external nofollow noreferrer" target=_blank>#11513</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Adding support for PREWHERE in live view tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/11495 rel="external nofollow noreferrer" target=_blank>#11495</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Automatically update DNS cache, which is used to check if user is allowed to connect from an address. <a href=https://github.com/ClickHouse/ClickHouse/pull/11487 rel="external nofollow noreferrer" target=_blank>#11487</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>OPTIMIZE FINAL will force merge even if concurrent merges are performed. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11309 rel="external nofollow noreferrer" target=_blank>#11309</a> and closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11322 rel="external nofollow noreferrer" target=_blank>#11322</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11346 rel="external nofollow noreferrer" target=_blank>#11346</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Suppress output of cancelled queries in clickhouse-client. In previous versions result may continue to print in terminal even after you press Ctrl+C to cancel query. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9473 rel="external nofollow noreferrer" target=_blank>#9473</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11342 rel="external nofollow noreferrer" target=_blank>#11342</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Now history file is updated after each query and there is no race condition if multiple clients use one history file. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9897 rel="external nofollow noreferrer" target=_blank>#9897</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11453 rel="external nofollow noreferrer" target=_blank>#11453</a> (<a href=https://github.com/kuskarov rel="external nofollow noreferrer" target=_blank>Tagir Kuskarov</a>).</li><li>Better log messages in while reloading configuration. <a href=https://github.com/ClickHouse/ClickHouse/pull/11341 rel="external nofollow noreferrer" target=_blank>#11341</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove trailing whitespaces from formatted queries in <code class=syntax>clickhouse-client</code> or <code class=syntax>clickhouse-format</code> in some cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/11325 rel="external nofollow noreferrer" target=_blank>#11325</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add setting "output_format_pretty_max_value_width". If value is longer, it will be cut to avoid output of too large values in terminal. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11140 rel="external nofollow noreferrer" target=_blank>#11140</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11324 rel="external nofollow noreferrer" target=_blank>#11324</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Better exception message in case when there is shortage of memory mappings. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11027 rel="external nofollow noreferrer" target=_blank>#11027</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11316 rel="external nofollow noreferrer" target=_blank>#11316</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Support (U)Int8, (U)Int16, Date in ASOF JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/11301 rel="external nofollow noreferrer" target=_blank>#11301</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Support kafka_client_id parameter for Kafka tables. It also changes the default <code class=syntax>client.id</code> used by ClickHouse when communicating with Kafka to be more verbose and usable. <a href=https://github.com/ClickHouse/ClickHouse/pull/11252 rel="external nofollow noreferrer" target=_blank>#11252</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Keep the value of <code class=syntax>DistributedFilesToInsert</code> metric on exceptions. In previous versions, the value was set when we are going to send some files, but it is zero, if there was an exception and some files are still pending. Now it corresponds to the number of pending files in filesystem. <a href=https://github.com/ClickHouse/ClickHouse/pull/11220 rel="external nofollow noreferrer" target=_blank>#11220</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add support for multi-word data type names (such as <code class=syntax>DOUBLE PRECISION</code> and <code class=syntax>CHAR VARYING</code>) for better SQL compatibility. <a href=https://github.com/ClickHouse/ClickHouse/pull/11214 rel="external nofollow noreferrer" target=_blank>#11214</a> (<a href=https://github.com/Potya rel="external nofollow noreferrer" target=_blank>Павел Потемкин</a>).</li><li>Provide synonyms for some data types. <a href=https://github.com/ClickHouse/ClickHouse/pull/10856 rel="external nofollow noreferrer" target=_blank>#10856</a> (<a href=https://github.com/Potya rel="external nofollow noreferrer" target=_blank>Павел Потемкин</a>).</li><li>The query log is now enabled by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/11184 rel="external nofollow noreferrer" target=_blank>#11184</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li><li>Show authentication type in table system.users and while executing SHOW CREATE USER query. <a href=https://github.com/ClickHouse/ClickHouse/pull/11080 rel="external nofollow noreferrer" target=_blank>#11080</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Remove data on explicit <code class=syntax>DROP DATABASE</code> for <code class=syntax>Memory</code> database engine. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10557 rel="external nofollow noreferrer" target=_blank>#10557</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11021 rel="external nofollow noreferrer" target=_blank>#11021</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Set thread names for internal threads of rdkafka library. Make logs from rdkafka available in server logs. <a href=https://github.com/ClickHouse/ClickHouse/pull/10983 rel="external nofollow noreferrer" target=_blank>#10983</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Support for unicode whitespaces in queries. This helps when queries are copy-pasted from Word or from web page. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10896 rel="external nofollow noreferrer" target=_blank>#10896</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10903 rel="external nofollow noreferrer" target=_blank>#10903</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Allow large UInt types as the index in function <code class=syntax>tupleElement</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10874 rel="external nofollow noreferrer" target=_blank>#10874</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Respect prefer_localhost_replica/load_balancing on INSERT into Distributed. <a href=https://github.com/ClickHouse/ClickHouse/pull/10867 rel="external nofollow noreferrer" target=_blank>#10867</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Introduce <code class=syntax>min_insert_block_size_rows_for_materialized_views</code>, <code class=syntax>min_insert_block_size_bytes_for_materialized_views</code> settings. This settings are similar to <code class=syntax>min_insert_block_size_rows</code> and <code class=syntax>min_insert_block_size_bytes</code>, but applied only for blocks inserted into <code class=syntax>MATERIALIZED VIEW</code>. It helps to control blocks squashing while pushing to MVs and avoid excessive memory usage. <a href=https://github.com/ClickHouse/ClickHouse/pull/10858 rel="external nofollow noreferrer" target=_blank>#10858</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Get rid of exception from replicated queue during server shutdown. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10819 rel="external nofollow noreferrer" target=_blank>#10819</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10841 rel="external nofollow noreferrer" target=_blank>#10841</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Ensure that <code class=syntax>varSamp</code>, <code class=syntax>varPop</code> cannot return negative results due to numerical errors and that <code class=syntax>stddevSamp</code>, <code class=syntax>stddevPop</code> cannot be calculated from negative variance. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10532 rel="external nofollow noreferrer" target=_blank>#10532</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10829 rel="external nofollow noreferrer" target=_blank>#10829</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Better DNS exception message. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10813 rel="external nofollow noreferrer" target=_blank>#10813</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10828 rel="external nofollow noreferrer" target=_blank>#10828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Change HTTP response code in case of some parse errors to 400 Bad Request. This fix <a href=https://github.com/ClickHouse/ClickHouse/issues/10636 rel="external nofollow noreferrer" target=_blank>#10636</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10640 rel="external nofollow noreferrer" target=_blank>#10640</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Print a message if clickhouse-client is newer than clickhouse-server. <a href=https://github.com/ClickHouse/ClickHouse/pull/10627 rel="external nofollow noreferrer" target=_blank>#10627</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Adding support for <code class=syntax>INSERT INTO [db.]table WATCH</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10498 rel="external nofollow noreferrer" target=_blank>#10498</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Allow to pass quota_key in clickhouse-client. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10227 rel="external nofollow noreferrer" target=_blank>#10227</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10270 rel="external nofollow noreferrer" target=_blank>#10270</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li></ul><h4 id=performance-improvement>Performance Improvement<a class=headerlink href=../amp/#performance-improvement title="Permanent link"> </a></h4><ul><li>Allow multiple replicas to assign merges, mutations, partition drop, move and replace concurrently. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10367 rel="external nofollow noreferrer" target=_blank>#10367</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11639 rel="external nofollow noreferrer" target=_blank>#11639</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/11795 rel="external nofollow noreferrer" target=_blank>#11795</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Optimization of GROUP BY with respect to table sorting key, enabled with <code class=syntax>optimize_aggregation_in_order</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/9113 rel="external nofollow noreferrer" target=_blank>#9113</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>).</li><li>Selects with final are executed in parallel. Added setting <code class=syntax>max_final_threads</code> to limit the number of threads used. <a href=https://github.com/ClickHouse/ClickHouse/pull/10463 rel="external nofollow noreferrer" target=_blank>#10463</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Improve performance for INSERT queries via <code class=syntax>INSERT SELECT</code> or INSERT with clickhouse-client when small blocks are generated (typical case with parallel parsing). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11275 rel="external nofollow noreferrer" target=_blank>#11275</a>. Fix the issue that CONSTRAINTs were not working for DEFAULT fields. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11273 rel="external nofollow noreferrer" target=_blank>#11273</a>. Fix the issue that CONSTRAINTS were ignored for TEMPORARY tables. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11274 rel="external nofollow noreferrer" target=_blank>#11274</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11276 rel="external nofollow noreferrer" target=_blank>#11276</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Optimization that eliminates min/max/any aggregators of GROUP BY keys in SELECT section, enabled with <code class=syntax>optimize_aggregators_of_group_by_keys</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/11667 rel="external nofollow noreferrer" target=_blank>#11667</a> (<a href=https://github.com/xPoSx rel="external nofollow noreferrer" target=_blank>xPoSx</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/11806 rel="external nofollow noreferrer" target=_blank>#11806</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>New optimization that takes all operations out of <code class=syntax>any</code> function, enabled with <code class=syntax>optimize_move_functions_out_of_any</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/11529 rel="external nofollow noreferrer" target=_blank>#11529</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>Ruslan</a>).</li><li>Improve performance of <code class=syntax>clickhouse-client</code> in interactive mode when Pretty formats are used. In previous versions, significant amount of time can be spent calculating visible width of UTF-8 string. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11323 rel="external nofollow noreferrer" target=_blank>#11323</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11323 rel="external nofollow noreferrer" target=_blank>#11323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Improved performance for queries with <code class=syntax>ORDER BY</code> and small <code class=syntax>LIMIT</code> (less, then <code class=syntax>max_block_size</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/11171 rel="external nofollow noreferrer" target=_blank>#11171</a> (<a href=https://github.com/Provet rel="external nofollow noreferrer" target=_blank>Albert Kidrachev</a>).</li><li>Add runtime CPU detection to select and dispatch the best function implementation. Add support for codegeneration for multiple targets. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/1017 rel="external nofollow noreferrer" target=_blank>#1017</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10058 rel="external nofollow noreferrer" target=_blank>#10058</a> (<a href=https://github.com/DimasKovas rel="external nofollow noreferrer" target=_blank>DimasKovas</a>).</li><li>Enable <code class=syntax>mlock</code> of clickhouse binary by default. It will prevent clickhouse executable from being paged out under high IO load. <a href=https://github.com/ClickHouse/ClickHouse/pull/11139 rel="external nofollow noreferrer" target=_blank>#11139</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Make queries with <code class=syntax>sum</code> aggregate function and without GROUP BY keys to run multiple times faster. <a href=https://github.com/ClickHouse/ClickHouse/pull/10992 rel="external nofollow noreferrer" target=_blank>#10992</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Improving radix sort (used in <code class=syntax>ORDER BY</code> with simple keys) by removing some redundant data moves. <a href=https://github.com/ClickHouse/ClickHouse/pull/10981 rel="external nofollow noreferrer" target=_blank>#10981</a> (<a href=https://github.com/g-arslan rel="external nofollow noreferrer" target=_blank>Arslan Gumerov</a>).</li><li>Sort bigger parts of the left table in MergeJoin. Buffer left blocks in memory. Add <code class=syntax>partial_merge_join_left_table_buffer_bytes</code> setting to manage the left blocks buffers sizes. <a href=https://github.com/ClickHouse/ClickHouse/pull/10601 rel="external nofollow noreferrer" target=_blank>#10601</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Remove duplicate ORDER BY and DISTINCT from subqueries, this optimization is enabled with <code class=syntax>optimize_duplicate_order_by_and_distinct</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/10067 rel="external nofollow noreferrer" target=_blank>#10067</a> (<a href=https://github.com/demo-99 rel="external nofollow noreferrer" target=_blank>Mikhail Malafeev</a>).</li><li>This feature eliminates functions of other keys in GROUP BY section, enabled with <code class=syntax>optimize_group_by_function_keys</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/10051 rel="external nofollow noreferrer" target=_blank>#10051</a> (<a href=https://github.com/xPoSx rel="external nofollow noreferrer" target=_blank>xPoSx</a>).</li><li>New optimization that takes arithmetic operations out of aggregate functions, enabled with <code class=syntax>optimize_arithmetic_operations_in_aggregate_functions</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/10047 rel="external nofollow noreferrer" target=_blank>#10047</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>Ruslan</a>).</li><li>Use HTTP client for S3 based on Poco instead of curl. This will improve performance and lower memory usage of s3 storage and table functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/11230 rel="external nofollow noreferrer" target=_blank>#11230</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Fix Kafka performance issue related to reschedules based on limits, which were always applied. <a href=https://github.com/ClickHouse/ClickHouse/pull/11149 rel="external nofollow noreferrer" target=_blank>#11149</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Enable percpu_arena:percpu for jemalloc (This will reduce memory fragmentation due to thread pool). <a href=https://github.com/ClickHouse/ClickHouse/pull/11084 rel="external nofollow noreferrer" target=_blank>#11084</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Optimize memory usage when reading a response from an S3 HTTP client. <a href=https://github.com/ClickHouse/ClickHouse/pull/11561 rel="external nofollow noreferrer" target=_blank>#11561</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Adjust the default Kafka settings for better performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/11388 rel="external nofollow noreferrer" target=_blank>#11388</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li></ul><h4 id=experimental-feature>Experimental Feature<a class=headerlink href=../amp/#experimental-feature title="Permanent link"> </a></h4><ul><li>Add data type <code class=syntax>Point</code> (Tuple(Float64, Float64)) and <code class=syntax>Polygon</code> (Array(Array(Tuple(Float64, Float64))). <a href=https://github.com/ClickHouse/ClickHouse/pull/10678 rel="external nofollow noreferrer" target=_blank>#10678</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li><li>Add's a <code class=syntax>hasSubstr</code> function that allows for look for subsequences in arrays. Note: this function is likely to be renamed without further notice. <a href=https://github.com/ClickHouse/ClickHouse/pull/11071 rel="external nofollow noreferrer" target=_blank>#11071</a> (<a href=https://github.com/r-zenine rel="external nofollow noreferrer" target=_blank>Ryad Zenine</a>).</li><li>Added OpenCL support and bitonic sort algorithm, which can be used for sorting integer types of data in single column. Needs to be build with flag <code class=syntax>-DENABLE_OPENCL=1</code>. For using bitonic sort algorithm instead of others you need to set <code class=syntax>bitonic_sort</code> for Setting's option <code class=syntax>special_sort</code> and make sure that OpenCL is available. This feature does not improve performance or anything else, it is only provided as an example and for demonstration purposes. It is likely to be removed in near future if there will be no further development in this direction. <a href=https://github.com/ClickHouse/ClickHouse/pull/10232 rel="external nofollow noreferrer" target=_blank>#10232</a> (<a href=https://github.com/margaritiko rel="external nofollow noreferrer" target=_blank>Ri</a>).</li></ul><h4 id=build-testing-packaging-improvement>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement title="Permanent link"> </a></h4><ul><li>Enable clang-tidy for programs and utils. <a href=https://github.com/ClickHouse/ClickHouse/pull/10991 rel="external nofollow noreferrer" target=_blank>#10991</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove dependency on <code class=syntax>tzdata</code>: do not fail if <code class=syntax>/usr/share/zoneinfo</code> directory does not exist. Note that all timezones work in ClickHouse even without tzdata installed in system. <a href=https://github.com/ClickHouse/ClickHouse/pull/11827 rel="external nofollow noreferrer" target=_blank>#11827</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added MSan and UBSan stress tests. Note that we already have MSan, UBSan for functional tests and "stress" test is another kind of tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/10871 rel="external nofollow noreferrer" target=_blank>#10871</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Print compiler build id in crash messages. It will make us slightly more certain about what binary has crashed. Added new function <code class=syntax>buildId</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11824 rel="external nofollow noreferrer" target=_blank>#11824</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added a test to ensure that mutations continue to work after FREEZE query. <a href=https://github.com/ClickHouse/ClickHouse/pull/11820 rel="external nofollow noreferrer" target=_blank>#11820</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Don't allow tests with "fail" substring in their names because it makes looking at the tests results in browser less convenient when you type Ctrl+F and search for "fail". <a href=https://github.com/ClickHouse/ClickHouse/pull/11817 rel="external nofollow noreferrer" target=_blank>#11817</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Removes unused imports from HTTPHandlerFactory. <a href=https://github.com/ClickHouse/ClickHouse/pull/11660 rel="external nofollow noreferrer" target=_blank>#11660</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li><li>Added a random sampling of instances where copier is executed. It is needed to avoid <code class=syntax>Too many simultaneous queries</code> error. Also increased timeout and decreased fault probability. <a href=https://github.com/ClickHouse/ClickHouse/pull/11573 rel="external nofollow noreferrer" target=_blank>#11573</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li><li>Fix missed include. <a href=https://github.com/ClickHouse/ClickHouse/pull/11525 rel="external nofollow noreferrer" target=_blank>#11525</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>).</li><li>Speed up build by removing old example programs. Also found some orphan functional test. <a href=https://github.com/ClickHouse/ClickHouse/pull/11486 rel="external nofollow noreferrer" target=_blank>#11486</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Increase ccache size for builds in CI. <a href=https://github.com/ClickHouse/ClickHouse/pull/11450 rel="external nofollow noreferrer" target=_blank>#11450</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Leave only unit_tests_dbms in deb build. <a href=https://github.com/ClickHouse/ClickHouse/pull/11429 rel="external nofollow noreferrer" target=_blank>#11429</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li><li>Update librdkafka to version <a href=https://github.com/edenhill/librdkafka/releases/tag/v1.4.2 rel="external nofollow noreferrer" target=_blank>1.4.2</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11256 rel="external nofollow noreferrer" target=_blank>#11256</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Refactor CMake build files. <a href=https://github.com/ClickHouse/ClickHouse/pull/11390 rel="external nofollow noreferrer" target=_blank>#11390</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li><li>Fix several flaky integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11355 rel="external nofollow noreferrer" target=_blank>#11355</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Add support for unit tests run with UBSan. <a href=https://github.com/ClickHouse/ClickHouse/pull/11345 rel="external nofollow noreferrer" target=_blank>#11345</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove redundant timeout from integration test <code class=syntax>test_insertion_sync_fails_with_timeout</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11343 rel="external nofollow noreferrer" target=_blank>#11343</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Better check for hung queries in clickhouse-test. <a href=https://github.com/ClickHouse/ClickHouse/pull/11321 rel="external nofollow noreferrer" target=_blank>#11321</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Emit a warning if server was build in debug or with sanitizers. <a href=https://github.com/ClickHouse/ClickHouse/pull/11304 rel="external nofollow noreferrer" target=_blank>#11304</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Now clickhouse-test check the server aliveness before tests run. <a href=https://github.com/ClickHouse/ClickHouse/pull/11285 rel="external nofollow noreferrer" target=_blank>#11285</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix potentially flacky test <code class=syntax>00731_long_merge_tree_select_opened_files.sh</code>. It does not fail frequently but we have discovered potential race condition in this test while experimenting with ThreadFuzzer: <a href=https://github.com/ClickHouse/ClickHouse/issues/9814 rel="external nofollow noreferrer" target=_blank>#9814</a> See <a href=https://clickhouse-test-reports.s3.yandex.net/9814/40e3023e215df22985d275bf85f4d2290897b76b/functional_stateless_tests_(unbundled).html#fail1 rel="external nofollow noreferrer" target=_blank>link</a> for the example. <a href=https://github.com/ClickHouse/ClickHouse/pull/11270 rel="external nofollow noreferrer" target=_blank>#11270</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Repeat test in CI if <code class=syntax>curl</code> invocation was timed out. It is possible due to system hangups for 10+ seconds that are typical in our CI infrastructure. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11267 rel="external nofollow noreferrer" target=_blank>#11267</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11268 rel="external nofollow noreferrer" target=_blank>#11268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add a test for Join table engine from @donmikel. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9158 rel="external nofollow noreferrer" target=_blank>#9158</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11265 rel="external nofollow noreferrer" target=_blank>#11265</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix several non significant errors in unit tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11262 rel="external nofollow noreferrer" target=_blank>#11262</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Now parts of linker command for <code class=syntax>cctz</code> library will not be shuffled with other libraries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11213 rel="external nofollow noreferrer" target=_blank>#11213</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Split /programs/server into actual program and library. <a href=https://github.com/ClickHouse/ClickHouse/pull/11186 rel="external nofollow noreferrer" target=_blank>#11186</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li><li>Improve build scripts for protobuf &amp; gRPC. <a href=https://github.com/ClickHouse/ClickHouse/pull/11172 rel="external nofollow noreferrer" target=_blank>#11172</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Enable performance test that was not working. <a href=https://github.com/ClickHouse/ClickHouse/pull/11158 rel="external nofollow noreferrer" target=_blank>#11158</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Create root S3 bucket for tests before any CH instance is started. <a href=https://github.com/ClickHouse/ClickHouse/pull/11142 rel="external nofollow noreferrer" target=_blank>#11142</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Add performance test for non-constant polygons. <a href=https://github.com/ClickHouse/ClickHouse/pull/11141 rel="external nofollow noreferrer" target=_blank>#11141</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixing <code class=syntax>00979_live_view_watch_continuous_aggregates</code> test. <a href=https://github.com/ClickHouse/ClickHouse/pull/11024 rel="external nofollow noreferrer" target=_blank>#11024</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Add ability to run zookeeper in integration tests over tmpfs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11002 rel="external nofollow noreferrer" target=_blank>#11002</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Wait for odbc-bridge with exponential backoff. Previous wait time of 200 ms was not enough in our CI environment. <a href=https://github.com/ClickHouse/ClickHouse/pull/10990 rel="external nofollow noreferrer" target=_blank>#10990</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix non-deterministic test. <a href=https://github.com/ClickHouse/ClickHouse/pull/10989 rel="external nofollow noreferrer" target=_blank>#10989</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added a test for empty external data. <a href=https://github.com/ClickHouse/ClickHouse/pull/10926 rel="external nofollow noreferrer" target=_blank>#10926</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Database is recreated for every test. This improves separation of tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/10902 rel="external nofollow noreferrer" target=_blank>#10902</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added more asserts in columns code. <a href=https://github.com/ClickHouse/ClickHouse/pull/10833 rel="external nofollow noreferrer" target=_blank>#10833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Better cooperation with sanitizers. Print information about query_id in the message of sanitizer failure. <a href=https://github.com/ClickHouse/ClickHouse/pull/10832 rel="external nofollow noreferrer" target=_blank>#10832</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix obvious race condition in "Split build smoke test" check. <a href=https://github.com/ClickHouse/ClickHouse/pull/10820 rel="external nofollow noreferrer" target=_blank>#10820</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href=https://github.com/ClickHouse/ClickHouse/issues/9968 rel="external nofollow noreferrer" target=_blank>#9968</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10801 rel="external nofollow noreferrer" target=_blank>#10801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add MSan suppression for MariaDB Client library. <a href=https://github.com/ClickHouse/ClickHouse/pull/10800 rel="external nofollow noreferrer" target=_blank>#10800</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>GRPC make couldn't find protobuf files, changed make file by adding the right link. <a href=https://github.com/ClickHouse/ClickHouse/pull/10794 rel="external nofollow noreferrer" target=_blank>#10794</a> (<a href=https://github.com/mnkonkova rel="external nofollow noreferrer" target=_blank>mnkonkova</a>).</li><li>Enable extra warnings (<code class=syntax>-Weverything</code>) for base, utils, programs. Note that we already have it for the most of the code. <a href=https://github.com/ClickHouse/ClickHouse/pull/10779 rel="external nofollow noreferrer" target=_blank>#10779</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Suppressions of warnings from libraries was mistakenly declared as public in <a href=https://github.com/ClickHouse/ClickHouse/issues/10396 rel="external nofollow noreferrer" target=_blank>#10396</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10776 rel="external nofollow noreferrer" target=_blank>#10776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Restore a patch that was accidentially deleted in <a href=https://github.com/ClickHouse/ClickHouse/issues/10396 rel="external nofollow noreferrer" target=_blank>#10396</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10774 rel="external nofollow noreferrer" target=_blank>#10774</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix performance tests errors, part 2. <a href=https://github.com/ClickHouse/ClickHouse/pull/10773 rel="external nofollow noreferrer" target=_blank>#10773</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix performance test errors. <a href=https://github.com/ClickHouse/ClickHouse/pull/10766 rel="external nofollow noreferrer" target=_blank>#10766</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Update cross-builds to use clang-10 compiler. <a href=https://github.com/ClickHouse/ClickHouse/pull/10724 rel="external nofollow noreferrer" target=_blank>#10724</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li><li>Update instruction to install RPM packages. This was suggested by Denis (TG login @ldviolet) and implemented by Arkady Shejn. <a href=https://github.com/ClickHouse/ClickHouse/pull/10707 rel="external nofollow noreferrer" target=_blank>#10707</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Trying to fix <code class=syntax>tests/queries/0_stateless/01246_insert_into_watch_live_view.py</code> test. <a href=https://github.com/ClickHouse/ClickHouse/pull/10670 rel="external nofollow noreferrer" target=_blank>#10670</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Fixing and re-enabling 00979_live_view_watch_continuous_aggregates.py test. <a href=https://github.com/ClickHouse/ClickHouse/pull/10658 rel="external nofollow noreferrer" target=_blank>#10658</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Fix OOM in ASan stress test. <a href=https://github.com/ClickHouse/ClickHouse/pull/10646 rel="external nofollow noreferrer" target=_blank>#10646</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix UBSan report (adding zero to nullptr) in HashTable that appeared after migration to clang-10. <a href=https://github.com/ClickHouse/ClickHouse/pull/10638 rel="external nofollow noreferrer" target=_blank>#10638</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove external call to <code class=syntax>ld</code> (bfd) linker during tzdata processing in compile time. <a href=https://github.com/ClickHouse/ClickHouse/pull/10634 rel="external nofollow noreferrer" target=_blank>#10634</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Allow to use <code class=syntax>lld</code> to link blobs (resources). <a href=https://github.com/ClickHouse/ClickHouse/pull/10632 rel="external nofollow noreferrer" target=_blank>#10632</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix UBSan report in <code class=syntax>LZ4</code> library. <a href=https://github.com/ClickHouse/ClickHouse/pull/10631 rel="external nofollow noreferrer" target=_blank>#10631</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>). See also <a href=https://github.com/lz4/lz4/issues/857 rel="external nofollow noreferrer" target=_blank>https://github.com/lz4/lz4/issues/857</a></li><li>Update LZ4 to the latest dev branch. <a href=https://github.com/ClickHouse/ClickHouse/pull/10630 rel="external nofollow noreferrer" target=_blank>#10630</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added auto-generated machine-readable file with the list of stable versions. <a href=https://github.com/ClickHouse/ClickHouse/pull/10628 rel="external nofollow noreferrer" target=_blank>#10628</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix <code class=syntax>capnproto</code> version check for <code class=syntax>capnp::UnalignedFlatArrayMessageReader</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10618 rel="external nofollow noreferrer" target=_blank>#10618</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>).</li><li>Lower memory usage in tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/10617 rel="external nofollow noreferrer" target=_blank>#10617</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixing hard coded timeouts in new live view tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/10604 rel="external nofollow noreferrer" target=_blank>#10604</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Increasing timeout when opening a client in tests/queries/0_stateless/helpers/client.py. <a href=https://github.com/ClickHouse/ClickHouse/pull/10599 rel="external nofollow noreferrer" target=_blank>#10599</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li><li>Enable ThinLTO for clang builds, continuation of <a href=https://github.com/ClickHouse/ClickHouse/pull/10435 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/10435</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10585 rel="external nofollow noreferrer" target=_blank>#10585</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Adding fuzzers and preparing for oss-fuzz integration. <a href=https://github.com/ClickHouse/ClickHouse/pull/10546 rel="external nofollow noreferrer" target=_blank>#10546</a> (<a href=https://github.com/kyprizel rel="external nofollow noreferrer" target=_blank>kyprizel</a>).</li><li>Fix FreeBSD build. <a href=https://github.com/ClickHouse/ClickHouse/pull/10150 rel="external nofollow noreferrer" target=_blank>#10150</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li><li>Add new build for query tests using pytest framework. <a href=https://github.com/ClickHouse/ClickHouse/pull/10039 rel="external nofollow noreferrer" target=_blank>#10039</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li></ul><h2 id=clickhouse-release-v20-4>ClickHouse release v20.4<a class=headerlink href=../amp/#clickhouse-release-v20-4 title="Permanent link"> </a></h2><h3 id=clickhouse-release-v20-4-6-53-stable-2020-06-25>ClickHouse release v20.4.6.53-stable 2020-06-25<a class=headerlink href=../amp/#clickhouse-release-v20-4-6-53-stable-2020-06-25 title="Permanent link"> </a></h3><h4 id=bug-fix_1>Bug Fix<a class=headerlink href=../amp/#bug-fix_1 title="Permanent link"> </a></h4><ul><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix wrong result of comparison of FixedString with constant String. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11393 rel="external nofollow noreferrer" target=_blank>#11393</a>. This bug appeared in version 20.4. <a href=https://github.com/ClickHouse/ClickHouse/pull/11828 rel="external nofollow noreferrer" target=_blank>#11828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix wrong result for <code class=syntax>if()</code> with NULLs in condition. <a href=https://github.com/ClickHouse/ClickHouse/pull/11807 rel="external nofollow noreferrer" target=_blank>#11807</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix using too many threads for queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11788 rel="external nofollow noreferrer" target=_blank>#11788</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix unexpected behaviour of queries like <code class=syntax>SELECT *, xyz.*</code> which were success while an error expected. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li><li>Now replicated fetches will be cancelled during metadata alter. <a href=https://github.com/ClickHouse/ClickHouse/pull/11744 rel="external nofollow noreferrer" target=_blank>#11744</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix <code class=syntax>ORDER BY ... WITH FILL</code> over const columns. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix <code class=syntax>LIMIT n WITH TIES</code> usage together with <code class=syntax>ORDER BY</code> statement, which contains aliases. <a href=https://github.com/ClickHouse/ClickHouse/pull/11689 rel="external nofollow noreferrer" target=_blank>#11689</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix error which leads to an incorrect state of <code class=syntax>system.mutations</code>. It may show that whole mutation is already done but the server still has <code class=syntax>MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11611 rel="external nofollow noreferrer" target=_blank>#11611</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11681 rel="external nofollow noreferrer" target=_blank>#11681</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11352 rel="external nofollow noreferrer" target=_blank>#11352</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11644 rel="external nofollow noreferrer" target=_blank>#11644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. (Probably it is connected with <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a> somehow). <a href=https://github.com/ClickHouse/ClickHouse/pull/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix error <code class=syntax>Block structure mismatch</code> for queries with sampling reading from <code class=syntax>Buffer</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11602 rel="external nofollow noreferrer" target=_blank>#11602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix error <code class=syntax>Size of offsets doesn't match size of column</code> for queries with <code class=syntax>PREWHERE column in (subquery)</code> and <code class=syntax>ARRAY JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed rare segfault in <code class=syntax>SHOW CREATE TABLE</code> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11490 rel="external nofollow noreferrer" target=_blank>#11490</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11579 rel="external nofollow noreferrer" target=_blank>#11579</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>All queries in HTTP session have had the same query_id. It is fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/11578 rel="external nofollow noreferrer" target=_blank>#11578</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li><li>Fix shard_num/replica_num for <code class=syntax>&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href=https://github.com/ClickHouse/ClickHouse/pull/11528 rel="external nofollow noreferrer" target=_blank>#11528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix race condition which may lead to an exception during table drop. It's a bit tricky and not dangerous at all. If you want an explanation, just notice me in telegram. <a href=https://github.com/ClickHouse/ClickHouse/pull/11523 rel="external nofollow noreferrer" target=_blank>#11523</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Get rid of old libunwind patches. <a href=https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012 target=_blank>https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> This allows to disable <code class=syntax>-fno-omit-frame-pointer</code> in <code class=syntax>clang</code> builds that improves performance at least by 1% in average. <a href=https://github.com/ClickHouse/ClickHouse/pull/10761 rel="external nofollow noreferrer" target=_blank>#10761</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix usage of primary key wrapped into a function with 'FINAL' modifier and 'ORDER BY' optimization. <a href=https://github.com/ClickHouse/ClickHouse/pull/10715 rel="external nofollow noreferrer" target=_blank>#10715</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li></ul><h4 id=build-testing-packaging-improvement_1>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_1 title="Permanent link"> </a></h4><ul><li>Fix several non significant errors in unit tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11262 rel="external nofollow noreferrer" target=_blank>#11262</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href=https://github.com/ClickHouse/ClickHouse/issues/9968 rel="external nofollow noreferrer" target=_blank>#9968</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10801 rel="external nofollow noreferrer" target=_blank>#10801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li></ul><h3 id=clickhouse-release-v20-4-5-36-stable-2020-06-10>ClickHouse release v20.4.5.36-stable 2020-06-10<a class=headerlink href=../amp/#clickhouse-release-v20-4-5-36-stable-2020-06-10 title="Permanent link"> </a></h3><h4 id=bug-fix_2>Bug Fix<a class=headerlink href=../amp/#bug-fix_2 title="Permanent link"> </a></h4><ul><li>Fix the error <code class=syntax>Data compressed with different methods</code> that can happen if <code class=syntax>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix return compressed size for codecs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix pointInPolygon with nan as point. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11375 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li><li>Fix potential uninitialized memory read in MergeTree shutdown if table was not created successfully. <a href=https://github.com/ClickHouse/ClickHouse/pull/11420 rel="external nofollow noreferrer" target=_blank>#11420</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fix possible <code class=syntax>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href=https://github.com/ClickHouse/ClickHouse/pull/11354 rel="external nofollow noreferrer" target=_blank>#11354</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix support for <code class=syntax>\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9933 rel="external nofollow noreferrer" target=_blank>#9933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11350 rel="external nofollow noreferrer" target=_blank>#11350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential segfault when using <code class=syntax>Lazy</code> database. <a href=https://github.com/ClickHouse/ClickHouse/pull/11348 rel="external nofollow noreferrer" target=_blank>#11348</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash in <code class=syntax>quantilesExactWeightedArray</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Now merges stopped before change metadata in <code class=syntax>ALTER</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11335 rel="external nofollow noreferrer" target=_blank>#11335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Make writing to <code class=syntax>MATERIALIZED VIEW</code> with setting <code class=syntax>parallel_view_processing = 1</code> parallel again. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix insignificant data race in clickhouse-copier. Found by integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11313 rel="external nofollow noreferrer" target=_blank>#11313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class=syntax>empty</code> or <code class=syntax>notEmpty</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code class=syntax>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class=syntax>max_network_bandwidth</code>, <code class=syntax>max_execution_speed</code> or <code class=syntax>priority</code> settings. Change the default value of <code class=syntax>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class=syntax>min_execution_speed</code> and <code class=syntax>max_execution_speed</code> have no effect. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class=syntax>clickhouse-client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash when SET DEFAULT ROLE is called with wrong arguments. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10586 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/10586</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11278 rel="external nofollow noreferrer" target=_blank>#11278</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix crash while reading malformed data in Protobuf format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fixed a bug when cache-dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href=https://github.com/ClickHouse/ClickHouse/pull/11233 rel="external nofollow noreferrer" target=_blank>#11233</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li><li>Fix error <code class=syntax>Block structure mismatch in QueryPipeline</code> while reading from <code class=syntax>VIEW</code> with constants in inner query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11181 rel="external nofollow noreferrer" target=_blank>#11181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11205 rel="external nofollow noreferrer" target=_blank>#11205</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix possible exception <code class=syntax>Invalid status for associated output</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11200 rel="external nofollow noreferrer" target=_blank>#11200</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix possible error <code class=syntax>Cannot capture column</code> for higher-order functions with <code class=syntax>Array(Array(LowCardinality))</code> captured argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed S3 globbing which could fail in case of more than 1000 keys and some backends. <a href=https://github.com/ClickHouse/ClickHouse/pull/11179 rel="external nofollow noreferrer" target=_blank>#11179</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix Kafka performance issue related to reschedules based on limits, which were always applied. <a href=https://github.com/ClickHouse/ClickHouse/pull/11149 rel="external nofollow noreferrer" target=_blank>#11149</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href=https://github.com/ClickHouse/ClickHouse/pull/11145 rel="external nofollow noreferrer" target=_blank>#11145</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href=https://github.com/ClickHouse/ClickHouse/pull/11114 rel="external nofollow noreferrer" target=_blank>#11114</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix predicates optimization for distributed queries (<code class=syntax>enable_optimize_predicate_expression=1</code>) for queries with <code class=syntax>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li></ul><h4 id=build-testing-packaging-improvement_2>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_2 title="Permanent link"> </a></h4><ul><li>Fix several flaky integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11355 rel="external nofollow noreferrer" target=_blank>#11355</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li></ul><h3 id=clickhouse-release-v20-4-4-18-stable-2020-05-26>ClickHouse release v20.4.4.18-stable 2020-05-26<a class=headerlink href=../amp/#clickhouse-release-v20-4-4-18-stable-2020-05-26 title="Permanent link"> </a></h3><p>No changes compared to v20.4.3.16-stable.</p><h3 id=clickhouse-release-v20-4-3-16-stable-2020-05-23>ClickHouse release v20.4.3.16-stable 2020-05-23<a class=headerlink href=../amp/#clickhouse-release-v20-4-3-16-stable-2020-05-23 title="Permanent link"> </a></h3><h4 id=bug-fix_3>Bug Fix<a class=headerlink href=../amp/#bug-fix_3 title="Permanent link"> </a></h4><ul><li>Removed logging from mutation finalization task if nothing was finalized. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed memory leak in registerDiskS3. <a href=https://github.com/ClickHouse/ClickHouse/pull/11074 rel="external nofollow noreferrer" target=_blank>#11074</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li><li>Fixed the potential missed data during termination of Kafka engine table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11048 rel="external nofollow noreferrer" target=_blank>#11048</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fixed <code class=syntax>parseDateTime64BestEffort</code> argument resolution bugs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fixed very rare potential use-after-free error in <code class=syntax>MergeTree</code> if table was not created successfully. <a href=https://github.com/ClickHouse/ClickHouse/pull/10986 rel="external nofollow noreferrer" target=_blank>#10986</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/10970 rel="external nofollow noreferrer" target=_blank>#10970</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed metadata (relative path for rename) and data (relative path for symlink) handling for Atomic database. <a href=https://github.com/ClickHouse/ClickHouse/pull/10980 rel="external nofollow noreferrer" target=_blank>#10980</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed server crash on concurrent <code class=syntax>ALTER</code> and <code class=syntax>DROP DATABASE</code> queries with <code class=syntax>Atomic</code> database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10968 rel="external nofollow noreferrer" target=_blank>#10968</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed incorrect raw data size in <code class=syntax>getRawData()</code> method. <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li><li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed sending partially written files by the <code class=syntax>DistributedBlockOutputStream</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10940 rel="external nofollow noreferrer" target=_blank>#10940</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed crash in <code class=syntax>SELECT count(notNullIn(NULL, []))</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10920 rel="external nofollow noreferrer" target=_blank>#10920</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed the hang which was happening sometimes during <code class=syntax>DROP</code> of <code class=syntax>Kafka</code> table engine. (or during server restarts). <a href=https://github.com/ClickHouse/ClickHouse/pull/10910 rel="external nofollow noreferrer" target=_blank>#10910</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fixed the impossibility of executing multiple <code class=syntax>ALTER RENAME</code> like <code class=syntax>a TO b, c TO a</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10895 rel="external nofollow noreferrer" target=_blank>#10895</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed possible race which could happen when you get result from aggregate function state from multiple thread for the same column. The only way it can happen is when you use <code class=syntax>finalizeAggregation</code> function while reading from table with <code class=syntax>Memory</code> engine which stores <code class=syntax>AggregateFunction</code> state for <code class=syntax>quantile*</code> function. <a href=https://github.com/ClickHouse/ClickHouse/pull/10890 rel="external nofollow noreferrer" target=_blank>#10890</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed backward compatibility with tuples in Distributed tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fixed <code class=syntax>SIGSEGV</code> in <code class=syntax>StringHashTable</code> if such a key does not exist. <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed <code class=syntax>WATCH</code> hangs after <code class=syntax>LiveView</code> table was dropped from database with <code class=syntax>Atomic</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10859 rel="external nofollow noreferrer" target=_blank>#10859</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed bug in <code class=syntax>ReplicatedMergeTree</code> which might cause some <code class=syntax>ALTER</code> on <code class=syntax>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Now constraints are updated if the column participating in <code class=syntax>CONSTRAINT</code> expression was renamed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10844 rel="external nofollow noreferrer" target=_blank>#10844</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10847 rel="external nofollow noreferrer" target=_blank>#10847</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed potential read of uninitialized memory in cache-dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/10834 rel="external nofollow noreferrer" target=_blank>#10834</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed columns order after <code class=syntax>Block::sortColumns()</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed the issue with <code class=syntax>ODBC</code> bridge when no quoting of identifiers is requested. Fixes [#7984] (<a href=https://github.com/ClickHouse/ClickHouse/issues/7984 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/7984</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed <code class=syntax>UBSan</code> and <code class=syntax>MSan</code> report in <code class=syntax>DateLUT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed incorrect type conversion in key conditions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li><li>Fixed <code class=syntax>parallel_view_processing</code> behavior. Now all insertions into <code class=syntax>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed combinator <code class=syntax>-OrNull</code> and <code class=syntax>-OrDefault</code> when combined with <code class=syntax>-State</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Fixed possible buffer overflow in function <code class=syntax>h3EdgeAngle</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10711 rel="external nofollow noreferrer" target=_blank>#10711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed bug which locks concurrent alters when table has a lot of parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/10659 rel="external nofollow noreferrer" target=_blank>#10659</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed <code class=syntax>nullptr</code> dereference in <code class=syntax>StorageBuffer</code> if server was shutdown before table startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/10641 rel="external nofollow noreferrer" target=_blank>#10641</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed <code class=syntax>optimize_skip_unused_shards</code> with <code class=syntax>LowCardinality</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10611 rel="external nofollow noreferrer" target=_blank>#10611</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed handling condition variable for synchronous mutations. In some cases signals to that condition variable could be lost. <a href=https://github.com/ClickHouse/ClickHouse/pull/10588 rel="external nofollow noreferrer" target=_blank>#10588</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>Fixed possible crash when <code class=syntax>createDictionary()</code> is called before <code class=syntax>loadStoredObject()</code> has finished. <a href=https://github.com/ClickHouse/ClickHouse/pull/10587 rel="external nofollow noreferrer" target=_blank>#10587</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fixed <code class=syntax>SELECT</code> of column <code class=syntax>ALIAS</code> which default expression type different from column type. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Implemented comparison between DateTime64 and String values. <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Disable <code class=syntax>GROUP BY</code> sharding_key optimization by default (<code class=syntax>optimize_distributed_group_by_sharding_key</code> had been introduced and turned of by default, due to trickery of sharding_key analyzing, simple example is <code class=syntax>if</code> in sharding key) and fix it for <code class=syntax>WITH ROLLUP/CUBE/TOTALS</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10516 rel="external nofollow noreferrer" target=_blank>#10516</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed <a href=https://github.com/ClickHouse/ClickHouse/issues/10263 rel="external nofollow noreferrer" target=_blank>#10263</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10486 rel="external nofollow noreferrer" target=_blank>#10486</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Added tests about <code class=syntax>max_rows_to_sort</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10268 rel="external nofollow noreferrer" target=_blank>#10268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added backward compatibility for create bloom filter index. <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li></ul><h3 id=clickhouse-release-v20-4-2-9-2020-05-12>ClickHouse release v20.4.2.9, 2020-05-12<a class=headerlink href=../amp/#clickhouse-release-v20-4-2-9-2020-05-12 title="Permanent link"> </a></h3><h4 id=backward-incompatible-change_1>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change_1 title="Permanent link"> </a></h4><ul><li>System tables (e.g. system.query_log, system.trace_log, system.metric_log) are using compact data part format for parts smaller than 10 MiB in size. Compact data part format is supported since version 20.3. If you are going to downgrade to version less than 20.3, you should manually delete table data for system logs in <code class=syntax>/var/lib/clickhouse/data/system/</code>.</li><li>When string comparison involves FixedString and compared arguments are of different sizes, do comparison as if smaller string is padded to the length of the larger. This is intented for SQL compatibility if we imagine that FixedString data type corresponds to SQL CHAR. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9272 rel="external nofollow noreferrer" target=_blank>#9272</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10363 rel="external nofollow noreferrer" target=_blank>#10363</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Make SHOW CREATE TABLE multiline. Now it is more readable and more like MySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/10049 rel="external nofollow noreferrer" target=_blank>#10049</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Added a setting <code class=syntax>validate_polygons</code> that is used in <code class=syntax>pointInPolygon</code> function and enabled by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/9857 rel="external nofollow noreferrer" target=_blank>#9857</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h4 id=new-feature_1>New Feature<a class=headerlink href=../amp/#new-feature_1 title="Permanent link"> </a></h4><ul><li>Add support for secured connection from ClickHouse to Zookeeper <a href=https://github.com/ClickHouse/ClickHouse/pull/10184 rel="external nofollow noreferrer" target=_blank>#10184</a> (<a href=https://github.com/xzkostyan rel="external nofollow noreferrer" target=_blank>Konstantin Lebedev</a>)</li><li>Support custom HTTP handlers. See ISSUES-5436 for description. <a href=https://github.com/ClickHouse/ClickHouse/pull/7572 rel="external nofollow noreferrer" target=_blank>#7572</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Add MessagePack Input/Output format. <a href=https://github.com/ClickHouse/ClickHouse/pull/9889 rel="external nofollow noreferrer" target=_blank>#9889</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li><li>Add Regexp input format. <a href=https://github.com/ClickHouse/ClickHouse/pull/9196 rel="external nofollow noreferrer" target=_blank>#9196</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li><li>Added output format <code class=syntax>Markdown</code> for embedding tables in markdown documents. <a href=https://github.com/ClickHouse/ClickHouse/pull/10317 rel="external nofollow noreferrer" target=_blank>#10317</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li><li>Added support for custom settings section in dictionaries. Also fixes issue <a href=https://github.com/ClickHouse/ClickHouse/issues/2829 rel="external nofollow noreferrer" target=_blank>#2829</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10137 rel="external nofollow noreferrer" target=_blank>#10137</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>)</li><li>Added custom settings support in DDL-queries for CREATE DICTIONARY <a href=https://github.com/ClickHouse/ClickHouse/pull/10465 rel="external nofollow noreferrer" target=_blank>#10465</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>)</li><li>Add simple server-wide memory profiler that will collect allocation contexts when server memory usage becomes higher than the next allocation threshold. <a href=https://github.com/ClickHouse/ClickHouse/pull/10444 rel="external nofollow noreferrer" target=_blank>#10444</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add setting <code class=syntax>always_fetch_merged_part</code> which restrict replica to merge parts by itself and always prefer dowloading from other replicas. <a href=https://github.com/ClickHouse/ClickHouse/pull/10379 rel="external nofollow noreferrer" target=_blank>#10379</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Add function JSONExtractKeysAndValuesRaw which extracts raw data from JSON objects <a href=https://github.com/ClickHouse/ClickHouse/pull/10378 rel="external nofollow noreferrer" target=_blank>#10378</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Add memory usage from OS to <code class=syntax>system.asynchronous_metrics</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10361 rel="external nofollow noreferrer" target=_blank>#10361</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added generic variants for functions <code class=syntax>least</code> and <code class=syntax>greatest</code>. Now they work with arbitrary number of arguments of arbitrary types. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4767 rel="external nofollow noreferrer" target=_blank>#4767</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10318 rel="external nofollow noreferrer" target=_blank>#10318</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Now ClickHouse controls timeouts of dictionary sources on its side. Two new settings added to cache dictionary configuration: <code class=syntax>strict_max_lifetime_seconds</code>, which is <code class=syntax>max_lifetime</code> by default, and <code class=syntax>query_wait_timeout_milliseconds</code>, which is one minute by default. The first settings is also useful with <code class=syntax>allow_read_expired_keys</code> settings (to forbid reading very expired keys). <a href=https://github.com/ClickHouse/ClickHouse/pull/10337 rel="external nofollow noreferrer" target=_blank>#10337</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Add log_queries_min_type to filter which entries will be written to query_log <a href=https://github.com/ClickHouse/ClickHouse/pull/10053 rel="external nofollow noreferrer" target=_blank>#10053</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Added function <code class=syntax>isConstant</code>. This function checks whether its argument is constant expression and returns 1 or 0. It is intended for development, debugging and demonstration purposes. <a href=https://github.com/ClickHouse/ClickHouse/pull/10198 rel="external nofollow noreferrer" target=_blank>#10198</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>add joinGetOrNull to return NULL when key is missing instead of returning the default value. <a href=https://github.com/ClickHouse/ClickHouse/pull/10094 rel="external nofollow noreferrer" target=_blank>#10094</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Consider <code class=syntax>NULL</code> to be equal to <code class=syntax>NULL</code> in <code class=syntax>IN</code> operator, if the option <code class=syntax>transform_null_in</code> is set. <a href=https://github.com/ClickHouse/ClickHouse/pull/10085 rel="external nofollow noreferrer" target=_blank>#10085</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li><li>Add <code class=syntax>ALTER TABLE ... RENAME COLUMN</code> for MergeTree table engines family. <a href=https://github.com/ClickHouse/ClickHouse/pull/9948 rel="external nofollow noreferrer" target=_blank>#9948</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Support parallel distributed INSERT SELECT. <a href=https://github.com/ClickHouse/ClickHouse/pull/9759 rel="external nofollow noreferrer" target=_blank>#9759</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li><li>Add ability to query Distributed over Distributed (w/o <code class=syntax>distributed_group_by_no_merge</code>) ... <a href=https://github.com/ClickHouse/ClickHouse/pull/9923 rel="external nofollow noreferrer" target=_blank>#9923</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Add function <code class=syntax>arrayReduceInRanges</code> which aggregates array elements in given ranges. <a href=https://github.com/ClickHouse/ClickHouse/pull/9598 rel="external nofollow noreferrer" target=_blank>#9598</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Add Dictionary Status on prometheus exporter. <a href=https://github.com/ClickHouse/ClickHouse/pull/9622 rel="external nofollow noreferrer" target=_blank>#9622</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>Add function arrayAUC <a href=https://github.com/ClickHouse/ClickHouse/pull/8698 rel="external nofollow noreferrer" target=_blank>#8698</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>)</li><li>Support <code class=syntax>DROP VIEW</code> statement for better TPC-H compatibility. <a href=https://github.com/ClickHouse/ClickHouse/pull/9831 rel="external nofollow noreferrer" target=_blank>#9831</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Add 'strict_order' option to windowFunnel() <a href=https://github.com/ClickHouse/ClickHouse/pull/9773 rel="external nofollow noreferrer" target=_blank>#9773</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li><li>Support <code class=syntax>DATE</code> and <code class=syntax>TIMESTAMP</code> SQL operators, e.g. <code class=syntax>SELECT date '2001-01-01'</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9691 rel="external nofollow noreferrer" target=_blank>#9691</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li></ul><h4 id=experimental-feature_1>Experimental Feature<a class=headerlink href=../amp/#experimental-feature_1 title="Permanent link"> </a></h4><ul><li>Added experimental database engine Atomic. It supports non-blocking <code class=syntax>DROP</code> and <code class=syntax>RENAME TABLE</code> queries and atomic <code class=syntax>EXCHANGE TABLES t1 AND t2</code> query <a href=https://github.com/ClickHouse/ClickHouse/pull/7512 rel="external nofollow noreferrer" target=_blank>#7512</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Initial support for ReplicatedMergeTree over S3 (it works in suboptimal way) <a href=https://github.com/ClickHouse/ClickHouse/pull/10126 rel="external nofollow noreferrer" target=_blank>#10126</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li></ul><h4 id=bug-fix_4>Bug Fix<a class=headerlink href=../amp/#bug-fix_4 title="Permanent link"> </a></h4><ul><li>Fixed incorrect scalar results inside inner query of <code class=syntax>MATERIALIZED VIEW</code> in case if this query contained dependent table <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed bug, which caused HTTP requests to get stuck on client closing connection when <code class=syntax>readonly=2</code> and <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix segfault in StorageBuffer when exception is thrown on server startup. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10550 rel="external nofollow noreferrer" target=_blank>#10550</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10609 rel="external nofollow noreferrer" target=_blank>#10609</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>The query<code class=syntax>SYSTEM DROP DNS CACHE</code> now also drops caches used to check if user is allowed to connect from some IP addresses <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix usage of multiple <code class=syntax>IN</code> operators with an identical set in one query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10539 rel="external nofollow noreferrer" target=_blank>#10539</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix crash in <code class=syntax>generateRandom</code> with nested types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10583 rel="external nofollow noreferrer" target=_blank>#10583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10734 rel="external nofollow noreferrer" target=_blank>#10734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix data corruption for <code class=syntax>LowCardinality(FixedString)</code> key column in <code class=syntax>SummingMergeTree</code> which could have happened after merge. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix logic for aggregation_memory_efficient_merge_threads setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>)</li><li>Fix disappearing totals. Totals could have being filtered if query had <code class=syntax>JOIN</code> or subquery with external <code class=syntax>WHERE</code> condition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix the lack of parallel execution of remote queries with <code class=syntax>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix possible incorrect number of rows for queries with <code class=syntax>LIMIT</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10566 rel="external nofollow noreferrer" target=_blank>#10566</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10709 rel="external nofollow noreferrer" target=_blank>#10709</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10660 rel="external nofollow noreferrer" target=_blank>#10660</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix index corruption, which may occur in some cases after merging compact parts into another compact part. <a href=https://github.com/ClickHouse/ClickHouse/pull/10531 rel="external nofollow noreferrer" target=_blank>#10531</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix the situation, when mutation finished all parts, but hung up in <code class=syntax>is_done=0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10526 rel="external nofollow noreferrer" target=_blank>#10526</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix overflow at beginning of unix epoch for timezones with fractional offset from UTC. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9335 rel="external nofollow noreferrer" target=_blank>#9335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10513 rel="external nofollow noreferrer" target=_blank>#10513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Better diagnostics for input formats. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10204 rel="external nofollow noreferrer" target=_blank>#10204</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10418 rel="external nofollow noreferrer" target=_blank>#10418</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix numeric overflow in <code class=syntax>simpleLinearRegression()</code> over large integers <a href=https://github.com/ClickHouse/ClickHouse/pull/10474 rel="external nofollow noreferrer" target=_blank>#10474</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Fix use-after-free in Distributed shutdown, avoid waiting for sending all batches <a href=https://github.com/ClickHouse/ClickHouse/pull/10491 rel="external nofollow noreferrer" target=_blank>#10491</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Add CA certificates to clickhouse-server docker image <a href=https://github.com/ClickHouse/ClickHouse/pull/10476 rel="external nofollow noreferrer" target=_blank>#10476</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fix a rare endless loop that might have occurred when using the <code class=syntax>addressToLine</code> function or AggregateFunctionState columns. <a href=https://github.com/ClickHouse/ClickHouse/pull/10466 rel="external nofollow noreferrer" target=_blank>#10466</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Handle zookeeper "no node error" during distributed query <a href=https://github.com/ClickHouse/ClickHouse/pull/10050 rel="external nofollow noreferrer" target=_blank>#10050</a> (<a href=https://github.com/Phantomape rel="external nofollow noreferrer" target=_blank>Daniel Chen</a>)</li><li>Fix bug when server cannot attach table after column's default was altered. <a href=https://github.com/ClickHouse/ClickHouse/pull/10441 rel="external nofollow noreferrer" target=_blank>#10441</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Implicitly cast the default expression type to the column type for the ALIAS columns <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Don't remove metadata directory if <code class=syntax>ATTACH DATABASE</code> fails <a href=https://github.com/ClickHouse/ClickHouse/pull/10442 rel="external nofollow noreferrer" target=_blank>#10442</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Avoid dependency on system tzdata. Fixes loading of <code class=syntax>Africa/Casablanca</code> timezone on CentOS 8. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10211 rel="external nofollow noreferrer" target=_blank>#10211</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10425 rel="external nofollow noreferrer" target=_blank>#10425</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix some issues if data is inserted with quorum and then gets deleted (DROP PARTITION, TTL, etc.). It led to stuck of INSERTs or false-positive exceptions in SELECTs. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9946 rel="external nofollow noreferrer" target=_blank>#9946</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10188 rel="external nofollow noreferrer" target=_blank>#10188</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Check the number and type of arguments when creating BloomFilter index <a href=https://github.com/ClickHouse/ClickHouse/issues/9623 rel="external nofollow noreferrer" target=_blank>#9623</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10431 rel="external nofollow noreferrer" target=_blank>#10431</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Prefer <code class=syntax>fallback_to_stale_replicas</code> over <code class=syntax>skip_unavailable_shards</code>, otherwise when both settings specified and there are no up-to-date replicas the query will fail (patch from @alex-zaitsev ) <a href=https://github.com/ClickHouse/ClickHouse/pull/10422 rel="external nofollow noreferrer" target=_blank>#10422</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix the issue when a query with ARRAY JOIN, ORDER BY and LIMIT may return incomplete result. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10226 rel="external nofollow noreferrer" target=_blank>#10226</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10427 rel="external nofollow noreferrer" target=_blank>#10427</a> (<a href=https://github.com/VadimPlh rel="external nofollow noreferrer" target=_blank>Vadim Plakhtinskiy</a>)</li><li>Add database name to dictionary name after DETACH/ATTACH. Fixes system.dictionaries table and <code class=syntax>SYSTEM RELOAD</code> query <a href=https://github.com/ClickHouse/ClickHouse/pull/10415 rel="external nofollow noreferrer" target=_blank>#10415</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix possible incorrect result for extremes in processors pipeline. <a href=https://github.com/ClickHouse/ClickHouse/pull/10131 rel="external nofollow noreferrer" target=_blank>#10131</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix possible segfault when the setting <code class=syntax>distributed_group_by_no_merge</code> is enabled (introduced in 20.3.7.46 by <a href=https://github.com/ClickHouse/ClickHouse/issues/10131 rel="external nofollow noreferrer" target=_blank>#10131</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10399 rel="external nofollow noreferrer" target=_blank>#10399</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix wrong flattening of <code class=syntax>Array(Tuple(...))</code> data types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10259 rel="external nofollow noreferrer" target=_blank>#10259</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10390 rel="external nofollow noreferrer" target=_blank>#10390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN <a href=https://github.com/ClickHouse/ClickHouse/pull/9950 rel="external nofollow noreferrer" target=_blank>#9950</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Fix order of columns after Block::sortColumns() <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix possible <code class=syntax>Pipeline stuck</code> error in <code class=syntax>ConcatProcessor</code> which may happen in remote query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10381 rel="external nofollow noreferrer" target=_blank>#10381</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Don't make disk reservations for aggregations. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9241 rel="external nofollow noreferrer" target=_blank>#9241</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10375 rel="external nofollow noreferrer" target=_blank>#10375</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix wrong behaviour of datetime functions for timezones that has altered between positive and negative offsets from UTC (e.g. Pacific/Kiritimati). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7202 rel="external nofollow noreferrer" target=_blank>#7202</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10369 rel="external nofollow noreferrer" target=_blank>#10369</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Avoid infinite loop in <code class=syntax>dictIsIn</code> function. Fixes #515 <a href=https://github.com/ClickHouse/ClickHouse/pull/10365 rel="external nofollow noreferrer" target=_blank>#10365</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Disable GROUP BY sharding_key optimization by default and fix it for WITH ROLLUP/CUBE/TOTALS <a href=https://github.com/ClickHouse/ClickHouse/pull/10516 rel="external nofollow noreferrer" target=_blank>#10516</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Check for error code when checking parts and don't mark part as broken if the error is like "not enough memory". Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6269 rel="external nofollow noreferrer" target=_blank>#6269</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10364 rel="external nofollow noreferrer" target=_blank>#10364</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Show information about not loaded dictionaries in system tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10234 rel="external nofollow noreferrer" target=_blank>#10234</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fix nullptr dereference in StorageBuffer if server was shutdown before table startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/10641 rel="external nofollow noreferrer" target=_blank>#10641</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed <code class=syntax>DROP</code> vs <code class=syntax>OPTIMIZE</code> race in <code class=syntax>ReplicatedMergeTree</code>. <code class=syntax>DROP</code> could left some garbage in replica path in ZooKeeper if there was concurrent <code class=syntax>OPTIMIZE</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10312 rel="external nofollow noreferrer" target=_blank>#10312</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix 'Logical error: CROSS JOIN has expressions' error for queries with comma and names joins mix. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9910 rel="external nofollow noreferrer" target=_blank>#9910</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10311 rel="external nofollow noreferrer" target=_blank>#10311</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix queries with <code class=syntax>max_bytes_before_external_group_by</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10302 rel="external nofollow noreferrer" target=_blank>#10302</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix the issue with limiting maximum recursion depth in parser in certain cases. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10283 rel="external nofollow noreferrer" target=_blank>#10283</a> This fix may introduce minor incompatibility: long and deep queries via clickhouse-client may refuse to work, and you should adjust settings <code class=syntax>max_query_size</code> and <code class=syntax>max_parser_depth</code> accordingly. <a href=https://github.com/ClickHouse/ClickHouse/pull/10295 rel="external nofollow noreferrer" target=_blank>#10295</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Allow to use <code class=syntax>count(*)</code> with multiple JOINs. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9853 rel="external nofollow noreferrer" target=_blank>#9853</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10291 rel="external nofollow noreferrer" target=_blank>#10291</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix error <code class=syntax>Pipeline stuck</code> with <code class=syntax>max_rows_to_group_by</code> and <code class=syntax>group_by_overflow_mode = 'break'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10279 rel="external nofollow noreferrer" target=_blank>#10279</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix 'Cannot add column' error while creating <code class=syntax>range_hashed</code> dictionary using DDL query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10093 rel="external nofollow noreferrer" target=_blank>#10093</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10235 rel="external nofollow noreferrer" target=_blank>#10235</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix rare possible exception <code class=syntax>Cannot drain connections: cancel first</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10239 rel="external nofollow noreferrer" target=_blank>#10239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed bug where ClickHouse would throw "Unknown function lambda." error message when user tries to run ALTER UPDATE/DELETE on tables with ENGINE = Replicated*. Check for nondeterministic functions now handles lambda expressions correctly. <a href=https://github.com/ClickHouse/ClickHouse/pull/10237 rel="external nofollow noreferrer" target=_blank>#10237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Fixed reasonably rare segfault in StorageSystemTables that happens when SELECT ... FROM system.tables is run on a database with Lazy engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10209 rel="external nofollow noreferrer" target=_blank>#10209</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Fix possible infinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code class=syntax>system.numbers</code> or <code class=syntax>system.zeros</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10206 rel="external nofollow noreferrer" target=_blank>#10206</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed "generateRandom" function for Date type. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9973 rel="external nofollow noreferrer" target=_blank>#9973</a>. Fix an edge case when dates with year 2106 are inserted to MergeTree tables with old-style partitioning but partitions are named with year 1970. <a href=https://github.com/ClickHouse/ClickHouse/pull/10218 rel="external nofollow noreferrer" target=_blank>#10218</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Convert types if the table definition of a View does not correspond to the SELECT query. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10180 rel="external nofollow noreferrer" target=_blank>#10180</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/10022 rel="external nofollow noreferrer" target=_blank>#10022</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10217 rel="external nofollow noreferrer" target=_blank>#10217</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix <code class=syntax>parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10082 rel="external nofollow noreferrer" target=_blank>#10082</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10214 rel="external nofollow noreferrer" target=_blank>#10214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/10207 rel="external nofollow noreferrer" target=_blank>#10207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix move-to-prewhere optimization in presense of arrayJoin functions (in certain cases). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10092 rel="external nofollow noreferrer" target=_blank>#10092</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10195 rel="external nofollow noreferrer" target=_blank>#10195</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix issue with separator appearing in SCRAMBLE for native mysql-connector-java (JDBC) <a href=https://github.com/ClickHouse/ClickHouse/pull/10140 rel="external nofollow noreferrer" target=_blank>#10140</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>)</li><li>Fix using the current database for an access checking when the database isn't specified. <a href=https://github.com/ClickHouse/ClickHouse/pull/10192 rel="external nofollow noreferrer" target=_blank>#10192</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fix ALTER of tables with compact parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/10130 rel="external nofollow noreferrer" target=_blank>#10130</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code class=syntax>allow_nondeterministic_mutations</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10186 rel="external nofollow noreferrer" target=_blank>#10186</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fix <code class=syntax>DROP TABLE</code> invoked for dictionary <a href=https://github.com/ClickHouse/ClickHouse/pull/10165 rel="external nofollow noreferrer" target=_blank>#10165</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Convert blocks if structure does not match when doing <code class=syntax>INSERT</code> into Distributed table <a href=https://github.com/ClickHouse/ClickHouse/pull/10135 rel="external nofollow noreferrer" target=_blank>#10135</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>The number of rows was logged incorrectly (as sum across all parts) when inserted block is split by parts with partition key. <a href=https://github.com/ClickHouse/ClickHouse/pull/10138 rel="external nofollow noreferrer" target=_blank>#10138</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add some arguments check and support identifier arguments for MySQL Database Engine <a href=https://github.com/ClickHouse/ClickHouse/pull/10077 rel="external nofollow noreferrer" target=_blank>#10077</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Fix incorrect <code class=syntax>index_granularity_bytes</code> check while creating new replica. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10098 rel="external nofollow noreferrer" target=_blank>#10098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10121 rel="external nofollow noreferrer" target=_blank>#10121</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix bug in <code class=syntax>CHECK TABLE</code> query when table contain skip indices. <a href=https://github.com/ClickHouse/ClickHouse/pull/10068 rel="external nofollow noreferrer" target=_blank>#10068</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix Distributed-over-Distributed with the only one shard in a nested table <a href=https://github.com/ClickHouse/ClickHouse/pull/9997 rel="external nofollow noreferrer" target=_blank>#9997</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix possible rows loss for queries with <code class=syntax>JOIN</code> and <code class=syntax>UNION ALL</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9826 rel="external nofollow noreferrer" target=_blank>#9826</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10113 rel="external nofollow noreferrer" target=_blank>#10113</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/10099 rel="external nofollow noreferrer" target=_blank>#10099</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix bug in dictionary when local clickhouse server is used as source. It may caused memory corruption if types in dictionary and source are not compatible. <a href=https://github.com/ClickHouse/ClickHouse/pull/10071 rel="external nofollow noreferrer" target=_blank>#10071</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed replicated tables startup when updating from an old ClickHouse version where <code class=syntax>/table/replicas/replica_name/metadata</code> node doesn't exist. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10037 rel="external nofollow noreferrer" target=_blank>#10037</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10095 rel="external nofollow noreferrer" target=_blank>#10095</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix error <code class=syntax>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code class=syntax>distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with mixed single and two-level aggregation from different shards. <a href=https://github.com/ClickHouse/ClickHouse/pull/10063 rel="external nofollow noreferrer" target=_blank>#10063</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix deadlock when database with materialized view failed attach at start <a href=https://github.com/ClickHouse/ClickHouse/pull/10054 rel="external nofollow noreferrer" target=_blank>#10054</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix a segmentation fault that could occur in GROUP BY over string keys containing trailing zero bytes (<a href=https://github.com/ClickHouse/ClickHouse/issues/8636 rel="external nofollow noreferrer" target=_blank>#8636</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8925 rel="external nofollow noreferrer" target=_blank>#8925</a>). ... <a href=https://github.com/ClickHouse/ClickHouse/pull/10025 rel="external nofollow noreferrer" target=_blank>#10025</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Fix wrong results of distributed queries when alias could override qualified column name. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9672 rel="external nofollow noreferrer" target=_blank>#9672</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/9714 rel="external nofollow noreferrer" target=_blank>#9714</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9972 rel="external nofollow noreferrer" target=_blank>#9972</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix possible deadlock in <code class=syntax>SYSTEM RESTART REPLICAS</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9955 rel="external nofollow noreferrer" target=_blank>#9955</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix the number of threads used for remote query execution (performance regression, since 20.3). This happened when query from <code class=syntax>Distributed</code> table was executed simultaneously on local and remote shards. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9965 rel="external nofollow noreferrer" target=_blank>#9965</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9971 rel="external nofollow noreferrer" target=_blank>#9971</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed <code class=syntax>DeleteOnDestroy</code> logic in <code class=syntax>ATTACH PART</code> which could lead to automatic removal of attached part and added few tests <a href=https://github.com/ClickHouse/ClickHouse/pull/9410 rel="external nofollow noreferrer" target=_blank>#9410</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix a bug with <code class=syntax>ON CLUSTER</code> DDL queries freezing on server startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/9927 rel="external nofollow noreferrer" target=_blank>#9927</a> (<a href=https://github.com/garneja rel="external nofollow noreferrer" target=_blank>Gagan Arneja</a>)</li><li>Fix bug in which the necessary tables weren't retrieved at one of the processing stages of queries to some databases. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9699 rel="external nofollow noreferrer" target=_blank>#9699</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9949 rel="external nofollow noreferrer" target=_blank>#9949</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>)</li><li>Fix 'Not found column in block' error when <code class=syntax>JOIN</code> appears with <code class=syntax>TOTALS</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9839 rel="external nofollow noreferrer" target=_blank>#9839</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9939 rel="external nofollow noreferrer" target=_blank>#9939</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix parsing multiple hosts set in the CREATE USER command <a href=https://github.com/ClickHouse/ClickHouse/pull/9924 rel="external nofollow noreferrer" target=_blank>#9924</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fix <code class=syntax>TRUNCATE</code> for Join table engine (<a href=https://github.com/ClickHouse/ClickHouse/issues/9917 rel="external nofollow noreferrer" target=_blank>#9917</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9920 rel="external nofollow noreferrer" target=_blank>#9920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Fix race condition between drop and optimize in <code class=syntax>ReplicatedMergeTree</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9901 rel="external nofollow noreferrer" target=_blank>#9901</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix <code class=syntax>DISTINCT</code> for Distributed when <code class=syntax>optimize_skip_unused_shards</code> is set. <a href=https://github.com/ClickHouse/ClickHouse/pull/9808 rel="external nofollow noreferrer" target=_blank>#9808</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix "scalar doesn't exist" error in ALTERs (<a href=https://github.com/ClickHouse/ClickHouse/issues/9878 rel="external nofollow noreferrer" target=_blank>#9878</a>). ... <a href=https://github.com/ClickHouse/ClickHouse/pull/9904 rel="external nofollow noreferrer" target=_blank>#9904</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Fix error with qualified names in <code class=syntax>distributed_product_mode=\'local\'</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4756 rel="external nofollow noreferrer" target=_blank>#4756</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9891 rel="external nofollow noreferrer" target=_blank>#9891</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>For INSERT queries shards now do clamp the settings from the initiator to their constraints instead of throwing an exception. This fix allows to send INSERT queries to a shard with another constraints. This change improves fix <a href=https://github.com/ClickHouse/ClickHouse/issues/9447 rel="external nofollow noreferrer" target=_blank>#9447</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9852 rel="external nofollow noreferrer" target=_blank>#9852</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Add some retries when commiting offsets to Kafka broker, since it can reject commit if during <code class=syntax>offsets.commit.timeout.ms</code> there were no enough replicas available for the <code class=syntax>__consumer_offsets</code> topic <a href=https://github.com/ClickHouse/ClickHouse/pull/9884 rel="external nofollow noreferrer" target=_blank>#9884</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fix Distributed engine behavior when virtual columns of the underlying table used in <code class=syntax>WHERE</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9847 rel="external nofollow noreferrer" target=_blank>#9847</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fixed some cases when timezone of the function argument wasn't used properly. <a href=https://github.com/ClickHouse/ClickHouse/pull/9574 rel="external nofollow noreferrer" target=_blank>#9574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Fix 'Different expressions with the same alias' error when query has PREWHERE and WHERE on distributed table and <code class=syntax>SET distributed_product_mode = 'local'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9871 rel="external nofollow noreferrer" target=_blank>#9871</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9850 rel="external nofollow noreferrer" target=_blank>#9850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9860 rel="external nofollow noreferrer" target=_blank>#9860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix calculating grants for introspection functions from the setting <code class=syntax>allow_introspection_functions</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9840 rel="external nofollow noreferrer" target=_blank>#9840</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fix max_distributed_connections (w/ and w/o Processors) <a href=https://github.com/ClickHouse/ClickHouse/pull/9673 rel="external nofollow noreferrer" target=_blank>#9673</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix possible exception <code class=syntax>Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code class=syntax>JOIN</code> in case if right joined table had zero rows. Example: <code class=syntax>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9777 rel="external nofollow noreferrer" target=_blank>#9777</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/9823 rel="external nofollow noreferrer" target=_blank>#9823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix 'COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query' error in case of subqueries with COMMA JOIN out of tables lists (i.e. in WHERE). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9782 rel="external nofollow noreferrer" target=_blank>#9782</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9830 rel="external nofollow noreferrer" target=_blank>#9830</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix server crashing when <code class=syntax>optimize_skip_unused_shards</code> is set and expression for key can't be converted to its field type <a href=https://github.com/ClickHouse/ClickHouse/pull/9804 rel="external nofollow noreferrer" target=_blank>#9804</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix empty string handling in <code class=syntax>splitByString</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9767 rel="external nofollow noreferrer" target=_blank>#9767</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Fix broken <code class=syntax>ALTER TABLE DELETE COLUMN</code> query for compact parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/9779 rel="external nofollow noreferrer" target=_blank>#9779</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed missing <code class=syntax>rows_before_limit_at_least</code> for queries over http (with processors pipeline). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9730 rel="external nofollow noreferrer" target=_blank>#9730</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9757 rel="external nofollow noreferrer" target=_blank>#9757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix excessive memory consumption in <code class=syntax>ALTER</code> queries (mutations). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9533 rel="external nofollow noreferrer" target=_blank>#9533</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/9670 rel="external nofollow noreferrer" target=_blank>#9670</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9754 rel="external nofollow noreferrer" target=_blank>#9754</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix possible permanent "Cannot schedule a task" error. <a href=https://github.com/ClickHouse/ClickHouse/pull/9154 rel="external nofollow noreferrer" target=_blank>#9154</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix bug in backquoting in external dictionaries DDL. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9619 rel="external nofollow noreferrer" target=_blank>#9619</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9734 rel="external nofollow noreferrer" target=_blank>#9734</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed data race in <code class=syntax>text_log</code>. It does not correspond to any real bug. <a href=https://github.com/ClickHouse/ClickHouse/pull/9726 rel="external nofollow noreferrer" target=_blank>#9726</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix bug in a replication that doesn't allow replication to work if the user has executed mutations on the previous version. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9645 rel="external nofollow noreferrer" target=_blank>#9645</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9652 rel="external nofollow noreferrer" target=_blank>#9652</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed incorrect internal function names for <code class=syntax>sumKahan</code> and <code class=syntax>sumWithOverflow</code>. It led to exception while using this functions in remote queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9636 rel="external nofollow noreferrer" target=_blank>#9636</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Add setting <code class=syntax>use_compact_format_in_distributed_parts_names</code> which allows to write files for <code class=syntax>INSERT</code> queries into <code class=syntax>Distributed</code> table with more compact format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9647 rel="external nofollow noreferrer" target=_blank>#9647</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9653 rel="external nofollow noreferrer" target=_blank>#9653</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix RIGHT and FULL JOIN with LowCardinality in JOIN keys. <a href=https://github.com/ClickHouse/ClickHouse/pull/9610 rel="external nofollow noreferrer" target=_blank>#9610</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix possible exceptions <code class=syntax>Size of filter doesn't match size of column</code> and <code class=syntax>Invalid number of rows in Chunk</code> in <code class=syntax>MergeTreeRangeReader</code>. They could appear while executing <code class=syntax>PREWHERE</code> in some cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/9612 rel="external nofollow noreferrer" target=_blank>#9612</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Allow <code class=syntax>ALTER ON CLUSTER</code> of Distributed tables with internal replication. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/3268 rel="external nofollow noreferrer" target=_blank>#3268</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9617 rel="external nofollow noreferrer" target=_blank>#9617</a> (<a href=https://github.com/shinoi2 rel="external nofollow noreferrer" target=_blank>shinoi2</a>)</li><li>Fix issue when timezone was not preserved if you write a simple arithmetic expression like <code class=syntax>time + 1</code> (in contrast to an expression like <code class=syntax>time + INTERVAL 1 SECOND</code>). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5743 rel="external nofollow noreferrer" target=_blank>#5743</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9323 rel="external nofollow noreferrer" target=_blank>#9323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h4 id=improvement_1>Improvement<a class=headerlink href=../amp/#improvement_1 title="Permanent link"> </a></h4><ul><li>Use time zone when comparing DateTime with string literal. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5206 rel="external nofollow noreferrer" target=_blank>#5206</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10515 rel="external nofollow noreferrer" target=_blank>#10515</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Print verbose diagnostic info if Decimal value cannot be parsed from text input format. <a href=https://github.com/ClickHouse/ClickHouse/pull/10205 rel="external nofollow noreferrer" target=_blank>#10205</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add tasks/memory metrics for distributed/buffer schedule pools <a href=https://github.com/ClickHouse/ClickHouse/pull/10449 rel="external nofollow noreferrer" target=_blank>#10449</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Display result as soon as it's ready for SELECT DISTINCT queries in clickhouse-local and HTTP interface. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8951 rel="external nofollow noreferrer" target=_blank>#8951</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9559 rel="external nofollow noreferrer" target=_blank>#9559</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Allow to use <code class=syntax>SAMPLE OFFSET</code> query instead of <code class=syntax>cityHash64(PRIMARY KEY) % N == n</code> for splitting in <code class=syntax>clickhouse-copier</code>. To use this feature, pass <code class=syntax>--experimental-use-sample-offset 1</code> as a command line argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/10414 rel="external nofollow noreferrer" target=_blank>#10414</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Allow to parse BOM in TSV if the first column cannot contain BOM in its value. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10301 rel="external nofollow noreferrer" target=_blank>#10301</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10424 rel="external nofollow noreferrer" target=_blank>#10424</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add Avro nested fields insert support <a href=https://github.com/ClickHouse/ClickHouse/pull/10354 rel="external nofollow noreferrer" target=_blank>#10354</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li><li>Allowed to alter column in non-modifying data mode when the same type is specified. <a href=https://github.com/ClickHouse/ClickHouse/pull/10382 rel="external nofollow noreferrer" target=_blank>#10382</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Auto <code class=syntax>distributed_group_by_no_merge</code> on GROUP BY sharding key (if <code class=syntax>optimize_skip_unused_shards</code> is set) <a href=https://github.com/ClickHouse/ClickHouse/pull/10341 rel="external nofollow noreferrer" target=_blank>#10341</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Optimize queries with LIMIT/LIMIT BY/ORDER BY for distributed with GROUP BY sharding_key <a href=https://github.com/ClickHouse/ClickHouse/pull/10373 rel="external nofollow noreferrer" target=_blank>#10373</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Added a setting <code class=syntax>max_server_memory_usage</code> to limit total memory usage of the server. The metric <code class=syntax>MemoryTracking</code> is now calculated without a drift. The setting <code class=syntax>max_memory_usage_for_all_queries</code> is now obsolete and does nothing. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10293 rel="external nofollow noreferrer" target=_blank>#10293</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10362 rel="external nofollow noreferrer" target=_blank>#10362</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add config option <code class=syntax>system_tables_lazy_load</code>. If it's set to false, then system tables with logs are loaded at the server startup. <a href=https://github.com/Alex-Burmak rel="external nofollow noreferrer" target=_blank>Alexander Burmak</a>, <a href=https://github.com/DeifyTheGod rel="external nofollow noreferrer" target=_blank>Svyatoslav Tkhon Il Pak</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/9642 rel="external nofollow noreferrer" target=_blank>#9642</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10359 rel="external nofollow noreferrer" target=_blank>#10359</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Use background thread pool (background_schedule_pool_size) for distributed sends <a href=https://github.com/ClickHouse/ClickHouse/pull/10263 rel="external nofollow noreferrer" target=_blank>#10263</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Use background thread pool for background buffer flushes. <a href=https://github.com/ClickHouse/ClickHouse/pull/10315 rel="external nofollow noreferrer" target=_blank>#10315</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Support for one special case of removing incompletely written parts. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9940 rel="external nofollow noreferrer" target=_blank>#9940</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10221 rel="external nofollow noreferrer" target=_blank>#10221</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Use isInjective() over manual list of such functions for GROUP BY optimization. <a href=https://github.com/ClickHouse/ClickHouse/pull/10342 rel="external nofollow noreferrer" target=_blank>#10342</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Avoid printing error message in log if client sends RST packet immediately on connect. It is typical behaviour of IPVS balancer with keepalived and VRRP. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/1851 rel="external nofollow noreferrer" target=_blank>#1851</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10274 rel="external nofollow noreferrer" target=_blank>#10274</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Allow to parse <code class=syntax>+inf</code> for floating point types. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/1839 rel="external nofollow noreferrer" target=_blank>#1839</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10272 rel="external nofollow noreferrer" target=_blank>#10272</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Implemented <code class=syntax>generateRandom</code> table function for Nested types. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9903 rel="external nofollow noreferrer" target=_blank>#9903</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10219 rel="external nofollow noreferrer" target=_blank>#10219</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Provide <code class=syntax>max_allowed_packed</code> in MySQL compatibility interface that will help some clients to communicate with ClickHouse via MySQL protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/10199 rel="external nofollow noreferrer" target=_blank>#10199</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>)</li><li>Allow literals for GLOBAL IN (i.e. <code class=syntax>SELECT * FROM remote('localhost', system.one) WHERE dummy global in (0)</code>) <a href=https://github.com/ClickHouse/ClickHouse/pull/10196 rel="external nofollow noreferrer" target=_blank>#10196</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix various small issues in interactive mode of clickhouse-client <a href=https://github.com/ClickHouse/ClickHouse/pull/10194 rel="external nofollow noreferrer" target=_blank>#10194</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Avoid superfluous dictionaries load (system.tables, DROP/SHOW CREATE TABLE) <a href=https://github.com/ClickHouse/ClickHouse/pull/10164 rel="external nofollow noreferrer" target=_blank>#10164</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Update to RWLock: timeout parameter for getLock() + implementation reworked to be phase fair <a href=https://github.com/ClickHouse/ClickHouse/pull/10073 rel="external nofollow noreferrer" target=_blank>#10073</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Enhanced compatibility with native mysql-connector-java(JDBC) <a href=https://github.com/ClickHouse/ClickHouse/pull/10021 rel="external nofollow noreferrer" target=_blank>#10021</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>)</li><li>The function <code class=syntax>toString</code> is considered monotonic and can be used for index analysis even when applied in tautological cases with String or LowCardinality(String) argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/10110 rel="external nofollow noreferrer" target=_blank>#10110</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Add <code class=syntax>ON CLUSTER</code> clause support to commands <code class=syntax>{CREATE|DROP} USER/ROLE/ROW POLICY/SETTINGS PROFILE/QUOTA</code>, <code class=syntax>GRANT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9811 rel="external nofollow noreferrer" target=_blank>#9811</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Virtual hosted-style support for S3 URI <a href=https://github.com/ClickHouse/ClickHouse/pull/9998 rel="external nofollow noreferrer" target=_blank>#9998</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Now layout type for dictionaries with no arguments can be specified without round brackets in dictionaries DDL-queries. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10057 rel="external nofollow noreferrer" target=_blank>#10057</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10064 rel="external nofollow noreferrer" target=_blank>#10064</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Add ability to use number ranges with leading zeros in filepath <a href=https://github.com/ClickHouse/ClickHouse/pull/9989 rel="external nofollow noreferrer" target=_blank>#9989</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li><li>Better memory usage in CROSS JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/10029 rel="external nofollow noreferrer" target=_blank>#10029</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Try to connect to all shards in cluster when getting structure of remote table and skip_unavailable_shards is set. <a href=https://github.com/ClickHouse/ClickHouse/pull/7278 rel="external nofollow noreferrer" target=_blank>#7278</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li><li>Add <code class=syntax>total_rows</code>/<code class=syntax>total_bytes</code> into the <code class=syntax>system.tables</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/9919 rel="external nofollow noreferrer" target=_blank>#9919</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>System log tables now use polymorpic parts by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/9905 rel="external nofollow noreferrer" target=_blank>#9905</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Add type column into system.settings/merge_tree_settings <a href=https://github.com/ClickHouse/ClickHouse/pull/9909 rel="external nofollow noreferrer" target=_blank>#9909</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Check for available CPU instructions at server startup as early as possible. <a href=https://github.com/ClickHouse/ClickHouse/pull/9888 rel="external nofollow noreferrer" target=_blank>#9888</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove <code class=syntax>ORDER BY</code> stage from mutations because we read from a single ordered part in a single thread. Also add check that the rows in mutation are ordered by sorting key and this order is not violated. <a href=https://github.com/ClickHouse/ClickHouse/pull/9886 rel="external nofollow noreferrer" target=_blank>#9886</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Implement operator LIKE for FixedString at left hand side. This is needed to better support TPC-DS queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9890 rel="external nofollow noreferrer" target=_blank>#9890</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add <code class=syntax>force_optimize_skip_unused_shards_no_nested</code> that will disable <code class=syntax>force_optimize_skip_unused_shards</code> for nested Distributed table <a href=https://github.com/ClickHouse/ClickHouse/pull/9812 rel="external nofollow noreferrer" target=_blank>#9812</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Now columns size is calculated only once for MergeTree data parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/9827 rel="external nofollow noreferrer" target=_blank>#9827</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Evaluate constant expressions for <code class=syntax>optimize_skip_unused_shards</code> (i.e. <code class=syntax>SELECT * FROM foo_dist WHERE key=xxHash32(0)</code>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8846 rel="external nofollow noreferrer" target=_blank>#8846</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Check for using <code class=syntax>Date</code> or <code class=syntax>DateTime</code> column from TTL expressions was removed. <a href=https://github.com/ClickHouse/ClickHouse/pull/9967 rel="external nofollow noreferrer" target=_blank>#9967</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>DiskS3 hard links optimal implementation. <a href=https://github.com/ClickHouse/ClickHouse/pull/9760 rel="external nofollow noreferrer" target=_blank>#9760</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>If <code class=syntax>set multiple_joins_rewriter_version = 2</code> enables second version of multiple JOIN rewrites that keeps not clashed column names as is. It supports multiple JOINs with <code class=syntax>USING</code> and allow <code class=syntax>select *</code> for JOINs with subqueries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9739 rel="external nofollow noreferrer" target=_blank>#9739</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Implementation of "non-blocking" alter for StorageMergeTree <a href=https://github.com/ClickHouse/ClickHouse/pull/9606 rel="external nofollow noreferrer" target=_blank>#9606</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Add MergeTree full support for DiskS3 <a href=https://github.com/ClickHouse/ClickHouse/pull/9646 rel="external nofollow noreferrer" target=_blank>#9646</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Extend <code class=syntax>splitByString</code> to support empty strings as separators. <a href=https://github.com/ClickHouse/ClickHouse/pull/9742 rel="external nofollow noreferrer" target=_blank>#9742</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Add a <code class=syntax>timestamp_ns</code> column to <code class=syntax>system.trace_log</code>. It contains a high-definition timestamp of the trace event, and allows to build timelines of thread profiles ("flame charts"). <a href=https://github.com/ClickHouse/ClickHouse/pull/9696 rel="external nofollow noreferrer" target=_blank>#9696</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>When the setting <code class=syntax>send_logs_level</code> is enabled, avoid intermixing of log messages and query progress. <a href=https://github.com/ClickHouse/ClickHouse/pull/9634 rel="external nofollow noreferrer" target=_blank>#9634</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Added support of <code class=syntax>MATERIALIZE TTL IN PARTITION</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9581 rel="external nofollow noreferrer" target=_blank>#9581</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Support complex types inside Avro nested fields <a href=https://github.com/ClickHouse/ClickHouse/pull/10502 rel="external nofollow noreferrer" target=_blank>#10502</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li></ul><h4 id=performance-improvement_1>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_1 title="Permanent link"> </a></h4><ul><li>Better insert logic for right table for Partial MergeJoin. <a href=https://github.com/ClickHouse/ClickHouse/pull/10467 rel="external nofollow noreferrer" target=_blank>#10467</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Improved performance of row-oriented formats (more than 10% for CSV and more than 35% for Avro in case of narrow tables). <a href=https://github.com/ClickHouse/ClickHouse/pull/10503 rel="external nofollow noreferrer" target=_blank>#10503</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li><li>Improved performance of queries with explicitly defined sets at right side of IN operator and tuples on the left side. <a href=https://github.com/ClickHouse/ClickHouse/pull/10385 rel="external nofollow noreferrer" target=_blank>#10385</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Use less memory for hash table in HashJoin. <a href=https://github.com/ClickHouse/ClickHouse/pull/10416 rel="external nofollow noreferrer" target=_blank>#10416</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Special HashJoin over StorageDictionary. Allow rewrite <code class=syntax>dictGet()</code> functions with JOINs. It's not backward incompatible itself but could uncover <a href=https://github.com/ClickHouse/ClickHouse/issues/8400 rel="external nofollow noreferrer" target=_blank>#8400</a> on some installations. <a href=https://github.com/ClickHouse/ClickHouse/pull/10133 rel="external nofollow noreferrer" target=_blank>#10133</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Enable parallel insert of materialized view when its target table supports. <a href=https://github.com/ClickHouse/ClickHouse/pull/10052 rel="external nofollow noreferrer" target=_blank>#10052</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li><li>Improved performance of index analysis with monotonic functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9607 rel="external nofollow noreferrer" target=_blank>#9607</a><a href=https://github.com/ClickHouse/ClickHouse/pull/10026 rel="external nofollow noreferrer" target=_blank>#10026</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Using SSE2 or SSE4.2 SIMD intrinsics to speed up tokenization in bloom filters. <a href=https://github.com/ClickHouse/ClickHouse/pull/9968 rel="external nofollow noreferrer" target=_blank>#9968</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Improved performance of queries with explicitly defined sets at right side of <code class=syntax>IN</code> operator. This fixes performance regression in version 20.3. <a href=https://github.com/ClickHouse/ClickHouse/pull/9740 rel="external nofollow noreferrer" target=_blank>#9740</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Now clickhouse-copier splits each partition in number of pieces and copies them independently. <a href=https://github.com/ClickHouse/ClickHouse/pull/9075 rel="external nofollow noreferrer" target=_blank>#9075</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Adding more aggregation methods. For example TPC-H query 1 will now pick <code class=syntax>FixedHashMap&lt;UInt16, AggregateDataPtr&gt;</code> and gets 25% performance gain <a href=https://github.com/ClickHouse/ClickHouse/pull/9829 rel="external nofollow noreferrer" target=_blank>#9829</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Use single row counter for multiple streams in pre-limit transform. This helps to avoid uniting pipeline streams in queries with <code class=syntax>limit</code> but without <code class=syntax>order by</code> (like <code class=syntax>select f(x) from (select x from t limit 1000000000)</code>) and use multiple threads for further processing. <a href=https://github.com/ClickHouse/ClickHouse/pull/9602 rel="external nofollow noreferrer" target=_blank>#9602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li></ul><h4 id=build-testing-packaging-improvement_3>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_3 title="Permanent link"> </a></h4><ul><li>Use a fork of AWS SDK libraries from ClickHouse-Extras <a href=https://github.com/ClickHouse/ClickHouse/pull/10527 rel="external nofollow noreferrer" target=_blank>#10527</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Add integration tests for new ALTER RENAME COLUMN query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10654 rel="external nofollow noreferrer" target=_blank>#10654</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li><li>Fix possible signed integer overflow in invocation of function <code class=syntax>now64</code> with wrong arguments. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8973 rel="external nofollow noreferrer" target=_blank>#8973</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10511 rel="external nofollow noreferrer" target=_blank>#10511</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Split fuzzer and sanitizer configurations to make build config compatible with Oss-fuzz. <a href=https://github.com/ClickHouse/ClickHouse/pull/10494 rel="external nofollow noreferrer" target=_blank>#10494</a> (<a href=https://github.com/kyprizel rel="external nofollow noreferrer" target=_blank>kyprizel</a>)</li><li>Fixes for clang-tidy on clang-10. <a href=https://github.com/ClickHouse/ClickHouse/pull/10420 rel="external nofollow noreferrer" target=_blank>#10420</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Display absolute paths in error messages. Otherwise KDevelop fails to navigate to correct file and opens a new file instead. <a href=https://github.com/ClickHouse/ClickHouse/pull/10434 rel="external nofollow noreferrer" target=_blank>#10434</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added <code class=syntax>ASAN_OPTIONS</code> environment variable to investigate errors in CI stress tests with Address sanitizer. <a href=https://github.com/ClickHouse/ClickHouse/pull/10440 rel="external nofollow noreferrer" target=_blank>#10440</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Enable ThinLTO for clang builds (experimental). <a href=https://github.com/ClickHouse/ClickHouse/pull/10435 rel="external nofollow noreferrer" target=_blank>#10435</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove accidential dependency on Z3 that may be introduced if the system has Z3 solver installed. <a href=https://github.com/ClickHouse/ClickHouse/pull/10426 rel="external nofollow noreferrer" target=_blank>#10426</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Move integration tests docker files to docker/ directory. <a href=https://github.com/ClickHouse/ClickHouse/pull/10335 rel="external nofollow noreferrer" target=_blank>#10335</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li><li>Allow to use <code class=syntax>clang-10</code> in CI. It ensures that <a href=https://github.com/ClickHouse/ClickHouse/issues/10238 rel="external nofollow noreferrer" target=_blank>#10238</a> is fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/10384 rel="external nofollow noreferrer" target=_blank>#10384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update OpenSSL to upstream master. Fixed the issue when TLS connections may fail with the message <code class=syntax>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error</code> and <code class=syntax>SSL Exception: error:2400006E:random number generator::error retrieving entropy</code>. The issue was present in version 20.1. <a href=https://github.com/ClickHouse/ClickHouse/pull/8956 rel="external nofollow noreferrer" target=_blank>#8956</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix clang-10 build. <a href=https://github.com/ClickHouse/ClickHouse/issues/10238 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/10238</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10370 rel="external nofollow noreferrer" target=_blank>#10370</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Add performance test for <a href=https://github.com/ClickHouse/ClickHouse/pull/10052 rel="external nofollow noreferrer" target=_blank>Parallel INSERT for materialized view</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10345 rel="external nofollow noreferrer" target=_blank>#10345</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li><li>Fix flaky test <code class=syntax>test_settings_constraints_distributed.test_insert_clamps_settings</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10346 rel="external nofollow noreferrer" target=_blank>#10346</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Add util to test results upload in CI ClickHouse <a href=https://github.com/ClickHouse/ClickHouse/pull/10330 rel="external nofollow noreferrer" target=_blank>#10330</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li><li>Convert test results to JSONEachRow format in junit_to_html tool <a href=https://github.com/ClickHouse/ClickHouse/pull/10323 rel="external nofollow noreferrer" target=_blank>#10323</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li><li>Update cctz. <a href=https://github.com/ClickHouse/ClickHouse/pull/10215 rel="external nofollow noreferrer" target=_blank>#10215</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Allow to create HTML report from the purest JUnit XML report. <a href=https://github.com/ClickHouse/ClickHouse/pull/10247 rel="external nofollow noreferrer" target=_blank>#10247</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li><li>Update the check for minimal compiler version. Fix the root cause of the issue <a href=https://github.com/ClickHouse/ClickHouse/issues/10250 rel="external nofollow noreferrer" target=_blank>#10250</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10256 rel="external nofollow noreferrer" target=_blank>#10256</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Initial support for live view tables over distributed <a href=https://github.com/ClickHouse/ClickHouse/pull/10179 rel="external nofollow noreferrer" target=_blank>#10179</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li><li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href=https://github.com/ClickHouse/ClickHouse/issues/9968 rel="external nofollow noreferrer" target=_blank>#9968</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10801 rel="external nofollow noreferrer" target=_blank>#10801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>clickhouse-docker-util <a href=https://github.com/ClickHouse/ClickHouse/pull/10151 rel="external nofollow noreferrer" target=_blank>#10151</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Update pdqsort to recent version <a href=https://github.com/ClickHouse/ClickHouse/pull/10171 rel="external nofollow noreferrer" target=_blank>#10171</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Update libdivide to v3.0 <a href=https://github.com/ClickHouse/ClickHouse/pull/10169 rel="external nofollow noreferrer" target=_blank>#10169</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Add check with enabled polymorphic parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/10086 rel="external nofollow noreferrer" target=_blank>#10086</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Add cross-compile build for FreeBSD. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9465 rel="external nofollow noreferrer" target=_blank>#9465</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9643 rel="external nofollow noreferrer" target=_blank>#9643</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Add performance test for <a href=https://github.com/ClickHouse/ClickHouse/issues/6924 rel="external nofollow noreferrer" target=_blank>#6924</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6980 rel="external nofollow noreferrer" target=_blank>#6980</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Add support of <code class=syntax>/dev/null</code> in the <code class=syntax>File</code> engine for better performance testing <a href=https://github.com/ClickHouse/ClickHouse/pull/8455 rel="external nofollow noreferrer" target=_blank>#8455</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Move all folders inside /dbms one level up <a href=https://github.com/ClickHouse/ClickHouse/pull/9974 rel="external nofollow noreferrer" target=_blank>#9974</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Add a test that checks that read from MergeTree with single thread is performed in order. Addition to <a href=https://github.com/ClickHouse/ClickHouse/issues/9670 rel="external nofollow noreferrer" target=_blank>#9670</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9762 rel="external nofollow noreferrer" target=_blank>#9762</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix the <code class=syntax>00964_live_view_watch_events_heartbeat.py</code> test to avoid race condition. <a href=https://github.com/ClickHouse/ClickHouse/pull/9944 rel="external nofollow noreferrer" target=_blank>#9944</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li><li>Fix integration test <code class=syntax>test_settings_constraints</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9962 rel="external nofollow noreferrer" target=_blank>#9962</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Every function in its own file, part 12. <a href=https://github.com/ClickHouse/ClickHouse/pull/9922 rel="external nofollow noreferrer" target=_blank>#9922</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added performance test for the case of extremely slow analysis of array of tuples. <a href=https://github.com/ClickHouse/ClickHouse/pull/9872 rel="external nofollow noreferrer" target=_blank>#9872</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update zstd to 1.4.4. It has some minor improvements in performance and compression ratio. If you run replicas with different versions of ClickHouse you may see reasonable error messages <code class=syntax>Data after merge is not byte-identical to data on another replicas.</code> with explanation. These messages are Ok and you should not worry. <a href=https://github.com/ClickHouse/ClickHouse/pull/10663 rel="external nofollow noreferrer" target=_blank>#10663</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix TSan report in <code class=syntax>system.stack_trace</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9832 rel="external nofollow noreferrer" target=_blank>#9832</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Removed dependency on <code class=syntax>clock_getres</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9833 rel="external nofollow noreferrer" target=_blank>#9833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added identifier names check with clang-tidy. <a href=https://github.com/ClickHouse/ClickHouse/pull/9799 rel="external nofollow noreferrer" target=_blank>#9799</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update "builder" docker image. This image is not used in CI but is useful for developers. <a href=https://github.com/ClickHouse/ClickHouse/pull/9809 rel="external nofollow noreferrer" target=_blank>#9809</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove old <code class=syntax>performance-test</code> tool that is no longer used in CI. <code class=syntax>clickhouse-performance-test</code> is great but now we are using way superior tool that is doing comparison testing with sophisticated statistical formulas to achieve confident results regardless to various changes in environment. <a href=https://github.com/ClickHouse/ClickHouse/pull/9796 rel="external nofollow noreferrer" target=_blank>#9796</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added most of clang-static-analyzer checks. <a href=https://github.com/ClickHouse/ClickHouse/pull/9765 rel="external nofollow noreferrer" target=_blank>#9765</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update Poco to 1.9.3 in preparation for MongoDB URI support. <a href=https://github.com/ClickHouse/ClickHouse/pull/6892 rel="external nofollow noreferrer" target=_blank>#6892</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Fix build with <code class=syntax>-DUSE_STATIC_LIBRARIES=0 -DENABLE_JEMALLOC=0</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9651 rel="external nofollow noreferrer" target=_blank>#9651</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>For change log script, if merge commit was cherry-picked to release branch, take PR name from commit description. <a href=https://github.com/ClickHouse/ClickHouse/pull/9708 rel="external nofollow noreferrer" target=_blank>#9708</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Support <code class=syntax>vX.X-conflicts</code> tag in backport script. <a href=https://github.com/ClickHouse/ClickHouse/pull/9705 rel="external nofollow noreferrer" target=_blank>#9705</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix <code class=syntax>auto-label</code> for backporting script. <a href=https://github.com/ClickHouse/ClickHouse/pull/9685 rel="external nofollow noreferrer" target=_blank>#9685</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Use libc++ in Darwin cross-build to make it consistent with native build. <a href=https://github.com/ClickHouse/ClickHouse/pull/9665 rel="external nofollow noreferrer" target=_blank>#9665</a> (<a href=https://github.com/huiwang rel="external nofollow noreferrer" target=_blank>Hui Wang</a>)</li><li>Fix flacky test <code class=syntax>01017_uniqCombined_memory_usage</code>. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/7236 rel="external nofollow noreferrer" target=_blank>#7236</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9667 rel="external nofollow noreferrer" target=_blank>#9667</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix build for native MacOS Clang compiler <a href=https://github.com/ClickHouse/ClickHouse/pull/9649 rel="external nofollow noreferrer" target=_blank>#9649</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Allow to add various glitches around <code class=syntax>pthread_mutex_lock</code>, <code class=syntax>pthread_mutex_unlock</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9635 rel="external nofollow noreferrer" target=_blank>#9635</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add support for <code class=syntax>clang-tidy</code> in <code class=syntax>packager</code> script. <a href=https://github.com/ClickHouse/ClickHouse/pull/9625 rel="external nofollow noreferrer" target=_blank>#9625</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add ability to use unbundled msgpack. <a href=https://github.com/ClickHouse/ClickHouse/pull/10168 rel="external nofollow noreferrer" target=_blank>#10168</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li></ul><h2 id=clickhouse-release-v20-3>ClickHouse release v20.3<a class=headerlink href=../amp/#clickhouse-release-v20-3 title="Permanent link"> </a></h2><h3 id=clickhouse-release-v20-3-12-112-lts-2020-06-25>ClickHouse release v20.3.12.112-lts 2020-06-25<a class=headerlink href=../amp/#clickhouse-release-v20-3-12-112-lts-2020-06-25 title="Permanent link"> </a></h3><h4 id=bug-fix_5>Bug Fix<a class=headerlink href=../amp/#bug-fix_5 title="Permanent link"> </a></h4><ul><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix using too many threads for queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11788 rel="external nofollow noreferrer" target=_blank>#11788</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix unexpected behaviour of queries like <code class=syntax>SELECT *, xyz.*</code> which were success while an error expected. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li><li>Now replicated fetches will be cancelled during metadata alter. <a href=https://github.com/ClickHouse/ClickHouse/pull/11744 rel="external nofollow noreferrer" target=_blank>#11744</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix <code class=syntax>ORDER BY ... WITH FILL</code> over const columns. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix error which leads to an incorrect state of <code class=syntax>system.mutations</code>. It may show that whole mutation is already done but the server still has <code class=syntax>MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11611 rel="external nofollow noreferrer" target=_blank>#11611</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11681 rel="external nofollow noreferrer" target=_blank>#11681</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11352 rel="external nofollow noreferrer" target=_blank>#11352</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11644 rel="external nofollow noreferrer" target=_blank>#11644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. (Probably it is connected with <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a> somehow). <a href=https://github.com/ClickHouse/ClickHouse/pull/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix error <code class=syntax>Block structure mismatch</code> for queries with sampling reading from <code class=syntax>Buffer</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/11602 rel="external nofollow noreferrer" target=_blank>#11602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix error <code class=syntax>Size of offsets doesn't match size of column</code> for queries with <code class=syntax>PREWHERE column in (subquery)</code> and <code class=syntax>ARRAY JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>All queries in HTTP session have had the same query_id. It is fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/11578 rel="external nofollow noreferrer" target=_blank>#11578</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li><li>Fix shard_num/replica_num for <code class=syntax>&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href=https://github.com/ClickHouse/ClickHouse/pull/11528 rel="external nofollow noreferrer" target=_blank>#11528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix wrong results of distributed queries when alias could override qualified column name. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9672 rel="external nofollow noreferrer" target=_blank>#9672</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/9714 rel="external nofollow noreferrer" target=_blank>#9714</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9972 rel="external nofollow noreferrer" target=_blank>#9972</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li></ul><h3 id=clickhouse-release-v20-3-11-97-lts-2020-06-10>ClickHouse release v20.3.11.97-lts 2020-06-10<a class=headerlink href=../amp/#clickhouse-release-v20-3-11-97-lts-2020-06-10 title="Permanent link"> </a></h3><h4 id=new-feature_2>New Feature<a class=headerlink href=../amp/#new-feature_2 title="Permanent link"> </a></h4><ul><li>Now ClickHouse controls timeouts of dictionary sources on its side. Two new settings added to cache dictionary configuration: <code class=syntax>strict_max_lifetime_seconds</code>, which is <code class=syntax>max_lifetime</code> by default and <code class=syntax>query_wait_timeout_milliseconds</code>, which is one minute by default. The first settings is also useful with <code class=syntax>allow_read_expired_keys</code> settings (to forbid reading very expired keys). <a href=https://github.com/ClickHouse/ClickHouse/pull/10337 rel="external nofollow noreferrer" target=_blank>#10337</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li></ul><h4 id=bug-fix_6>Bug Fix<a class=headerlink href=../amp/#bug-fix_6 title="Permanent link"> </a></h4><ul><li>Fix the error <code class=syntax>Data compressed with different methods</code> that can happen if <code class=syntax>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix return compressed size for codecs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix pointInPolygon with nan as point. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11375 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li><li>Fix crash in JOIN over LowCarinality(T) and Nullable(T). <a href=https://github.com/ClickHouse/ClickHouse/issues/11380 rel="external nofollow noreferrer" target=_blank>#11380</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11414 rel="external nofollow noreferrer" target=_blank>#11414</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix error code for wrong <code class=syntax>USING</code> key. <a href=https://github.com/ClickHouse/ClickHouse/issues/11373 rel="external nofollow noreferrer" target=_blank>#11373</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11404 rel="external nofollow noreferrer" target=_blank>#11404</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Better errors for <code class=syntax>joinGet()</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/11389 rel="external nofollow noreferrer" target=_blank>#11389</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix possible <code class=syntax>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href=https://github.com/ClickHouse/ClickHouse/pull/11354 rel="external nofollow noreferrer" target=_blank>#11354</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix support for <code class=syntax>\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9933 rel="external nofollow noreferrer" target=_blank>#9933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11350 rel="external nofollow noreferrer" target=_blank>#11350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash in direct selects from StorageJoin (without JOIN) and wrong nullability. <a href=https://github.com/ClickHouse/ClickHouse/pull/11340 rel="external nofollow noreferrer" target=_blank>#11340</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix crash in <code class=syntax>quantilesExactWeightedArray</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Now merges stopped before change metadata in <code class=syntax>ALTER</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/11335 rel="external nofollow noreferrer" target=_blank>#11335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Make writing to <code class=syntax>MATERIALIZED VIEW</code> with setting <code class=syntax>parallel_view_processing = 1</code> parallel again. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class=syntax>empty</code> or <code class=syntax>notEmpty</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code class=syntax>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class=syntax>max_network_bandwidth</code>, <code class=syntax>max_execution_speed</code> or <code class=syntax>priority</code> settings. Change the default value of <code class=syntax>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class=syntax>min_execution_speed</code> and <code class=syntax>max_execution_speed</code> have no effect. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class=syntax>clickhouse-client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash while reading malformed data in Protobuf format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fixed a bug when cache-dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href=https://github.com/ClickHouse/ClickHouse/pull/11233 rel="external nofollow noreferrer" target=_blank>#11233</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li><li>Fix error <code class=syntax>Block structure mismatch in QueryPipeline</code> while reading from <code class=syntax>VIEW</code> with constants in inner query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11181 rel="external nofollow noreferrer" target=_blank>#11181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11205 rel="external nofollow noreferrer" target=_blank>#11205</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix possible exception <code class=syntax>Invalid status for associated output</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11200 rel="external nofollow noreferrer" target=_blank>#11200</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix possible error <code class=syntax>Cannot capture column</code> for higher-order functions with <code class=syntax>Array(Array(LowCardinality))</code> captured argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed S3 globbing which could fail in case of more than 1000 keys and some backends. <a href=https://github.com/ClickHouse/ClickHouse/pull/11179 rel="external nofollow noreferrer" target=_blank>#11179</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href=https://github.com/ClickHouse/ClickHouse/pull/11114 rel="external nofollow noreferrer" target=_blank>#11114</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix predicates optimization for distributed queries (<code class=syntax>enable_optimize_predicate_expression=1</code>) for queries with <code class=syntax>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Introduce commit retry logic to decrease the possibility of getting duplicates from Kafka in rare cases when offset commit was failed. <a href=https://github.com/ClickHouse/ClickHouse/pull/9884 rel="external nofollow noreferrer" target=_blank>#9884</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li></ul><h4 id=performance-improvement_2>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_2 title="Permanent link"> </a></h4><ul><li>Get dictionary and check access rights only once per each call of any function reading external dictionaries. <a href=https://github.com/ClickHouse/ClickHouse/pull/10928 rel="external nofollow noreferrer" target=_blank>#10928</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li></ul><h4 id=build-testing-packaging-improvement_4>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_4 title="Permanent link"> </a></h4><ul><li>Fix several flaky integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/11355 rel="external nofollow noreferrer" target=_blank>#11355</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li></ul><h3 id=clickhouse-release-v20-3-10-75-lts-2020-05-23>ClickHouse release v20.3.10.75-lts 2020-05-23<a class=headerlink href=../amp/#clickhouse-release-v20-3-10-75-lts-2020-05-23 title="Permanent link"> </a></h3><h4 id=bug-fix_7>Bug Fix<a class=headerlink href=../amp/#bug-fix_7 title="Permanent link"> </a></h4><ul><li>Removed logging from mutation finalization task if nothing was finalized. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed <code class=syntax>parseDateTime64BestEffort</code> argument resolution bugs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fixed incorrect raw data size in method <code class=syntax>getRawData()</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li><li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of <code class=syntax>GROUP BY</code> result is large and aggregation is performed by a single <code class=syntax>String</code> field. It leads to several unmerged rows for a single key in result. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed backward compatibility with tuples in <code class=syntax>Distributed</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fixed <code class=syntax>SIGSEGV</code> in <code class=syntax>StringHashTable</code> if such a key does not exist. <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed bug in <code class=syntax>ReplicatedMergeTree</code> which might cause some <code class=syntax>ALTER</code> on <code class=syntax>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed columns order after <code class=syntax>Block::sortColumns()</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed the issue with <code class=syntax>ODBC</code> bridge when no quoting of identifiers is requested. Fixes [#7984] (<a href=https://github.com/ClickHouse/ClickHouse/issues/7984 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/7984</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed <code class=syntax>UBSan</code> and <code class=syntax>MSan</code> report in <code class=syntax>DateLUT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed incorrect type conversion in key conditions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li><li>Fixed <code class=syntax>parallel_view_processing</code> behavior. Now all insertions into <code class=syntax>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed combinator -<code class=syntax>OrNull</code> and <code class=syntax>-OrDefault</code> when combined with <code class=syntax>-State</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Fixed crash in <code class=syntax>generateRandom</code> with nested types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10583 rel="external nofollow noreferrer" target=_blank>#10583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10734 rel="external nofollow noreferrer" target=_blank>#10734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed data corruption for <code class=syntax>LowCardinality(FixedString)</code> key column in <code class=syntax>SummingMergeTree</code> which could have happened after merge. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed possible buffer overflow in function <code class=syntax>h3EdgeAngle</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10711 rel="external nofollow noreferrer" target=_blank>#10711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed multiple usages of <code class=syntax>IN</code> operator with the identical set in one query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fixed bug, which causes http requests stuck on client close when <code class=syntax>readonly=2</code> and <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7939 rel="external nofollow noreferrer" target=_blank>#7939</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7019 rel="external nofollow noreferrer" target=_blank>#7019</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7736 rel="external nofollow noreferrer" target=_blank>#7736</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7091 rel="external nofollow noreferrer" target=_blank>#7091</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed order of parameters in <code class=syntax>AggregateTransform</code> constructor. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li><li>Fixed the lack of parallel execution of remote queries with <code class=syntax>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed possible incorrect number of rows for queries with <code class=syntax>LIMIT</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10566 rel="external nofollow noreferrer" target=_blank>#10566</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10709 rel="external nofollow noreferrer" target=_blank>#10709</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10660 rel="external nofollow noreferrer" target=_blank>#10660</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed a bug which locks concurrent alters when table has a lot of parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/10659 rel="external nofollow noreferrer" target=_blank>#10659</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed a bug when on <code class=syntax>SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed incorrect scalar results inside inner query of <code class=syntax>MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed <code class=syntax>SELECT</code> of column <code class=syntax>ALIAS</code> which default expression type different from column type. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Implemented comparison between DateTime64 and String values. <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fixed index corruption, which may accur in some cases after merge compact parts into another compact part. <a href=https://github.com/ClickHouse/ClickHouse/pull/10531 rel="external nofollow noreferrer" target=_blank>#10531</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fixed the situation, when mutation finished all parts, but hung up in <code class=syntax>is_done=0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10526 rel="external nofollow noreferrer" target=_blank>#10526</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed overflow at beginning of unix epoch for timezones with fractional offset from <code class=syntax>UTC</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9335 rel="external nofollow noreferrer" target=_blank>#9335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10513 rel="external nofollow noreferrer" target=_blank>#10513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed improper shutdown of <code class=syntax>Distributed</code> storage. <a href=https://github.com/ClickHouse/ClickHouse/pull/10491 rel="external nofollow noreferrer" target=_blank>#10491</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed numeric overflow in <code class=syntax>simpleLinearRegression</code> over large integers. <a href=https://github.com/ClickHouse/ClickHouse/pull/10474 rel="external nofollow noreferrer" target=_blank>#10474</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li></ul><h4 id=build-testing-packaging-improvement_5>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_5 title="Permanent link"> </a></h4><ul><li>Fix UBSan report in LZ4 library. <a href=https://github.com/ClickHouse/ClickHouse/pull/10631 rel="external nofollow noreferrer" target=_blank>#10631</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix clang-10 build. <a href=https://github.com/ClickHouse/ClickHouse/issues/10238 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/10238</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10370 rel="external nofollow noreferrer" target=_blank>#10370</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Added failing tests about <code class=syntax>max_rows_to_sort</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10268 rel="external nofollow noreferrer" target=_blank>#10268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Added some improvements in printing diagnostic info in input formats. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10204 rel="external nofollow noreferrer" target=_blank>#10204</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10418 rel="external nofollow noreferrer" target=_blank>#10418</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Added CA certificates to clickhouse-server docker image. <a href=https://github.com/ClickHouse/ClickHouse/pull/10476 rel="external nofollow noreferrer" target=_blank>#10476</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li></ul><h4 id=bug-fix_8>Bug fix<a class=headerlink href=../amp/#bug-fix_8 title="Permanent link"> </a></h4><ul><li><h1 id=10551-10569-winter-zhang>10551. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).<a class=headerlink href=../amp/#10551-10569-winter-zhang title="Permanent link"> </a></h1></li></ul><h3 id=clickhouse-release-v20-3-8-53-2020-04-23>ClickHouse release v20.3.8.53, 2020-04-23<a class=headerlink href=../amp/#clickhouse-release-v20-3-8-53-2020-04-23 title="Permanent link"> </a></h3><h4 id=bug-fix_9>Bug Fix<a class=headerlink href=../amp/#bug-fix_9 title="Permanent link"> </a></h4><ul><li>Fixed wrong behaviour of datetime functions for timezones that has altered between positive and negative offsets from UTC (e.g. Pacific/Kiritimati). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7202 rel="external nofollow noreferrer" target=_blank>#7202</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10369 rel="external nofollow noreferrer" target=_blank>#10369</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix possible segfault with <code class=syntax>distributed_group_by_no_merge</code> enabled (introduced in 20.3.7.46 by <a href=https://github.com/ClickHouse/ClickHouse/issues/10131 rel="external nofollow noreferrer" target=_blank>#10131</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10399 rel="external nofollow noreferrer" target=_blank>#10399</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix wrong flattening of <code class=syntax>Array(Tuple(...))</code> data types. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10259 rel="external nofollow noreferrer" target=_blank>#10259</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10390 rel="external nofollow noreferrer" target=_blank>#10390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Drop disks reservation in Aggregator. This fixes bug in disk space reservation, which may cause big external aggregation to fail even if it could be completed successfully <a href=https://github.com/ClickHouse/ClickHouse/pull/10375 rel="external nofollow noreferrer" target=_blank>#10375</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fixed <code class=syntax>DROP</code> vs <code class=syntax>OPTIMIZE</code> race in <code class=syntax>ReplicatedMergeTree</code>. <code class=syntax>DROP</code> could left some garbage in replica path in ZooKeeper if there was concurrent <code class=syntax>OPTIMIZE</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10312 rel="external nofollow noreferrer" target=_blank>#10312</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix bug when server cannot attach table after column default was altered. <a href=https://github.com/ClickHouse/ClickHouse/pull/10441 rel="external nofollow noreferrer" target=_blank>#10441</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Do not remove metadata directory when attach database fails before loading tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10442 rel="external nofollow noreferrer" target=_blank>#10442</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Fixed several bugs when some data was inserted with quorum, then deleted somehow (DROP PARTITION, TTL) and this leaded to the stuck of INSERTs or false-positive exceptions in SELECTs. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9946 rel="external nofollow noreferrer" target=_blank>#9946</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10188 rel="external nofollow noreferrer" target=_blank>#10188</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Fix possible <code class=syntax>Pipeline stuck</code> error in <code class=syntax>ConcatProcessor</code> which could have happened in remote query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10381 rel="external nofollow noreferrer" target=_blank>#10381</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed wrong behavior in HashTable that caused compilation error when trying to read HashMap from buffer. <a href=https://github.com/ClickHouse/ClickHouse/pull/10386 rel="external nofollow noreferrer" target=_blank>#10386</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>)</li><li>Allow to use <code class=syntax>count(*)</code> with multiple JOINs. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9853 rel="external nofollow noreferrer" target=_blank>#9853</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10291 rel="external nofollow noreferrer" target=_blank>#10291</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Prefer <code class=syntax>fallback_to_stale_replicas</code> over <code class=syntax>skip_unavailable_shards</code>, otherwise when both settings specified and there are no up-to-date replicas the query will fail (patch from @alex-zaitsev). Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/2564 rel="external nofollow noreferrer" target=_blank>#2564</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10422 rel="external nofollow noreferrer" target=_blank>#10422</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix the issue when a query with ARRAY JOIN, ORDER BY and LIMIT may return incomplete result. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10226 rel="external nofollow noreferrer" target=_blank>#10226</a>. Author: <a href=https://github.com/VadimPlh rel="external nofollow noreferrer" target=_blank>Vadim Plakhtinskiy</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10427 rel="external nofollow noreferrer" target=_blank>#10427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Check the number and type of arguments when creating BloomFilter index <a href=https://github.com/ClickHouse/ClickHouse/issues/9623 rel="external nofollow noreferrer" target=_blank>#9623</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10431 rel="external nofollow noreferrer" target=_blank>#10431</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li></ul><h4 id=performance-improvement_3>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_3 title="Permanent link"> </a></h4><ul><li>Improved performance of queries with explicitly defined sets at right side of <code class=syntax>IN</code> operator and tuples in the left side. This fixes performance regression in version 20.3. <a href=https://github.com/ClickHouse/ClickHouse/pull/9740 rel="external nofollow noreferrer" target=_blank>#9740</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/10385 rel="external nofollow noreferrer" target=_blank>#10385</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li></ul><h3 id=clickhouse-release-v20-3-7-46-2020-04-17>ClickHouse release v20.3.7.46, 2020-04-17<a class=headerlink href=../amp/#clickhouse-release-v20-3-7-46-2020-04-17 title="Permanent link"> </a></h3><h4 id=bug-fix_10>Bug Fix<a class=headerlink href=../amp/#bug-fix_10 title="Permanent link"> </a></h4><ul><li>Fix <code class=syntax>Logical error: CROSS JOIN has expressions</code> error for queries with comma and names joins mix. <a href=https://github.com/ClickHouse/ClickHouse/pull/10311 rel="external nofollow noreferrer" target=_blank>#10311</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix queries with <code class=syntax>max_bytes_before_external_group_by</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10302 rel="external nofollow noreferrer" target=_blank>#10302</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix move-to-prewhere optimization in presense of arrayJoin functions (in certain cases). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10092 rel="external nofollow noreferrer" target=_blank>#10092</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10195 rel="external nofollow noreferrer" target=_blank>#10195</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code class=syntax>allow_nondeterministic_mutations</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10186 rel="external nofollow noreferrer" target=_blank>#10186</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li></ul><h3 id=clickhouse-release-v20-3-6-40-2020-04-16>ClickHouse release v20.3.6.40, 2020-04-16<a class=headerlink href=../amp/#clickhouse-release-v20-3-6-40-2020-04-16 title="Permanent link"> </a></h3><h4 id=new-feature_3>New Feature<a class=headerlink href=../amp/#new-feature_3 title="Permanent link"> </a></h4><ul><li>Added function <code class=syntax>isConstant</code>. This function checks whether its argument is constant expression and returns 1 or 0. It is intended for development, debugging and demonstration purposes. <a href=https://github.com/ClickHouse/ClickHouse/pull/10198 rel="external nofollow noreferrer" target=_blank>#10198</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li></ul><h4 id=bug-fix_11>Bug Fix<a class=headerlink href=../amp/#bug-fix_11 title="Permanent link"> </a></h4><ul><li>Fix error <code class=syntax>Pipeline stuck</code> with <code class=syntax>max_rows_to_group_by</code> and <code class=syntax>group_by_overflow_mode = 'break'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10279 rel="external nofollow noreferrer" target=_blank>#10279</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix rare possible exception <code class=syntax>Cannot drain connections: cancel first</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10239 rel="external nofollow noreferrer" target=_blank>#10239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed bug where ClickHouse would throw "Unknown function lambda." error message when user tries to run ALTER UPDATE/DELETE on tables with ENGINE = Replicated*. Check for nondeterministic functions now handles lambda expressions correctly. <a href=https://github.com/ClickHouse/ClickHouse/pull/10237 rel="external nofollow noreferrer" target=_blank>#10237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li><li>Fixed "generateRandom" function for Date type. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9973 rel="external nofollow noreferrer" target=_blank>#9973</a>. Fix an edge case when dates with year 2106 are inserted to MergeTree tables with old-style partitioning but partitions are named with year 1970. <a href=https://github.com/ClickHouse/ClickHouse/pull/10218 rel="external nofollow noreferrer" target=_blank>#10218</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Convert types if the table definition of a View does not correspond to the SELECT query. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10180 rel="external nofollow noreferrer" target=_blank>#10180</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/10022 rel="external nofollow noreferrer" target=_blank>#10022</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10217 rel="external nofollow noreferrer" target=_blank>#10217</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix <code class=syntax>parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10082 rel="external nofollow noreferrer" target=_blank>#10082</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10214 rel="external nofollow noreferrer" target=_blank>#10214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/10207 rel="external nofollow noreferrer" target=_blank>#10207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix possible inifinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code class=syntax>system.numbers</code> or <code class=syntax>system.zeros</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10206 rel="external nofollow noreferrer" target=_blank>#10206</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix using the current database for access checking when the database isn't specified. <a href=https://github.com/ClickHouse/ClickHouse/pull/10192 rel="external nofollow noreferrer" target=_blank>#10192</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Convert blocks if structure does not match on INSERT into Distributed(). <a href=https://github.com/ClickHouse/ClickHouse/pull/10135 rel="external nofollow noreferrer" target=_blank>#10135</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix possible incorrect result for extremes in processors pipeline. <a href=https://github.com/ClickHouse/ClickHouse/pull/10131 rel="external nofollow noreferrer" target=_blank>#10131</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix some kinds of alters with compact parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/10130 rel="external nofollow noreferrer" target=_blank>#10130</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix incorrect <code class=syntax>index_granularity_bytes</code> check while creating new replica. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10098 rel="external nofollow noreferrer" target=_blank>#10098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10121 rel="external nofollow noreferrer" target=_blank>#10121</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix SIGSEGV on INSERT into Distributed table when its structure differs from the underlying tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10105 rel="external nofollow noreferrer" target=_blank>#10105</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix possible rows loss for queries with <code class=syntax>JOIN</code> and <code class=syntax>UNION ALL</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9826 rel="external nofollow noreferrer" target=_blank>#9826</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10113 rel="external nofollow noreferrer" target=_blank>#10113</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10099 rel="external nofollow noreferrer" target=_blank>#10099</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed replicated tables startup when updating from an old ClickHouse version where <code class=syntax>/table/replicas/replica_name/metadata</code> node doesn't exist. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10037 rel="external nofollow noreferrer" target=_blank>#10037</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10095 rel="external nofollow noreferrer" target=_blank>#10095</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Add some arguments check and support identifier arguments for MySQL Database Engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10077 rel="external nofollow noreferrer" target=_blank>#10077</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Fix bug in clickhouse dictionary source from localhost clickhouse server. The bug may lead to memory corruption if types in dictionary and source are not compatible. <a href=https://github.com/ClickHouse/ClickHouse/pull/10071 rel="external nofollow noreferrer" target=_blank>#10071</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix bug in <code class=syntax>CHECK TABLE</code> query when table contain skip indices. <a href=https://github.com/ClickHouse/ClickHouse/pull/10068 rel="external nofollow noreferrer" target=_blank>#10068</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix error <code class=syntax>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code class=syntax>distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with different level from different shards (mixed single and two level aggregation). <a href=https://github.com/ClickHouse/ClickHouse/pull/10063 rel="external nofollow noreferrer" target=_blank>#10063</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix a segmentation fault that could occur in GROUP BY over string keys containing trailing zero bytes (<a href=https://github.com/ClickHouse/ClickHouse/issues/8636 rel="external nofollow noreferrer" target=_blank>#8636</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8925 rel="external nofollow noreferrer" target=_blank>#8925</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10025 rel="external nofollow noreferrer" target=_blank>#10025</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li><li>Fix the number of threads used for remote query execution (performance regression, since 20.3). This happened when query from <code class=syntax>Distributed</code> table was executed simultaneously on local and remote shards. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9965 rel="external nofollow noreferrer" target=_blank>#9965</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9971 rel="external nofollow noreferrer" target=_blank>#9971</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix bug in which the necessary tables weren't retrieved at one of the processing stages of queries to some databases. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9699 rel="external nofollow noreferrer" target=_blank>#9699</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9949 rel="external nofollow noreferrer" target=_blank>#9949</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>).</li><li>Fix 'Not found column in block' error when <code class=syntax>JOIN</code> appears with <code class=syntax>TOTALS</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9839 rel="external nofollow noreferrer" target=_blank>#9839</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9939 rel="external nofollow noreferrer" target=_blank>#9939</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix a bug with <code class=syntax>ON CLUSTER</code> DDL queries freezing on server startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/9927 rel="external nofollow noreferrer" target=_blank>#9927</a> (<a href=https://github.com/garneja rel="external nofollow noreferrer" target=_blank>Gagan Arneja</a>).</li><li>Fix parsing multiple hosts set in the CREATE USER command, e.g. <code class=syntax>CREATE USER user6 HOST NAME REGEXP 'lo.?*host', NAME REGEXP 'lo*host'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9924 rel="external nofollow noreferrer" target=_blank>#9924</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix <code class=syntax>TRUNCATE</code> for Join table engine (<a href=https://github.com/ClickHouse/ClickHouse/issues/9917 rel="external nofollow noreferrer" target=_blank>#9917</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9920 rel="external nofollow noreferrer" target=_blank>#9920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix "scalar doesn't exist" error in ALTERs (<a href=https://github.com/ClickHouse/ClickHouse/issues/9878 rel="external nofollow noreferrer" target=_blank>#9878</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9904 rel="external nofollow noreferrer" target=_blank>#9904</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix race condition between drop and optimize in <code class=syntax>ReplicatedMergeTree</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9901 rel="external nofollow noreferrer" target=_blank>#9901</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix error with qualified names in <code class=syntax>distributed_product_mode='local'</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4756 rel="external nofollow noreferrer" target=_blank>#4756</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9891 rel="external nofollow noreferrer" target=_blank>#9891</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix calculating grants for introspection functions from the setting 'allow_introspection_functions'. <a href=https://github.com/ClickHouse/ClickHouse/pull/9840 rel="external nofollow noreferrer" target=_blank>#9840</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li></ul><h4 id=build-testing-packaging-improvement_6>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_6 title="Permanent link"> </a></h4><ul><li>Fix integration test <code class=syntax>test_settings_constraints</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9962 rel="external nofollow noreferrer" target=_blank>#9962</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Removed dependency on <code class=syntax>clock_getres</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9833 rel="external nofollow noreferrer" target=_blank>#9833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li></ul><h3 id=clickhouse-release-v20-3-5-21-2020-03-27>ClickHouse release v20.3.5.21, 2020-03-27<a class=headerlink href=../amp/#clickhouse-release-v20-3-5-21-2020-03-27 title="Permanent link"> </a></h3><h4 id=bug-fix_12>Bug Fix<a class=headerlink href=../amp/#bug-fix_12 title="Permanent link"> </a></h4><ul><li>Fix 'Different expressions with the same alias' error when query has PREWHERE and WHERE on distributed table and <code class=syntax>SET distributed_product_mode = 'local'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9871 rel="external nofollow noreferrer" target=_blank>#9871</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9850 rel="external nofollow noreferrer" target=_blank>#9850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9860 rel="external nofollow noreferrer" target=_blank>#9860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>For INSERT queries shard now clamps the settings got from the initiator to the shard's constaints instead of throwing an exception. This fix allows to send INSERT queries to a shard with another constraints. This change improves fix <a href=https://github.com/ClickHouse/ClickHouse/issues/9447 rel="external nofollow noreferrer" target=_blank>#9447</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9852 rel="external nofollow noreferrer" target=_blank>#9852</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix 'COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query' error in case of subqueries with COMMA JOIN out of tables lists (i.e. in WHERE). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9782 rel="external nofollow noreferrer" target=_blank>#9782</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9830 rel="external nofollow noreferrer" target=_blank>#9830</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix possible exception <code class=syntax>Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code class=syntax>JOIN</code> in case if right joined table had zero rows. Example: <code class=syntax>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9777 rel="external nofollow noreferrer" target=_blank>#9777</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9823 rel="external nofollow noreferrer" target=_blank>#9823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix SIGSEGV with optimize_skip_unused_shards when type cannot be converted. <a href=https://github.com/ClickHouse/ClickHouse/pull/9804 rel="external nofollow noreferrer" target=_blank>#9804</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix broken <code class=syntax>ALTER TABLE DELETE COLUMN</code> query for compact parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/9779 rel="external nofollow noreferrer" target=_blank>#9779</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix max_distributed_connections (w/ and w/o Processors). <a href=https://github.com/ClickHouse/ClickHouse/pull/9673 rel="external nofollow noreferrer" target=_blank>#9673</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed a few cases when timezone of the function argument wasn't used properly. <a href=https://github.com/ClickHouse/ClickHouse/pull/9574 rel="external nofollow noreferrer" target=_blank>#9574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li></ul><h4 id=improvement_2>Improvement<a class=headerlink href=../amp/#improvement_2 title="Permanent link"> </a></h4><ul><li>Remove order by stage from mutations because we read from a single ordered part in a single thread. Also add check that the order of rows in mutation is ordered in sorting key order and this order is not violated. <a href=https://github.com/ClickHouse/ClickHouse/pull/9886 rel="external nofollow noreferrer" target=_blank>#9886</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li></ul><h3 id=clickhouse-release-v20-3-4-10-2020-03-20>ClickHouse release v20.3.4.10, 2020-03-20<a class=headerlink href=../amp/#clickhouse-release-v20-3-4-10-2020-03-20 title="Permanent link"> </a></h3><h4 id=bug-fix_13>Bug Fix<a class=headerlink href=../amp/#bug-fix_13 title="Permanent link"> </a></h4><ul><li>This release also contains all bug fixes from 20.1.8.41</li><li>Fix missing <code class=syntax>rows_before_limit_at_least</code> for queries over http (with processors pipeline). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9730 rel="external nofollow noreferrer" target=_blank>#9730</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9757 rel="external nofollow noreferrer" target=_blank>#9757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li></ul><h3 id=clickhouse-release-v20-3-3-6-2020-03-17>ClickHouse release v20.3.3.6, 2020-03-17<a class=headerlink href=../amp/#clickhouse-release-v20-3-3-6-2020-03-17 title="Permanent link"> </a></h3><h4 id=bug-fix_14>Bug Fix<a class=headerlink href=../amp/#bug-fix_14 title="Permanent link"> </a></h4><ul><li>This release also contains all bug fixes from 20.1.7.38</li><li>Fix bug in a replication that doesn't allow replication to work if the user has executed mutations on the previous version. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9645 rel="external nofollow noreferrer" target=_blank>#9645</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9652 rel="external nofollow noreferrer" target=_blank>#9652</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>). It makes version 20.3 backward compatible again.</li><li>Add setting <code class=syntax>use_compact_format_in_distributed_parts_names</code> which allows to write files for <code class=syntax>INSERT</code> queries into <code class=syntax>Distributed</code> table with more compact format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9647 rel="external nofollow noreferrer" target=_blank>#9647</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9653 rel="external nofollow noreferrer" target=_blank>#9653</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>). It makes version 20.3 backward compatible again.</li></ul><h3 id=clickhouse-release-v20-3-2-1-2020-03-12>ClickHouse release v20.3.2.1, 2020-03-12<a class=headerlink href=../amp/#clickhouse-release-v20-3-2-1-2020-03-12 title="Permanent link"> </a></h3><h4 id=backward-incompatible-change_2>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change_2 title="Permanent link"> </a></h4><ul><li>Fixed the issue <code class=syntax>file name too long</code> when sending data for <code class=syntax>Distributed</code> tables for a large number of replicas. Fixed the issue that replica credentials were exposed in the server log. The format of directory name on disk was changed to <code class=syntax>[shard{shard_index}[_replica{replica_index}]]</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8911 rel="external nofollow noreferrer" target=_blank>#8911</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>) After you upgrade to the new version, you will not be able to downgrade without manual intervention, because old server version does not recognize the new directory format. If you want to downgrade, you have to manually rename the corresponding directories to the old format. This change is relevant only if you have used asynchronous <code class=syntax>INSERT</code>s to <code class=syntax>Distributed</code> tables. In the version 20.3.3 we will introduce a setting that will allow you to enable the new format gradually.</li><li>Changed the format of replication log entries for mutation commands. You have to wait for old mutations to process before installing the new version.</li><li>Implement simple memory profiler that dumps stacktraces to <code class=syntax>system.trace_log</code> every N bytes over soft allocation limit <a href=https://github.com/ClickHouse/ClickHouse/pull/8765 rel="external nofollow noreferrer" target=_blank>#8765</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/9472 rel="external nofollow noreferrer" target=_blank>#9472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) The column of <code class=syntax>system.trace_log</code> was renamed from <code class=syntax>timer_type</code> to <code class=syntax>trace_type</code>. This will require changes in third-party performance analysis and flamegraph processing tools.</li><li>Use OS thread id everywhere instead of internal thread number. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7477 rel="external nofollow noreferrer" target=_blank>#7477</a> Old <code class=syntax>clickhouse-client</code> cannot receive logs that are send from the server when the setting <code class=syntax>send_logs_level</code> is enabled, because the names and types of the structured log messages were changed. On the other hand, different server versions can send logs with different types to each other. When you don't use the <code class=syntax>send_logs_level</code> setting, you should not care. <a href=https://github.com/ClickHouse/ClickHouse/pull/8954 rel="external nofollow noreferrer" target=_blank>#8954</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove <code class=syntax>indexHint</code> function <a href=https://github.com/ClickHouse/ClickHouse/pull/9542 rel="external nofollow noreferrer" target=_blank>#9542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove <code class=syntax>findClusterIndex</code>, <code class=syntax>findClusterValue</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8641 rel="external nofollow noreferrer" target=_blank>#8641</a>. If you were using these functions, send an email to <code class=syntax>clickhouse-feedback@yandex-team.com</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9543 rel="external nofollow noreferrer" target=_blank>#9543</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Now it's not allowed to create columns or add columns with <code class=syntax>SELECT</code> subquery as default expression. <a href=https://github.com/ClickHouse/ClickHouse/pull/9481 rel="external nofollow noreferrer" target=_blank>#9481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Require aliases for subqueries in JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/9274 rel="external nofollow noreferrer" target=_blank>#9274</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Improved <code class=syntax>ALTER MODIFY/ADD</code> queries logic. Now you cannot <code class=syntax>ADD</code> column without type, <code class=syntax>MODIFY</code> default expression doesn't change type of column and <code class=syntax>MODIFY</code> type doesn't loose default expression value. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8669 rel="external nofollow noreferrer" target=_blank>#8669</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9227 rel="external nofollow noreferrer" target=_blank>#9227</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Require server to be restarted to apply the changes in logging configuration. This is a temporary workaround to avoid the bug where the server logs to a deleted log file (see <a href=https://github.com/ClickHouse/ClickHouse/issues/8696 rel="external nofollow noreferrer" target=_blank>#8696</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8707 rel="external nofollow noreferrer" target=_blank>#8707</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>The setting <code class=syntax>experimental_use_processors</code> is enabled by default. This setting enables usage of the new query pipeline. This is internal refactoring and we expect no visible changes. If you will see any issues, set it to back zero. <a href=https://github.com/ClickHouse/ClickHouse/pull/8768 rel="external nofollow noreferrer" target=_blank>#8768</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h4 id=new-feature_4>New Feature<a class=headerlink href=../amp/#new-feature_4 title="Permanent link"> </a></h4><ul><li>Add <code class=syntax>Avro</code> and <code class=syntax>AvroConfluent</code> input/output formats <a href=https://github.com/ClickHouse/ClickHouse/pull/8571 rel="external nofollow noreferrer" target=_blank>#8571</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8957 rel="external nofollow noreferrer" target=_blank>#8957</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8717 rel="external nofollow noreferrer" target=_blank>#8717</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Multi-threaded and non-blocking updates of expired keys in <code class=syntax>cache</code> dictionaries (with optional permission to read old ones). <a href=https://github.com/ClickHouse/ClickHouse/pull/8303 rel="external nofollow noreferrer" target=_blank>#8303</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Add query <code class=syntax>ALTER ... MATERIALIZE TTL</code>. It runs mutation that forces to remove expired data by TTL and recalculates meta-information about TTL in all parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/8775 rel="external nofollow noreferrer" target=_blank>#8775</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Switch from HashJoin to MergeJoin (on disk) if needed <a href=https://github.com/ClickHouse/ClickHouse/pull/9082 rel="external nofollow noreferrer" target=_blank>#9082</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Added <code class=syntax>MOVE PARTITION</code> command for <code class=syntax>ALTER TABLE</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/4729 rel="external nofollow noreferrer" target=_blank>#4729</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6168 rel="external nofollow noreferrer" target=_blank>#6168</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>Reloading storage configuration from configuration file on the fly. <a href=https://github.com/ClickHouse/ClickHouse/pull/8594 rel="external nofollow noreferrer" target=_blank>#8594</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Allowed to change <code class=syntax>storage_policy</code> to not less rich one. <a href=https://github.com/ClickHouse/ClickHouse/pull/8107 rel="external nofollow noreferrer" target=_blank>#8107</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Added support for globs/wildcards for S3 storage and table function. <a href=https://github.com/ClickHouse/ClickHouse/pull/8851 rel="external nofollow noreferrer" target=_blank>#8851</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Implement <code class=syntax>bitAnd</code>, <code class=syntax>bitOr</code>, <code class=syntax>bitXor</code>, <code class=syntax>bitNot</code> for <code class=syntax>FixedString(N)</code> datatype. <a href=https://github.com/ClickHouse/ClickHouse/pull/9091 rel="external nofollow noreferrer" target=_blank>#9091</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>Added function <code class=syntax>bitCount</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8702 rel="external nofollow noreferrer" target=_blank>#8702</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8708 rel="external nofollow noreferrer" target=_blank>#8708</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8749 rel="external nofollow noreferrer" target=_blank>#8749</a> (<a href=https://github.com/ikopylov rel="external nofollow noreferrer" target=_blank>ikopylov</a>)</li><li>Add <code class=syntax>generateRandom</code> table function to generate random rows with given schema. Allows to populate arbitrary test table with data. <a href=https://github.com/ClickHouse/ClickHouse/pull/8994 rel="external nofollow noreferrer" target=_blank>#8994</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li><li><code class=syntax>JSONEachRowFormat</code>: support special case when objects enclosed in top-level array. <a href=https://github.com/ClickHouse/ClickHouse/pull/8860 rel="external nofollow noreferrer" target=_blank>#8860</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li><li>Now it's possible to create a column with <code class=syntax>DEFAULT</code> expression which depends on a column with default <code class=syntax>ALIAS</code> expression. <a href=https://github.com/ClickHouse/ClickHouse/pull/9489 rel="external nofollow noreferrer" target=_blank>#9489</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Allow to specify <code class=syntax>--limit</code> more than the source data size in <code class=syntax>clickhouse-obfuscator</code>. The data will repeat itself with different random seed. <a href=https://github.com/ClickHouse/ClickHouse/pull/9155 rel="external nofollow noreferrer" target=_blank>#9155</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added <code class=syntax>groupArraySample</code> function (similar to <code class=syntax>groupArray</code>) with reservior sampling algorithm. <a href=https://github.com/ClickHouse/ClickHouse/pull/8286 rel="external nofollow noreferrer" target=_blank>#8286</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Now you can monitor the size of update queue in <code class=syntax>cache</code>/<code class=syntax>complex_key_cache</code> dictionaries via system metrics. <a href=https://github.com/ClickHouse/ClickHouse/pull/9413 rel="external nofollow noreferrer" target=_blank>#9413</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Allow to use CRLF as a line separator in CSV output format with setting <code class=syntax>output_format_csv_crlf_end_of_line</code> is set to 1 <a href=https://github.com/ClickHouse/ClickHouse/pull/8934 rel="external nofollow noreferrer" target=_blank>#8934</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8935 rel="external nofollow noreferrer" target=_blank>#8935</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8963 rel="external nofollow noreferrer" target=_blank>#8963</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Implement more functions of the <a href=https://github.com/uber/h3 rel="external nofollow noreferrer" target=_blank>H3</a> API: <code class=syntax>h3GetBaseCell</code>, <code class=syntax>h3HexAreaM2</code>, <code class=syntax>h3IndexesAreNeighbors</code>, <code class=syntax>h3ToChildren</code>, <code class=syntax>h3ToString</code> and <code class=syntax>stringToH3</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/8938 rel="external nofollow noreferrer" target=_blank>#8938</a> (<a href=https://github.com/nmandery rel="external nofollow noreferrer" target=_blank>Nico Mandery</a>)</li><li>New setting introduced: <code class=syntax>max_parser_depth</code> to control maximum stack size and allow large complex queries. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6681 rel="external nofollow noreferrer" target=_blank>#6681</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/7668 rel="external nofollow noreferrer" target=_blank>#7668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8647 rel="external nofollow noreferrer" target=_blank>#8647</a> (<a href=https://github.com/qMBQx8GH rel="external nofollow noreferrer" target=_blank>Maxim Smirnov</a>)</li><li>Add a setting <code class=syntax>force_optimize_skip_unused_shards</code> setting to throw if skipping of unused shards is not possible <a href=https://github.com/ClickHouse/ClickHouse/pull/8805 rel="external nofollow noreferrer" target=_blank>#8805</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Allow to configure multiple disks/volumes for storing data for send in <code class=syntax>Distributed</code> engine <a href=https://github.com/ClickHouse/ClickHouse/pull/8756 rel="external nofollow noreferrer" target=_blank>#8756</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Support storage policy (<code class=syntax>&lt;tmp_policy&gt;</code>) for storing temporary data. <a href=https://github.com/ClickHouse/ClickHouse/pull/8750 rel="external nofollow noreferrer" target=_blank>#8750</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Added <code class=syntax>X-ClickHouse-Exception-Code</code> HTTP header that is set if exception was thrown before sending data. This implements <a href=https://github.com/ClickHouse/ClickHouse/issues/4971 rel="external nofollow noreferrer" target=_blank>#4971</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8786 rel="external nofollow noreferrer" target=_blank>#8786</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Added function <code class=syntax>ifNotFinite</code>. It is just a syntactic sugar: <code class=syntax>ifNotFinite(x, y) = isFinite(x) ? x : y</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8710 rel="external nofollow noreferrer" target=_blank>#8710</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added <code class=syntax>last_successful_update_time</code> column in <code class=syntax>system.dictionaries</code> table <a href=https://github.com/ClickHouse/ClickHouse/pull/9394 rel="external nofollow noreferrer" target=_blank>#9394</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Add <code class=syntax>blockSerializedSize</code> function (size on disk without compression) <a href=https://github.com/ClickHouse/ClickHouse/pull/8952 rel="external nofollow noreferrer" target=_blank>#8952</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Add function <code class=syntax>moduloOrZero</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9358 rel="external nofollow noreferrer" target=_blank>#9358</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Added system tables <code class=syntax>system.zeros</code> and <code class=syntax>system.zeros_mt</code> as well as tale functions <code class=syntax>zeros()</code> and <code class=syntax>zeros_mt()</code>. Tables (and table functions) contain single column with name <code class=syntax>zero</code> and type <code class=syntax>UInt8</code>. This column contains zeros. It is needed for test purposes as the fastest method to generate many rows. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6604 rel="external nofollow noreferrer" target=_blank>#6604</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9593 rel="external nofollow noreferrer" target=_blank>#9593</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li></ul><h4 id=experimental-feature_2>Experimental Feature<a class=headerlink href=../amp/#experimental-feature_2 title="Permanent link"> </a></h4><ul><li>Add new compact format of parts in <code class=syntax>MergeTree</code>-family tables in which all columns are stored in one file. It helps to increase performance of small and frequent inserts. The old format (one file per column) is now called wide. Data storing format is controlled by settings <code class=syntax>min_bytes_for_wide_part</code> and <code class=syntax>min_rows_for_wide_part</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8290 rel="external nofollow noreferrer" target=_blank>#8290</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Support for S3 storage for <code class=syntax>Log</code>, <code class=syntax>TinyLog</code> and <code class=syntax>StripeLog</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/8862 rel="external nofollow noreferrer" target=_blank>#8862</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li></ul><h4 id=bug-fix_15>Bug Fix<a class=headerlink href=../amp/#bug-fix_15 title="Permanent link"> </a></h4><ul><li>Fixed inconsistent whitespaces in log messages. <a href=https://github.com/ClickHouse/ClickHouse/pull/9322 rel="external nofollow noreferrer" target=_blank>#9322</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix bug in which arrays of unnamed tuples were flattened as Nested structures on table creation. <a href=https://github.com/ClickHouse/ClickHouse/pull/8866 rel="external nofollow noreferrer" target=_blank>#8866</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>)</li><li>Fixed the issue when "Too many open files" error may happen if there are too many files matching glob pattern in <code class=syntax>File</code> table or <code class=syntax>file</code> table function. Now files are opened lazily. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8857 rel="external nofollow noreferrer" target=_blank>#8857</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8861 rel="external nofollow noreferrer" target=_blank>#8861</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>DROP TEMPORARY TABLE now drops only temporary table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8907 rel="external nofollow noreferrer" target=_blank>#8907</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Remove outdated partition when we shutdown the server or DETACH/ATTACH a table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8602 rel="external nofollow noreferrer" target=_blank>#8602</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>For how the default disk calculates the free space from <code class=syntax>data</code> subdirectory. Fixed the issue when the amount of free space is not calculated correctly if the <code class=syntax>data</code> directory is mounted to a separate device (rare case). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7441 rel="external nofollow noreferrer" target=_blank>#7441</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9257 rel="external nofollow noreferrer" target=_blank>#9257</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Allow comma (cross) join with IN () inside. <a href=https://github.com/ClickHouse/ClickHouse/pull/9251 rel="external nofollow noreferrer" target=_blank>#9251</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Allow to rewrite CROSS to INNER JOIN if there's [NOT] LIKE operator in WHERE section. <a href=https://github.com/ClickHouse/ClickHouse/pull/9229 rel="external nofollow noreferrer" target=_blank>#9229</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix possible incorrect result after <code class=syntax>GROUP BY</code> with enabled setting <code class=syntax>distributed_aggregation_memory_efficient</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9134 rel="external nofollow noreferrer" target=_blank>#9134</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9289 rel="external nofollow noreferrer" target=_blank>#9289</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Found keys were counted as missed in metrics of cache dictionaries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9411 rel="external nofollow noreferrer" target=_blank>#9411</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Fix replication protocol incompatibility introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/8598 rel="external nofollow noreferrer" target=_blank>#8598</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9412 rel="external nofollow noreferrer" target=_blank>#9412</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed race condition on <code class=syntax>queue_task_handle</code> at the startup of <code class=syntax>ReplicatedMergeTree</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/9552 rel="external nofollow noreferrer" target=_blank>#9552</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>The token <code class=syntax>NOT</code> didn't work in <code class=syntax>SHOW TABLES NOT LIKE</code> query <a href=https://github.com/ClickHouse/ClickHouse/issues/8727 rel="external nofollow noreferrer" target=_blank>#8727</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8940 rel="external nofollow noreferrer" target=_blank>#8940</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added range check to function <code class=syntax>h3EdgeLengthM</code>. Without this check, buffer overflow is possible. <a href=https://github.com/ClickHouse/ClickHouse/pull/8945 rel="external nofollow noreferrer" target=_blank>#8945</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed up a bug in batched calculations of ternary logical OPs on multiple arguments (more than 10). <a href=https://github.com/ClickHouse/ClickHouse/pull/8718 rel="external nofollow noreferrer" target=_blank>#8718</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Fix error of PREWHERE optimization, which could lead to segfaults or <code class=syntax>Inconsistent number of columns got from MergeTreeRangeReader</code> exception. <a href=https://github.com/ClickHouse/ClickHouse/pull/9024 rel="external nofollow noreferrer" target=_blank>#9024</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix unexpected <code class=syntax>Timeout exceeded while reading from socket</code> exception, which randomly happens on secure connection before timeout actually exceeded and when query profiler is enabled. Also add <code class=syntax>connect_timeout_with_failover_secure_ms</code> settings (default 100ms), which is similar to <code class=syntax>connect_timeout_with_failover_ms</code>, but is used for secure connections (because SSL handshake is slower, than ordinary TCP connection) <a href=https://github.com/ClickHouse/ClickHouse/pull/9026 rel="external nofollow noreferrer" target=_blank>#9026</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix bug with mutations finalization, when mutation may hang in state with <code class=syntax>parts_to_do=0</code> and <code class=syntax>is_done=0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9022 rel="external nofollow noreferrer" target=_blank>#9022</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Use new ANY JOIN logic with <code class=syntax>partial_merge_join</code> setting. It's possible to make <code class=syntax>ANY|ALL|SEMI LEFT</code> and <code class=syntax>ALL INNER</code> joins with <code class=syntax>partial_merge_join=1</code> now. <a href=https://github.com/ClickHouse/ClickHouse/pull/8932 rel="external nofollow noreferrer" target=_blank>#8932</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Shard now clamps the settings got from the initiator to the shard's constaints instead of throwing an exception. This fix allows to send queries to a shard with another constraints. <a href=https://github.com/ClickHouse/ClickHouse/pull/9447 rel="external nofollow noreferrer" target=_blank>#9447</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fixed memory management problem in <code class=syntax>MergeTreeReadPool</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8791 rel="external nofollow noreferrer" target=_blank>#8791</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix <code class=syntax>toDecimal*OrNull()</code> functions family when called with string <code class=syntax>e</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8312 rel="external nofollow noreferrer" target=_blank>#8312</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8764 rel="external nofollow noreferrer" target=_blank>#8764</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Make sure that <code class=syntax>FORMAT Null</code> sends no data to the client. <a href=https://github.com/ClickHouse/ClickHouse/pull/8767 rel="external nofollow noreferrer" target=_blank>#8767</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Fix bug that timestamp in <code class=syntax>LiveViewBlockInputStream</code> will not updated. <code class=syntax>LIVE VIEW</code> is an experimental feature. <a href=https://github.com/ClickHouse/ClickHouse/pull/8644 rel="external nofollow noreferrer" target=_blank>#8644</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8625 rel="external nofollow noreferrer" target=_blank>#8625</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li><li>Fixed <code class=syntax>ALTER MODIFY TTL</code> wrong behavior which did not allow to delete old TTL expressions. <a href=https://github.com/ClickHouse/ClickHouse/pull/8422 rel="external nofollow noreferrer" target=_blank>#8422</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fixed UBSan report in MergeTreeIndexSet. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9250 rel="external nofollow noreferrer" target=_blank>#9250</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9365 rel="external nofollow noreferrer" target=_blank>#9365</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed the behaviour of <code class=syntax>match</code> and <code class=syntax>extract</code> functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9160 rel="external nofollow noreferrer" target=_blank>#9160</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9163 rel="external nofollow noreferrer" target=_blank>#9163</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/9345 rel="external nofollow noreferrer" target=_blank>#9345</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Avoid throwing from destructor in Apache Avro 3rd-party library. <a href=https://github.com/ClickHouse/ClickHouse/pull/9066 rel="external nofollow noreferrer" target=_blank>#9066</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li><li>Don't commit a batch polled from <code class=syntax>Kafka</code> partially as it can lead to holes in data. <a href=https://github.com/ClickHouse/ClickHouse/pull/8876 rel="external nofollow noreferrer" target=_blank>#8876</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fix <code class=syntax>joinGet</code> with nullable return types. <a href=https://github.com/ClickHouse/ClickHouse/issues/8919 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/8919</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9014 rel="external nofollow noreferrer" target=_blank>#9014</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Fix data incompatibility when compressed with <code class=syntax>T64</code> codec. <a href=https://github.com/ClickHouse/ClickHouse/pull/9016 rel="external nofollow noreferrer" target=_blank>#9016</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>) Fix data type ids in <code class=syntax>T64</code> compression codec that leads to wrong (de)compression in affected versions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9033 rel="external nofollow noreferrer" target=_blank>#9033</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Add setting <code class=syntax>enable_early_constant_folding</code> and disable it in some cases that leads to errors. <a href=https://github.com/ClickHouse/ClickHouse/pull/9010 rel="external nofollow noreferrer" target=_blank>#9010</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix pushdown predicate optimizer with VIEW and enable the test <a href=https://github.com/ClickHouse/ClickHouse/pull/9011 rel="external nofollow noreferrer" target=_blank>#9011</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Fix segfault in <code class=syntax>Merge</code> tables, that can happen when reading from <code class=syntax>File</code> storages <a href=https://github.com/ClickHouse/ClickHouse/pull/9387 rel="external nofollow noreferrer" target=_blank>#9387</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Added a check for storage policy in <code class=syntax>ATTACH PARTITION FROM</code>, <code class=syntax>REPLACE PARTITION</code>, <code class=syntax>MOVE TO TABLE</code>. Otherwise it could make data of part inaccessible after restart and prevent ClickHouse to start. <a href=https://github.com/ClickHouse/ClickHouse/pull/9383 rel="external nofollow noreferrer" target=_blank>#9383</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix alters if there is TTL set for table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8800 rel="external nofollow noreferrer" target=_blank>#8800</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix race condition that can happen when <code class=syntax>SYSTEM RELOAD ALL DICTIONARIES</code> is executed while some dictionary is being modified/added/removed. <a href=https://github.com/ClickHouse/ClickHouse/pull/8801 rel="external nofollow noreferrer" target=_blank>#8801</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>In previous versions <code class=syntax>Memory</code> database engine use empty data path, so tables are created in <code class=syntax>path</code> directory (e.g. <code class=syntax>/var/lib/clickhouse/</code>), not in data directory of database (e.g. <code class=syntax>/var/lib/clickhouse/db_name</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8753 rel="external nofollow noreferrer" target=_blank>#8753</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fixed wrong log messages about missing default disk or policy. <a href=https://github.com/ClickHouse/ClickHouse/pull/9530 rel="external nofollow noreferrer" target=_blank>#9530</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix not(has()) for the bloom_filter index of array types. <a href=https://github.com/ClickHouse/ClickHouse/pull/9407 rel="external nofollow noreferrer" target=_blank>#9407</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li><li>Allow first column(s) in a table with <code class=syntax>Log</code> engine be an alias <a href=https://github.com/ClickHouse/ClickHouse/pull/9231 rel="external nofollow noreferrer" target=_blank>#9231</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Fix order of ranges while reading from <code class=syntax>MergeTree</code> table in one thread. It could lead to exceptions from <code class=syntax>MergeTreeRangeReader</code> or wrong query results. <a href=https://github.com/ClickHouse/ClickHouse/pull/9050 rel="external nofollow noreferrer" target=_blank>#9050</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Make <code class=syntax>reinterpretAsFixedString</code> to return <code class=syntax>FixedString</code> instead of <code class=syntax>String</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9052 rel="external nofollow noreferrer" target=_blank>#9052</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li><li>Avoid extremely rare cases when the user can get wrong error message (<code class=syntax>Success</code> instead of detailed error description). <a href=https://github.com/ClickHouse/ClickHouse/pull/9457 rel="external nofollow noreferrer" target=_blank>#9457</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Do not crash when using <code class=syntax>Template</code> format with empty row template. <a href=https://github.com/ClickHouse/ClickHouse/pull/8785 rel="external nofollow noreferrer" target=_blank>#8785</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Metadata files for system tables could be created in wrong place <a href=https://github.com/ClickHouse/ClickHouse/pull/8653 rel="external nofollow noreferrer" target=_blank>#8653</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>) Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8581 rel="external nofollow noreferrer" target=_blank>#8581</a>.</li><li>Fix data race on exception_ptr in cache dictionary <a href=https://github.com/ClickHouse/ClickHouse/issues/8303 rel="external nofollow noreferrer" target=_blank>#8303</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9379 rel="external nofollow noreferrer" target=_blank>#9379</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Do not throw an exception for query <code class=syntax>ATTACH TABLE IF NOT EXISTS</code>. Previously it was thrown if table already exists, despite the <code class=syntax>IF NOT EXISTS</code> clause. <a href=https://github.com/ClickHouse/ClickHouse/pull/8967 rel="external nofollow noreferrer" target=_blank>#8967</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fixed missing closing paren in exception message. <a href=https://github.com/ClickHouse/ClickHouse/pull/8811 rel="external nofollow noreferrer" target=_blank>#8811</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Avoid message <code class=syntax>Possible deadlock avoided</code> at the startup of clickhouse-client in interactive mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/9455 rel="external nofollow noreferrer" target=_blank>#9455</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed the issue when padding at the end of base64 encoded value can be malformed. Update base64 library. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9491 rel="external nofollow noreferrer" target=_blank>#9491</a>, closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9492 rel="external nofollow noreferrer" target=_blank>#9492</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9500 rel="external nofollow noreferrer" target=_blank>#9500</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Prevent losing data in <code class=syntax>Kafka</code> in rare cases when exception happens after reading suffix but before commit. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9378 rel="external nofollow noreferrer" target=_blank>#9378</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9507 rel="external nofollow noreferrer" target=_blank>#9507</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fixed exception in <code class=syntax>DROP TABLE IF EXISTS</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/8663 rel="external nofollow noreferrer" target=_blank>#8663</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li><li>Fix crash when a user tries to <code class=syntax>ALTER MODIFY SETTING</code> for old-formated <code class=syntax>MergeTree</code> table engines family. <a href=https://github.com/ClickHouse/ClickHouse/pull/9435 rel="external nofollow noreferrer" target=_blank>#9435</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Support for UInt64 numbers that don't fit in Int64 in JSON-related functions. Update SIMDJSON to master. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9209 rel="external nofollow noreferrer" target=_blank>#9209</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9344 rel="external nofollow noreferrer" target=_blank>#9344</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed execution of inversed predicates when non-strictly monotinic functional index is used. <a href=https://github.com/ClickHouse/ClickHouse/pull/9223 rel="external nofollow noreferrer" target=_blank>#9223</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Don't try to fold <code class=syntax>IN</code> constant in <code class=syntax>GROUP BY</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/8868 rel="external nofollow noreferrer" target=_blank>#8868</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Fix bug in <code class=syntax>ALTER DELETE</code> mutations which leads to index corruption. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9019 rel="external nofollow noreferrer" target=_blank>#9019</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/8982 rel="external nofollow noreferrer" target=_blank>#8982</a>. Additionally fix extremely rare race conditions in <code class=syntax>ReplicatedMergeTree</code> <code class=syntax>ALTER</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9048 rel="external nofollow noreferrer" target=_blank>#9048</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>When the setting <code class=syntax>compile_expressions</code> is enabled, you can get <code class=syntax>unexpected column</code> in <code class=syntax>LLVMExecutableFunction</code> when we use <code class=syntax>Nullable</code> type <a href=https://github.com/ClickHouse/ClickHouse/pull/8910 rel="external nofollow noreferrer" target=_blank>#8910</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>Multiple fixes for <code class=syntax>Kafka</code> engine: 1) fix duplicates that were appearing during consumer group rebalance. 2) Fix rare 'holes' appeared when data were polled from several partitions with one poll and committed partially (now we always process / commit the whole polled block of messages). 3) Fix flushes by block size (before that only flushing by timeout was working properly). 4) better subscription procedure (with assignment feedback). 5) Make tests work faster (with default intervals and timeouts). Due to the fact that data was not flushed by block size before (as it should according to documentation), that PR may lead to some performance degradation with default settings (due to more often &amp; tinier flushes which are less optimal). If you encounter the performance issue after that change - please increase <code class=syntax>kafka_max_block_size</code> in the table to the bigger value ( for example <code class=syntax>CREATE TABLE ...Engine=Kafka ... SETTINGS ... kafka_max_block_size=524288</code>). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7259 rel="external nofollow noreferrer" target=_blank>#7259</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8917 rel="external nofollow noreferrer" target=_blank>#8917</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fix <code class=syntax>Parameter out of bound</code> exception in some queries after PREWHERE optimizations. <a href=https://github.com/ClickHouse/ClickHouse/pull/8914 rel="external nofollow noreferrer" target=_blank>#8914</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>)</li><li>Fixed the case of mixed-constness of arguments of function <code class=syntax>arrayZip</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8705 rel="external nofollow noreferrer" target=_blank>#8705</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>When executing <code class=syntax>CREATE</code> query, fold constant expressions in storage engine arguments. Replace empty database name with current database. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6508 rel="external nofollow noreferrer" target=_blank>#6508</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/3492 rel="external nofollow noreferrer" target=_blank>#3492</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9262 rel="external nofollow noreferrer" target=_blank>#9262</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Now it's not possible to create or add columns with simple cyclic aliases like <code class=syntax>a DEFAULT b, b DEFAULT a</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9603 rel="external nofollow noreferrer" target=_blank>#9603</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed a bug with double move which may corrupt original part. This is relevant if you use <code class=syntax>ALTER TABLE MOVE</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/8680 rel="external nofollow noreferrer" target=_blank>#8680</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Allow <code class=syntax>interval</code> identifier to correctly parse without backticks. Fixed issue when a query cannot be executed even if the <code class=syntax>interval</code> identifier is enclosed in backticks or double quotes. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9124 rel="external nofollow noreferrer" target=_blank>#9124</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9142 rel="external nofollow noreferrer" target=_blank>#9142</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed fuzz test and incorrect behaviour of <code class=syntax>bitTestAll</code>/<code class=syntax>bitTestAny</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9143 rel="external nofollow noreferrer" target=_blank>#9143</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix possible crash/wrong number of rows in <code class=syntax>LIMIT n WITH TIES</code> when there are a lot of rows equal to n'th row. <a href=https://github.com/ClickHouse/ClickHouse/pull/9464 rel="external nofollow noreferrer" target=_blank>#9464</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix mutations with parts written with enabled <code class=syntax>insert_quorum</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9463 rel="external nofollow noreferrer" target=_blank>#9463</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix data race at destruction of <code class=syntax>Poco::HTTPServer</code>. It could happen when server is started and immediately shut down. <a href=https://github.com/ClickHouse/ClickHouse/pull/9468 rel="external nofollow noreferrer" target=_blank>#9468</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix bug in which a misleading error message was shown when running <code class=syntax>SHOW CREATE TABLE a_table_that_does_not_exist</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8899 rel="external nofollow noreferrer" target=_blank>#8899</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>)</li><li>Fixed <code class=syntax>Parameters are out of bound</code> exception in some rare cases when we have a constant in the <code class=syntax>SELECT</code> clause when we have an <code class=syntax>ORDER BY</code> and a <code class=syntax>LIMIT</code> clause. <a href=https://github.com/ClickHouse/ClickHouse/pull/8892 rel="external nofollow noreferrer" target=_blank>#8892</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>Fix mutations finalization, when already done mutation can have status <code class=syntax>is_done=0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9217 rel="external nofollow noreferrer" target=_blank>#9217</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Prevent from executing <code class=syntax>ALTER ADD INDEX</code> for MergeTree tables with old syntax, because it doesn't work. <a href=https://github.com/ClickHouse/ClickHouse/pull/8822 rel="external nofollow noreferrer" target=_blank>#8822</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>During server startup do not access table, which <code class=syntax>LIVE VIEW</code> depends on, so server will be able to start. Also remove <code class=syntax>LIVE VIEW</code> dependencies when detaching <code class=syntax>LIVE VIEW</code>. <code class=syntax>LIVE VIEW</code> is an experimental feature. <a href=https://github.com/ClickHouse/ClickHouse/pull/8824 rel="external nofollow noreferrer" target=_blank>#8824</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix possible segfault in <code class=syntax>MergeTreeRangeReader</code>, while executing <code class=syntax>PREWHERE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9106 rel="external nofollow noreferrer" target=_blank>#9106</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix possible mismatched checksums with column TTLs. <a href=https://github.com/ClickHouse/ClickHouse/pull/9451 rel="external nofollow noreferrer" target=_blank>#9451</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fixed a bug when parts were not being moved in background by TTL rules in case when there is only one volume. <a href=https://github.com/ClickHouse/ClickHouse/pull/8672 rel="external nofollow noreferrer" target=_blank>#8672</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fixed the issue <code class=syntax>Method createColumn() is not implemented for data type Set</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7799 rel="external nofollow noreferrer" target=_blank>#7799</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8674 rel="external nofollow noreferrer" target=_blank>#8674</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Now we will try finalize mutations more frequently. <a href=https://github.com/ClickHouse/ClickHouse/pull/9427 rel="external nofollow noreferrer" target=_blank>#9427</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix <code class=syntax>intDiv</code> by minus one constant <a href=https://github.com/ClickHouse/ClickHouse/pull/9351 rel="external nofollow noreferrer" target=_blank>#9351</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Fix possible race condition in <code class=syntax>BlockIO</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9356 rel="external nofollow noreferrer" target=_blank>#9356</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix bug leading to server termination when trying to use / drop <code class=syntax>Kafka</code> table created with wrong parameters. <a href=https://github.com/ClickHouse/ClickHouse/pull/9513 rel="external nofollow noreferrer" target=_blank>#9513</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Added workaround if OS returns wrong result for <code class=syntax>timer_create</code> function. <a href=https://github.com/ClickHouse/ClickHouse/pull/8837 rel="external nofollow noreferrer" target=_blank>#8837</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed error in usage of <code class=syntax>min_marks_for_seek</code> parameter. Fixed the error message when there is no sharding key in Distributed table and we try to skip unused shards. <a href=https://github.com/ClickHouse/ClickHouse/pull/8908 rel="external nofollow noreferrer" target=_blank>#8908</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li></ul><h4 id=improvement_3>Improvement<a class=headerlink href=../amp/#improvement_3 title="Permanent link"> </a></h4><ul><li>Implement <code class=syntax>ALTER MODIFY/DROP</code> queries on top of mutations for <code class=syntax>ReplicatedMergeTree*</code> engines family. Now <code class=syntax>ALTERS</code> blocks only at the metadata update stage, and don't block after that. <a href=https://github.com/ClickHouse/ClickHouse/pull/8701 rel="external nofollow noreferrer" target=_blank>#8701</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Add ability to rewrite CROSS to INNER JOINs with <code class=syntax>WHERE</code> section containing unqialified names. <a href=https://github.com/ClickHouse/ClickHouse/pull/9512 rel="external nofollow noreferrer" target=_blank>#9512</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Make <code class=syntax>SHOW TABLES</code> and <code class=syntax>SHOW DATABASES</code> queries support the <code class=syntax>WHERE</code> expressions and <code class=syntax>FROM</code>/<code class=syntax>IN</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9076 rel="external nofollow noreferrer" target=_blank>#9076</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li><li>Added a setting <code class=syntax>deduplicate_blocks_in_dependent_materialized_views</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9070 rel="external nofollow noreferrer" target=_blank>#9070</a> (<a href=https://github.com/urykhy rel="external nofollow noreferrer" target=_blank>urykhy</a>)</li><li>After recent changes MySQL client started to print binary strings in hex thereby making them not readable (<a href=https://github.com/ClickHouse/ClickHouse/issues/9032 rel="external nofollow noreferrer" target=_blank>#9032</a>). The workaround in ClickHouse is to mark string columns as UTF-8, which is not always, but usually the case. <a href=https://github.com/ClickHouse/ClickHouse/pull/9079 rel="external nofollow noreferrer" target=_blank>#9079</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li><li>Add support of String and FixedString keys for <code class=syntax>sumMap</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/8903 rel="external nofollow noreferrer" target=_blank>#8903</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>)</li><li>Support string keys in SummingMergeTree maps <a href=https://github.com/ClickHouse/ClickHouse/pull/8933 rel="external nofollow noreferrer" target=_blank>#8933</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>)</li><li>Signal termination of thread to the thread pool even if the thread has thrown exception <a href=https://github.com/ClickHouse/ClickHouse/pull/8736 rel="external nofollow noreferrer" target=_blank>#8736</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li><li>Allow to set <code class=syntax>query_id</code> in <code class=syntax>clickhouse-benchmark</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9416 rel="external nofollow noreferrer" target=_blank>#9416</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Don't allow strange expressions in <code class=syntax>ALTER TABLE ... PARTITION partition</code> query. This addresses <a href=https://github.com/ClickHouse/ClickHouse/issues/7192 rel="external nofollow noreferrer" target=_blank>#7192</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8835 rel="external nofollow noreferrer" target=_blank>#8835</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>The table <code class=syntax>system.table_engines</code> now provides information about feature support (like <code class=syntax>supports_ttl</code> or <code class=syntax>supports_sort_order</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8830 rel="external nofollow noreferrer" target=_blank>#8830</a> (<a href=https://github.com/zlobober rel="external nofollow noreferrer" target=_blank>Max Akhmedov</a>)</li><li>Enable <code class=syntax>system.metric_log</code> by default. It will contain rows with values of ProfileEvents, CurrentMetrics collected with "collect_interval_milliseconds" interval (one second by default). The table is very small (usually in order of megabytes) and collecting this data by default is reasonable. <a href=https://github.com/ClickHouse/ClickHouse/pull/9225 rel="external nofollow noreferrer" target=_blank>#9225</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6964 rel="external nofollow noreferrer" target=_blank>#6964</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8874 rel="external nofollow noreferrer" target=_blank>#8874</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Now temporary <code class=syntax>LIVE VIEW</code> is created by <code class=syntax>CREATE LIVE VIEW name WITH TIMEOUT [42] ...</code> instead of <code class=syntax>CREATE TEMPORARY LIVE VIEW ...</code>, because the previous syntax was not consistent with <code class=syntax>CREATE TEMPORARY TABLE ...</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/9131 rel="external nofollow noreferrer" target=_blank>#9131</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Add text_log.level configuration parameter to limit entries that goes to <code class=syntax>system.text_log</code> table <a href=https://github.com/ClickHouse/ClickHouse/pull/8809 rel="external nofollow noreferrer" target=_blank>#8809</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Allow to put downloaded part to a disks/volumes according to TTL rules <a href=https://github.com/ClickHouse/ClickHouse/pull/8598 rel="external nofollow noreferrer" target=_blank>#8598</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>For external MySQL dictionaries, allow to mutualize MySQL connection pool to "share" them among dictionaries. This option significantly reduces the number of connections to MySQL servers. <a href=https://github.com/ClickHouse/ClickHouse/pull/9409 rel="external nofollow noreferrer" target=_blank>#9409</a> (<a href=https://github.com/clemrodriguez rel="external nofollow noreferrer" target=_blank>Clément Rodriguez</a>)</li><li>Show nearest query execution time for quantiles in <code class=syntax>clickhouse-benchmark</code> output instead of interpolated values. It's better to show values that correspond to the execution time of some queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/8712 rel="external nofollow noreferrer" target=_blank>#8712</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Possibility to add key &amp; timestamp for the message when inserting data to Kafka. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7198 rel="external nofollow noreferrer" target=_blank>#7198</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8969 rel="external nofollow noreferrer" target=_blank>#8969</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>If server is run from terminal, highlight thread number, query id and log priority by colors. This is for improved readability of correlated log messages for developers. <a href=https://github.com/ClickHouse/ClickHouse/pull/8961 rel="external nofollow noreferrer" target=_blank>#8961</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Better exception message while loading tables for <code class=syntax>Ordinary</code> database. <a href=https://github.com/ClickHouse/ClickHouse/pull/9527 rel="external nofollow noreferrer" target=_blank>#9527</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Implement <code class=syntax>arraySlice</code> for arrays with aggregate function states. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9388 rel="external nofollow noreferrer" target=_blank>#9388</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9391 rel="external nofollow noreferrer" target=_blank>#9391</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Allow constant functions and constant arrays to be used on the right side of IN operator. <a href=https://github.com/ClickHouse/ClickHouse/pull/8813 rel="external nofollow noreferrer" target=_blank>#8813</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>If zookeeper exception has happened while fetching data for system.replicas, display it in a separate column. This implements <a href=https://github.com/ClickHouse/ClickHouse/issues/9137 rel="external nofollow noreferrer" target=_blank>#9137</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9138 rel="external nofollow noreferrer" target=_blank>#9138</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Atomically remove MergeTree data parts on destroy. <a href=https://github.com/ClickHouse/ClickHouse/pull/8402 rel="external nofollow noreferrer" target=_blank>#8402</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Support row-level security for Distributed tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/8926 rel="external nofollow noreferrer" target=_blank>#8926</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Now we recognize suffix (like KB, KiB...) in settings values. <a href=https://github.com/ClickHouse/ClickHouse/pull/8072 rel="external nofollow noreferrer" target=_blank>#8072</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Prevent out of memory while constructing result of a large JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/8637 rel="external nofollow noreferrer" target=_blank>#8637</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Added names of clusters to suggestions in interactive mode in <code class=syntax>clickhouse-client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8709 rel="external nofollow noreferrer" target=_blank>#8709</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries <a href=https://github.com/ClickHouse/ClickHouse/pull/8820 rel="external nofollow noreferrer" target=_blank>#8820</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Added column <code class=syntax>exception_code</code> in <code class=syntax>system.query_log</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8770 rel="external nofollow noreferrer" target=_blank>#8770</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Enabled MySQL compatibility server on port <code class=syntax>9004</code> in the default server configuration file. Fixed password generation command in the example in configuration. <a href=https://github.com/ClickHouse/ClickHouse/pull/8771 rel="external nofollow noreferrer" target=_blank>#8771</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li><li>Prevent abort on shutdown if the filesystem is readonly. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9094 rel="external nofollow noreferrer" target=_blank>#9094</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9100 rel="external nofollow noreferrer" target=_blank>#9100</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Better exception message when length is required in HTTP POST query. <a href=https://github.com/ClickHouse/ClickHouse/pull/9453 rel="external nofollow noreferrer" target=_blank>#9453</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add <code class=syntax>_path</code> and <code class=syntax>_file</code> virtual columns to <code class=syntax>HDFS</code> and <code class=syntax>File</code> engines and <code class=syntax>hdfs</code> and <code class=syntax>file</code> table functions <a href=https://github.com/ClickHouse/ClickHouse/pull/8489 rel="external nofollow noreferrer" target=_blank>#8489</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li><li>Fix error <code class=syntax>Cannot find column</code> while inserting into <code class=syntax>MATERIALIZED VIEW</code> in case if new column was added to view's internal table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8766 rel="external nofollow noreferrer" target=_blank>#8766</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8788 rel="external nofollow noreferrer" target=_blank>#8788</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>) <a href=https://github.com/ClickHouse/ClickHouse/issues/8788 rel="external nofollow noreferrer" target=_blank>#8788</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8806 rel="external nofollow noreferrer" target=_blank>#8806</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8803 rel="external nofollow noreferrer" target=_blank>#8803</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix progress over native client-server protocol, by send progress after final update (like logs). This may be relevant only to some third-party tools that are using native protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/9495 rel="external nofollow noreferrer" target=_blank>#9495</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Add a system metric tracking the number of client connections using MySQL protocol (<a href=https://github.com/ClickHouse/ClickHouse/issues/9013 rel="external nofollow noreferrer" target=_blank>#9013</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9015 rel="external nofollow noreferrer" target=_blank>#9015</a> (<a href=https://github.com/Slach rel="external nofollow noreferrer" target=_blank>Eugene Klimov</a>)</li><li>From now on, HTTP responses will have <code class=syntax>X-ClickHouse-Timezone</code> header set to the same timezone value that <code class=syntax>SELECT timezone()</code> would report. <a href=https://github.com/ClickHouse/ClickHouse/pull/9493 rel="external nofollow noreferrer" target=_blank>#9493</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>)</li></ul><h4 id=performance-improvement_4>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_4 title="Permanent link"> </a></h4><ul><li>Improve performance of analysing index with IN <a href=https://github.com/ClickHouse/ClickHouse/pull/9261 rel="external nofollow noreferrer" target=_blank>#9261</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Simpler and more efficient code in Logical Functions + code cleanups. A followup to <a href=https://github.com/ClickHouse/ClickHouse/issues/8718 rel="external nofollow noreferrer" target=_blank>#8718</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8728 rel="external nofollow noreferrer" target=_blank>#8728</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Overall performance improvement (in range of 5%..200% for affected queries) by ensuring even more strict aliasing with C++20 features. <a href=https://github.com/ClickHouse/ClickHouse/pull/9304 rel="external nofollow noreferrer" target=_blank>#9304</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>More strict aliasing for inner loops of comparison functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9327 rel="external nofollow noreferrer" target=_blank>#9327</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>More strict aliasing for inner loops of arithmetic functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9325 rel="external nofollow noreferrer" target=_blank>#9325</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>A ~3 times faster implementation for ColumnVector::replicate(), via which ColumnConst::convertToFullColumn() is implemented. Also will be useful in tests when materializing constants. <a href=https://github.com/ClickHouse/ClickHouse/pull/9293 rel="external nofollow noreferrer" target=_blank>#9293</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Another minor performance improvement to <code class=syntax>ColumnVector::replicate()</code> (this speeds up the <code class=syntax>materialize</code> function and higher order functions) an even further improvement to <a href=https://github.com/ClickHouse/ClickHouse/issues/9293 rel="external nofollow noreferrer" target=_blank>#9293</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9442 rel="external nofollow noreferrer" target=_blank>#9442</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Improved performance of <code class=syntax>stochasticLinearRegression</code> aggregate function. This patch is contributed by Intel. <a href=https://github.com/ClickHouse/ClickHouse/pull/8652 rel="external nofollow noreferrer" target=_blank>#8652</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Improve performance of <code class=syntax>reinterpretAsFixedString</code> function. <a href=https://github.com/ClickHouse/ClickHouse/pull/9342 rel="external nofollow noreferrer" target=_blank>#9342</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Do not send blocks to client for <code class=syntax>Null</code> format in processors pipeline. <a href=https://github.com/ClickHouse/ClickHouse/pull/8797 rel="external nofollow noreferrer" target=_blank>#8797</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8767 rel="external nofollow noreferrer" target=_blank>#8767</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li></ul><h4 id=build-testing-packaging-improvement_7>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_7 title="Permanent link"> </a></h4><ul><li>Exception handling now works correctly on Windows Subsystem for Linux. See <a href=https://github.com/ClickHouse-Extras/libunwind/pull/3 target=_blank>https://github.com/ClickHouse-Extras/libunwind/pull/3</a> This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6480 rel="external nofollow noreferrer" target=_blank>#6480</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9564 rel="external nofollow noreferrer" target=_blank>#9564</a> (<a href=https://github.com/sobolevsv rel="external nofollow noreferrer" target=_blank>sobolevsv</a>)</li><li>Replace <code class=syntax>readline</code> with <code class=syntax>replxx</code> for interactive line editing in <code class=syntax>clickhouse-client</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/8416 rel="external nofollow noreferrer" target=_blank>#8416</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Better build time and less template instantiations in FunctionsComparison. <a href=https://github.com/ClickHouse/ClickHouse/pull/9324 rel="external nofollow noreferrer" target=_blank>#9324</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added integration with <code class=syntax>clang-tidy</code> in CI. See also <a href=https://github.com/ClickHouse/ClickHouse/issues/6044 rel="external nofollow noreferrer" target=_blank>#6044</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9566 rel="external nofollow noreferrer" target=_blank>#9566</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Now we link ClickHouse in CI using <code class=syntax>lld</code> even for <code class=syntax>gcc</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9049 rel="external nofollow noreferrer" target=_blank>#9049</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Allow to randomize thread scheduling and insert glitches when <code class=syntax>THREAD_FUZZER_*</code> environment variables are set. This helps testing. <a href=https://github.com/ClickHouse/ClickHouse/pull/9459 rel="external nofollow noreferrer" target=_blank>#9459</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Enable secure sockets in stateless tests <a href=https://github.com/ClickHouse/ClickHouse/pull/9288 rel="external nofollow noreferrer" target=_blank>#9288</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Make SPLIT_SHARED_LIBRARIES=OFF more robust <a href=https://github.com/ClickHouse/ClickHouse/pull/9156 rel="external nofollow noreferrer" target=_blank>#9156</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Make "performance_introspection_and_logging" test reliable to random server stuck. This may happen in CI environment. See also <a href=https://github.com/ClickHouse/ClickHouse/issues/9515 rel="external nofollow noreferrer" target=_blank>#9515</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9528 rel="external nofollow noreferrer" target=_blank>#9528</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Validate XML in style check. <a href=https://github.com/ClickHouse/ClickHouse/pull/9550 rel="external nofollow noreferrer" target=_blank>#9550</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed race condition in test <code class=syntax>00738_lock_for_inner_table</code>. This test relied on sleep. <a href=https://github.com/ClickHouse/ClickHouse/pull/9555 rel="external nofollow noreferrer" target=_blank>#9555</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove performance tests of type <code class=syntax>once</code>. This is needed to run all performance tests in statistical comparison mode (more reliable). <a href=https://github.com/ClickHouse/ClickHouse/pull/9557 rel="external nofollow noreferrer" target=_blank>#9557</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added performance test for arithmetic functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/9326 rel="external nofollow noreferrer" target=_blank>#9326</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added performance test for <code class=syntax>sumMap</code> and <code class=syntax>sumMapWithOverflow</code> aggregate functions. Follow-up for <a href=https://github.com/ClickHouse/ClickHouse/issues/8933 rel="external nofollow noreferrer" target=_blank>#8933</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8947 rel="external nofollow noreferrer" target=_blank>#8947</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Ensure style of ErrorCodes by style check. <a href=https://github.com/ClickHouse/ClickHouse/pull/9370 rel="external nofollow noreferrer" target=_blank>#9370</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add script for tests history. <a href=https://github.com/ClickHouse/ClickHouse/pull/8796 rel="external nofollow noreferrer" target=_blank>#8796</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Add GCC warning <code class=syntax>-Wsuggest-override</code> to locate and fix all places where <code class=syntax>override</code> keyword must be used. <a href=https://github.com/ClickHouse/ClickHouse/pull/8760 rel="external nofollow noreferrer" target=_blank>#8760</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li><li>Ignore weak symbol under Mac OS X because it must be defined <a href=https://github.com/ClickHouse/ClickHouse/pull/9538 rel="external nofollow noreferrer" target=_blank>#9538</a> (<a href=https://github.com/ghost rel="external nofollow noreferrer" target=_blank>Deleted user</a>)</li><li>Normalize running time of some queries in performance tests. This is done in preparation to run all the performance tests in comparison mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/9565 rel="external nofollow noreferrer" target=_blank>#9565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix some tests to support pytest with query tests <a href=https://github.com/ClickHouse/ClickHouse/pull/9062 rel="external nofollow noreferrer" target=_blank>#9062</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Enable SSL in build with MSan, so server will not fail at startup when running stateless tests <a href=https://github.com/ClickHouse/ClickHouse/pull/9531 rel="external nofollow noreferrer" target=_blank>#9531</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix database substitution in test results <a href=https://github.com/ClickHouse/ClickHouse/pull/9384 rel="external nofollow noreferrer" target=_blank>#9384</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li><li>Build fixes for miscellaneous platforms <a href=https://github.com/ClickHouse/ClickHouse/pull/9381 rel="external nofollow noreferrer" target=_blank>#9381</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8755 rel="external nofollow noreferrer" target=_blank>#8755</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8631 rel="external nofollow noreferrer" target=_blank>#8631</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li><li>Added disks section to stateless-with-coverage test docker image <a href=https://github.com/ClickHouse/ClickHouse/pull/9213 rel="external nofollow noreferrer" target=_blank>#9213</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Get rid of in-source-tree files when building with GRPC <a href=https://github.com/ClickHouse/ClickHouse/pull/9588 rel="external nofollow noreferrer" target=_blank>#9588</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Slightly faster build time by removing SessionCleaner from Context. Make the code of SessionCleaner more simple. <a href=https://github.com/ClickHouse/ClickHouse/pull/9232 rel="external nofollow noreferrer" target=_blank>#9232</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Updated checking for hung queries in clickhouse-test script <a href=https://github.com/ClickHouse/ClickHouse/pull/8858 rel="external nofollow noreferrer" target=_blank>#8858</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Removed some useless files from repository. <a href=https://github.com/ClickHouse/ClickHouse/pull/8843 rel="external nofollow noreferrer" target=_blank>#8843</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Changed type of math perftests from <code class=syntax>once</code> to <code class=syntax>loop</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8783 rel="external nofollow noreferrer" target=_blank>#8783</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Add docker image which allows to build interactive code browser HTML report for our codebase. <a href=https://github.com/ClickHouse/ClickHouse/pull/8781 rel="external nofollow noreferrer" target=_blank>#8781</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>) See <a href=https://clickhouse-test-reports.s3.yandex.net/codebrowser/html_report///ClickHouse/dbms/index.html rel="external nofollow noreferrer" target=_blank>Woboq Code Browser</a></li><li>Suppress some test failures under MSan. <a href=https://github.com/ClickHouse/ClickHouse/pull/8780 rel="external nofollow noreferrer" target=_blank>#8780</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Speedup "exception while insert" test. This test often time out in debug-with-coverage build. <a href=https://github.com/ClickHouse/ClickHouse/pull/8711 rel="external nofollow noreferrer" target=_blank>#8711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Updated <code class=syntax>libcxx</code> and <code class=syntax>libcxxabi</code> to master. In preparation to <a href=https://github.com/ClickHouse/ClickHouse/issues/9304 rel="external nofollow noreferrer" target=_blank>#9304</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9308 rel="external nofollow noreferrer" target=_blank>#9308</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix flacky test <code class=syntax>00910_zookeeper_test_alter_compression_codecs</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9525 rel="external nofollow noreferrer" target=_blank>#9525</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Clean up duplicated linker flags. Make sure the linker won't look up an unexpected symbol. <a href=https://github.com/ClickHouse/ClickHouse/pull/9433 rel="external nofollow noreferrer" target=_blank>#9433</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Add <code class=syntax>clickhouse-odbc</code> driver into test images. This allows to test interaction of ClickHouse with ClickHouse via its own ODBC driver. <a href=https://github.com/ClickHouse/ClickHouse/pull/9348 rel="external nofollow noreferrer" target=_blank>#9348</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fix several bugs in unit tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/9047 rel="external nofollow noreferrer" target=_blank>#9047</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Enable <code class=syntax>-Wmissing-include-dirs</code> GCC warning to eliminate all non-existing includes - mostly as a result of CMake scripting errors <a href=https://github.com/ClickHouse/ClickHouse/pull/8704 rel="external nofollow noreferrer" target=_blank>#8704</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li><li>Describe reasons if query profiler cannot work. This is intended for <a href=https://github.com/ClickHouse/ClickHouse/issues/9049 rel="external nofollow noreferrer" target=_blank>#9049</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9144 rel="external nofollow noreferrer" target=_blank>#9144</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update OpenSSL to upstream master. Fixed the issue when TLS connections may fail with the message <code class=syntax>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error</code> and <code class=syntax>SSL Exception: error:2400006E:random number generator::error retrieving entropy</code>. The issue was present in version 20.1. <a href=https://github.com/ClickHouse/ClickHouse/pull/8956 rel="external nofollow noreferrer" target=_blank>#8956</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update Dockerfile for server <a href=https://github.com/ClickHouse/ClickHouse/pull/8893 rel="external nofollow noreferrer" target=_blank>#8893</a> (<a href=https://github.com/ne-ray rel="external nofollow noreferrer" target=_blank>Ilya Mazaev</a>)</li><li>Minor fixes in build-gcc-from-sources script <a href=https://github.com/ClickHouse/ClickHouse/pull/8774 rel="external nofollow noreferrer" target=_blank>#8774</a> (<a href=https://github.com/mnach rel="external nofollow noreferrer" target=_blank>Michael Nacharov</a>)</li><li>Replace <code class=syntax>numbers</code> to <code class=syntax>zeros</code> in perftests where <code class=syntax>number</code> column is not used. This will lead to more clean test results. <a href=https://github.com/ClickHouse/ClickHouse/pull/9600 rel="external nofollow noreferrer" target=_blank>#9600</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix stack overflow issue when using initializer_list in Column constructors. <a href=https://github.com/ClickHouse/ClickHouse/pull/9367 rel="external nofollow noreferrer" target=_blank>#9367</a> (<a href=https://github.com/ghost rel="external nofollow noreferrer" target=_blank>Deleted user</a>)</li><li>Upgrade librdkafka to v1.3.0. Enable bundled <code class=syntax>rdkafka</code> and <code class=syntax>gsasl</code> libraries on Mac OS X. <a href=https://github.com/ClickHouse/ClickHouse/pull/9000 rel="external nofollow noreferrer" target=_blank>#9000</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li><li>build fix on GCC 9.2.0 <a href=https://github.com/ClickHouse/ClickHouse/pull/9306 rel="external nofollow noreferrer" target=_blank>#9306</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li></ul><h2 id=clickhouse-release-v20-1>ClickHouse release v20.1<a class=headerlink href=../amp/#clickhouse-release-v20-1 title="Permanent link"> </a></h2><h3 id=clickhouse-release-v20-1-16-120-stable-2020-60-26>ClickHouse release v20.1.16.120-stable 2020-60-26<a class=headerlink href=../amp/#clickhouse-release-v20-1-16-120-stable-2020-60-26 title="Permanent link"> </a></h3><h4 id=bug-fix_16>Bug Fix<a class=headerlink href=../amp/#bug-fix_16 title="Permanent link"> </a></h4><ul><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix unexpected behaviour of queries like <code class=syntax>SELECT *, xyz.*</code> which were success while an error expected. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix <code class=syntax>ORDER BY ... WITH FILL</code> over const columns. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix rare crash caused by using <code class=syntax>Nullable</code> column in prewhere condition. (Probably it is connected with <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a> somehow). <a href=https://github.com/ClickHouse/ClickHouse/pull/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix usage of primary key wrapped into a function with 'FINAL' modifier and 'ORDER BY' optimization. <a href=https://github.com/ClickHouse/ClickHouse/pull/10715 rel="external nofollow noreferrer" target=_blank>#10715</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li></ul><h3 id=clickhouse-release-v20-1-15-109-stable-2020-06-19>ClickHouse release v20.1.15.109-stable 2020-06-19<a class=headerlink href=../amp/#clickhouse-release-v20-1-15-109-stable-2020-06-19 title="Permanent link"> </a></h3><h4 id=bug-fix_17>Bug Fix<a class=headerlink href=../amp/#bug-fix_17 title="Permanent link"> </a></h4><ul><li>Fix excess lock for structure during alter. <a href=https://github.com/ClickHouse/ClickHouse/pull/11790 rel="external nofollow noreferrer" target=_blank>#11790</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li></ul><h3 id=clickhouse-release-v20-1-14-107-stable-2020-06-11>ClickHouse release v20.1.14.107-stable 2020-06-11<a class=headerlink href=../amp/#clickhouse-release-v20-1-14-107-stable-2020-06-11 title="Permanent link"> </a></h3><h4 id=bug-fix_18>Bug Fix<a class=headerlink href=../amp/#bug-fix_18 title="Permanent link"> </a></h4><ul><li>Fix error <code class=syntax>Size of offsets doesn't match size of column</code> for queries with <code class=syntax>PREWHERE column in (subquery)</code> and <code class=syntax>ARRAY JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li></ul><h3 id=clickhouse-release-v20-1-13-105-stable-2020-06-10>ClickHouse release v20.1.13.105-stable 2020-06-10<a class=headerlink href=../amp/#clickhouse-release-v20-1-13-105-stable-2020-06-10 title="Permanent link"> </a></h3><h4 id=bug-fix_19>Bug Fix<a class=headerlink href=../amp/#bug-fix_19 title="Permanent link"> </a></h4><ul><li>Fix the error <code class=syntax>Data compressed with different methods</code> that can happen if <code class=syntax>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix return compressed size for codecs. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix pointInPolygon with nan as point. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11375 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li><li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fix possible <code class=syntax>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix crash in <code class=syntax>quantilesExactWeightedArray</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Make writing to <code class=syntax>MATERIALIZED VIEW</code> with setting <code class=syntax>parallel_view_processing = 1</code> parallel again. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class=syntax>empty</code> or <code class=syntax>notEmpty</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code class=syntax>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class=syntax>max_network_bandwidth</code>, <code class=syntax>max_execution_speed</code> or <code class=syntax>priority</code> settings. Change the default value of <code class=syntax>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class=syntax>min_execution_speed</code> and <code class=syntax>max_execution_speed</code> have no effect. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class=syntax>clickhouse-client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix crash while reading malformed data in Protobuf format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix possible error <code class=syntax>Cannot capture column</code> for higher-order functions with <code class=syntax>Array(Array(LowCardinality))</code> captured argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Remove logging from mutation finalization task if nothing was finalized. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed parseDateTime64BestEffort argument resolution bugs. <a href=https://github.com/ClickHouse/ClickHouse/issues/10925 rel="external nofollow noreferrer" target=_blank>#10925</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li><li>Fix incorrect raw data size in method getRawData(). <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li><li>Fix backward compatibility with tuples in Distributed tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix SIGSEGV in StringHashTable (if such key does not exist). <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed bug in <code class=syntax>ReplicatedMergeTree</code> which might cause some <code class=syntax>ALTER</code> on <code class=syntax>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fix columns order after Block::sortColumns() (also add a test that shows that it affects some real use case - Buffer engine). <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix the issue with ODBC bridge when no quoting of identifiers is requested. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7984 rel="external nofollow noreferrer" target=_blank>#7984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix UBSan and MSan report in DateLUT. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li><ul><li>Make use of <code class=syntax>src_type</code> for correct type conversion in key conditions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li></ul></li><li>Fix <code class=syntax>parallel_view_processing</code> behavior. Now all insertions into <code class=syntax>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix combinator -OrNull and -OrDefault when combined with -State. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Fix disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix multiple usages of <code class=syntax>IN</code> operator with the identical set in one query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li><li>Fix order of parameters in AggregateTransform constructor. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li><li>Fix the lack of parallel execution of remote queries with <code class=syntax>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix predicates optimization for distributed queries (<code class=syntax>enable_optimize_predicate_expression=1</code>) for queries with <code class=syntax>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix error <code class=syntax>the BloomFilter false positive must be a double number between 0 and 1</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Fix SELECT of column ALIAS which default expression type different from column type. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li><ul><li>Implemented comparison between DateTime64 and String values (just like for DateTime). <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li></ul></li></ul><h3 id=clickhouse-release-v20-1-12-86-2020-05-26>ClickHouse release v20.1.12.86, 2020-05-26<a class=headerlink href=../amp/#clickhouse-release-v20-1-12-86-2020-05-26 title="Permanent link"> </a></h3><h4 id=bug-fix_20>Bug Fix<a class=headerlink href=../amp/#bug-fix_20 title="Permanent link"> </a></h4><ul><li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed data corruption for <code class=syntax>LowCardinality(FixedString)</code> key column in <code class=syntax>SummingMergeTree</code> which could have happened after merge. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed bug, which causes http requests stuck on client close when <code class=syntax>readonly=2</code> and <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7939 rel="external nofollow noreferrer" target=_blank>#7939</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7019 rel="external nofollow noreferrer" target=_blank>#7019</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7736 rel="external nofollow noreferrer" target=_blank>#7736</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7091 rel="external nofollow noreferrer" target=_blank>#7091</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed a bug when on <code class=syntax>SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li><li>Fixed incorrect scalar results inside inner query of <code class=syntax>MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed the situation when mutation finished all parts, but hung up in <code class=syntax>is_done=0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10526 rel="external nofollow noreferrer" target=_blank>#10526</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed overflow at beginning of unix epoch for timezones with fractional offset from UTC. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9335 rel="external nofollow noreferrer" target=_blank>#9335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10513 rel="external nofollow noreferrer" target=_blank>#10513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed improper shutdown of Distributed storage. <a href=https://github.com/ClickHouse/ClickHouse/pull/10491 rel="external nofollow noreferrer" target=_blank>#10491</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed numeric overflow in <code class=syntax>simpleLinearRegression</code> over large integers. <a href=https://github.com/ClickHouse/ClickHouse/pull/10474 rel="external nofollow noreferrer" target=_blank>#10474</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li><li>Fixed removing metadata directory when attach database fails. <a href=https://github.com/ClickHouse/ClickHouse/pull/10442 rel="external nofollow noreferrer" target=_blank>#10442</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Added a check of number and type of arguments when creating <code class=syntax>BloomFilter</code> index <a href=https://github.com/ClickHouse/ClickHouse/issues/9623 rel="external nofollow noreferrer" target=_blank>#9623</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10431 rel="external nofollow noreferrer" target=_blank>#10431</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Fixed the issue when a query with <code class=syntax>ARRAY JOIN</code>, <code class=syntax>ORDER BY</code> and <code class=syntax>LIMIT</code> may return incomplete result. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10226 rel="external nofollow noreferrer" target=_blank>#10226</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10427 rel="external nofollow noreferrer" target=_blank>#10427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Prefer <code class=syntax>fallback_to_stale_replicas</code> over <code class=syntax>skip_unavailable_shards</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10422 rel="external nofollow noreferrer" target=_blank>#10422</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed wrong flattening of <code class=syntax>Array(Tuple(...))</code> data types. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10259 rel="external nofollow noreferrer" target=_blank>#10259</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10390 rel="external nofollow noreferrer" target=_blank>#10390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fixed wrong behavior in <code class=syntax>HashTable</code> that caused compilation error when trying to read HashMap from buffer. <a href=https://github.com/ClickHouse/ClickHouse/pull/10386 rel="external nofollow noreferrer" target=_blank>#10386</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li><li>Fixed possible <code class=syntax>Pipeline stuck</code> error in <code class=syntax>ConcatProcessor</code> which could have happened in remote query. <a href=https://github.com/ClickHouse/ClickHouse/pull/10381 rel="external nofollow noreferrer" target=_blank>#10381</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed error <code class=syntax>Pipeline stuck</code> with <code class=syntax>max_rows_to_group_by</code> and <code class=syntax>group_by_overflow_mode = 'break'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10279 rel="external nofollow noreferrer" target=_blank>#10279</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed several bugs when some data was inserted with quorum, then deleted somehow (DROP PARTITION, TTL) and this leaded to the stuck of INSERTs or false-positive exceptions in SELECTs. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9946 rel="external nofollow noreferrer" target=_blank>#9946</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10188 rel="external nofollow noreferrer" target=_blank>#10188</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li><li>Fixed incompatibility when versions prior to 18.12.17 are used on remote servers and newer is used on initiating server, and GROUP BY both fixed and non-fixed keys, and when two-level group by method is activated. <a href=https://github.com/ClickHouse/ClickHouse/pull/3254 rel="external nofollow noreferrer" target=_blank>#3254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li></ul><h4 id=build-testing-packaging-improvement_8>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_8 title="Permanent link"> </a></h4><ul><li>Added CA certificates to clickhouse-server docker image. <a href=https://github.com/ClickHouse/ClickHouse/pull/10476 rel="external nofollow noreferrer" target=_blank>#10476</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li></ul><h3 id=clickhouse-release-v20-1-10-70-2020-04-17>ClickHouse release v20.1.10.70, 2020-04-17<a class=headerlink href=../amp/#clickhouse-release-v20-1-10-70-2020-04-17 title="Permanent link"> </a></h3><h4 id=bug-fix_21>Bug Fix<a class=headerlink href=../amp/#bug-fix_21 title="Permanent link"> </a></h4><ul><li>Fix rare possible exception <code class=syntax>Cannot drain connections: cancel first</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10239 rel="external nofollow noreferrer" target=_blank>#10239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fixed bug where ClickHouse would throw <code class=syntax>'Unknown function lambda.'</code> error message when user tries to run <code class=syntax>ALTER UPDATE/DELETE</code> on tables with <code class=syntax>ENGINE = Replicated*</code>. Check for nondeterministic functions now handles lambda expressions correctly. <a href=https://github.com/ClickHouse/ClickHouse/pull/10237 rel="external nofollow noreferrer" target=_blank>#10237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li><li>Fix <code class=syntax>parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10082 rel="external nofollow noreferrer" target=_blank>#10082</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10214 rel="external nofollow noreferrer" target=_blank>#10214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix column names of constants inside <code class=syntax>JOIN</code> that may clash with names of constants outside of <code class=syntax>JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10207 rel="external nofollow noreferrer" target=_blank>#10207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Fix possible inifinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code class=syntax>system.numbers</code> or <code class=syntax>system.zeros</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10206 rel="external nofollow noreferrer" target=_blank>#10206</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix move-to-prewhere optimization in presense of <code class=syntax>arrayJoin</code> functions (in certain cases). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10092 rel="external nofollow noreferrer" target=_blank>#10092</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10195 rel="external nofollow noreferrer" target=_blank>#10195</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li><li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code class=syntax>allow_nondeterministic_mutations</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/10186 rel="external nofollow noreferrer" target=_blank>#10186</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li><li>Convert blocks if structure does not match on <code class=syntax>INSERT</code> into table with <code class=syntax>Distributed</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10135 rel="external nofollow noreferrer" target=_blank>#10135</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix <code class=syntax>SIGSEGV</code> on <code class=syntax>INSERT</code> into <code class=syntax>Distributed</code> table when its structure differs from the underlying tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/10105 rel="external nofollow noreferrer" target=_blank>#10105</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fix possible rows loss for queries with <code class=syntax>JOIN</code> and <code class=syntax>UNION ALL</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9826 rel="external nofollow noreferrer" target=_blank>#9826</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10113 rel="external nofollow noreferrer" target=_blank>#10113</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10099 rel="external nofollow noreferrer" target=_blank>#10099</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Add arguments check and support identifier arguments for MySQL Database Engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/10077 rel="external nofollow noreferrer" target=_blank>#10077</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li><li>Fix bug in clickhouse dictionary source from localhost clickhouse server. The bug may lead to memory corruption if types in dictionary and source are not compatible. <a href=https://github.com/ClickHouse/ClickHouse/pull/10071 rel="external nofollow noreferrer" target=_blank>#10071</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fix error <code class=syntax>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code class=syntax>distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with different level from different shards (mixed single and two level aggregation). <a href=https://github.com/ClickHouse/ClickHouse/pull/10063 rel="external nofollow noreferrer" target=_blank>#10063</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix a segmentation fault that could occur in <code class=syntax>GROUP BY</code> over string keys containing trailing zero bytes (<a href=https://github.com/ClickHouse/ClickHouse/issues/8636 rel="external nofollow noreferrer" target=_blank>#8636</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8925 rel="external nofollow noreferrer" target=_blank>#8925</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10025 rel="external nofollow noreferrer" target=_blank>#10025</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li><li>Fix bug in which the necessary tables weren't retrieved at one of the processing stages of queries to some databases. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9699 rel="external nofollow noreferrer" target=_blank>#9699</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9949 rel="external nofollow noreferrer" target=_blank>#9949</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>).</li><li>Fix <code class=syntax>'Not found column in block'</code> error when <code class=syntax>JOIN</code> appears with <code class=syntax>TOTALS</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9839 rel="external nofollow noreferrer" target=_blank>#9839</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9939 rel="external nofollow noreferrer" target=_blank>#9939</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix a bug with <code class=syntax>ON CLUSTER</code> DDL queries freezing on server startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/9927 rel="external nofollow noreferrer" target=_blank>#9927</a> (<a href=https://github.com/garneja rel="external nofollow noreferrer" target=_blank>Gagan Arneja</a>).</li><li>Fix <code class=syntax>TRUNCATE</code> for Join table engine (<a href=https://github.com/ClickHouse/ClickHouse/issues/9917 rel="external nofollow noreferrer" target=_blank>#9917</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9920 rel="external nofollow noreferrer" target=_blank>#9920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix <code class=syntax>'scalar doesn't exist'</code> error in ALTER queries (<a href=https://github.com/ClickHouse/ClickHouse/issues/9878 rel="external nofollow noreferrer" target=_blank>#9878</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9904 rel="external nofollow noreferrer" target=_blank>#9904</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li><li>Fix race condition between drop and optimize in <code class=syntax>ReplicatedMergeTree</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9901 rel="external nofollow noreferrer" target=_blank>#9901</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>Fixed <code class=syntax>DeleteOnDestroy</code> logic in <code class=syntax>ATTACH PART</code> which could lead to automatic removal of attached part and added few tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/9410 rel="external nofollow noreferrer" target=_blank>#9410</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li></ul><h4 id=build-testing-packaging-improvement_9>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_9 title="Permanent link"> </a></h4><ul><li>Fix unit test <code class=syntax>collapsing_sorted_stream</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9367 rel="external nofollow noreferrer" target=_blank>#9367</a> (<a href=https://github.com/ghost rel="external nofollow noreferrer" target=_blank>Deleted user</a>).</li></ul><h3 id=clickhouse-release-v20-1-9-54-2020-03-28>ClickHouse release v20.1.9.54, 2020-03-28<a class=headerlink href=../amp/#clickhouse-release-v20-1-9-54-2020-03-28 title="Permanent link"> </a></h3><h4 id=bug-fix_22>Bug Fix<a class=headerlink href=../amp/#bug-fix_22 title="Permanent link"> </a></h4><ul><li>Fix <code class=syntax>'Different expressions with the same alias'</code> error when query has <code class=syntax>PREWHERE</code> and <code class=syntax>WHERE</code> on distributed table and <code class=syntax>SET distributed_product_mode = 'local'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9871 rel="external nofollow noreferrer" target=_blank>#9871</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li><li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9850 rel="external nofollow noreferrer" target=_blank>#9850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9860 rel="external nofollow noreferrer" target=_blank>#9860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li><li>For INSERT queries shard now clamps the settings got from the initiator to the shard's constaints instead of throwing an exception. This fix allows to send <code class=syntax>INSERT</code> queries to a shard with another constraints. This change improves fix <a href=https://github.com/ClickHouse/ClickHouse/issues/9447 rel="external nofollow noreferrer" target=_blank>#9447</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9852 rel="external nofollow noreferrer" target=_blank>#9852</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li><li>Fix possible exception <code class=syntax>Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code class=syntax>JOIN</code> in case if right joined table had zero rows. Example: <code class=syntax>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9777 rel="external nofollow noreferrer" target=_blank>#9777</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9823 rel="external nofollow noreferrer" target=_blank>#9823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li><li>Fix <code class=syntax>SIGSEGV</code> with <code class=syntax>optimize_skip_unused_shards</code> when type cannot be converted. <a href=https://github.com/ClickHouse/ClickHouse/pull/9804 rel="external nofollow noreferrer" target=_blank>#9804</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li><li>Fixed a few cases when timezone of the function argument wasn't used properly. <a href=https://github.com/ClickHouse/ClickHouse/pull/9574 rel="external nofollow noreferrer" target=_blank>#9574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li></ul><h4 id=improvement_4>Improvement<a class=headerlink href=../amp/#improvement_4 title="Permanent link"> </a></h4><ul><li>Remove <code class=syntax>ORDER BY</code> stage from mutations because we read from a single ordered part in a single thread. Also add check that the order of rows in mutation is ordered in sorting key order and this order is not violated. <a href=https://github.com/ClickHouse/ClickHouse/pull/9886 rel="external nofollow noreferrer" target=_blank>#9886</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li></ul><h4 id=build-testing-packaging-improvement_10>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_10 title="Permanent link"> </a></h4><ul><li>Clean up duplicated linker flags. Make sure the linker won't look up an unexpected symbol. <a href=https://github.com/ClickHouse/ClickHouse/pull/9433 rel="external nofollow noreferrer" target=_blank>#9433</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li></ul><h3 id=clickhouse-release-v20-1-8-41-2020-03-20>ClickHouse release v20.1.8.41, 2020-03-20<a class=headerlink href=../amp/#clickhouse-release-v20-1-8-41-2020-03-20 title="Permanent link"> </a></h3><h4 id=bug-fix_23>Bug Fix<a class=headerlink href=../amp/#bug-fix_23 title="Permanent link"> </a></h4><ul><li>Fix possible permanent <code class=syntax>Cannot schedule a task</code> error (due to unhandled exception in <code class=syntax>ParallelAggregatingBlockInputStream::Handler::onFinish/onFinishThread</code>). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6833 rel="external nofollow noreferrer" target=_blank>#6833</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9154 rel="external nofollow noreferrer" target=_blank>#9154</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix excessive memory consumption in <code class=syntax>ALTER</code> queries (mutations). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9533 rel="external nofollow noreferrer" target=_blank>#9533</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/9670 rel="external nofollow noreferrer" target=_blank>#9670</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9754 rel="external nofollow noreferrer" target=_blank>#9754</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix bug in backquoting in external dictionaries DDL. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9619 rel="external nofollow noreferrer" target=_blank>#9619</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9734 rel="external nofollow noreferrer" target=_blank>#9734</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li></ul><h3 id=clickhouse-release-v20-1-7-38-2020-03-18>ClickHouse release v20.1.7.38, 2020-03-18<a class=headerlink href=../amp/#clickhouse-release-v20-1-7-38-2020-03-18 title="Permanent link"> </a></h3><h4 id=bug-fix_24>Bug Fix<a class=headerlink href=../amp/#bug-fix_24 title="Permanent link"> </a></h4><ul><li>Fixed incorrect internal function names for <code class=syntax>sumKahan</code> and <code class=syntax>sumWithOverflow</code>. I lead to exception while using this functions in remote queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9636 rel="external nofollow noreferrer" target=_blank>#9636</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>). This issue was in all ClickHouse releases.</li><li>Allow <code class=syntax>ALTER ON CLUSTER</code> of <code class=syntax>Distributed</code> tables with internal replication. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/3268 rel="external nofollow noreferrer" target=_blank>#3268</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9617 rel="external nofollow noreferrer" target=_blank>#9617</a> (<a href=https://github.com/shinoi2 rel="external nofollow noreferrer" target=_blank>shinoi2</a>). This issue was in all ClickHouse releases.</li><li>Fix possible exceptions <code class=syntax>Size of filter doesn't match size of column</code> and <code class=syntax>Invalid number of rows in Chunk</code> in <code class=syntax>MergeTreeRangeReader</code>. They could appear while executing <code class=syntax>PREWHERE</code> in some cases. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9132 rel="external nofollow noreferrer" target=_blank>#9132</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9612 rel="external nofollow noreferrer" target=_blank>#9612</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fixed the issue: timezone was not preserved if you write a simple arithmetic expression like <code class=syntax>time + 1</code> (in contrast to an expression like <code class=syntax>time + INTERVAL 1 SECOND</code>). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5743 rel="external nofollow noreferrer" target=_blank>#5743</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9323 rel="external nofollow noreferrer" target=_blank>#9323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>). This issue was in all ClickHouse releases.</li><li>Now it's not possible to create or add columns with simple cyclic aliases like <code class=syntax>a DEFAULT b, b DEFAULT a</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9603 rel="external nofollow noreferrer" target=_blank>#9603</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed the issue when padding at the end of base64 encoded value can be malformed. Update base64 library. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9491 rel="external nofollow noreferrer" target=_blank>#9491</a>, closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9492 rel="external nofollow noreferrer" target=_blank>#9492</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9500 rel="external nofollow noreferrer" target=_blank>#9500</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix data race at destruction of <code class=syntax>Poco::HTTPServer</code>. It could happen when server is started and immediately shut down. <a href=https://github.com/ClickHouse/ClickHouse/pull/9468 rel="external nofollow noreferrer" target=_blank>#9468</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix possible crash/wrong number of rows in <code class=syntax>LIMIT n WITH TIES</code> when there are a lot of rows equal to n'th row. <a href=https://github.com/ClickHouse/ClickHouse/pull/9464 rel="external nofollow noreferrer" target=_blank>#9464</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix possible mismatched checksums with column TTLs. <a href=https://github.com/ClickHouse/ClickHouse/pull/9451 rel="external nofollow noreferrer" target=_blank>#9451</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Fix crash when a user tries to <code class=syntax>ALTER MODIFY SETTING</code> for old-formated <code class=syntax>MergeTree</code> table engines family. <a href=https://github.com/ClickHouse/ClickHouse/pull/9435 rel="external nofollow noreferrer" target=_blank>#9435</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Now we will try finalize mutations more frequently. <a href=https://github.com/ClickHouse/ClickHouse/pull/9427 rel="external nofollow noreferrer" target=_blank>#9427</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix replication protocol incompatibility introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/8598 rel="external nofollow noreferrer" target=_blank>#8598</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9412 rel="external nofollow noreferrer" target=_blank>#9412</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix not(has()) for the bloom_filter index of array types. <a href=https://github.com/ClickHouse/ClickHouse/pull/9407 rel="external nofollow noreferrer" target=_blank>#9407</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li><li>Fixed the behaviour of <code class=syntax>match</code> and <code class=syntax>extract</code> functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9160 rel="external nofollow noreferrer" target=_blank>#9160</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9163 rel="external nofollow noreferrer" target=_blank>#9163</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/9345 rel="external nofollow noreferrer" target=_blank>#9345</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h4 id=build-testing-packaging-improvement_11>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_11 title="Permanent link"> </a></h4><ul><li>Exception handling now works correctly on Windows Subsystem for Linux. See <a href=https://github.com/ClickHouse-Extras/libunwind/pull/3 target=_blank>https://github.com/ClickHouse-Extras/libunwind/pull/3</a> This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6480 rel="external nofollow noreferrer" target=_blank>#6480</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9564 rel="external nofollow noreferrer" target=_blank>#9564</a> (<a href=https://github.com/sobolevsv rel="external nofollow noreferrer" target=_blank>sobolevsv</a>)</li></ul><h3 id=clickhouse-release-v20-1-6-30-2020-03-05>ClickHouse release v20.1.6.30, 2020-03-05<a class=headerlink href=../amp/#clickhouse-release-v20-1-6-30-2020-03-05 title="Permanent link"> </a></h3><h4 id=bug-fix_25>Bug Fix<a class=headerlink href=../amp/#bug-fix_25 title="Permanent link"> </a></h4><ul><li>Fix data incompatibility when compressed with <code class=syntax>T64</code> codec.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9039 rel="external nofollow noreferrer" target=_blank>#9039</a> <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>(abyss7)</a></li><li>Fix order of ranges while reading from MergeTree table in one thread. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8964 rel="external nofollow noreferrer" target=_blank>#8964</a>.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9050 rel="external nofollow noreferrer" target=_blank>#9050</a> <a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>(CurtizJ)</a></li><li>Fix possible segfault in <code class=syntax>MergeTreeRangeReader</code>, while executing <code class=syntax>PREWHERE</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9064 rel="external nofollow noreferrer" target=_blank>#9064</a>.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9106 rel="external nofollow noreferrer" target=_blank>#9106</a> <a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>(CurtizJ)</a></li><li>Fix <code class=syntax>reinterpretAsFixedString</code> to return <code class=syntax>FixedString</code> instead of <code class=syntax>String</code>.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9052 rel="external nofollow noreferrer" target=_blank>#9052</a> <a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>(oandrew)</a></li><li>Fix <code class=syntax>joinGet</code> with nullable return types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8919 rel="external nofollow noreferrer" target=_blank>#8919</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9014 rel="external nofollow noreferrer" target=_blank>#9014</a> <a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>(amosbird)</a></li><li>Fix fuzz test and incorrect behaviour of bitTestAll/bitTestAny functions.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9143 rel="external nofollow noreferrer" target=_blank>#9143</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li><li>Fix the behaviour of match and extract functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9160 rel="external nofollow noreferrer" target=_blank>#9160</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9163 rel="external nofollow noreferrer" target=_blank>#9163</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li><li>Fixed execution of inversed predicates when non-strictly monotinic functional index is used. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9034 rel="external nofollow noreferrer" target=_blank>#9034</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9223 rel="external nofollow noreferrer" target=_blank>#9223</a> <a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>(Akazz)</a></li><li>Allow to rewrite <code class=syntax>CROSS</code> to <code class=syntax>INNER JOIN</code> if there's <code class=syntax>[NOT] LIKE</code> operator in <code class=syntax>WHERE</code> section. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9191 rel="external nofollow noreferrer" target=_blank>#9191</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9229 rel="external nofollow noreferrer" target=_blank>#9229</a> <a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>(4ertus2)</a></li><li>Allow first column(s) in a table with Log engine be an alias.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9231 rel="external nofollow noreferrer" target=_blank>#9231</a> <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>(abyss7)</a></li><li>Allow comma join with <code class=syntax>IN()</code> inside. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7314 rel="external nofollow noreferrer" target=_blank>#7314</a>.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9251 rel="external nofollow noreferrer" target=_blank>#9251</a> <a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>(4ertus2)</a></li><li>Improve <code class=syntax>ALTER MODIFY/ADD</code> queries logic. Now you cannot <code class=syntax>ADD</code> column without type, <code class=syntax>MODIFY</code> default expression doesn't change type of column and <code class=syntax>MODIFY</code> type doesn't loose default expression value. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8669 rel="external nofollow noreferrer" target=_blank>#8669</a>.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9227 rel="external nofollow noreferrer" target=_blank>#9227</a> <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>(alesapin)</a></li><li>Fix mutations finalization, when already done mutation can have status is_done=0.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9217 rel="external nofollow noreferrer" target=_blank>#9217</a> <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>(alesapin)</a></li><li>Support "Processors" pipeline for system.numbers and system.numbers_mt. This also fixes the bug when <code class=syntax>max_execution_time</code> is not respected.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/7796 rel="external nofollow noreferrer" target=_blank>#7796</a> <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>(KochetovNicolai)</a></li><li>Fix wrong counting of <code class=syntax>DictCacheKeysRequestedFound</code> metric.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9411 rel="external nofollow noreferrer" target=_blank>#9411</a> <a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>(nikitamikhaylov)</a></li><li>Added a check for storage policy in <code class=syntax>ATTACH PARTITION FROM</code>, <code class=syntax>REPLACE PARTITION</code>, <code class=syntax>MOVE TO TABLE</code> which otherwise could make data of part inaccessible after restart and prevent ClickHouse to start.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9383 rel="external nofollow noreferrer" target=_blank>#9383</a> <a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>(excitoon)</a></li><li>Fixed UBSan report in <code class=syntax>MergeTreeIndexSet</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9250 rel="external nofollow noreferrer" target=_blank>#9250</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9365 rel="external nofollow noreferrer" target=_blank>#9365</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li><li>Fix possible datarace in BlockIO.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9356 rel="external nofollow noreferrer" target=_blank>#9356</a> <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>(KochetovNicolai)</a></li><li>Support for <code class=syntax>UInt64</code> numbers that don't fit in Int64 in JSON-related functions. Update <code class=syntax>SIMDJSON</code> to master. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9209 rel="external nofollow noreferrer" target=_blank>#9209</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9344 rel="external nofollow noreferrer" target=_blank>#9344</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li><li>Fix the issue when the amount of free space is not calculated correctly if the data directory is mounted to a separate device. For default disk calculate the free space from data subdirectory. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7441 rel="external nofollow noreferrer" target=_blank>#7441</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9257 rel="external nofollow noreferrer" target=_blank>#9257</a> <a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>(millb)</a></li><li>Fix the issue when TLS connections may fail with the message <code class=syntax>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error and SSL Exception: error:2400006E:random number generator::error retrieving entropy.</code> Update OpenSSL to upstream master.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/8956 rel="external nofollow noreferrer" target=_blank>#8956</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li><li>When executing <code class=syntax>CREATE</code> query, fold constant expressions in storage engine arguments. Replace empty database name with current database. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6508 rel="external nofollow noreferrer" target=_blank>#6508</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/3492 rel="external nofollow noreferrer" target=_blank>#3492</a>. Also fix check for local address in ClickHouseDictionarySource.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9262 rel="external nofollow noreferrer" target=_blank>#9262</a> <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>(tabplubix)</a></li><li>Fix segfault in <code class=syntax>StorageMerge</code>, which can happen when reading from StorageFile.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9387 rel="external nofollow noreferrer" target=_blank>#9387</a> <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>(tabplubix)</a></li><li>Prevent losing data in <code class=syntax>Kafka</code> in rare cases when exception happens after reading suffix but before commit. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9378 rel="external nofollow noreferrer" target=_blank>#9378</a>. Related: <a href=https://github.com/ClickHouse/ClickHouse/issues/7175 rel="external nofollow noreferrer" target=_blank>#7175</a><br><a href=https://github.com/ClickHouse/ClickHouse/pull/9507 rel="external nofollow noreferrer" target=_blank>#9507</a> <a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>(filimonov)</a></li><li>Fix bug leading to server termination when trying to use / drop <code class=syntax>Kafka</code> table created with wrong parameters. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9494 rel="external nofollow noreferrer" target=_blank>#9494</a>. Incorporates <a href=https://github.com/ClickHouse/ClickHouse/issues/9507 rel="external nofollow noreferrer" target=_blank>#9507</a>.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9513 rel="external nofollow noreferrer" target=_blank>#9513</a> <a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>(filimonov)</a></li></ul><h4 id=new-feature_5>New Feature<a class=headerlink href=../amp/#new-feature_5 title="Permanent link"> </a></h4><ul><li>Add <code class=syntax>deduplicate_blocks_in_dependent_materialized_views</code> option to control the behaviour of idempotent inserts into tables with materialized views. This new feature was added to the bugfix release by a special request from Altinity.<br><a href=https://github.com/ClickHouse/ClickHouse/pull/9070 rel="external nofollow noreferrer" target=_blank>#9070</a> <a href=https://github.com/urykhy rel="external nofollow noreferrer" target=_blank>(urykhy)</a></li></ul><h3 id=clickhouse-release-v20-1-2-4-2020-01-22>ClickHouse release v20.1.2.4, 2020-01-22<a class=headerlink href=../amp/#clickhouse-release-v20-1-2-4-2020-01-22 title="Permanent link"> </a></h3><h4 id=backward-incompatible-change_3>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change_3 title="Permanent link"> </a></h4><ul><li>Make the setting <code class=syntax>merge_tree_uniform_read_distribution</code> obsolete. The server still recognizes this setting but it has no effect. <a href=https://github.com/ClickHouse/ClickHouse/pull/8308 rel="external nofollow noreferrer" target=_blank>#8308</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Changed return type of the function <code class=syntax>greatCircleDistance</code> to <code class=syntax>Float32</code> because now the result of calculation is <code class=syntax>Float32</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7993 rel="external nofollow noreferrer" target=_blank>#7993</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Now it's expected that query parameters are represented in "escaped" format. For example, to pass string <code class=syntax>a&lt;tab&gt;b</code> you have to write <code class=syntax>a\tb</code> or <code class=syntax>a\&lt;tab&gt;b</code> and respectively, <code class=syntax>a%5Ctb</code> or <code class=syntax>a%5C%09b</code> in URL. This is needed to add the possibility to pass NULL as <code class=syntax>\N</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7488 rel="external nofollow noreferrer" target=_blank>#7488</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8517 rel="external nofollow noreferrer" target=_blank>#8517</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Enable <code class=syntax>use_minimalistic_part_header_in_zookeeper</code> setting for <code class=syntax>ReplicatedMergeTree</code> by default. This will significantly reduce amount of data stored in ZooKeeper. This setting is supported since version 19.1 and we already use it in production in multiple services without any issues for more than half a year. Disable this setting if you have a chance to downgrade to versions older than 19.1. <a href=https://github.com/ClickHouse/ClickHouse/pull/6850 rel="external nofollow noreferrer" target=_blank>#6850</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Data skipping indices are production ready and enabled by default. The settings <code class=syntax>allow_experimental_data_skipping_indices</code>, <code class=syntax>allow_experimental_cross_to_join_conversion</code> and <code class=syntax>allow_experimental_multiple_joins_emulation</code> are now obsolete and do nothing. <a href=https://github.com/ClickHouse/ClickHouse/pull/7974 rel="external nofollow noreferrer" target=_blank>#7974</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add new <code class=syntax>ANY JOIN</code> logic for <code class=syntax>StorageJoin</code> consistent with <code class=syntax>JOIN</code> operation. To upgrade without changes in behaviour you need add <code class=syntax>SETTINGS any_join_distinct_right_table_keys = 1</code> to Engine Join tables metadata or recreate these tables after upgrade. <a href=https://github.com/ClickHouse/ClickHouse/pull/8400 rel="external nofollow noreferrer" target=_blank>#8400</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Require server to be restarted to apply the changes in logging configuration. This is a temporary workaround to avoid the bug where the server logs to a deleted log file (see <a href=https://github.com/ClickHouse/ClickHouse/issues/8696 rel="external nofollow noreferrer" target=_blank>#8696</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8707 rel="external nofollow noreferrer" target=_blank>#8707</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li></ul><h4 id=new-feature_6>New Feature<a class=headerlink href=../amp/#new-feature_6 title="Permanent link"> </a></h4><ul><li>Added information about part paths to <code class=syntax>system.merges</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8043 rel="external nofollow noreferrer" target=_blank>#8043</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Add ability to execute <code class=syntax>SYSTEM RELOAD DICTIONARY</code> query in <code class=syntax>ON CLUSTER</code> mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/8288 rel="external nofollow noreferrer" target=_blank>#8288</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li><li>Add ability to execute <code class=syntax>CREATE DICTIONARY</code> queries in <code class=syntax>ON CLUSTER</code> mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/8163 rel="external nofollow noreferrer" target=_blank>#8163</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Now user's profile in <code class=syntax>users.xml</code> can inherit multiple profiles. <a href=https://github.com/ClickHouse/ClickHouse/pull/8343 rel="external nofollow noreferrer" target=_blank>#8343</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li><li>Added <code class=syntax>system.stack_trace</code> table that allows to look at stack traces of all server threads. This is useful for developers to introspect server state. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7576 rel="external nofollow noreferrer" target=_blank>#7576</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8344 rel="external nofollow noreferrer" target=_blank>#8344</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add <code class=syntax>DateTime64</code> datatype with configurable sub-second precision. <a href=https://github.com/ClickHouse/ClickHouse/pull/7170 rel="external nofollow noreferrer" target=_blank>#7170</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Add table function <code class=syntax>clusterAllReplicas</code> which allows to query all the nodes in the cluster. <a href=https://github.com/ClickHouse/ClickHouse/pull/8493 rel="external nofollow noreferrer" target=_blank>#8493</a> (<a href=https://github.com/kiransunkari rel="external nofollow noreferrer" target=_blank>kiran sunkari</a>)</li><li>Add aggregate function <code class=syntax>categoricalInformationValue</code> which calculates the information value of a discrete feature. <a href=https://github.com/ClickHouse/ClickHouse/pull/8117 rel="external nofollow noreferrer" target=_blank>#8117</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Speed up parsing of data files in <code class=syntax>CSV</code>, <code class=syntax>TSV</code> and <code class=syntax>JSONEachRow</code> format by doing it in parallel. <a href=https://github.com/ClickHouse/ClickHouse/pull/7780 rel="external nofollow noreferrer" target=_blank>#7780</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Add function <code class=syntax>bankerRound</code> which performs banker's rounding. <a href=https://github.com/ClickHouse/ClickHouse/pull/8112 rel="external nofollow noreferrer" target=_blank>#8112</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Support more languages in embedded dictionary for region names: 'ru', 'en', 'ua', 'uk', 'by', 'kz', 'tr', 'de', 'uz', 'lv', 'lt', 'et', 'pt', 'he', 'vi'. <a href=https://github.com/ClickHouse/ClickHouse/pull/8189 rel="external nofollow noreferrer" target=_blank>#8189</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Improvements in consistency of <code class=syntax>ANY JOIN</code> logic. Now <code class=syntax>t1 ANY LEFT JOIN t2</code> equals <code class=syntax>t2 ANY RIGHT JOIN t1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7665 rel="external nofollow noreferrer" target=_blank>#7665</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Add setting <code class=syntax>any_join_distinct_right_table_keys</code> which enables old behaviour for <code class=syntax>ANY INNER JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7665 rel="external nofollow noreferrer" target=_blank>#7665</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Add new <code class=syntax>SEMI</code> and <code class=syntax>ANTI JOIN</code>. Old <code class=syntax>ANY INNER JOIN</code> behaviour now available as <code class=syntax>SEMI LEFT JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7665 rel="external nofollow noreferrer" target=_blank>#7665</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Added <code class=syntax>Distributed</code> format for <code class=syntax>File</code> engine and <code class=syntax>file</code> table function which allows to read from <code class=syntax>.bin</code> files generated by asynchronous inserts into <code class=syntax>Distributed</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8535 rel="external nofollow noreferrer" target=_blank>#8535</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Add optional reset column argument for <code class=syntax>runningAccumulate</code> which allows to reset aggregation results for each new key value. <a href=https://github.com/ClickHouse/ClickHouse/pull/8326 rel="external nofollow noreferrer" target=_blank>#8326</a> (<a href=https://github.com/kononencheg rel="external nofollow noreferrer" target=_blank>Sergey Kononenko</a>)</li><li>Add ability to use ClickHouse as Prometheus endpoint. <a href=https://github.com/ClickHouse/ClickHouse/pull/7900 rel="external nofollow noreferrer" target=_blank>#7900</a> (<a href=https://github.com/Vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>)</li><li>Add section <code class=syntax>&lt;remote_url_allow_hosts&gt;</code> in <code class=syntax>config.xml</code> which restricts allowed hosts for remote table engines and table functions <code class=syntax>URL</code>, <code class=syntax>S3</code>, <code class=syntax>HDFS</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7154 rel="external nofollow noreferrer" target=_blank>#7154</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Added function <code class=syntax>greatCircleAngle</code> which calculates the distance on a sphere in degrees. <a href=https://github.com/ClickHouse/ClickHouse/pull/8105 rel="external nofollow noreferrer" target=_blank>#8105</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Changed Earth radius to be consistent with H3 library. <a href=https://github.com/ClickHouse/ClickHouse/pull/8105 rel="external nofollow noreferrer" target=_blank>#8105</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added <code class=syntax>JSONCompactEachRow</code> and <code class=syntax>JSONCompactEachRowWithNamesAndTypes</code> formats for input and output. <a href=https://github.com/ClickHouse/ClickHouse/pull/7841 rel="external nofollow noreferrer" target=_blank>#7841</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Added feature for file-related table engines and table functions (<code class=syntax>File</code>, <code class=syntax>S3</code>, <code class=syntax>URL</code>, <code class=syntax>HDFS</code>) which allows to read and write <code class=syntax>gzip</code> files based on additional engine parameter or file extension. <a href=https://github.com/ClickHouse/ClickHouse/pull/7840 rel="external nofollow noreferrer" target=_blank>#7840</a> (<a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a>)</li><li>Added the <code class=syntax>randomASCII(length)</code> function, generating a string with a random set of <a href=https://en.wikipedia.org/wiki/ASCII#Printable_characters rel="external nofollow noreferrer" target=_blank>ASCII</a> printable characters. <a href=https://github.com/ClickHouse/ClickHouse/pull/8401 rel="external nofollow noreferrer" target=_blank>#8401</a> (<a href=https://github.com/BayoNet rel="external nofollow noreferrer" target=_blank>BayoNet</a>)</li><li>Added function <code class=syntax>JSONExtractArrayRaw</code> which returns an array on unparsed json array elements from <code class=syntax>JSON</code> string. <a href=https://github.com/ClickHouse/ClickHouse/pull/8081 rel="external nofollow noreferrer" target=_blank>#8081</a> (<a href=https://github.com/errx rel="external nofollow noreferrer" target=_blank>Oleg Matrokhin</a>)</li><li>Add <code class=syntax>arrayZip</code> function which allows to combine multiple arrays of equal lengths into one array of tuples. <a href=https://github.com/ClickHouse/ClickHouse/pull/8149 rel="external nofollow noreferrer" target=_blank>#8149</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Add ability to move data between disks according to configured <code class=syntax>TTL</code>-expressions for <code class=syntax>*MergeTree</code> table engines family. <a href=https://github.com/ClickHouse/ClickHouse/pull/8140 rel="external nofollow noreferrer" target=_blank>#8140</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Added new aggregate function <code class=syntax>avgWeighted</code> which allows to calculate weighted average. <a href=https://github.com/ClickHouse/ClickHouse/pull/7898 rel="external nofollow noreferrer" target=_blank>#7898</a> (<a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a>)</li><li>Now parallel parsing is enabled by default for <code class=syntax>TSV</code>, <code class=syntax>TSKV</code>, <code class=syntax>CSV</code> and <code class=syntax>JSONEachRow</code> formats. <a href=https://github.com/ClickHouse/ClickHouse/pull/7894 rel="external nofollow noreferrer" target=_blank>#7894</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Add several geo functions from <code class=syntax>H3</code> library: <code class=syntax>h3GetResolution</code>, <code class=syntax>h3EdgeAngle</code>, <code class=syntax>h3EdgeLength</code>, <code class=syntax>h3IsValid</code> and <code class=syntax>h3kRing</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8034 rel="external nofollow noreferrer" target=_blank>#8034</a> (<a href=https://github.com/hombit rel="external nofollow noreferrer" target=_blank>Konstantin Malanchev</a>)</li><li>Added support for brotli (<code class=syntax>br</code>) compression in file-related storages and table functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8156 rel="external nofollow noreferrer" target=_blank>#8156</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8526 rel="external nofollow noreferrer" target=_blank>#8526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add <code class=syntax>groupBit*</code> functions for the <code class=syntax>SimpleAggregationFunction</code> type. <a href=https://github.com/ClickHouse/ClickHouse/pull/8485 rel="external nofollow noreferrer" target=_blank>#8485</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li></ul><h4 id=bug-fix_26>Bug Fix<a class=headerlink href=../amp/#bug-fix_26 title="Permanent link"> </a></h4><ul><li>Fix rename of tables with <code class=syntax>Distributed</code> engine. Fixes issue <a href=https://github.com/ClickHouse/ClickHouse/issues/7868 rel="external nofollow noreferrer" target=_blank>#7868</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8306 rel="external nofollow noreferrer" target=_blank>#8306</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Now dictionaries support <code class=syntax>EXPRESSION</code> for attributes in arbitrary string in non-ClickHouse SQL dialect. <a href=https://github.com/ClickHouse/ClickHouse/pull/8098 rel="external nofollow noreferrer" target=_blank>#8098</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix broken <code class=syntax>INSERT SELECT FROM mysql(...)</code> query. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8070 rel="external nofollow noreferrer" target=_blank>#8070</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/7960 rel="external nofollow noreferrer" target=_blank>#7960</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8234 rel="external nofollow noreferrer" target=_blank>#8234</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix error "Mismatch column sizes" when inserting default <code class=syntax>Tuple</code> from <code class=syntax>JSONEachRow</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5653 rel="external nofollow noreferrer" target=_blank>#5653</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8606 rel="external nofollow noreferrer" target=_blank>#8606</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Now an exception will be thrown in case of using <code class=syntax>WITH TIES</code> alongside <code class=syntax>LIMIT BY</code>. Also add ability to use <code class=syntax>TOP</code> with <code class=syntax>LIMIT BY</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7472 rel="external nofollow noreferrer" target=_blank>#7472</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7637 rel="external nofollow noreferrer" target=_blank>#7637</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Fix unintendent dependency from fresh glibc version in <code class=syntax>clickhouse-odbc-bridge</code> binary. <a href=https://github.com/ClickHouse/ClickHouse/pull/8046 rel="external nofollow noreferrer" target=_blank>#8046</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Fix bug in check function of <code class=syntax>*MergeTree</code> engines family. Now it doesn't fail in case when we have equal amount of rows in last granule and last mark (non-final). <a href=https://github.com/ClickHouse/ClickHouse/pull/8047 rel="external nofollow noreferrer" target=_blank>#8047</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix insert into <code class=syntax>Enum*</code> columns after <code class=syntax>ALTER</code> query, when underlying numeric type is equal to table specified type. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7836 rel="external nofollow noreferrer" target=_blank>#7836</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7908 rel="external nofollow noreferrer" target=_blank>#7908</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Allowed non-constant negative "size" argument for function <code class=syntax>substring</code>. It was not allowed by mistake. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4832 rel="external nofollow noreferrer" target=_blank>#4832</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7703 rel="external nofollow noreferrer" target=_blank>#7703</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix parsing bug when wrong number of arguments passed to <code class=syntax>(O|J)DBC</code> table engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/7709 rel="external nofollow noreferrer" target=_blank>#7709</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Using command name of the running clickhouse process when sending logs to syslog. In previous versions, empty string was used instead of command name. <a href=https://github.com/ClickHouse/ClickHouse/pull/8460 rel="external nofollow noreferrer" target=_blank>#8460</a> (<a href=https://github.com/mnach rel="external nofollow noreferrer" target=_blank>Michael Nacharov</a>)</li><li>Fix check of allowed hosts for <code class=syntax>localhost</code>. This PR fixes the solution provided in <a href=https://github.com/ClickHouse/ClickHouse/pull/8241 rel="external nofollow noreferrer" target=_blank>#8241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8342 rel="external nofollow noreferrer" target=_blank>#8342</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fix rare crash in <code class=syntax>argMin</code> and <code class=syntax>argMax</code> functions for long string arguments, when result is used in <code class=syntax>runningAccumulate</code> function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8325 rel="external nofollow noreferrer" target=_blank>#8325</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8341 rel="external nofollow noreferrer" target=_blank>#8341</a> (<a href=https://github.com/769344359 rel="external nofollow noreferrer" target=_blank>dinosaur</a>)</li><li>Fix memory overcommit for tables with <code class=syntax>Buffer</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/8345 rel="external nofollow noreferrer" target=_blank>#8345</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fixed potential bug in functions that can take <code class=syntax>NULL</code> as one of the arguments and return non-NULL. <a href=https://github.com/ClickHouse/ClickHouse/pull/8196 rel="external nofollow noreferrer" target=_blank>#8196</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Better metrics calculations in thread pool for background processes for <code class=syntax>MergeTree</code> table engines. <a href=https://github.com/ClickHouse/ClickHouse/pull/8194 rel="external nofollow noreferrer" target=_blank>#8194</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix function <code class=syntax>IN</code> inside <code class=syntax>WHERE</code> statement when row-level table filter is present. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6687 rel="external nofollow noreferrer" target=_blank>#6687</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8357 rel="external nofollow noreferrer" target=_blank>#8357</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Now an exception is thrown if the integral value is not parsed completely for settings values. <a href=https://github.com/ClickHouse/ClickHouse/pull/7678 rel="external nofollow noreferrer" target=_blank>#7678</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Fix exception when aggregate function is used in query to distributed table with more than two local shards. <a href=https://github.com/ClickHouse/ClickHouse/pull/8164 rel="external nofollow noreferrer" target=_blank>#8164</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li><li>Now bloom filter can handle zero length arrays and doesn't perform redundant calculations. <a href=https://github.com/ClickHouse/ClickHouse/pull/8242 rel="external nofollow noreferrer" target=_blank>#8242</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li><li>Fixed checking if a client host is allowed by matching the client host to <code class=syntax>host_regexp</code> specified in <code class=syntax>users.xml</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8241 rel="external nofollow noreferrer" target=_blank>#8241</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Relax ambiguous column check that leads to false positives in multiple <code class=syntax>JOIN ON</code> section. <a href=https://github.com/ClickHouse/ClickHouse/pull/8385 rel="external nofollow noreferrer" target=_blank>#8385</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fixed possible server crash (<code class=syntax>std::terminate</code>) when the server cannot send or write data in <code class=syntax>JSON</code> or <code class=syntax>XML</code> format with values of <code class=syntax>String</code> data type (that require <code class=syntax>UTF-8</code> validation) or when compressing result data with Brotli algorithm or in some other rare cases. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7603 rel="external nofollow noreferrer" target=_blank>#7603</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8384 rel="external nofollow noreferrer" target=_blank>#8384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix race condition in <code class=syntax>StorageDistributedDirectoryMonitor</code> found by CI. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8364 rel="external nofollow noreferrer" target=_blank>#8364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8383 rel="external nofollow noreferrer" target=_blank>#8383</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Now background merges in <code class=syntax>*MergeTree</code> table engines family preserve storage policy volume order more accurately. <a href=https://github.com/ClickHouse/ClickHouse/pull/8549 rel="external nofollow noreferrer" target=_blank>#8549</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Now table engine <code class=syntax>Kafka</code> works properly with <code class=syntax>Native</code> format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6731 rel="external nofollow noreferrer" target=_blank>#6731</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/7337 rel="external nofollow noreferrer" target=_blank>#7337</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/8003 rel="external nofollow noreferrer" target=_blank>#8003</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8016 rel="external nofollow noreferrer" target=_blank>#8016</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fixed formats with headers (like <code class=syntax>CSVWithNames</code>) which were throwing exception about EOF for table engine <code class=syntax>Kafka</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8016 rel="external nofollow noreferrer" target=_blank>#8016</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Fixed a bug with making set from subquery in right part of <code class=syntax>IN</code> section. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5767 rel="external nofollow noreferrer" target=_blank>#5767</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/2542 rel="external nofollow noreferrer" target=_blank>#2542</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7755 rel="external nofollow noreferrer" target=_blank>#7755</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Fix possible crash while reading from storage <code class=syntax>File</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7756 rel="external nofollow noreferrer" target=_blank>#7756</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed reading of the files in <code class=syntax>Parquet</code> format containing columns of type <code class=syntax>list</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8334 rel="external nofollow noreferrer" target=_blank>#8334</a> (<a href=https://github.com/maxulan rel="external nofollow noreferrer" target=_blank>maxulan</a>)</li><li>Fix error <code class=syntax>Not found column</code> for distributed queries with <code class=syntax>PREWHERE</code> condition dependent on sampling key if <code class=syntax>max_parallel_replicas &gt; 1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7913 rel="external nofollow noreferrer" target=_blank>#7913</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix error <code class=syntax>Not found column</code> if query used <code class=syntax>PREWHERE</code> dependent on table's alias and the result set was empty because of primary key condition. <a href=https://github.com/ClickHouse/ClickHouse/pull/7911 rel="external nofollow noreferrer" target=_blank>#7911</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed return type for functions <code class=syntax>rand</code> and <code class=syntax>randConstant</code> in case of <code class=syntax>Nullable</code> argument. Now functions always return <code class=syntax>UInt32</code> and never <code class=syntax>Nullable(UInt32)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8204 rel="external nofollow noreferrer" target=_blank>#8204</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Disabled predicate push-down for <code class=syntax>WITH FILL</code> expression. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7784 rel="external nofollow noreferrer" target=_blank>#7784</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7789 rel="external nofollow noreferrer" target=_blank>#7789</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Fixed incorrect <code class=syntax>count()</code> result for <code class=syntax>SummingMergeTree</code> when <code class=syntax>FINAL</code> section is used. <a href=https://github.com/ClickHouse/ClickHouse/issues/3280 rel="external nofollow noreferrer" target=_blank>#3280</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7786 rel="external nofollow noreferrer" target=_blank>#7786</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Fix possible incorrect result for constant functions from remote servers. It happened for queries with functions like <code class=syntax>version()</code>, <code class=syntax>uptime()</code>, etc. which returns different constant values for different servers. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7666 rel="external nofollow noreferrer" target=_blank>#7666</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7689 rel="external nofollow noreferrer" target=_blank>#7689</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix complicated bug in push-down predicate optimization which leads to wrong results. This fixes a lot of issues on push-down predicate optimization. <a href=https://github.com/ClickHouse/ClickHouse/pull/8503 rel="external nofollow noreferrer" target=_blank>#8503</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Fix crash in <code class=syntax>CREATE TABLE .. AS dictionary</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/8508 rel="external nofollow noreferrer" target=_blank>#8508</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Several improvements ClickHouse grammar in <code class=syntax>.g4</code> file. <a href=https://github.com/ClickHouse/ClickHouse/pull/8294 rel="external nofollow noreferrer" target=_blank>#8294</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>)</li><li>Fix bug that leads to crashes in <code class=syntax>JOIN</code>s with tables with engine <code class=syntax>Join</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7556 rel="external nofollow noreferrer" target=_blank>#7556</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/8254 rel="external nofollow noreferrer" target=_blank>#8254</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/7915 rel="external nofollow noreferrer" target=_blank>#7915</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/8100 rel="external nofollow noreferrer" target=_blank>#8100</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8298 rel="external nofollow noreferrer" target=_blank>#8298</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fix redundant dictionaries reload on <code class=syntax>CREATE DATABASE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7916 rel="external nofollow noreferrer" target=_blank>#7916</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Limit maximum number of streams for read from <code class=syntax>StorageFile</code> and <code class=syntax>StorageHDFS</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7650 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/7650</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7981 rel="external nofollow noreferrer" target=_blank>#7981</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix bug in <code class=syntax>ALTER ... MODIFY ... CODEC</code> query, when user specify both default expression and codec. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8593 rel="external nofollow noreferrer" target=_blank>8593</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8614 rel="external nofollow noreferrer" target=_blank>#8614</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix error in background merge of columns with <code class=syntax>SimpleAggregateFunction(LowCardinality)</code> type. <a href=https://github.com/ClickHouse/ClickHouse/pull/8613 rel="external nofollow noreferrer" target=_blank>#8613</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fixed type check in function <code class=syntax>toDateTime64</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8375 rel="external nofollow noreferrer" target=_blank>#8375</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Now server do not crash on <code class=syntax>LEFT</code> or <code class=syntax>FULL JOIN</code> with and Join engine and unsupported <code class=syntax>join_use_nulls</code> settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/8479 rel="external nofollow noreferrer" target=_blank>#8479</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Now <code class=syntax>DROP DICTIONARY IF EXISTS db.dict</code> query doesn't throw exception if <code class=syntax>db</code> doesn't exist. <a href=https://github.com/ClickHouse/ClickHouse/pull/8185 rel="external nofollow noreferrer" target=_blank>#8185</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Fix possible crashes in table functions (<code class=syntax>file</code>, <code class=syntax>mysql</code>, <code class=syntax>remote</code>) caused by usage of reference to removed <code class=syntax>IStorage</code> object. Fix incorrect parsing of columns specified at insertion into table function. <a href=https://github.com/ClickHouse/ClickHouse/pull/7762 rel="external nofollow noreferrer" target=_blank>#7762</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Ensure network be up before starting <code class=syntax>clickhouse-server</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7507 rel="external nofollow noreferrer" target=_blank>#7507</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8570 rel="external nofollow noreferrer" target=_blank>#8570</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li><li>Fix timeouts handling for secure connections, so queries doesn't hang indefenitely. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8126 rel="external nofollow noreferrer" target=_blank>#8126</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8128 rel="external nofollow noreferrer" target=_blank>#8128</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix <code class=syntax>clickhouse-copier</code>'s redundant contention between concurrent workers. <a href=https://github.com/ClickHouse/ClickHouse/pull/7816 rel="external nofollow noreferrer" target=_blank>#7816</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li><li>Now mutations doesn't skip attached parts, even if their mutation version were larger than current mutation version. <a href=https://github.com/ClickHouse/ClickHouse/pull/7812 rel="external nofollow noreferrer" target=_blank>#7812</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8250 rel="external nofollow noreferrer" target=_blank>#8250</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Ignore redundant copies of <code class=syntax>*MergeTree</code> data parts after move to another disk and server restart. <a href=https://github.com/ClickHouse/ClickHouse/pull/7810 rel="external nofollow noreferrer" target=_blank>#7810</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix crash in <code class=syntax>FULL JOIN</code> with <code class=syntax>LowCardinality</code> in <code class=syntax>JOIN</code> key. <a href=https://github.com/ClickHouse/ClickHouse/pull/8252 rel="external nofollow noreferrer" target=_blank>#8252</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Forbidden to use column name more than once in insert query like <code class=syntax>INSERT INTO tbl (x, y, x)</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5465 rel="external nofollow noreferrer" target=_blank>#5465</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7681 rel="external nofollow noreferrer" target=_blank>#7681</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7685 rel="external nofollow noreferrer" target=_blank>#7685</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Added fallback for detection the number of physical CPU cores for unknown CPUs (using the number of logical CPU cores). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5239 rel="external nofollow noreferrer" target=_blank>#5239</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7726 rel="external nofollow noreferrer" target=_blank>#7726</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix <code class=syntax>There's no column</code> error for materialized and alias columns. <a href=https://github.com/ClickHouse/ClickHouse/pull/8210 rel="external nofollow noreferrer" target=_blank>#8210</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fixed sever crash when <code class=syntax>EXISTS</code> query was used without <code class=syntax>TABLE</code> or <code class=syntax>DICTIONARY</code> qualifier. Just like <code class=syntax>EXISTS t</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8172 rel="external nofollow noreferrer" target=_blank>#8172</a>. This bug was introduced in version 19.17. <a href=https://github.com/ClickHouse/ClickHouse/pull/8213 rel="external nofollow noreferrer" target=_blank>#8213</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix rare bug with error <code class=syntax>"Sizes of columns doesn't match"</code> that might appear when using <code class=syntax>SimpleAggregateFunction</code> column. <a href=https://github.com/ClickHouse/ClickHouse/pull/7790 rel="external nofollow noreferrer" target=_blank>#7790</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li><li>Fix bug where user with empty <code class=syntax>allow_databases</code> got access to all databases (and same for <code class=syntax>allow_dictionaries</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7793 rel="external nofollow noreferrer" target=_blank>#7793</a> (<a href=https://github.com/DeifyTheGod rel="external nofollow noreferrer" target=_blank>DeifyTheGod</a>)</li><li>Fix client crash when server already disconnected from client. <a href=https://github.com/ClickHouse/ClickHouse/pull/8071 rel="external nofollow noreferrer" target=_blank>#8071</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix <code class=syntax>ORDER BY</code> behaviour in case of sorting by primary key prefix and non primary key suffix. <a href=https://github.com/ClickHouse/ClickHouse/pull/7759 rel="external nofollow noreferrer" target=_blank>#7759</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Check if qualified column present in the table. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6836 rel="external nofollow noreferrer" target=_blank>#6836</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7758 rel="external nofollow noreferrer" target=_blank>#7758</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Fixed behavior with <code class=syntax>ALTER MOVE</code> ran immediately after merge finish moves superpart of specified. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8103 rel="external nofollow noreferrer" target=_blank>#8103</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8104 rel="external nofollow noreferrer" target=_blank>#8104</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix possible server crash while using <code class=syntax>UNION</code> with different number of columns. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7279 rel="external nofollow noreferrer" target=_blank>#7279</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7929 rel="external nofollow noreferrer" target=_blank>#7929</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix size of result substring for function <code class=syntax>substr</code> with negative size. <a href=https://github.com/ClickHouse/ClickHouse/pull/8589 rel="external nofollow noreferrer" target=_blank>#8589</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Now server does not execute part mutation in <code class=syntax>MergeTree</code> if there are not enough free threads in background pool. <a href=https://github.com/ClickHouse/ClickHouse/pull/8588 rel="external nofollow noreferrer" target=_blank>#8588</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix a minor typo on formatting <code class=syntax>UNION ALL</code> AST. <a href=https://github.com/ClickHouse/ClickHouse/pull/7999 rel="external nofollow noreferrer" target=_blank>#7999</a> (<a href=https://github.com/litao91 rel="external nofollow noreferrer" target=_blank>litao91</a>)</li><li>Fixed incorrect bloom filter results for negative numbers. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8317 rel="external nofollow noreferrer" target=_blank>#8317</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8566 rel="external nofollow noreferrer" target=_blank>#8566</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Fixed potential buffer overflow in decompress. Malicious user can pass fabricated compressed data that will cause read after buffer. This issue was found by Eldar Zaitov from Yandex information security team. <a href=https://github.com/ClickHouse/ClickHouse/pull/8404 rel="external nofollow noreferrer" target=_blank>#8404</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix incorrect result because of integers overflow in <code class=syntax>arrayIntersect</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7777 rel="external nofollow noreferrer" target=_blank>#7777</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Now <code class=syntax>OPTIMIZE TABLE</code> query will not wait for offline replicas to perform the operation. <a href=https://github.com/ClickHouse/ClickHouse/pull/8314 rel="external nofollow noreferrer" target=_blank>#8314</a> (<a href=https://github.com/javisantana rel="external nofollow noreferrer" target=_blank>javi santana</a>)</li><li>Fixed <code class=syntax>ALTER TTL</code> parser for <code class=syntax>Replicated*MergeTree</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/8318 rel="external nofollow noreferrer" target=_blank>#8318</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix communication between server and client, so server read temporary tables info after query failure. <a href=https://github.com/ClickHouse/ClickHouse/pull/8084 rel="external nofollow noreferrer" target=_blank>#8084</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fix <code class=syntax>bitmapAnd</code> function error when intersecting an aggregated bitmap and a scalar bitmap. <a href=https://github.com/ClickHouse/ClickHouse/pull/8082 rel="external nofollow noreferrer" target=_blank>#8082</a> (<a href=https://github.com/moon03432 rel="external nofollow noreferrer" target=_blank>Yue Huang</a>)</li><li>Refine the definition of <code class=syntax>ZXid</code> according to the ZooKeeper Programmer's Guide which fixes bug in <code class=syntax>clickhouse-cluster-copier</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8088 rel="external nofollow noreferrer" target=_blank>#8088</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li><li><code class=syntax>odbc</code> table function now respects <code class=syntax>external_table_functions_use_nulls</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/7506 rel="external nofollow noreferrer" target=_blank>#7506</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Fixed bug that lead to a rare data race. <a href=https://github.com/ClickHouse/ClickHouse/pull/8143 rel="external nofollow noreferrer" target=_blank>#8143</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Now <code class=syntax>SYSTEM RELOAD DICTIONARY</code> reloads a dictionary completely, ignoring <code class=syntax>update_field</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7440 rel="external nofollow noreferrer" target=_blank>#7440</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8037 rel="external nofollow noreferrer" target=_blank>#8037</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Add ability to check if dictionary exists in create query. <a href=https://github.com/ClickHouse/ClickHouse/pull/8032 rel="external nofollow noreferrer" target=_blank>#8032</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix <code class=syntax>Float*</code> parsing in <code class=syntax>Values</code> format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7817 rel="external nofollow noreferrer" target=_blank>#7817</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7870 rel="external nofollow noreferrer" target=_blank>#7870</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fix crash when we cannot reserve space in some background operations of <code class=syntax>*MergeTree</code> table engines family. <a href=https://github.com/ClickHouse/ClickHouse/pull/7873 rel="external nofollow noreferrer" target=_blank>#7873</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix crash of merge operation when table contains <code class=syntax>SimpleAggregateFunction(LowCardinality)</code> column. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8515 rel="external nofollow noreferrer" target=_blank>#8515</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8522 rel="external nofollow noreferrer" target=_blank>#8522</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Restore support of all ICU locales and add the ability to apply collations for constant expressions. Also add language name to <code class=syntax>system.collations</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8051 rel="external nofollow noreferrer" target=_blank>#8051</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix bug when external dictionaries with zero minimal lifetime (<code class=syntax>LIFETIME(MIN 0 MAX N)</code>, <code class=syntax>LIFETIME(N)</code>) don't update in background. <a href=https://github.com/ClickHouse/ClickHouse/pull/7983 rel="external nofollow noreferrer" target=_blank>#7983</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix crash when external dictionary with ClickHouse source has subquery in query. <a href=https://github.com/ClickHouse/ClickHouse/pull/8351 rel="external nofollow noreferrer" target=_blank>#8351</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Fix incorrect parsing of file extension in table with engine <code class=syntax>URL</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8157 rel="external nofollow noreferrer" target=_blank>#8157</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8419 rel="external nofollow noreferrer" target=_blank>#8419</a> (<a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a>)</li><li>Fix <code class=syntax>CHECK TABLE</code> query for <code class=syntax>*MergeTree</code> tables without key. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7543 rel="external nofollow noreferrer" target=_blank>#7543</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7979 rel="external nofollow noreferrer" target=_blank>#7979</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed conversion of <code class=syntax>Float64</code> to MySQL type. <a href=https://github.com/ClickHouse/ClickHouse/pull/8079 rel="external nofollow noreferrer" target=_blank>#8079</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li><li>Now if table was not completely dropped because of server crash, server will try to restore and load it. <a href=https://github.com/ClickHouse/ClickHouse/pull/8176 rel="external nofollow noreferrer" target=_blank>#8176</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li><li>Fixed crash in table function <code class=syntax>file</code> while inserting into file that doesn't exist. Now in this case file would be created and then insert would be processed. <a href=https://github.com/ClickHouse/ClickHouse/pull/8177 rel="external nofollow noreferrer" target=_blank>#8177</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li><li>Fix rare deadlock which can happen when <code class=syntax>trace_log</code> is in enabled. <a href=https://github.com/ClickHouse/ClickHouse/pull/7838 rel="external nofollow noreferrer" target=_blank>#7838</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Add ability to work with different types besides <code class=syntax>Date</code> in <code class=syntax>RangeHashed</code> external dictionary created from DDL query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7899 rel="external nofollow noreferrer" target=_blank>7899</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8275 rel="external nofollow noreferrer" target=_blank>#8275</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixes crash when <code class=syntax>now64()</code> is called with result of another function. <a href=https://github.com/ClickHouse/ClickHouse/pull/8270 rel="external nofollow noreferrer" target=_blank>#8270</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Fixed bug with detecting client IP for connections through mysql wire protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/7743 rel="external nofollow noreferrer" target=_blank>#7743</a> (<a href=https://github.com/dmitriy-myz rel="external nofollow noreferrer" target=_blank>Dmitry Muzyka</a>)</li><li>Fix empty array handling in <code class=syntax>arraySplit</code> function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7708 rel="external nofollow noreferrer" target=_blank>#7708</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7747 rel="external nofollow noreferrer" target=_blank>#7747</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Fixed the issue when <code class=syntax>pid-file</code> of another running <code class=syntax>clickhouse-server</code> may be deleted. <a href=https://github.com/ClickHouse/ClickHouse/pull/8487 rel="external nofollow noreferrer" target=_blank>#8487</a> (<a href=https://github.com/weiqxu rel="external nofollow noreferrer" target=_blank>Weiqing Xu</a>)</li><li>Fix dictionary reload if it has <code class=syntax>invalidate_query</code>, which stopped updates and some exception on previous update tries. <a href=https://github.com/ClickHouse/ClickHouse/pull/8029 rel="external nofollow noreferrer" target=_blank>#8029</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fixed error in function <code class=syntax>arrayReduce</code> that may lead to "double free" and error in aggregate function combinator <code class=syntax>Resample</code> that may lead to memory leak. Added aggregate function <code class=syntax>aggThrow</code>. This function can be used for testing purposes. <a href=https://github.com/ClickHouse/ClickHouse/pull/8446 rel="external nofollow noreferrer" target=_blank>#8446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h4 id=improvement_5>Improvement<a class=headerlink href=../amp/#improvement_5 title="Permanent link"> </a></h4><ul><li>Improved logging when working with <code class=syntax>S3</code> table engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/8251 rel="external nofollow noreferrer" target=_blank>#8251</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>)</li><li>Printed help message when no arguments are passed when calling <code class=syntax>clickhouse-local</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5335 rel="external nofollow noreferrer" target=_blank>#5335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8230 rel="external nofollow noreferrer" target=_blank>#8230</a> (<a href=https://github.com/Melancholic rel="external nofollow noreferrer" target=_blank>Andrey Nagorny</a>)</li><li>Add setting <code class=syntax>mutations_sync</code> which allows to wait <code class=syntax>ALTER UPDATE/DELETE</code> queries synchronously. <a href=https://github.com/ClickHouse/ClickHouse/pull/8237 rel="external nofollow noreferrer" target=_blank>#8237</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Allow to set up relative <code class=syntax>user_files_path</code> in <code class=syntax>config.xml</code> (in the way similar to <code class=syntax>format_schema_path</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7632 rel="external nofollow noreferrer" target=_blank>#7632</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Add exception for illegal types for conversion functions with <code class=syntax>-OrZero</code> postfix. <a href=https://github.com/ClickHouse/ClickHouse/pull/7880 rel="external nofollow noreferrer" target=_blank>#7880</a> (<a href=https://github.com/akonyaev90 rel="external nofollow noreferrer" target=_blank>Andrey Konyaev</a>)</li><li>Simplify format of the header of data sending to a shard in a distributed query. <a href=https://github.com/ClickHouse/ClickHouse/pull/8044 rel="external nofollow noreferrer" target=_blank>#8044</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li><code class=syntax>Live View</code> table engine refactoring. <a href=https://github.com/ClickHouse/ClickHouse/pull/8519 rel="external nofollow noreferrer" target=_blank>#8519</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li><li>Add additional checks for external dictionaries created from DDL-queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/8127 rel="external nofollow noreferrer" target=_blank>#8127</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Fix error <code class=syntax>Column ... already exists</code> while using <code class=syntax>FINAL</code> and <code class=syntax>SAMPLE</code> together, e.g. <code class=syntax>select count() from table final sample 1/2</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5186 rel="external nofollow noreferrer" target=_blank>#5186</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7907 rel="external nofollow noreferrer" target=_blank>#7907</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Now table the first argument of <code class=syntax>joinGet</code> function can be table indentifier. <a href=https://github.com/ClickHouse/ClickHouse/pull/7707 rel="external nofollow noreferrer" target=_blank>#7707</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Allow using <code class=syntax>MaterializedView</code> with subqueries above <code class=syntax>Kafka</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/8197 rel="external nofollow noreferrer" target=_blank>#8197</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Now background moves between disks run it the seprate thread pool. <a href=https://github.com/ClickHouse/ClickHouse/pull/7670 rel="external nofollow noreferrer" target=_blank>#7670</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li><code class=syntax>SYSTEM RELOAD DICTIONARY</code> now executes synchronously. <a href=https://github.com/ClickHouse/ClickHouse/pull/8240 rel="external nofollow noreferrer" target=_blank>#8240</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Stack traces now display physical addresses (offsets in object file) instead of virtual memory addresses (where the object file was loaded). That allows the use of <code class=syntax>addr2line</code> when binary is position independent and ASLR is active. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8360 rel="external nofollow noreferrer" target=_blank>#8360</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8387 rel="external nofollow noreferrer" target=_blank>#8387</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Support new syntax for row-level security filters: <code class=syntax>&lt;table name='table_name'&gt;…&lt;/table&gt;</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5779 rel="external nofollow noreferrer" target=_blank>#5779</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8381 rel="external nofollow noreferrer" target=_blank>#8381</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Now <code class=syntax>cityHash</code> function can work with <code class=syntax>Decimal</code> and <code class=syntax>UUID</code> types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5184 rel="external nofollow noreferrer" target=_blank>#5184</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7693 rel="external nofollow noreferrer" target=_blank>#7693</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li><li>Removed fixed index granularity (it was 1024) from system logs because it's obsolete after implementation of adaptive granularity. <a href=https://github.com/ClickHouse/ClickHouse/pull/7698 rel="external nofollow noreferrer" target=_blank>#7698</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Enabled MySQL compatibility server when ClickHouse is compiled without SSL. <a href=https://github.com/ClickHouse/ClickHouse/pull/7852 rel="external nofollow noreferrer" target=_blank>#7852</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li><li>Now server checksums distributed batches, which gives more verbose errors in case of corrupted data in batch. <a href=https://github.com/ClickHouse/ClickHouse/pull/7914 rel="external nofollow noreferrer" target=_blank>#7914</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Support <code class=syntax>DROP DATABASE</code>, <code class=syntax>DETACH TABLE</code>, <code class=syntax>DROP TABLE</code> and <code class=syntax>ATTACH TABLE</code> for <code class=syntax>MySQL</code> database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/8202 rel="external nofollow noreferrer" target=_blank>#8202</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li><li>Add authentication in S3 table function and table engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/7623 rel="external nofollow noreferrer" target=_blank>#7623</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Added check for extra parts of <code class=syntax>MergeTree</code> at different disks, in order to not allow to miss data parts at undefined disks. <a href=https://github.com/ClickHouse/ClickHouse/pull/8118 rel="external nofollow noreferrer" target=_blank>#8118</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Enable SSL support for Mac client and server. <a href=https://github.com/ClickHouse/ClickHouse/pull/8297 rel="external nofollow noreferrer" target=_blank>#8297</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Now ClickHouse can work as MySQL federated server (see <a href=https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html target=_blank>https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7717 rel="external nofollow noreferrer" target=_blank>#7717</a> (<a href=https://github.com/MaxFedotov rel="external nofollow noreferrer" target=_blank>Maxim Fedotov</a>)</li><li><code class=syntax>clickhouse-client</code> now only enable <code class=syntax>bracketed-paste</code> when multiquery is on and multiline is off. This fixes (#7757)[<a href=https://github.com/ClickHouse/ClickHouse/issues/7757 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/7757</a>]. <a href=https://github.com/ClickHouse/ClickHouse/pull/7761 rel="external nofollow noreferrer" target=_blank>#7761</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Support <code class=syntax>Array(Decimal)</code> in <code class=syntax>if</code> function. <a href=https://github.com/ClickHouse/ClickHouse/pull/7721 rel="external nofollow noreferrer" target=_blank>#7721</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Support Decimals in <code class=syntax>arrayDifference</code>, <code class=syntax>arrayCumSum</code> and <code class=syntax>arrayCumSumNegative</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/7724 rel="external nofollow noreferrer" target=_blank>#7724</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Added <code class=syntax>lifetime</code> column to <code class=syntax>system.dictionaries</code> table. <a href=https://github.com/ClickHouse/ClickHouse/issues/6820 rel="external nofollow noreferrer" target=_blank>#6820</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7727 rel="external nofollow noreferrer" target=_blank>#7727</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>kekekekule</a>)</li><li>Improved check for existing parts on different disks for <code class=syntax>*MergeTree</code> table engines. Addresses <a href=https://github.com/ClickHouse/ClickHouse/issues/7660 rel="external nofollow noreferrer" target=_blank>#7660</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8440 rel="external nofollow noreferrer" target=_blank>#8440</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Integration with <code class=syntax>AWS SDK</code> for <code class=syntax>S3</code> interactions which allows to use all S3 features out of the box. <a href=https://github.com/ClickHouse/ClickHouse/pull/8011 rel="external nofollow noreferrer" target=_blank>#8011</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Added support for subqueries in <code class=syntax>Live View</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/7792 rel="external nofollow noreferrer" target=_blank>#7792</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li><li>Check for using <code class=syntax>Date</code> or <code class=syntax>DateTime</code> column from <code class=syntax>TTL</code> expressions was removed. <a href=https://github.com/ClickHouse/ClickHouse/pull/7920 rel="external nofollow noreferrer" target=_blank>#7920</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Information about disk was added to <code class=syntax>system.detached_parts</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/7833 rel="external nofollow noreferrer" target=_blank>#7833</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Now settings <code class=syntax>max_(table|partition)_size_to_drop</code> can be changed without a restart. <a href=https://github.com/ClickHouse/ClickHouse/pull/7779 rel="external nofollow noreferrer" target=_blank>#7779</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>)</li><li>Slightly better usability of error messages. Ask user not to remove the lines below <code class=syntax>Stack trace:</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7897 rel="external nofollow noreferrer" target=_blank>#7897</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Better reading messages from <code class=syntax>Kafka</code> engine in various formats after <a href=https://github.com/ClickHouse/ClickHouse/issues/7935 rel="external nofollow noreferrer" target=_blank>#7935</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8035 rel="external nofollow noreferrer" target=_blank>#8035</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Better compatibility with MySQL clients which don't support <code class=syntax>sha2_password</code> auth plugin. <a href=https://github.com/ClickHouse/ClickHouse/pull/8036 rel="external nofollow noreferrer" target=_blank>#8036</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li><li>Support more column types in MySQL compatibility server. <a href=https://github.com/ClickHouse/ClickHouse/pull/7975 rel="external nofollow noreferrer" target=_blank>#7975</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li><li>Implement <code class=syntax>ORDER BY</code> optimization for <code class=syntax>Merge</code>, <code class=syntax>Buffer</code> and <code class=syntax>Materilized View</code> storages with underlying <code class=syntax>MergeTree</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/8130 rel="external nofollow noreferrer" target=_blank>#8130</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li><li>Now we always use POSIX implementation of <code class=syntax>getrandom</code> to have better compatibility with old kernels (&lt; 3.17). <a href=https://github.com/ClickHouse/ClickHouse/pull/7940 rel="external nofollow noreferrer" target=_blank>#7940</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Better check for valid destination in a move TTL rule. <a href=https://github.com/ClickHouse/ClickHouse/pull/8410 rel="external nofollow noreferrer" target=_blank>#8410</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Better checks for broken insert batches for <code class=syntax>Distributed</code> table engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/7933 rel="external nofollow noreferrer" target=_blank>#7933</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Add column with array of parts name which mutations must process in future to <code class=syntax>system.mutations</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/8179 rel="external nofollow noreferrer" target=_blank>#8179</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Parallel merge sort optimization for processors. <a href=https://github.com/ClickHouse/ClickHouse/pull/8552 rel="external nofollow noreferrer" target=_blank>#8552</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>The settings <code class=syntax>mark_cache_min_lifetime</code> is now obsolete and does nothing. In previous versions, mark cache can grow in memory larger than <code class=syntax>mark_cache_size</code> to accomodate data within <code class=syntax>mark_cache_min_lifetime</code> seconds. That was leading to confusion and higher memory usage than expected, that is especially bad on memory constrained systems. If you will see performance degradation after installing this release, you should increase the <code class=syntax>mark_cache_size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8484 rel="external nofollow noreferrer" target=_blank>#8484</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Preparation to use <code class=syntax>tid</code> everywhere. This is needed for <a href=https://github.com/ClickHouse/ClickHouse/issues/7477 rel="external nofollow noreferrer" target=_blank>#7477</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8276 rel="external nofollow noreferrer" target=_blank>#8276</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h4 id=performance-improvement_5>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_5 title="Permanent link"> </a></h4><ul><li>Performance optimizations in processors pipeline. <a href=https://github.com/ClickHouse/ClickHouse/pull/7988 rel="external nofollow noreferrer" target=_blank>#7988</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Non-blocking updates of expired keys in cache dictionaries (with permission to read old ones). <a href=https://github.com/ClickHouse/ClickHouse/pull/8303 rel="external nofollow noreferrer" target=_blank>#8303</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Compile ClickHouse without <code class=syntax>-fno-omit-frame-pointer</code> globally to spare one more register. <a href=https://github.com/ClickHouse/ClickHouse/pull/8097 rel="external nofollow noreferrer" target=_blank>#8097</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Speedup <code class=syntax>greatCircleDistance</code> function and add performance tests for it. <a href=https://github.com/ClickHouse/ClickHouse/pull/7307 rel="external nofollow noreferrer" target=_blank>#7307</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li><li>Improved performance of function <code class=syntax>roundDown</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8465 rel="external nofollow noreferrer" target=_blank>#8465</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Improved performance of <code class=syntax>max</code>, <code class=syntax>min</code>, <code class=syntax>argMin</code>, <code class=syntax>argMax</code> for <code class=syntax>DateTime64</code> data type. <a href=https://github.com/ClickHouse/ClickHouse/pull/8199 rel="external nofollow noreferrer" target=_blank>#8199</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Improved performance of sorting without a limit or with big limit and external sorting. <a href=https://github.com/ClickHouse/ClickHouse/pull/8545 rel="external nofollow noreferrer" target=_blank>#8545</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Improved performance of formatting floating point numbers up to 6 times. <a href=https://github.com/ClickHouse/ClickHouse/pull/8542 rel="external nofollow noreferrer" target=_blank>#8542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Improved performance of <code class=syntax>modulo</code> function. <a href=https://github.com/ClickHouse/ClickHouse/pull/7750 rel="external nofollow noreferrer" target=_blank>#7750</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Optimized <code class=syntax>ORDER BY</code> and merging with single column key. <a href=https://github.com/ClickHouse/ClickHouse/pull/8335 rel="external nofollow noreferrer" target=_blank>#8335</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Better implementation for <code class=syntax>arrayReduce</code>, <code class=syntax>-Array</code> and <code class=syntax>-State</code> combinators. <a href=https://github.com/ClickHouse/ClickHouse/pull/7710 rel="external nofollow noreferrer" target=_blank>#7710</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Now <code class=syntax>PREWHERE</code> should be optimized to be at least as efficient as <code class=syntax>WHERE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7769 rel="external nofollow noreferrer" target=_blank>#7769</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Improve the way <code class=syntax>round</code> and <code class=syntax>roundBankers</code> handling negative numbers. <a href=https://github.com/ClickHouse/ClickHouse/pull/8229 rel="external nofollow noreferrer" target=_blank>#8229</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li><li>Improved decoding performance of <code class=syntax>DoubleDelta</code> and <code class=syntax>Gorilla</code> codecs by roughly 30-40%. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7082 rel="external nofollow noreferrer" target=_blank>#7082</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8019 rel="external nofollow noreferrer" target=_blank>#8019</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Improved performance of <code class=syntax>base64</code> related functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/8444 rel="external nofollow noreferrer" target=_blank>#8444</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Added a function <code class=syntax>geoDistance</code>. It is similar to <code class=syntax>greatCircleDistance</code> but uses approximation to WGS-84 ellipsoid model. The performance of both functions are near the same. <a href=https://github.com/ClickHouse/ClickHouse/pull/8086 rel="external nofollow noreferrer" target=_blank>#8086</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Faster <code class=syntax>min</code> and <code class=syntax>max</code> aggregation functions for <code class=syntax>Decimal</code> data type. <a href=https://github.com/ClickHouse/ClickHouse/pull/8144 rel="external nofollow noreferrer" target=_blank>#8144</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li><li>Vectorize processing <code class=syntax>arrayReduce</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7608 rel="external nofollow noreferrer" target=_blank>#7608</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li><code class=syntax>if</code> chains are now optimized as <code class=syntax>multiIf</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8355 rel="external nofollow noreferrer" target=_blank>#8355</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>kamalov-ruslan</a>)</li><li>Fix performance regression of <code class=syntax>Kafka</code> table engine introduced in 19.15. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7261 rel="external nofollow noreferrer" target=_blank>#7261</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7935 rel="external nofollow noreferrer" target=_blank>#7935</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li><li>Removed "pie" code generation that <code class=syntax>gcc</code> from Debian packages occasionally brings by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/8483 rel="external nofollow noreferrer" target=_blank>#8483</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Parallel parsing data formats <a href=https://github.com/ClickHouse/ClickHouse/pull/6553 rel="external nofollow noreferrer" target=_blank>#6553</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li><li>Enable optimized parser of <code class=syntax>Values</code> with expressions by default (<code class=syntax>input_format_values_deduce_templates_of_expressions=1</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8231 rel="external nofollow noreferrer" target=_blank>#8231</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li></ul><h4 id=build-testing-packaging-improvement_12>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_12 title="Permanent link"> </a></h4><ul><li>Build fixes for <code class=syntax>ARM</code> and in minimal mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/8304 rel="external nofollow noreferrer" target=_blank>#8304</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li><li>Add coverage file flush for <code class=syntax>clickhouse-server</code> when std::atexit is not called. Also slightly improved logging in stateless tests with coverage. <a href=https://github.com/ClickHouse/ClickHouse/pull/8267 rel="external nofollow noreferrer" target=_blank>#8267</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Update LLVM library in contrib. Avoid using LLVM from OS packages. <a href=https://github.com/ClickHouse/ClickHouse/pull/8258 rel="external nofollow noreferrer" target=_blank>#8258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Make bundled <code class=syntax>curl</code> build fully quiet. <a href=https://github.com/ClickHouse/ClickHouse/pull/8232 rel="external nofollow noreferrer" target=_blank>#8232</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8203 rel="external nofollow noreferrer" target=_blank>#8203</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Fix some <code class=syntax>MemorySanitizer</code> warnings. <a href=https://github.com/ClickHouse/ClickHouse/pull/8235 rel="external nofollow noreferrer" target=_blank>#8235</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Use <code class=syntax>add_warning</code> and <code class=syntax>no_warning</code> macros in <code class=syntax>CMakeLists.txt</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8604 rel="external nofollow noreferrer" target=_blank>#8604</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li><li>Add support of Minio S3 Compatible object (<a href=https://min.io/ target=_blank>https://min.io/</a>) for better integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/7863 rel="external nofollow noreferrer" target=_blank>#7863</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7875 rel="external nofollow noreferrer" target=_blank>#7875</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li><li>Imported <code class=syntax>libc</code> headers to contrib. It allows to make builds more consistent across various systems (only for <code class=syntax>x86_64-linux-gnu</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/5773 rel="external nofollow noreferrer" target=_blank>#5773</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Remove <code class=syntax>-fPIC</code> from some libraries. <a href=https://github.com/ClickHouse/ClickHouse/pull/8464 rel="external nofollow noreferrer" target=_blank>#8464</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Clean <code class=syntax>CMakeLists.txt</code> for curl. See <a href=https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8459 rel="external nofollow noreferrer" target=_blank>#8459</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Silent warnings in <code class=syntax>CapNProto</code> library. <a href=https://github.com/ClickHouse/ClickHouse/pull/8220 rel="external nofollow noreferrer" target=_blank>#8220</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Add performance tests for short string optimized hash tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/7679 rel="external nofollow noreferrer" target=_blank>#7679</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Now ClickHouse will build on <code class=syntax>AArch64</code> even if <code class=syntax>MADV_FREE</code> is not available. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8027 rel="external nofollow noreferrer" target=_blank>#8027</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8243 rel="external nofollow noreferrer" target=_blank>#8243</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Update <code class=syntax>zlib-ng</code> to fix memory sanitizer problems. <a href=https://github.com/ClickHouse/ClickHouse/pull/7182 rel="external nofollow noreferrer" target=_blank>#7182</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8206 rel="external nofollow noreferrer" target=_blank>#8206</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Enable internal MySQL library on non-Linux system, because usage of OS packages is very fragile and usually doesn't work at all. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5765 rel="external nofollow noreferrer" target=_blank>#5765</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8426 rel="external nofollow noreferrer" target=_blank>#8426</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed build on some systems after enabling <code class=syntax>libc++</code>. This supersedes <a href=https://github.com/ClickHouse/ClickHouse/issues/8374 rel="external nofollow noreferrer" target=_blank>#8374</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8380 rel="external nofollow noreferrer" target=_blank>#8380</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Make <code class=syntax>Field</code> methods more type-safe to find more errors. <a href=https://github.com/ClickHouse/ClickHouse/pull/7386 rel="external nofollow noreferrer" target=_blank>#7386</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8209 rel="external nofollow noreferrer" target=_blank>#8209</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Added missing files to the <code class=syntax>libc-headers</code> submodule. <a href=https://github.com/ClickHouse/ClickHouse/pull/8507 rel="external nofollow noreferrer" target=_blank>#8507</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix wrong <code class=syntax>JSON</code> quoting in performance test output. <a href=https://github.com/ClickHouse/ClickHouse/pull/8497 rel="external nofollow noreferrer" target=_blank>#8497</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Now stack trace is displayed for <code class=syntax>std::exception</code> and <code class=syntax>Poco::Exception</code>. In previous versions it was available only for <code class=syntax>DB::Exception</code>. This improves diagnostics. <a href=https://github.com/ClickHouse/ClickHouse/pull/8501 rel="external nofollow noreferrer" target=_blank>#8501</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Porting <code class=syntax>clock_gettime</code> and <code class=syntax>clock_nanosleep</code> for fresh glibc versions. <a href=https://github.com/ClickHouse/ClickHouse/pull/8054 rel="external nofollow noreferrer" target=_blank>#8054</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Enable <code class=syntax>part_log</code> in example config for developers. <a href=https://github.com/ClickHouse/ClickHouse/pull/8609 rel="external nofollow noreferrer" target=_blank>#8609</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix async nature of reload in <code class=syntax>01036_no_superfluous_dict_reload_on_create_database*</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8111 rel="external nofollow noreferrer" target=_blank>#8111</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li><li>Fixed codec performance tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/8615 rel="external nofollow noreferrer" target=_blank>#8615</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>Add install scripts for <code class=syntax>.tgz</code> build and documentation for them. <a href=https://github.com/ClickHouse/ClickHouse/pull/8612 rel="external nofollow noreferrer" target=_blank>#8612</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8591 rel="external nofollow noreferrer" target=_blank>#8591</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Removed old <code class=syntax>ZSTD</code> test (it was created in year 2016 to reproduce the bug that pre 1.0 version of ZSTD has had). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8618 rel="external nofollow noreferrer" target=_blank>#8618</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8619 rel="external nofollow noreferrer" target=_blank>#8619</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed build on Mac OS Catalina. <a href=https://github.com/ClickHouse/ClickHouse/pull/8600 rel="external nofollow noreferrer" target=_blank>#8600</a> (<a href=https://github.com/meob rel="external nofollow noreferrer" target=_blank>meo</a>)</li><li>Increased number of rows in codec performance tests to make results noticeable. <a href=https://github.com/ClickHouse/ClickHouse/pull/8574 rel="external nofollow noreferrer" target=_blank>#8574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li>In debug builds, treat <code class=syntax>LOGICAL_ERROR</code> exceptions as assertion failures, so that they are easier to notice. <a href=https://github.com/ClickHouse/ClickHouse/pull/8475 rel="external nofollow noreferrer" target=_blank>#8475</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Make formats-related performance test more deterministic. <a href=https://github.com/ClickHouse/ClickHouse/pull/8477 rel="external nofollow noreferrer" target=_blank>#8477</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Update <code class=syntax>lz4</code> to fix a MemorySanitizer failure. <a href=https://github.com/ClickHouse/ClickHouse/pull/8181 rel="external nofollow noreferrer" target=_blank>#8181</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Suppress a known MemorySanitizer false positive in exception handling. <a href=https://github.com/ClickHouse/ClickHouse/pull/8182 rel="external nofollow noreferrer" target=_blank>#8182</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Update <code class=syntax>gcc</code> and <code class=syntax>g++</code> to version 9 in <code class=syntax>build/docker/build.sh</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/7766 rel="external nofollow noreferrer" target=_blank>#7766</a> (<a href=https://github.com/tlightsky rel="external nofollow noreferrer" target=_blank>TLightSky</a>)</li><li>Add performance test case to test that <code class=syntax>PREWHERE</code> is worse than <code class=syntax>WHERE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7768 rel="external nofollow noreferrer" target=_blank>#7768</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Progress towards fixing one flacky test. <a href=https://github.com/ClickHouse/ClickHouse/pull/8621 rel="external nofollow noreferrer" target=_blank>#8621</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Avoid MemorySanitizer report for data from <code class=syntax>libunwind</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8539 rel="external nofollow noreferrer" target=_blank>#8539</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Updated <code class=syntax>libc++</code> to the latest version. <a href=https://github.com/ClickHouse/ClickHouse/pull/8324 rel="external nofollow noreferrer" target=_blank>#8324</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Build ICU library from sources. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6460 rel="external nofollow noreferrer" target=_blank>#6460</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8219 rel="external nofollow noreferrer" target=_blank>#8219</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Switched from <code class=syntax>libressl</code> to <code class=syntax>openssl</code>. ClickHouse should support TLS 1.3 and SNI after this change. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8171 rel="external nofollow noreferrer" target=_blank>#8171</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8218 rel="external nofollow noreferrer" target=_blank>#8218</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fixed UBSan report when using <code class=syntax>chacha20_poly1305</code> from SSL (happens on connect to <a href=https://yandex.ru/ target=_blank>https://yandex.ru/</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8214 rel="external nofollow noreferrer" target=_blank>#8214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix mode of default password file for <code class=syntax>.deb</code> linux distros. <a href=https://github.com/ClickHouse/ClickHouse/pull/8075 rel="external nofollow noreferrer" target=_blank>#8075</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li><li>Improved expression for getting <code class=syntax>clickhouse-server</code> PID in <code class=syntax>clickhouse-test</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8063 rel="external nofollow noreferrer" target=_blank>#8063</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li><li>Updated contrib/googletest to v1.10.0. <a href=https://github.com/ClickHouse/ClickHouse/pull/8587 rel="external nofollow noreferrer" target=_blank>#8587</a> (<a href=https://github.com/Alex-Burmak rel="external nofollow noreferrer" target=_blank>Alexander Burmak</a>)</li><li>Fixed ThreadSaninitizer report in <code class=syntax>base64</code> library. Also updated this library to the latest version, but it doesn't matter. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8397 rel="external nofollow noreferrer" target=_blank>#8397</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8403 rel="external nofollow noreferrer" target=_blank>#8403</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Fix <code class=syntax>00600_replace_running_query</code> for processors. <a href=https://github.com/ClickHouse/ClickHouse/pull/8272 rel="external nofollow noreferrer" target=_blank>#8272</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Remove support for <code class=syntax>tcmalloc</code> to make <code class=syntax>CMakeLists.txt</code> simpler. <a href=https://github.com/ClickHouse/ClickHouse/pull/8310 rel="external nofollow noreferrer" target=_blank>#8310</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Release gcc builds now use <code class=syntax>libc++</code> instead of <code class=syntax>libstdc++</code>. Recently <code class=syntax>libc++</code> was used only with clang. This will improve consistency of build configurations and portability. <a href=https://github.com/ClickHouse/ClickHouse/pull/8311 rel="external nofollow noreferrer" target=_blank>#8311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Enable ICU library for build with MemorySanitizer. <a href=https://github.com/ClickHouse/ClickHouse/pull/8222 rel="external nofollow noreferrer" target=_blank>#8222</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Suppress warnings from <code class=syntax>CapNProto</code> library. <a href=https://github.com/ClickHouse/ClickHouse/pull/8224 rel="external nofollow noreferrer" target=_blank>#8224</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Removed special cases of code for <code class=syntax>tcmalloc</code>, because it's no longer supported. <a href=https://github.com/ClickHouse/ClickHouse/pull/8225 rel="external nofollow noreferrer" target=_blank>#8225</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>In CI coverage task, kill the server gracefully to allow it to save the coverage report. This fixes incomplete coverage reports we've been seeing lately. <a href=https://github.com/ClickHouse/ClickHouse/pull/8142 rel="external nofollow noreferrer" target=_blank>#8142</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Performance tests for all codecs against <code class=syntax>Float64</code> and <code class=syntax>UInt64</code> values. <a href=https://github.com/ClickHouse/ClickHouse/pull/8349 rel="external nofollow noreferrer" target=_blank>#8349</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li><li><code class=syntax>termcap</code> is very much deprecated and lead to various problems (f.g. missing "up" cap and echoing <code class=syntax>^J</code> instead of multi line) . Favor <code class=syntax>terminfo</code> or bundled <code class=syntax>ncurses</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7737 rel="external nofollow noreferrer" target=_blank>#7737</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Fix <code class=syntax>test_storage_s3</code> integration test. <a href=https://github.com/ClickHouse/ClickHouse/pull/7734 rel="external nofollow noreferrer" target=_blank>#7734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Support <code class=syntax>StorageFile(&lt;format&gt;, null)</code> to insert block into given format file without actually write to disk. This is required for performance tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/8455 rel="external nofollow noreferrer" target=_blank>#8455</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li><li>Added argument <code class=syntax>--print-time</code> to functional tests which prints execution time per test. <a href=https://github.com/ClickHouse/ClickHouse/pull/8001 rel="external nofollow noreferrer" target=_blank>#8001</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Added asserts to <code class=syntax>KeyCondition</code> while evaluating RPN. This will fix warning from gcc-9. <a href=https://github.com/ClickHouse/ClickHouse/pull/8279 rel="external nofollow noreferrer" target=_blank>#8279</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Dump cmake options in CI builds. <a href=https://github.com/ClickHouse/ClickHouse/pull/8273 rel="external nofollow noreferrer" target=_blank>#8273</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Don't generate debug info for some fat libraries. <a href=https://github.com/ClickHouse/ClickHouse/pull/8271 rel="external nofollow noreferrer" target=_blank>#8271</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Make <code class=syntax>log_to_console.xml</code> always log to stderr, regardless of is it interactive or not. <a href=https://github.com/ClickHouse/ClickHouse/pull/8395 rel="external nofollow noreferrer" target=_blank>#8395</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li><li>Removed some unused features from <code class=syntax>clickhouse-performance-test</code> tool. <a href=https://github.com/ClickHouse/ClickHouse/pull/8555 rel="external nofollow noreferrer" target=_blank>#8555</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Now we will also search for <code class=syntax>lld-X</code> with corresponding <code class=syntax>clang-X</code> version. <a href=https://github.com/ClickHouse/ClickHouse/pull/8092 rel="external nofollow noreferrer" target=_blank>#8092</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li><li>Parquet build improvement. <a href=https://github.com/ClickHouse/ClickHouse/pull/8421 rel="external nofollow noreferrer" target=_blank>#8421</a> (<a href=https://github.com/maxulan rel="external nofollow noreferrer" target=_blank>maxulan</a>)</li><li>More GCC warnings <a href=https://github.com/ClickHouse/ClickHouse/pull/8221 rel="external nofollow noreferrer" target=_blank>#8221</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li><li>Package for Arch Linux now allows to run ClickHouse server, and not only client. <a href=https://github.com/ClickHouse/ClickHouse/pull/8534 rel="external nofollow noreferrer" target=_blank>#8534</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li><li>Fix test with processors. Tiny performance fixes. <a href=https://github.com/ClickHouse/ClickHouse/pull/7672 rel="external nofollow noreferrer" target=_blank>#7672</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li><li>Update contrib/protobuf. <a href=https://github.com/ClickHouse/ClickHouse/pull/8256 rel="external nofollow noreferrer" target=_blank>#8256</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>)</li><li>In preparation of switching to c++20 as a new year celebration. "May the C++ force be with ClickHouse." <a href=https://github.com/ClickHouse/ClickHouse/pull/8447 rel="external nofollow noreferrer" target=_blank>#8447</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li></ul><h4 id=experimental-feature_3>Experimental Feature<a class=headerlink href=../amp/#experimental-feature_3 title="Permanent link"> </a></h4><ul><li>Added experimental setting <code class=syntax>min_bytes_to_use_mmap_io</code>. It allows to read big files without copying data from kernel to userspace. The setting is disabled by default. Recommended threshold is about 64 MB, because mmap/munmap is slow. <a href=https://github.com/ClickHouse/ClickHouse/pull/8520 rel="external nofollow noreferrer" target=_blank>#8520</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li><li>Reworked quotas as a part of access control system. Added new table <code class=syntax>system.quotas</code>, new functions <code class=syntax>currentQuota</code>, <code class=syntax>currentQuotaKey</code>, new SQL syntax <code class=syntax>CREATE QUOTA</code>, <code class=syntax>ALTER QUOTA</code>, <code class=syntax>DROP QUOTA</code>, <code class=syntax>SHOW QUOTA</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7257 rel="external nofollow noreferrer" target=_blank>#7257</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Allow skipping unknown settings with warnings instead of throwing exceptions. <a href=https://github.com/ClickHouse/ClickHouse/pull/7653 rel="external nofollow noreferrer" target=_blank>#7653</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li><li>Reworked row policies as a part of access control system. Added new table <code class=syntax>system.row_policies</code>, new function <code class=syntax>currentRowPolicies()</code>, new SQL syntax <code class=syntax>CREATE POLICY</code>, <code class=syntax>ALTER POLICY</code>, <code class=syntax>DROP POLICY</code>, <code class=syntax>SHOW CREATE POLICY</code>, <code class=syntax>SHOW POLICIES</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7808 rel="external nofollow noreferrer" target=_blank>#7808</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li></ul><h4 id=security-fix>Security Fix<a class=headerlink href=../amp/#security-fix title="Permanent link"> </a></h4><ul><li>Fixed the possibility of reading directories structure in tables with <code class=syntax>File</code> table engine. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8536 rel="external nofollow noreferrer" target=_blank>#8536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8537 rel="external nofollow noreferrer" target=_blank>#8537</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li></ul><h2 id=changelog-for-2019><a href=https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2019.md rel="external nofollow noreferrer" target=_blank>Changelog for 2019</a><a class=headerlink href=../amp/#changelog-for-2019 title="Permanent link"> </a></h2>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">評価: RATING_VALUE - RATING_COUNT 投票</p>
  <span class="alert-heading display-6">記事の評価</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2020 Yandex LLC</div>
    <div>から構築 <a href="https://github.com/ClickHouse/ClickHouse/commit/782f2179ce4ad0b9a9c898a5f32557555b59e4d0" rel="external nofollow noreferrer" target="_blank" class="text-reset">782f2179ce</a>, 掲載され <span title="2020-04-03T16:23:32+03:00">2020-04-03</span>, に変更 <span title="2020-05-15T07:34:54+03:00">2020-05-15</span>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.tech/docs/ja/whats-new/changelog/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
